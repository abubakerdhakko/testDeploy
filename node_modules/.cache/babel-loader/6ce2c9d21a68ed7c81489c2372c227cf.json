{"remainingRequest":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/node_modules/babel-loader/lib/index.js!/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/node_modules/cache-loader/dist/cjs.js??ref--1-0!/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/src/views/assets/AssetDetails.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/src/views/assets/AssetDetails.vue","mtime":1661968702424},{"path":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/babel.config.js","mtime":1661968702388},{"path":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/node_modules/cache-loader/dist/cjs.js","mtime":1662622637759},{"path":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/node_modules/babel-loader/lib/index.js","mtime":1662622637719},{"path":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/node_modules/cache-loader/dist/cjs.js","mtime":1662622637759},{"path":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/node_modules/vue-loader/lib/index.js","mtime":1662622639723}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1leGNlcHRpb24uc3RhY2suanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5hdC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnNldC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzbmV4dC50eXBlZC1hcnJheS5maW5kLWxhc3QuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lc25leHQudHlwZWQtYXJyYXkuZmluZC1sYXN0LWluZGV4LmpzIjsKaW1wb3J0IFNpZGViYXIgZnJvbSAiLi9jb21wb25lbnRzL1NpZGViYXIiOwppbXBvcnQgQXNzZXRNYW5hZ2VtZW50U2VydmljZSBmcm9tICIuLy4uLy4uL3NlcnZpY2VzL0Fzc2V0TWFuYWdlbWVudFNlcnZpY2UiOwppbXBvcnQgV29ya09yZGVyU2VydmljZSBmcm9tICIuLy4uLy4uL3NlcnZpY2VzL1dvcmtPcmRlclNlcnZpY2UiOwppbXBvcnQgSW5zcGVjdGlvblNlcnZpY2UgZnJvbSAiLi8uLi8uLi9zZXJ2aWNlcy9JbnNwZWN0aW9uU2VydmljZSI7CmltcG9ydCBBc3NldFBlcnNvbm5lbFNlcnZpY2UgZnJvbSAiLi8uLi8uLi9zZXJ2aWNlcy9Bc3NldFBlcnNvbm5lbFNlcnZpY2UiOwppbXBvcnQgQXNzaWduVXNlclBvcFVwIGZyb20gIi4vY29tcG9uZW50cy9Bc3NpZ25Vc2VyUG9wVXAiOwppbXBvcnQgVW5Bc3NpZ25Vc2VyUG9wVXAgZnJvbSAiLi9jb21wb25lbnRzL1VuQXNzaWduVXNlclBvcFVwIjsKaW1wb3J0IENhdGVnb3JpZXNGaWVsZHMgZnJvbSAiLi9jb21wb25lbnRzL0NhdGVnb3JpZXNGaWVsZHMiOwppbXBvcnQgbW9tZW50IGZyb20gIm1vbWVudCI7CmltcG9ydCBBc3NpZ25tZW50IGZyb20gIi4vY29tcG9uZW50cy9Bc3NpZ25tZW50IjsKaW1wb3J0IFdvcmtPcmRlcnMgZnJvbSAiLi9jb21wb25lbnRzL1dvcmtPcmRlcnMiOwppbXBvcnQgSXNzdWVzIGZyb20gIi4vY29tcG9uZW50cy9Jc3N1ZXMiOwppbXBvcnQgQ29uc3VtcHRpb25zIGZyb20gIi4vY29tcG9uZW50cy9Db25zdW1wdGlvbnMiOwppbXBvcnQgVXNhZ2VzIGZyb20gIi4vY29tcG9uZW50cy9Vc2FnZXMiOwppbXBvcnQgQXNzZXRTdW1tYXJ5IGZyb20gIi4vY29tcG9uZW50cy9Bc3NldFN1bW1hcnkiOwppbXBvcnQgRGVsZXRlRGlhbG9nIGZyb20gIi4uLy4uL2NvbXBvbmVudHMvRGVsZXRlRGlhbG9nIjsKaW1wb3J0IGxvYWRlciBmcm9tICJAL2NvbXBvbmVudHMvTG9hZGVyLnZ1ZSI7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiQXNzZXREZXRhaWxzIiwKICBjb21wb25lbnRzOiB7CiAgICBTaWRlYmFyLAogICAgQXNzaWdubWVudCwKICAgIFdvcmtPcmRlcnMsCiAgICBJc3N1ZXMsCiAgICBDb25zdW1wdGlvbnMsCiAgICBVc2FnZXMsCiAgICBBc3NpZ25Vc2VyUG9wVXAsCiAgICBDYXRlZ29yaWVzRmllbGRzLAogICAgQXNzZXRTdW1tYXJ5LAogICAgVW5Bc3NpZ25Vc2VyUG9wVXAsCiAgICBEZWxldGVEaWFsb2csCiAgICBsb2FkZXIKICB9LAoKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgZGVsZXRlRGlhbG9nQXR0YWNobWVudDogZmFsc2UsCiAgICAgIGRlbGV0ZURpYWxvZzogZmFsc2UsCiAgICAgIHRvYXN0RmxhZzogMCwKICAgICAgdG9hc3RNZXNzYWdlOiAiIiwKICAgICAgdG9hc3RUeXBlOiAiIiwKICAgICAgV29ya09yZGVyTGlzdDoge30sCiAgICAgIGxvYWRlckZsYWc6IGZhbHNlLAogICAgICBpbmRleDogMCwKICAgICAga2V5SW5kZXg6IDAsCiAgICAgIHBvcHVwSW1hZ2U6ICIiLAogICAgICBpbWFnZVZvaWNlczogW10sCiAgICAgIGltYWdlRGlhbG9nOiBmYWxzZSwKICAgICAgYXNzZXRVdWlkOiAiIiwKICAgICAgcGFnZTogMCwKICAgICAgcm93c1BlclBhZ2U6IDUsCiAgICAgIGFzc2V0RGV0YWlsOiB7fSwKICAgICAgZmllbGRzOiBbXSwKICAgICAgYXNzZXRGaWVsZHM6IFtdLAogICAgICBhc3NldEltYWdlczogW10sCiAgICAgIGF0dGFjaG1lbnRzOiBbXSwKICAgICAgYXNzZXRzOiBbXSwKICAgICAgY29uc3VtcHRpb25zOiB7fSwKICAgICAgaXNzdWVzOiB7fSwKICAgICAgdXNhZ2VzOiB7fSwKICAgICAgVXNlcnM6IFtdLAogICAgICBhbGxVc2VyczogW10sCiAgICAgIFNob3dQb3BVcDogZmFsc2UsCiAgICAgIFNob3dVblBvcFVwOiBmYWxzZSwKICAgICAgYXNzaWduZWRVc2VyczogW10sCiAgICAgIGFzc2lnbm1lbnRIaXN0b3J5VXNlcnM6IFtdLAogICAgICBkaXNhYmxlRmllbGRzOiB0cnVlLAogICAgICB2YWx1ZUVkaXRBc3NpZ246IHt9LAogICAgICBjb3N0OiAiIiwKICAgICAgYXNzaWduVGFibGVWYWx1ZTogIiIsCiAgICAgIGltYWdlVm9pY2VzQ2hlY2s6IFtdLAogICAgICBjdXJyZW5jeTogIiIsCiAgICAgIGlzc3VlVGFibGU6IDAsCiAgICAgIGF0dGFjaG1lbnRJRDogIiIKICAgIH07CiAgfSwKCiAgcHJvcHM6IHt9LAogIG1ldGhvZHM6IHsKICAgIGRvd25sb2FkRmlsZShmaWxlVXJsLCBpbmRleCkgewogICAgICB0aGlzLmxvYWRlckZsYWcgPSB0cnVlOwogICAgICBBc3NldE1hbmFnZW1lbnRTZXJ2aWNlLmdldEZpbGUoZmlsZVVybCkudGhlbihyZXMgPT4gewogICAgICAgIGlmIChyZXMuZGF0YS5yZXNwb25zZUlkZW50aWZpZXIgPT09ICJTdWNjZXNzIikgewogICAgICAgICAgdGhpcy5kb3dubG9hZFBERihyZXMuZGF0YSwgaW5kZXgpOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgIH0pOwogICAgfSwKCiAgICBjbG9zZURpYWxvZygpIHsKICAgICAgdGhpcy5kZWxldGVEaWFsb2dBdHRhY2htZW50ID0gZmFsc2U7CiAgICB9LAoKICAgIGRvd25sb2FkUERGKHBkZiwgaW5kZXgpIHsKICAgICAgY29uc3QgbGlua1NvdXJjZSA9IGBkYXRhOmFwcGxpY2F0aW9uL3BkZjtiYXNlNjQsJHtwZGYuY29udGVudH1gOwogICAgICBjb25zdCBkb3dubG9hZExpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgIGxldCBmaWxlTmFtZSA9IG51bGw7CgogICAgICBmb3IgKGxldCBpbmRleDIgPSAwOyBpbmRleDIgPCB0aGlzLmF0dGFjaG1lbnRzLmxlbmd0aDsgaW5kZXgyKyspIHsKICAgICAgICBmaWxlTmFtZSA9IHRoaXMuYXR0YWNobWVudHNbaW5kZXhdLmZpbGVOYW1lLnNwbGl0KCItIikucG9wKCk7CiAgICAgIH0KCiAgICAgIGRvd25sb2FkTGluay5ocmVmID0gbGlua1NvdXJjZTsKICAgICAgZG93bmxvYWRMaW5rLmRvd25sb2FkID0gZmlsZU5hbWU7CiAgICAgIGRvd25sb2FkTGluay5jbGljaygpOwogICAgICB0aGlzLmxvYWRlckZsYWcgPSBmYWxzZTsKICAgIH0sCgogICAgZGlzcGxheU1lc3NhZ2UoKSB7CiAgICAgIHRoaXMuc2hvd1RvYXN0KCJJc3N1ZSBDcmVhdGVkIFN1Y2N1c3NmdWxseS4iLCAic3VjY2VzcyIpOwogICAgfSwKCiAgICBkZWxldGVBc3NldEF0dGFjaG1lbnQoaWQpIHsKICAgICAgdGhpcy5hdHRhY2htZW50SUQgPSBpZDsKICAgICAgdGhpcy5kZWxldGVEaWFsb2dBdHRhY2htZW50ID0gdHJ1ZTsKICAgIH0sCgogICAgZGVsZXRlQXR0YWNobWVudEZ1bigpIHsKICAgICAgQXNzZXRNYW5hZ2VtZW50U2VydmljZS5kZWxldGVBc3NldEF0dGFjaG1lbnQodGhpcy5hdHRhY2htZW50SUQpLnRoZW4ocmVzID0+IHsKICAgICAgICBpZiAocmVzLmRhdGEucmVzcG9uc2VDb2RlID09PSAiMjAwIikgewogICAgICAgICAgdGhpcy5jbG9zZSgpOwogICAgICAgICAgdGhpcy5Bc3NldHNEZXRhaWxzKCk7CiAgICAgICAgICB0aGlzLnNob3dUb2FzdChyZXMuZGF0YS5kZXNjcmlwdGlvbiwgInN1Y2Nlc3MiKTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGUgPT4gewogICAgICAgIHRoaXMuc2hvd1RvYXN0KGUucmVzcG9uc2UuZGVzY3JpcHRpb24sICJlcnJvciIpOwogICAgICB9KTsKICAgIH0sCgogICAgZXhwb3J0Q3N2KCkgewogICAgICB0aGlzLmxvYWRlckZsYWcgPSB0cnVlOwogICAgICBsZXQgcmVxdWVzdCA9IHsKICAgICAgICBhc3NldEV4Y2VsRGF0YTogdGhpcy5idWlsZEV4cG9ydERhdGFSZXF1ZXN0KCksCiAgICAgICAgYXNzaWdubWVudHM6IHRoaXMuYnVpbGRBc3NpZ25tZW50UmVxdWVzdCgpLAogICAgICAgIGFzc2lnbm1lbnRIaXN0b3JpZXM6IHRoaXMuYnVpbGRBc3NpZ25tZW50SGlzdG9yaWVzKCksCiAgICAgICAgaXNzdWVzOiB0aGlzLmJ1aWxkSXNzdWVzKCksCiAgICAgICAgd29ya09yZGVyczogdGhpcy5idWlsZFdvcmtPcmRlcnMoKSwKICAgICAgICBjb25zdW1wdGlvbnM6IHRoaXMuYnVpbGRDb25zdW1wdGlvbnMoKSwKICAgICAgICB1c2FnZXM6IHRoaXMuYnVpbGRVc2FnZXMoKQogICAgICB9OwogICAgICBBc3NldE1hbmFnZW1lbnRTZXJ2aWNlLmV4cG9ydEFzc2V0RGV0YWlscyhyZXF1ZXN0KS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgIHRoaXMubG9hZGVyRmxhZyA9IGZhbHNlOwogICAgICAgICAgdmFyIHNhbXBsZUFycmF5ID0gdGhpcy5iYXNlNjRUb0FycmF5QnVmZmVyKHJlc3BvbnNlLmRhdGEuZmlsZSk7CiAgICAgICAgICBsZXQgZmlsZVVybCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKG5ldyBCbG9iKFtzYW1wbGVBcnJheV0sIHsKICAgICAgICAgICAgdHlwZTogImFwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5zcHJlYWRzaGVldG1sLnNoZWV0IgogICAgICAgICAgfSkpOwogICAgICAgICAgdmFyIGZpbGVMaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwogICAgICAgICAgZmlsZUxpbmsuaHJlZiA9IGZpbGVVcmw7CiAgICAgICAgICBmaWxlTGluay5zZXRBdHRyaWJ1dGUoImRvd25sb2FkIiwgcmVzcG9uc2UuZGF0YS5maWxlTmFtZSk7CiAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGZpbGVMaW5rKTsKICAgICAgICAgIGZpbGVMaW5rLmNsaWNrKCk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgY29uc29sZS5sb2coZXJyb3IpOwogICAgICB9KTsKICAgIH0sCgogICAgYnVpbGRXb3JrT3JkZXJzKCkgewogICAgICBsZXQgd29ya09yZGVyc0RhdGEgPSBbXTsKICAgICAgdGhpcy5Xb3JrT3JkZXJMaXN0LndvcmtPcmRlcnMubWFwKHdvcmtPcmRlcnMgPT4gewogICAgICAgIHdvcmtPcmRlcnNEYXRhLnB1c2goewogICAgICAgICAgd29ya09yZGVyTnVtYmVyOiB3b3JrT3JkZXJzLndvcmtPcmRlck51bWJlciwKICAgICAgICAgIGFzc2V0TmFtZTogd29ya09yZGVycy5hc3NldE5hbWUsCiAgICAgICAgICBpc3N1ZXM6IHdvcmtPcmRlcnMuaXNzdWVDb3VudCwKICAgICAgICAgIGNyZWF0ZWRBdDogd29ya09yZGVycy5jcmVhdGVkQXQgIT09IG51bGwgPyBtb21lbnQod29ya09yZGVycy5jcmVhdGVkQXQpLnRvSVNPU3RyaW5nKCkgOiBudWxsLAogICAgICAgICAgcHJpb3JpdHk6IHdvcmtPcmRlcnMucHJpb3JpdHksCiAgICAgICAgICBhc3NpZ25lZFRvOiB3b3JrT3JkZXJzLmFzc2lnbmVkVG9Vc2VyTmFtZSwKICAgICAgICAgIHN0YXR1czogd29ya09yZGVycy5zdGF0dXMKICAgICAgICB9KTsKICAgICAgfSk7CiAgICAgIHJldHVybiB3b3JrT3JkZXJzRGF0YTsKICAgIH0sCgogICAgYnVpbGRVc2FnZXMoKSB7CiAgICAgIGxldCB1c2FnZXMgPSBbXTsKICAgICAgdGhpcy51c2FnZXMuY29udGVudC5tYXAodXNhZ2UgPT4gewogICAgICAgIHVzYWdlcy5wdXNoKHsKICAgICAgICAgIGRhdGU6IHVzYWdlLnByaW1hcnlVc2FnZVRpbWUgIT09IG51bGwgPyBtb21lbnQodXNhZ2UucHJpbWFyeVVzYWdlVGltZSkudG9JU09TdHJpbmcoKSA6IHVzYWdlLnNlY29uZGFyeVVzYWdlVGltZSAhPT0gbnVsbCA/IG1vbWVudCh1c2FnZS5zZWNvbmRhcnlVc2FnZVRpbWUpLnRvSVNPU3RyaW5nKCkgOiBudWxsLAogICAgICAgICAgdmFsdWU6IHVzYWdlLnByaW1hcnlVc2FnZVZhbHVlLAogICAgICAgICAgc2Vjb25kYXJ5VmFsdWU6IHVzYWdlLnNlY29uZGFyeVVzYWdlVmFsdWUKICAgICAgICB9KTsKICAgICAgfSk7CiAgICAgIHJldHVybiB1c2FnZXM7CiAgICB9LAoKICAgIGJ1aWxkQ29uc3VtcHRpb25zKCkgewogICAgICBsZXQgY29uc3VtcHRpb25zID0gW107CiAgICAgIHRoaXMuY29uc3VtcHRpb25zLmNvbnRlbnQubWFwKGNvbnN1bXB0aW9uID0+IHsKICAgICAgICBjb25zdW1wdGlvbnMucHVzaCh7CiAgICAgICAgICBkYXRlOiBjb25zdW1wdGlvbi5jcmVhdGVkQXQgIT09IG51bGwgPyBtb21lbnQoY29uc3VtcHRpb24uY3JlYXRlZEF0KS50b0lTT1N0cmluZygpIDogbnVsbCwKICAgICAgICAgIGNvbnN1bXB0aW9uVmFsdWU6IGNvbnN1bXB0aW9uLmNvbnN1bXB0aW9uVmFsdWUsCiAgICAgICAgICB1bml0OiB0aGlzLmFzc2V0RGV0YWlsLmNvbnN1bXB0aW9uVW5pdAogICAgICAgIH0pOwogICAgICB9KTsKICAgICAgcmV0dXJuIGNvbnN1bXB0aW9uczsKICAgIH0sCgogICAgYnVpbGRJc3N1ZXMoKSB7CiAgICAgIGxldCBpc3N1ZXMgPSBbXTsKICAgICAgdGhpcy5pc3N1ZXMuaXNzdWVzLm1hcChpc3N1ZSA9PiB7CiAgICAgICAgaXNzdWVzLnB1c2goewogICAgICAgICAgaXNzdWVOdW1iZXI6IGlzc3VlLmlzc3VlTnVtYmVyLAogICAgICAgICAgaXNzdWVOYW1lOiBpc3N1ZS5pc3N1ZU5hbWUsCiAgICAgICAgICBzdGF0dXM6IGlzc3VlLnN0YXR1cywKICAgICAgICAgIHdvcmtPcmRlck51bWJlcjogaXNzdWUud29ya09yZGVyTnVtYmVyLAogICAgICAgICAgcmVwb3J0ZWRCeTogaXNzdWUucmVwb3J0ZWRCeSwKICAgICAgICAgIHJlcG9ydGVkQXQ6IGlzc3VlLnJlcG9ydGVkQXQgIT0gbnVsbCA/IG1vbWVudChpc3N1ZS5yZXBvcnRlZEF0KS50b0lTT1N0cmluZygpIDogbnVsbAogICAgICAgIH0pOwogICAgICB9KTsKICAgICAgcmV0dXJuIGlzc3VlczsKICAgIH0sCgogICAgYnVpbGRBc3NpZ25tZW50SGlzdG9yaWVzKCkgewogICAgICBsZXQgYXNzaWdubWVudEhpc3RvcmllcyA9IFtdOwogICAgICB0aGlzLmFzc2lnbm1lbnRIaXN0b3J5VXNlcnMubWFwKHVzZXJzID0+IHsKICAgICAgICBhc3NpZ25tZW50SGlzdG9yaWVzLnB1c2goewogICAgICAgICAgbmFtZTogdXNlcnMubmFtZSwKICAgICAgICAgIGR1cmF0aW9uOiB1c2Vycy5kdXJhdGlvbnMsCiAgICAgICAgICBzdGFydERhdGU6IHVzZXJzLnVzZXJTdGFydERhdGVzWzBdICE9PSBudWxsID8gbW9tZW50KHVzZXJzLnVzZXJTdGFydERhdGVzWzBdKS50b0lTT1N0cmluZygpIDogbnVsbCwKICAgICAgICAgIGVuZERhdGU6IHVzZXJzLnVzZXJFbmRpbmdEYXRlc1swXSAhPT0gbnVsbCA/IG1vbWVudCh1c2Vycy51c2VyRW5kaW5nRGF0ZXNbMF0pLnRvSVNPU3RyaW5nKCkgOiBudWxsCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICByZXR1cm4gYXNzaWdubWVudEhpc3RvcmllczsKICAgIH0sCgogICAgYnVpbGRBc3NpZ25tZW50UmVxdWVzdCgpIHsKICAgICAgbGV0IGFzc2lnbm1lbnRzID0gW107CiAgICAgIHRoaXMuYXNzaWduZWRVc2Vycy5tYXAodXNlciA9PiB7CiAgICAgICAgYXNzaWdubWVudHMucHVzaCh7CiAgICAgICAgICBuYW1lOiB1c2VyLm5hbWUsCiAgICAgICAgICBzdGF0dXM6IHVzZXIuc3RhdHVzLAogICAgICAgICAgc3RhcnREYXRlOiB1c2VyLnN0YXJ0RGF0ZSAhPSBudWxsID8gbW9tZW50KHVzZXIuc3RhcnREYXRlKS50b0lTT1N0cmluZygpIDogbnVsbCwKICAgICAgICAgIGFzc2lnbmVkOiB1c2VyLmNvdW50CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICByZXR1cm4gYXNzaWdubWVudHM7CiAgICB9LAoKICAgIGJhc2U2NFRvQXJyYXlCdWZmZXIoYmFzZTY0KSB7CiAgICAgIHZhciBiaW5hcnlTdHJpbmcgPSB3aW5kb3cuYXRvYihiYXNlNjQpOwogICAgICB2YXIgYmluYXJ5TGVuID0gYmluYXJ5U3RyaW5nLmxlbmd0aDsKICAgICAgdmFyIGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoYmluYXJ5TGVuKTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYmluYXJ5TGVuOyBpKyspIHsKICAgICAgICB2YXIgYXNjaWkgPSBiaW5hcnlTdHJpbmcuY2hhckNvZGVBdChpKTsKICAgICAgICBieXRlc1tpXSA9IGFzY2lpOwogICAgICB9CgogICAgICByZXR1cm4gYnl0ZXM7CiAgICB9LAoKICAgIGJ1aWxkRXhwb3J0RGF0YVJlcXVlc3QoKSB7CiAgICAgIGxldCByZXF1ZXN0ID0gewogICAgICAgIG5hbWU6IHRoaXMuYXNzZXREZXRhaWwubmFtZSwKICAgICAgICBtb2RlbE51bWJlcjogdGhpcy5hc3NldERldGFpbC5tb2RlbE51bWJlciwKICAgICAgICBtYW51ZmFjdHVyZXI6IHRoaXMuYXNzZXREZXRhaWwubWFudWZhY3R1cmUsCiAgICAgICAgcHVyY2hhc2VEYXRlOiB0aGlzLmFzc2V0RGV0YWlsLnB1cmNoYXNlRGF0ZSAhPT0gbnVsbCAmJiB0aGlzLmFzc2V0RGV0YWlsLnB1cmNoYXNlRGF0ZSAhPT0gIiIgPyBtb21lbnQodGhpcy5hc3NldERldGFpbC5wdXJjaGFzZURhdGUpLnRvSVNPU3RyaW5nKCkgOiBudWxsLAogICAgICAgIHN0YXR1czogdGhpcy5hc3NldERldGFpbC5zdGF0dXMsCiAgICAgICAgd2FycmFudHk6IHRoaXMuYXNzZXREZXRhaWwud2FycmFudHksCiAgICAgICAgcHJpbWFyeVVzYWdlVW5pdDogdGhpcy5hc3NldERldGFpbC5wcmltYXJ5VXNhZ2VVbml0LAogICAgICAgIHNlY29uZGFyeVVzYWdlVW5pdDogdGhpcy5hc3NldERldGFpbC5zZWNvbmRhcnlVc2FnZVVuaXQsCiAgICAgICAgY29uc3VtcHRpb25Vbml0OiB0aGlzLmFzc2V0RGV0YWlsLmNvbnN1bXB0aW9uVW5pdCwKICAgICAgICBkZXNjcmlwdGlvbjogdGhpcy5hc3NldERldGFpbC5kZXNjcmlwdGlvbiwKICAgICAgICBjb3N0OiB0aGlzLmFzc2V0RGV0YWlsLmNvc3QsCiAgICAgICAgY3VycmVuY3k6IHRoaXMuY3VycmVuY3ksCiAgICAgICAgYWRkaXRpb25hbEZpZWxkczogW10KICAgICAgfTsgLy8gdGhpcy5maWVsZHMKCiAgICAgIHRoaXMuYXNzZXRGaWVsZHMubWFwKGZpZWxkID0+IHsKICAgICAgICBsZXQgbGFiZWwgPSB0aGlzLmZpZWxkcy5maW5kKGYgPT4gZi51dWlkID09PSBmaWVsZC5maWVsZElkKS5sYWJlbDsKICAgICAgICByZXF1ZXN0LmFkZGl0aW9uYWxGaWVsZHMucHVzaCh7CiAgICAgICAgICBmaWVsZExhYmVsOiBsYWJlbCAhPT0gdW5kZWZpbmVkICYmIGxhYmVsICE9PSBudWxsID8gbGFiZWwgOiAiIiwKICAgICAgICAgIGZpZWxkVmFsdWU6IEpTT04ucGFyc2UoZmllbGQuZmllbGRWYWx1ZSkudmFsdWVzWzBdCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICByZXR1cm4gcmVxdWVzdDsKICAgIH0sCgogICAgY2xvc2UoKSB7CiAgICAgIHRoaXMuU2hvd1BvcFVwID0gZmFsc2U7CiAgICAgIHRoaXMuaW1hZ2VEaWFsb2cgPSBmYWxzZTsKICAgICAgdGhpcy5TaG93VW5Qb3BVcCA9IGZhbHNlOwogICAgICB0aGlzLmRlbGV0ZURpYWxvZ0F0dGFjaG1lbnQgPSBmYWxzZTsKICAgIH0sCgogICAgb3BlblBvcFVwKCkgewogICAgICB0aGlzLlNob3dQb3BVcCA9IHRydWU7CiAgICB9LAoKICAgIG9uU2VsZWN0ZWQodmFsdWUpIHsKICAgICAgY29uc29sZS5sb2coInNlbGV0ZWQgdmFsdWUiLCB2YWx1ZSk7CiAgICB9LAoKICAgIGdldEN1cnJlbmN5KCkgewogICAgICBsZXQgY3VycmVudFVzZXJEZXRhaWxzID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiY3VycmVudFVzZXJEZXRhaWxzIikpOwogICAgICBBc3NldFBlcnNvbm5lbFNlcnZpY2UuZ2V0Q29tcGFueUN1cnJlbmN5KGN1cnJlbnRVc2VyRGV0YWlscy5wcm9maWxlLm9yZ2FuaXphdGlvbklkKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICB0aGlzLmN1cnJlbmN5ID0gcmVzcG9uc2UuZGF0YS5jdXJyZW5jeTsKICAgICAgICB0aGlzLmtleUluZGV4Kys7CiAgICAgIH0pOwogICAgfSwKCiAgICBpc3N1ZXNBY2NvcmRpb25GdW5jdGlvbih2YWwpIHsKICAgICAgaWYgKHRoaXMuJHJlZnMuaXNzdWVzQWNjb3JkaW9uLm9wZW5GbGFnID09PSB0cnVlKSB7CiAgICAgICAgdGhpcy4kcmVmcy53b3JrT3JkZXJzQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy5hc3NpZ25tZW50QWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy5jYXRlZ29yeUZpZWxkc0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIHRoaXMuJHJlZnMuY29uc3VtcHRpb25zQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy51c2FnZXNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLmF0dGFjaG1lbnRBY2NvcmRpb24ub3BlbkZsYWcgPT09IGZhbHNlOwogICAgICB9CiAgICB9LAoKICAgIHdvcmtPcmRlcnNBY2NvcmRpb25GdW5jdGlvbih2YWwpIHsKICAgICAgaWYgKHRoaXMuJHJlZnMud29ya09yZGVyc0FjY29yZGlvbi5vcGVuRmxhZyA9PT0gdHJ1ZSkgewogICAgICAgIHRoaXMuJHJlZnMuaXNzdWVzQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy5hc3NpZ25tZW50QWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy5jYXRlZ29yeUZpZWxkc0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIHRoaXMuJHJlZnMuY29uc3VtcHRpb25zQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy51c2FnZXNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLmF0dGFjaG1lbnRBY2NvcmRpb24ub3BlbkZsYWcgPT09IGZhbHNlOwogICAgICB9CiAgICB9LAoKICAgIGFzc2lnbm1lbnRBY2NvcmRpb25GdW5jdGlvbih2YWwpIHsKICAgICAgaWYgKHRoaXMuJHJlZnMuYXNzaWdubWVudEFjY29yZGlvbi5vcGVuRmxhZyA9PT0gdHJ1ZSkgewogICAgICAgIHRoaXMuJHJlZnMud29ya09yZGVyc0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIHRoaXMuJHJlZnMuaXNzdWVzQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy5jYXRlZ29yeUZpZWxkc0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIHRoaXMuJHJlZnMuY29uc3VtcHRpb25zQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy51c2FnZXNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLmF0dGFjaG1lbnRBY2NvcmRpb24ub3BlbkZsYWcgPT09IGZhbHNlOwogICAgICB9CiAgICB9LAoKICAgIGNhdGVnb3J5RmllbGRzQWNjb3JkaW9uRnVuY3Rpb24oKSB7CiAgICAgIGlmICh0aGlzLiRyZWZzLmNhdGVnb3J5RmllbGRzQWNjb3JkaW9uLm9wZW5GbGFnID09PSB0cnVlKSB7CiAgICAgICAgdGhpcy4kcmVmcy5hc3NpZ25tZW50QWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy53b3JrT3JkZXJzQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy5pc3N1ZXNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLmNvbnN1bXB0aW9uc0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIHRoaXMuJHJlZnMudXNhZ2VzQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy5hdHRhY2htZW50QWNjb3JkaW9uLm9wZW5GbGFnID09PSBmYWxzZTsKICAgICAgfQogICAgfSwKCiAgICBjb25zdW1wdGlvbnNBY2NvcmRpb25GdW5jdGlvbigpIHsKICAgICAgaWYgKHRoaXMuJHJlZnMuY29uc3VtcHRpb25zQWNjb3JkaW9uLm9wZW5GbGFnID09PSB0cnVlKSB7CiAgICAgICAgdGhpcy4kcmVmcy5jYXRlZ29yeUZpZWxkc0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIHRoaXMuJHJlZnMuYXNzaWdubWVudEFjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIHRoaXMuJHJlZnMud29ya09yZGVyc0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIHRoaXMuJHJlZnMuaXNzdWVzQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy51c2FnZXNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLmF0dGFjaG1lbnRBY2NvcmRpb24ub3BlbkZsYWcgPT09IGZhbHNlOwogICAgICB9CiAgICB9LAoKICAgIGF0dGFjaG1lbnRBY2NvcmRpb25GdW5jdGlvbigpIHsKICAgICAgaWYgKHRoaXMuJHJlZnMuYXR0YWNobWVudEFjY29yZGlvbi5vcGVuRmxhZyA9PT0gdHJ1ZSkgewogICAgICAgIHRoaXMuJHJlZnMuY2F0ZWdvcnlGaWVsZHNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLmFzc2lnbm1lbnRBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLndvcmtPcmRlcnNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLmlzc3Vlc0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIHRoaXMuJHJlZnMudXNhZ2VzQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy5jb25zdW1wdGlvbnNBY2NvcmRpb24ub3BlbkZsYWcgPT09IGZhbHNlOwoKICAgICAgICBpZiAodGhpcy5pbWFnZVZvaWNlc0NoZWNrLmxlbmd0aCA+IDApIHsKICAgICAgICAgIHRoaXMubG9hZGVyRmxhZyA9IHRydWU7CiAgICAgICAgICB0aGlzLmdldEFzc2V0SW1hZ2VzKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAoKICAgIGdldEFzc2V0UmVsYXRlZElzc3VlKCkgewogICAgICBJbnNwZWN0aW9uU2VydmljZS5nZXRQYWdpbmF0ZWRJc3N1ZXNCeUFzc2V0KHRoaXMuYXNzZXRVdWlkLCAiYW55IiwgdGhpcy5wYWdlLCB0aGlzLnJvd3NQZXJQYWdlKS50aGVuKHJlcyA9PiB7CiAgICAgICAgbGV0IGlzc3VlcyA9IHJlcy5kYXRhOwogICAgICAgIGxldCB1dWlkcyA9IFtdOwoKICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgaXNzdWVzLmlzc3Vlcy5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgIHV1aWRzLnB1c2goaXNzdWVzLmlzc3Vlc1tpbmRleF0uc3VibWl0dGVkQnlVc2VyVVVJRCk7CiAgICAgICAgfQoKICAgICAgICBBc3NldFBlcnNvbm5lbFNlcnZpY2UuZ2V0TmFtZU9mVXNlcnNCeVVVSURTKHsKICAgICAgICAgIHV1aWRzOiB1dWlkcwogICAgICAgIH0pLnRoZW4ocmVzcG9uc2UyID0+IHsKICAgICAgICAgIGxldCB1c2VycyA9IHJlc3BvbnNlMi5kYXRhLnVzZXJzOwogICAgICAgICAgdGhpcy5pc3N1ZXMuaXNzdWVzLm1hcChpc3N1ZSA9PiB7CiAgICAgICAgICAgIGlzc3VlLnJlcG9ydGVkQnkgPSB1c2Vyc1tpc3N1ZS5zdWJtaXR0ZWRCeVVzZXJVVUlEXS5uYW1lOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5pc3N1ZXMgPSBpc3N1ZXM7CiAgICAgIH0pLmNhdGNoKGUgPT4gewogICAgICAgIGNvbnNvbGUubG9nKCJlcnJvciIsIGUpOwogICAgICB9KTsKICAgIH0sCgogICAgZ2V0QXNzZXRXb3JrT3JkZXJzKCkgewogICAgICBXb3JrT3JkZXJTZXJ2aWNlLmdldFBhZ2luYXRlZFdvcmtPcmRlcnNCeUFzc2V0KHRoaXMucGFnZSwgdGhpcy5yb3dzUGVyUGFnZSwgdGhpcy5hc3NldFV1aWQpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgbGV0IGNvdW50T2ZUb3RhbFdvcmtPcmRlcnMgPSByZXNwb25zZS5kYXRhLndvcmtPcmRlcnMudG90YWxFbGVtZW50czsKICAgICAgICAgIGxldCB0b3RhbFBhZ2VzID0gcmVzcG9uc2UuZGF0YS53b3JrT3JkZXJzLnRvdGFsUGFnZXM7CiAgICAgICAgICBsZXQgd29ya09yZGVycyA9IHJlc3BvbnNlLmRhdGEud29ya09yZGVycy5jb250ZW50OwoKICAgICAgICAgIGlmICh3b3JrT3JkZXJzLmxlbmd0aCA9PT0gMCkgey8vdGhpcy5zZXRTdGF0ZSh7IGxvYWRpbmc6IGZhbHNlLCB3b3JrT3JkZXJzOiB3b3JrT3JkZXJzIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIGxldCBhc3NldHV1aWRzID0gW107CgogICAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHdvcmtPcmRlcnMubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICAgIGlmICh3b3JrT3JkZXJzW2luZGV4XS5wcmlvcml0eSA9PT0gbnVsbCkgewogICAgICAgICAgICAgIHdvcmtPcmRlcnNbaW5kZXhdLnByaW9yaXR5ID0gIk5vdCBBc3NpZ25lZCI7CiAgICAgICAgICAgIH0gLy9hZGQgdXVpZCBvZiBhc3NldCBpbiB0aGUgbGlzdCBpZiBpdCBkb2VzIG5vdCBleGlzdAoKCiAgICAgICAgICAgIGxldCBhc3NldHV1aWRBZGRlZCA9IGZhbHNlOwoKICAgICAgICAgICAgZm9yIChsZXQgYXNzZXR1dWlkc0luZGV4ID0gMDsgYXNzZXR1dWlkc0luZGV4IDwgYXNzZXR1dWlkcy5sZW5ndGg7IGFzc2V0dXVpZHNJbmRleCsrKSB7CiAgICAgICAgICAgICAgaWYgKGFzc2V0dXVpZHNbYXNzZXR1dWlkc0luZGV4XSA9PT0gd29ya09yZGVyc1tpbmRleF0uYXNzZXRVVUlEKSB7CiAgICAgICAgICAgICAgICBhc3NldHV1aWRBZGRlZCA9IHRydWU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghYXNzZXR1dWlkQWRkZWQpIHsKICAgICAgICAgICAgICBhc3NldHV1aWRzLnB1c2god29ya09yZGVyc1tpbmRleF0uYXNzZXRVVUlEKTsKICAgICAgICAgICAgfSAvL3NldHRpbmcgZGF0ZSB0byBzdHJpbmcgKEREIG1tTSBZWVlZIGhoOm1tIGFtL3BtKSBmb3JtdAogICAgICAgICAgICAvL3N0YXJ0CiAgICAgICAgICAgIC8vIGRlYnVnZ2VyOwoKCiAgICAgICAgICAgIHdvcmtPcmRlcnNbaW5kZXhdLmNyZWF0ZWRBdCA9IG1vbWVudCh3b3JrT3JkZXJzW2luZGV4XS5jcmVhdGVkQXQpLmZvcm1hdCgiREQgTU1NIFlZWVkgaGg6bW0gYSIpOyAvL2VuZAogICAgICAgICAgICAvL2NhbGN1bGF0ZSBpc3N1ZSBjb3VudCBvZiB3b3JrIG9yZGVyCgogICAgICAgICAgICBsZXQgaXNzdWVDb3VudCA9IHdvcmtPcmRlcnNbaW5kZXhdLmlzc3Vlcy5sZW5ndGg7CiAgICAgICAgICAgIHdvcmtPcmRlcnNbaW5kZXhdLmlzc3VlQ291bnQgPSBpc3N1ZUNvdW50OwogICAgICAgICAgfSAvL2dldCBiYXNpYyBpbmZvIG9mIGFzc2V0cyBmcm9tIGFzc2V0IG1hbmFnZW1lbnQgc2VydmljZSBsaWtlIG5hbWUgYW5kIGNhdGVnb3J5IG5hbWUgb2YgYXNzZXQKCgogICAgICAgICAgQXNzZXRNYW5hZ2VtZW50U2VydmljZS5nZXROYW1lQW5kVHlwZU9mQXNzZXRzQnlVVUlEUyh7CiAgICAgICAgICAgIHV1aWRzOiBhc3NldHV1aWRzCiAgICAgICAgICB9KS50aGVuKHJlc3BvbnNlMSA9PiB7CiAgICAgICAgICAgIC8vIGRlYnVnZ2VyOwogICAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgd29ya09yZGVycy5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgICAgICB3b3JrT3JkZXJzW2luZGV4XS5hc3NldE5hbWUgPSByZXNwb25zZTEuZGF0YS5hc3NldHNbd29ya09yZGVyc1tpbmRleF0uYXNzZXRVVUlEXS5uYW1lOwogICAgICAgICAgICAgIHdvcmtPcmRlcnNbaW5kZXhdLmFzc2V0Q2F0ZWdvcnkgPSByZXNwb25zZTEuZGF0YS5hc3NldHNbd29ya09yZGVyc1tpbmRleF0uYXNzZXRVVUlEXS50eXBlOwogICAgICAgICAgICAgIHdvcmtPcmRlcnNbaW5kZXhdLmFzc2V0TnVtYmVyID0gcmVzcG9uc2UxLmRhdGEuYXNzZXRzW3dvcmtPcmRlcnNbaW5kZXhdLmFzc2V0VVVJRF0uYXNzZXROdW1iZXI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuV29ya09yZGVyTGlzdC50b3RhbEVsZW1lbnRzID0gY291bnRPZlRvdGFsV29ya09yZGVyczsKICAgICAgICAgICAgdGhpcy5Xb3JrT3JkZXJMaXN0Lm51bWJlciA9IHJlc3BvbnNlLmRhdGEud29ya09yZGVycy5udW1iZXI7CiAgICAgICAgICAgIHRoaXMuV29ya09yZGVyTGlzdC50b3RhbFBhZ2VzID0gdG90YWxQYWdlczsKICAgICAgICAgICAgdGhpcy5Xb3JrT3JkZXJMaXN0LndvcmtPcmRlcnMgPSB3b3JrT3JkZXJzOwogICAgICAgICAgfSkuY2F0Y2goZXJyb3IgPT4gewogICAgICAgICAgICBpZiAoZXJyb3IucmVzcG9uc2Uuc3RhdHVzID09PSA0MDYpIHsKICAgICAgICAgICAgICB0aGlzLnNob3dUb2FzdCgiRXJyb3Igd2hpbGUgZ2V0dGluZyB3b3JrIG9yZGVycy4gUGxlYXNlIHRyeSBhZ2FpbiIsICJlcnJvciIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KCJFcnJvciB3aGlsZSBnZXR0aW5nIHdvcmsgb3JkZXJzLiBQbGVhc2UgdHJ5IGFnYWluIiwgImVycm9yIik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnNob3dUb2FzdCgiRXJyb3Igd2hpbGUgZ2V0dGluZyB3b3JrIG9yZGVycy4gUGxlYXNlIHRyeSBhZ2FpbiIsICJlcnJvciIpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAoKICAgIHVzYWdlc0FjY29yZGlvbkZ1bmN0aW9uKCkgewogICAgICBpZiAodGhpcy4kcmVmcy51c2FnZXNBY2NvcmRpb24ub3BlbkZsYWcgPT09IHRydWUpIHsKICAgICAgICB0aGlzLiRyZWZzLmNhdGVnb3J5RmllbGRzQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy5hc3NpZ25tZW50QWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy53b3JrT3JkZXJzQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy5pc3N1ZXNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLmNvbnN1bXB0aW9uc0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICB9CiAgICB9LAoKICAgIGdldEFzc2V0SW1hZ2VzKCkgewogICAgICBBc3NldE1hbmFnZW1lbnRTZXJ2aWNlLmdldEFzc2V0SW1hZ2VzQnlVdWlkKHRoaXMuYXNzZXRVdWlkKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICB0aGlzLmxvYWRlckZsYWcgPSBmYWxzZTsKCiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICB0aGlzLmltYWdlVm9pY2VzID0gcmVzcG9uc2UuZGF0YS5hc3NldEltYWdlczsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGVycm9yID0+IHsKICAgICAgICBjb25zb2xlLmxvZygiQW4gRXJyb3IgT2NjdXJyZWQgd2hpbGUgZ2V0dGluZyBBc3NldCBJbWFnZXMuIik7CiAgICAgIH0pOwogICAgfSwKCiAgICBBc3NldHNEZXRhaWxzKCkgewogICAgICBBc3NldE1hbmFnZW1lbnRTZXJ2aWNlLmdldEFzc2V0V2l0aERldGFpbHModGhpcy5hc3NldFV1aWQsIHRydWUsIHRydWUsIHRydWUsIHRydWUsIHRydWUsIGZhbHNlLCBmYWxzZSkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICB0aGlzLmxvYWRlckZsYWcgPSB0cnVlOwogICAgICAgICAgbGV0IHRlbXBBc3NldCA9IHJlc3BvbnNlLmRhdGEuYXNzZXREZXRhaWw7CiAgICAgICAgICB0aGlzLmFzc2V0RGV0YWlsID0gdGVtcEFzc2V0LmFzc2V0RGV0YWlsOwogICAgICAgICAgdGhpcy5hc3NldERldGFpbC5jb3N0ID0gdGhpcy5jb3N0OwogICAgICAgICAgdGhpcy5pbWFnZVZvaWNlc0NoZWNrID0gdGVtcEFzc2V0LmFzc2V0SW1hZ2U7CiAgICAgICAgICB0aGlzLmFzc2V0VXVpZCA9IHRlbXBBc3NldC5hc3NldERldGFpbC51dWlkOwogICAgICAgICAgbGV0IGFzc2V0ID0gdGVtcEFzc2V0LmFzc2V0RGV0YWlsOwogICAgICAgICAgYXNzZXQucHVyY2hhc2VEYXRlID0gbW9tZW50KGFzc2V0LnB1cmNoYXNlRGF0ZSkuZm9ybWF0KCJERCBNTU0gWVlZWSIpOwogICAgICAgICAgYXNzZXQuYWN0aXZpdHlXYWxsID0gdGVtcEFzc2V0LmFjdGl2aXR5V2FsbDsKICAgICAgICAgIGFzc2V0LmFzc2V0RmllbGRzID0gdGVtcEFzc2V0LmFzc2V0RmllbGQ7CiAgICAgICAgICBhc3NldC5hdHRhY2htZW50cyA9IHRlbXBBc3NldC5hdHRhY2htZW50OwogICAgICAgICAgYXNzZXQuZG9jdW1lbnRzID0gdGVtcEFzc2V0LmF0dGFjaG1lbnQ7CiAgICAgICAgICBhc3NldC5hc3NldEltYWdlcyA9IHRlbXBBc3NldC5hc3NldEltYWdlOwoKICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMTsgaW5kZXggPCBhc3NldC5hc3NldEltYWdlcy5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgICAgYXNzZXQuYXNzZXRJbWFnZXNbaW5kZXhdLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgYXNzZXQuYXNzZXRJbWFnZXNbaW5kZXhdLmltYWdlRmxhZyA9IHRydWU7CiAgICAgICAgICAgIGFzc2V0LmF0dGFjaG1lbnRzLnB1c2goYXNzZXQuYXNzZXRJbWFnZXNbaW5kZXhdKTsKICAgICAgICAgIH0KCiAgICAgICAgICBhc3NldC5jYXRlZ29yeSA9IHRlbXBBc3NldC5jYXRlZ29yeTsKICAgICAgICAgIGFzc2V0LmZpZWxkVGVtcGxhdGUgPSB0ZW1wQXNzZXQuY2F0ZWdvcnkgJiYgdGVtcEFzc2V0LmNhdGVnb3J5LmZpZWxkVGVtcGxhdGUgPyB0ZW1wQXNzZXQuY2F0ZWdvcnkuZmllbGRUZW1wbGF0ZSA6IG51bGw7CiAgICAgICAgICB0aGlzLmFzc2V0cyA9IGFzc2V0OwogICAgICAgICAgdGhpcy5yZW5kZXJJbWFnZSgpOwogICAgICAgICAgdGhpcy5hc3NldEltYWdlcyA9IGFzc2V0LmFzc2V0SW1hZ2VzOwogICAgICAgICAgdGhpcy5hdHRhY2htZW50cyA9IGFzc2V0LmF0dGFjaG1lbnRzOwogICAgICAgICAgdGhpcy5maWVsZHMgPSB0aGlzLmFzc2V0cy5maWVsZFRlbXBsYXRlLmZpZWxkczsKICAgICAgICAgIHRoaXMuYXNzZXRGaWVsZHMgPSB0aGlzLmFzc2V0cy5hc3NldEZpZWxkczsKICAgICAgICAgIHRoaXMubG9hZGVyRmxhZyA9IGZhbHNlOwogICAgICAgICAgZG9jdW1lbnQudGl0bGUgPSB0aGlzLmFzc2V0RGV0YWlsLmFzc2V0TnVtYmVyICsgIiB8ICIgKyAiRXJvaGFsIjsKICAgICAgICAgIHJlc3BvbnNlLmRhdGEuYXNzZXREZXRhaWwuYWN0aXZpdHlXYWxsLm1lc3NhZ2VzLm1hcChpdGVtID0+IHsKICAgICAgICAgICAgaXRlbS5maXJzdE5hbWUgPSBpdGVtLnVzZXJOYW1lOwogICAgICAgICAgICBpdGVtLmlkID0gaXRlbS51dWlkOwogICAgICAgICAgICBpdGVtLnJlcGxpZXMubWFwKHJlcGx5SXRlbSA9PiB7CiAgICAgICAgICAgICAgcmVwbHlJdGVtLmZpcnN0TmFtZSA9IHJlcGx5SXRlbS51c2VyTmFtZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGl0ZW0uYXR0YWNobWVudHMgPSAiIjsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAoKICAgIGZ1bGxzY3JlZW5JbWFnZSh2YWx1ZSkgewogICAgICB0aGlzLnBvcHVwSW1hZ2UgPSB2YWx1ZTsKICAgICAgdGhpcy5pbWFnZURpYWxvZyA9IHRydWU7CiAgICB9LAoKICAgIHJlbmRlckltYWdlKCkgewogICAgICBpZiAodGhpcy5hc3NldHMuYXNzZXRJbWFnZXMubGVuZ3RoICE9PSAwKSB7CiAgICAgICAgbGV0IGltYWdlVXJsID0gdGhpcy5hc3NldHMuYXNzZXRJbWFnZXNbMF0uaW1hZ2VVcmw7CiAgICAgICAgSW5zcGVjdGlvblNlcnZpY2UuZ2V0RmlsZShpbWFnZVVybCkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICBsZXQgaW1hZ2VDb250ZW50ID0gImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCwiICsgcmVzcG9uc2UuZGF0YS5jb250ZW50OwogICAgICAgICAgdGhpcy5wbGFjZWhvbGRlckltZyA9IGltYWdlQ29udGVudDsKICAgICAgICB9KS5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICBpZiAoZXJyb3IucmVzcG9uc2Uuc3RhdHVzID09PSA0MDYpIHsKICAgICAgICAgICAgdGhpcy5zaG93VG9hc3QoIkFuIHVuZXhwZWN0ZWQgRXJyb3IgT2NjdXJyZWQiLCAiZXJyb3IiKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KCJBbiB1bmV4cGVjdGVkIEVycm9yIE9jY3VycmVkIiwgImVycm9yIik7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7Ly8gdGhpcy5wbGFjZWhvbGRlckltZyA9cmVxdWlyZSgiLi4vLi4vYXNzZXRzL2ltYWdlcy9QbGFjZWhvbGRlci5wbmciKTsKICAgICAgfQogICAgfSwKCiAgICBnZXRQYWdpbmF0ZWRDb25zdW1wdGlvbnNCeUFzc2V0KCkgewogICAgICBBc3NldE1hbmFnZW1lbnRTZXJ2aWNlLmdldENvbnN1bXB0aW9uc0J5QXNzZXQodGhpcy5hc3NldFV1aWQsIHRoaXMucGFnZSwgdGhpcy5yb3dzUGVyUGFnZSkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgdGhpcy5jb25zdW1wdGlvbnMgPSByZXNwb25zZS5kYXRhLmNvbnN1bXB0aW9uczsKCiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICBsZXQgY29uc3VtcHRpb25zID0gcmVzcG9uc2UuZGF0YS5jb25zdW1wdGlvbnMuY29udGVudDsKCiAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgY29uc3VtcHRpb25zLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgICBjb25zdW1wdGlvbnNbaW5kZXhdLmNyZWF0ZWRBdCA9IG1vbWVudChjb25zdW1wdGlvbnNbaW5kZXhdLmNyZWF0ZWRBdCkuZm9ybWF0KCJERCBNTU0gWVlZWSBoaDptbSBhIik7CiAgICAgICAgICAgIGNvbnN1bXB0aW9uc1tpbmRleF0uY29uc3VtcHRpb25Vbml0ID0gdGhpcy5jb25zdW1wdGlvblVuaXQ7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KCJFcnJvciB3aGlsZSBnZXR0aW5nIGNvbnN1bXB0aW9ucyBvZiBhc3NldCIsICJlcnJvciIpOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZXJyb3IgPT4gewogICAgICAgIC8vICAgdGhpcy5zZXRTdGF0ZSh7IGxvYWRpbmc6IGZhbHNlIH0pOwogICAgICAgIGlmIChlcnJvci5yZXNwb25zZSAhPT0gdW5kZWZpbmVkICYmIGVycm9yLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA2KSB7CiAgICAgICAgICB0aGlzLnNob3dUb2FzdCgiRXJyb3Igd2hpbGUgZ2V0dGluZyBjb25zdW1wdGlvbnMgb2YgYXNzZXQiLCAiZXJyb3IiKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5zaG93VG9hc3QoIkVycm9yIHdoaWxlIGdldHRpbmcgY29uc3VtcHRpb25zIG9mIGFzc2V0IiwgImVycm9yIik7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCgogICAgZ2V0UGFnaW5hdGVkVXNhZ2VzQnlBc3NldCgpIHsKICAgICAgQXNzZXRNYW5hZ2VtZW50U2VydmljZS5nZXRVc2FnZXNCeUFzc2V0KHRoaXMuYXNzZXRVdWlkLCB0aGlzLnBhZ2UsIHRoaXMucm93c1BlclBhZ2UpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgIHRoaXMudXNhZ2VzID0gcmVzcG9uc2UuZGF0YS51c2FnZXM7CgogICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgbGV0IHVzYWdlcyA9IHJlc3BvbnNlLmRhdGEudXNhZ2VzLmNvbnRlbnQ7CgogICAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHVzYWdlcy5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgICAgdXNhZ2VzW2luZGV4XS5jcmVhdGVkQXQgPSBtb21lbnQodXNhZ2VzW2luZGV4XS5jcmVhdGVkQXQpLmZvcm1hdCgiREQgTU1NIFlZWVkgaGg6bW0gYSIpOwogICAgICAgICAgICB1c2FnZXNbaW5kZXhdLnByaW1hcnlVc2FnZVRpbWUgPSB1c2FnZXNbaW5kZXhdLnByaW1hcnlVc2FnZVRpbWUgIT09IG51bGwgPyBtb21lbnQodXNhZ2VzW2luZGV4XS5wcmltYXJ5VXNhZ2VUaW1lKS5mb3JtYXQoIkREIE1NTSBZWVlZIGhoOm1tIGEiKSA6IG51bGw7CiAgICAgICAgICAgIHVzYWdlc1tpbmRleF0uc2Vjb25kYXJ5VXNhZ2VUaW1lID0gdXNhZ2VzW2luZGV4XS5zZWNvbmRhcnlVc2FnZVRpbWUgIT09IG51bGwgPyBtb21lbnQodXNhZ2VzW2luZGV4XS5zZWNvbmRhcnlVc2FnZVRpbWUpLmZvcm1hdCgiREQgTU1NIFlZWVkgaGg6bW0gYSIpIDogbnVsbDsKICAgICAgICAgICAgdXNhZ2VzW2luZGV4XS5wcmltYXJ5VXNhZ2VVbml0ID0gdGhpcy5wcmltYXJ5VXNhZ2VVbml0OwogICAgICAgICAgICB1c2FnZXNbaW5kZXhdLnNlY29uZGFyeVVzYWdlVW5pdCA9IHRoaXMuc2Vjb25kYXJ5VXNhZ2VVbml0OwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuY291bnRPZlRvdGFsVXNhZ2VzID0gcmVzcG9uc2UuZGF0YS51c2FnZXMudG90YWxFbGVtZW50czsKICAgICAgICAgIHRoaXMuZGF0YSA9IHVzYWdlczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5zaG93VG9hc3QoIkVycm9yIHdoaWxlIGdldHRpbmcgdXNhZ2VzIG9mIGFzc2V0IiwgImVycm9yIik7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgaWYgKGVycm9yKSB7CiAgICAgICAgICB0aGlzLnNob3dUb2FzdCgiRXJyb3Igd2hpbGUgZ2V0dGluZyB1c2FnZXMgb2YgYXNzZXQiLCAiZXJyb3IiKTsKICAgICAgICB9IC8vICAgdGhpcy5zZXRTdGF0ZSh7IGxvYWRpbmc6IGZhbHNlIH0pOwoKICAgICAgfSk7CiAgICB9LAoKICAgIHVuQXNzaWduQXNzZXQoaW5kZXgsIHZhbHVlKSB7CiAgICAgIHRoaXMuYXNzaWduVGFibGVWYWx1ZSA9IHZhbHVlOwogICAgICB2YXIgY3VycmVudERhdGUgPSBtb21lbnQoKS5mb3JtYXQoKTsKCiAgICAgIGlmIChtb21lbnQodmFsdWUuc3RhcnREYXRlKS5mb3JtYXQoKSA+IGN1cnJlbnREYXRlKSB7CiAgICAgICAgdGhpcy5mdXR1cmVkVW5Bc3NpZ25tZW50KHZhbHVlLmFzc2lnbm1lbnRJZCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy52YWx1ZUVkaXRBc3NpZ24gPSB2YWx1ZTsKICAgICAgICB0aGlzLmluZGV4Kys7CiAgICAgICAgdGhpcy5TaG93VW5Qb3BVcCA9IHRydWU7CiAgICAgICAgdGhpcy51c2VySW5kZXggPSBpbmRleDsKICAgICAgfQogICAgfSwKCiAgICB1bkFzc2lnblVzZXIodmFsdWUpIHsKICAgICAgLy8JdGhpcy5sb2FkZXJGbGFnID0gdHJ1ZTsKICAgICAgdmFyIGN1cnJlbnREYXRlID0gbW9tZW50KCkuZm9ybWF0KCk7CiAgICAgIHZhciBzZWxlY3RlZERhdGUgPSBtb21lbnQodmFsdWUuYXNzaWdubWVudERhdGUpLmZvcm1hdCgiWVlZWS1NTS1ERFRISDpNTTpTU1oiKTsKICAgICAgdmFyIGRhdGVTcGxpdCA9IHNlbGVjdGVkRGF0ZS5zcGxpdCgiVCIpOwogICAgICB2YXIgb2JqRGF0ZSA9IGRhdGVTcGxpdFswXTsKICAgICAgdmFyIHRpbWVTcGxpdCA9IHZhbHVlLmFzc2lnbm1lbnRUaW1lLnNwbGl0KCI6Iik7CiAgICAgIHZhciBob3VyID0gdGltZVNwbGl0WzBdOwogICAgICB2YXIgbWluID0gdGltZVNwbGl0WzFdOwogICAgICB2YXIgYXNzaWdubWVudERhdGUgPSBvYmpEYXRlICsgIlQiICsgaG91ciArICI6IiArIG1pbiArICI6IiArICIwMCswNTowMCI7CgogICAgICBpZiAoRGF0ZS5wYXJzZSh0aGlzLmFzc2lnblRhYmxlVmFsdWUuc3RhcnREYXRlKSA+IERhdGUucGFyc2UoYXNzaWdubWVudERhdGUpKSB7CiAgICAgICAgdGhpcy5zaG93VG9hc3QoIlNlbGVjdCBEYXRlIGFuZCB0aW1lIGxhdGVyIHRvIGN1cnJlbnQgYXNzaWdubWVudCBkYXRlIGFuZCB0aW1lLiIsICJzdWNjZXNzIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodmFsdWUuY3VycmVudERhdGVUaW1lID09IHRydWUpIHsKICAgICAgICBsZXQgRGVsZXRlQXNzaWdubWVudFJlY29yZFJlcXVlc3QgPSB7CiAgICAgICAgICBhc3NldFVVSUQ6IHRoaXMuYXNzZXRVdWlkLAogICAgICAgICAgdXNlclVVSUQ6IHZhbHVlLnV1aWQsCiAgICAgICAgICBlbmRpbmdEYXRlOiBjdXJyZW50RGF0ZQogICAgICAgIH07CiAgICAgICAgQXNzZXRQZXJzb25uZWxTZXJ2aWNlLnVuYXNzaWduQXNzZXQoRGVsZXRlQXNzaWdubWVudFJlY29yZFJlcXVlc3QpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBsZXQgdXNlcnMgPSB0aGlzLmFzc2lnbmVkVXNlcnM7CiAgICAgICAgICBsZXQgaGlzdG9yeVVzZXJzID0gdGhpcy5hc3NpZ25tZW50SGlzdG9yeVVzZXJzOwogICAgICAgICAgbGV0IGhpc3RvcnlBZGRlZCA9IGZhbHNlOyAvL3JldHVybjsKICAgICAgICAgIC8vCXRoaXMuZGVsZXRlTW9kZWwgPSBmYWxzZTsKCiAgICAgICAgICBoaXN0b3J5VXNlcnMubWFwKGhpc3RvcnlJdGVtID0+IHsKICAgICAgICAgICAgaWYgKGhpc3RvcnlJdGVtLnV1aWQgPT09IHZhbHVlLnV1aWQpIHsKICAgICAgICAgICAgICBoaXN0b3J5SXRlbS51c2VyRW5kaW5nRGF0ZXM7CiAgICAgICAgICAgICAgaGlzdG9yeUl0ZW0udXNlclN0YXJ0RGF0ZXM7CiAgICAgICAgICAgICAgaGlzdG9yeUFkZGVkID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGhpc3RvcnlJdGVtOwogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKCFoaXN0b3J5QWRkZWQpIHsKICAgICAgICAgICAgbGV0IG5ld1VzZXIgPSB7CiAgICAgICAgICAgICAgdXVpZDogdmFsdWUudXVpZCwKICAgICAgICAgICAgICBuYW1lOiB1c2Vyc1t0aGlzLnVzZXJJbmRleF0ubmFtZSwKICAgICAgICAgICAgICBkdXJhdGlvbnM6IHVzZXJzW3RoaXMudXNlckluZGV4XS5kdXJhdGlvbnMsCiAgICAgICAgICAgICAgdXNlclN0YXJ0RGF0ZXM6IHVzZXJzW3RoaXMudXNlckluZGV4XS51c2VyU3RhcnREYXRlcywKICAgICAgICAgICAgICB1c2VyRW5kaW5nRGF0ZXM6IHVzZXJzW3RoaXMudXNlckluZGV4XS51c2VyRW5kaW5nRGF0ZXMKICAgICAgICAgICAgfTsgLy8gaGlzdG9yeVVzZXJzLnB1c2gobmV3VXNlcik7CiAgICAgICAgICB9CgogICAgICAgICAgdXNlcnMuc3BsaWNlKHRoaXMudXNlckluZGV4LCAxKTsKICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KCJVc2VyIFVuLUFzc2lnbmVkIFN1Y2Nlc3NmdWxseSIsICJzdWNjZXNzIik7CiAgICAgICAgICB0aGlzLmdldEFzc2lnbmVkVXNlcnNPZkFzc2V0KCk7CiAgICAgICAgICB0aGlzLmdldEFzc2lnbm1lbnRIaXN0b3J5QnlBc3NldCgpOwogICAgICAgICAgdGhpcy5TaG93VW5Qb3BVcCA9IGZhbHNlOwogICAgICAgICAgdGhpcy5sb2FkZXJGbGFnID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAodmFsdWUuY3VycmVudERhdGVUaW1lID09IGZhbHNlICYmIGN1cnJlbnREYXRlID4gbW9tZW50KHZhbHVlLmFzc2lnbm1lbnREYXRlKS5mb3JtYXQoKSkgewogICAgICAgIHNlbGVjdGVkRGF0ZSA9IG1vbWVudCh2YWx1ZS5hc3NpZ25tZW50RGF0ZSkuZm9ybWF0KCJZWVlZLU1NLUREVEhIOk1NOlNTWiIpOwogICAgICAgIGRhdGVTcGxpdCA9IHNlbGVjdGVkRGF0ZS5zcGxpdCgiVCIpOwogICAgICAgIG9iakRhdGUgPSBkYXRlU3BsaXRbMF07CiAgICAgICAgdGltZVNwbGl0ID0gdmFsdWUuYXNzaWdubWVudFRpbWUuc3BsaXQoIjoiKTsKICAgICAgICBob3VyID0gdGltZVNwbGl0WzBdOwogICAgICAgIG1pbiA9IHRpbWVTcGxpdFsxXTsKICAgICAgICBsZXQgYXNzaWdubWVudERhdGUgPSBvYmpEYXRlICsgIlQiICsgaG91ciArICI6IiArIG1pbiArICI6IiArICIwMCswNTowMCI7CiAgICAgICAgbGV0IERlbGV0ZUFzc2lnbm1lbnRSZWNvcmRSZXF1ZXN0ID0gewogICAgICAgICAgYXNzZXRVVUlEOiB0aGlzLmFzc2V0VXVpZCwKICAgICAgICAgIHVzZXJVVUlEOiB2YWx1ZS51dWlkLAogICAgICAgICAgZW5kaW5nRGF0ZTogbW9tZW50KGFzc2lnbm1lbnREYXRlKS5mb3JtYXQoKQogICAgICAgIH07CiAgICAgICAgQXNzZXRQZXJzb25uZWxTZXJ2aWNlLnVuYXNzaWduQXNzZXQoRGVsZXRlQXNzaWdubWVudFJlY29yZFJlcXVlc3QpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBsZXQgdXNlcnMgPSB0aGlzLmFzc2lnbmVkVXNlcnM7CiAgICAgICAgICBsZXQgaGlzdG9yeVVzZXJzID0gdGhpcy5hc3NpZ25tZW50SGlzdG9yeVVzZXJzOwogICAgICAgICAgbGV0IGhpc3RvcnlBZGRlZCA9IGZhbHNlOwogICAgICAgICAgaGlzdG9yeVVzZXJzLm1hcChoaXN0b3J5SXRlbSA9PiB7CiAgICAgICAgICAgIGlmIChoaXN0b3J5SXRlbS51dWlkID09PSB2YWx1ZS51dWlkKSB7CiAgICAgICAgICAgICAgaGlzdG9yeUl0ZW0udXNlckVuZGluZ0RhdGVzOwogICAgICAgICAgICAgIGhpc3RvcnlJdGVtLnVzZXJTdGFydERhdGVzOwogICAgICAgICAgICAgIGhpc3RvcnlBZGRlZCA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBoaXN0b3J5SXRlbTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmICghaGlzdG9yeUFkZGVkKSB7CiAgICAgICAgICAgIGxldCBuZXdVc2VyID0gewogICAgICAgICAgICAgIHV1aWQ6IHZhbHVlLnV1aWQsCiAgICAgICAgICAgICAgbmFtZTogdXNlcnNbdGhpcy51c2VySW5kZXhdLm5hbWUsCiAgICAgICAgICAgICAgZHVyYXRpb25zOiB1c2Vyc1t0aGlzLnVzZXJJbmRleF0uZHVyYXRpb25zLAogICAgICAgICAgICAgIHVzZXJTdGFydERhdGVzOiB1c2Vyc1t0aGlzLnVzZXJJbmRleF0udXNlclN0YXJ0RGF0ZXMsCiAgICAgICAgICAgICAgdXNlckVuZGluZ0RhdGVzOiB1c2Vyc1t0aGlzLnVzZXJJbmRleF0udXNlckVuZGluZ0RhdGVzCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGhpc3RvcnlVc2Vycy5wdXNoKG5ld1VzZXIpOwogICAgICAgICAgfQoKICAgICAgICAgIHVzZXJzLnNwbGljZSh0aGlzLnVzZXJJbmRleCwgMSk7CiAgICAgICAgICB0aGlzLnNob3dUb2FzdCgiVXNlciBVbi1Bc3NpZ25lZCBTdWNjZXNzZnVsbHkiLCAic3VjY2VzcyIpOwogICAgICAgICAgdGhpcy5nZXRBc3NpZ25lZFVzZXJzT2ZBc3NldCgpOwogICAgICAgICAgdGhpcy5nZXRBc3NpZ25tZW50SGlzdG9yeUJ5QXNzZXQoKTsKICAgICAgICAgIHRoaXMuU2hvd1VuUG9wVXAgPSBmYWxzZTsKICAgICAgICAgIHRoaXMubG9hZGVyRmxhZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgaWYgKGN1cnJlbnREYXRlIDwgbW9tZW50KHZhbHVlLmFzc2lnbm1lbnREYXRlKS5mb3JtYXQoKSAmJiB2YWx1ZS5jdXJyZW50RGF0ZVRpbWUgPT0gZmFsc2UpIHsKICAgICAgICBzZWxlY3RlZERhdGUgPSBtb21lbnQodmFsdWUuYXNzaWdubWVudERhdGUpLmZvcm1hdCgiWVlZWS1NTS1ERFRISDpNTTpTU1oiKTsKICAgICAgICBkYXRlU3BsaXQgPSBzZWxlY3RlZERhdGUuc3BsaXQoIlQiKTsKICAgICAgICBvYmpEYXRlID0gZGF0ZVNwbGl0WzBdOwogICAgICAgIHRpbWVTcGxpdCA9IHZhbHVlLmFzc2lnbm1lbnRUaW1lLnNwbGl0KCI6Iik7CiAgICAgICAgaG91ciA9IHRpbWVTcGxpdFswXTsKICAgICAgICBtaW4gPSB0aW1lU3BsaXRbMV07CiAgICAgICAgbGV0IGFzc2lnbm1lbnREYXRlID0gb2JqRGF0ZSArICJUIiArIGhvdXIgKyAiOiIgKyBtaW4gKyAiOiIgKyAiMDArMDU6MDAiOwogICAgICAgIHZhbHVlLnN0YXJ0RGF0ZSA9IGFzc2lnbm1lbnREYXRlOwogICAgICAgIHRoaXMudW5Bc3NpZ25tZW50VXNlckxhdGVyKHZhbHVlKTsKICAgICAgfQogICAgfSwKCiAgICB1bkFzc2lnbm1lbnRVc2VyTGF0ZXIodmFsdWUpIHsKICAgICAgdGhpcy5sb2FkZXJGbGFnID0gdHJ1ZTsKICAgICAgSW5zcGVjdGlvblNlcnZpY2UuZ2V0SW5zcGVjdGlvblRlbXBhbHRlc0J5QXNzZXQodGhpcy5hc3NldFV1aWQpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgbGV0IHBvc3RBc3NpZ25tZW50ID0gW107CiAgICAgICAgICBsZXQgb2JqID0gewogICAgICAgICAgICBhc3NpZ25tZW50VVVJRDogdmFsdWUuYXNzaWdubWVudFVVSUQsCiAgICAgICAgICAgIGFzc2V0SWQ6IHRoaXMuYXNzZXRVdWlkLAogICAgICAgICAgICB1c2VySWQ6IHZhbHVlLnV1aWQsCiAgICAgICAgICAgIGFzc2lnbjogZmFsc2UsCiAgICAgICAgICAgIGVuZERhdGU6IHZhbHVlLnN0YXJ0RGF0ZQogICAgICAgICAgfTsKICAgICAgICAgIHBvc3RBc3NpZ25tZW50LnB1c2gob2JqKTsKICAgICAgICAgIGxldCBVcGRhdGVBc3NldEFzc2lnbm1lbnRSZXF1ZXN0ID0ge307CiAgICAgICAgICBVcGRhdGVBc3NldEFzc2lnbm1lbnRSZXF1ZXN0Lmluc3BlY3Rpb25UZW1wbGF0ZXMgPSByZXNwb25zZS5kYXRhLmluc3BlY3Rpb25UZW1wbGF0ZXM7CiAgICAgICAgICBVcGRhdGVBc3NldEFzc2lnbm1lbnRSZXF1ZXN0LnBvc3RBc3NpZ25tZW50ID0gcG9zdEFzc2lnbm1lbnQ7CiAgICAgICAgICBBc3NldFBlcnNvbm5lbFNlcnZpY2UuYWRkUG9zdEFzc2lnbm1lbnRPclVuQXNzaWdubWVudChVcGRhdGVBc3NldEFzc2lnbm1lbnRSZXF1ZXN0KS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KHJlcy5kYXRhLmRlc2NyaXB0aW9uLCAic3VjY2VzcyIpOwogICAgICAgICAgICB0aGlzLlNob3dVblBvcFVwID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuZ2V0QXNzaWduZWRVc2Vyc09mQXNzZXQoKTsKICAgICAgICAgICAgdGhpcy5nZXRBc3NpZ25tZW50SGlzdG9yeUJ5QXNzZXQoKTsKICAgICAgICAgICAgdGhpcy5sb2FkZXJGbGFnID0gZmFsc2U7CiAgICAgICAgICB9KS5jYXRjaChlID0+IHsKICAgICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGUgPT4gewogICAgICAgIGNvbnNvbGUubG9nKCJlcnJvciIsIGUpOwogICAgICB9KTsKICAgIH0sCgogICAgYXNzaWduVXNlcih2YWx1ZSkgewogICAgICBpZiAodGhpcy52YWx1ZSAhPT0gbnVsbCkgewogICAgICAgIHZhciBzZWxlY3RlZERhdGUgPSBtb21lbnQodmFsdWUuYXNzaWdubWVudERhdGUpLmZvcm1hdCgiWVlZWS1NTS1ERFRISDpNTTpTU1oiKTsKICAgICAgICB2YXIgZGF0ZVNwbGl0ID0gc2VsZWN0ZWREYXRlLnNwbGl0KCJUIik7CiAgICAgICAgdmFyIG9iakRhdGUgPSBkYXRlU3BsaXRbMF07CiAgICAgICAgdmFyIHRpbWVTcGxpdCA9IHZhbHVlLmFzc2lnbm1lbnRUaW1lLnNwbGl0KCI6Iik7CiAgICAgICAgdmFyIGhvdXIgPSB0aW1lU3BsaXRbMF07CiAgICAgICAgdmFyIG1pbiA9IHRpbWVTcGxpdFsxXTsKICAgICAgICBsZXQgYXNzaWdubWVudERhdGUgPSBvYmpEYXRlICsgIlQiICsgaG91ciArICI6IiArIG1pbiArICI6IiArICIwMCswNTowMCI7IC8vbGV0IGRhdGUgPSBEYXRlKCk7CgogICAgICAgIHZhciBjdXJyZW50RGF0ZSA9IG1vbWVudCgpLmZvcm1hdCgpOwoKICAgICAgICBpZiAodmFsdWUuY3VycmVudERhdGVUaW1lID09IHRydWUpIHsKICAgICAgICAgIHZhbHVlLnN0YXJ0RGF0ZSA9IGFzc2lnbm1lbnREYXRlOwogICAgICAgICAgdGhpcy5hc3NpZ25tZW50VXNlckN1cnJlbnREYXRlKHZhbHVlKTsKICAgICAgICB9IGVsc2UgaWYgKGFzc2lnbm1lbnREYXRlID4gY3VycmVudERhdGUgJiYgdmFsdWUuY3VycmVudERhdGVUaW1lID09IGZhbHNlKSB7CiAgICAgICAgICB2YWx1ZS5zdGFydERhdGUgPSBhc3NpZ25tZW50RGF0ZTsKICAgICAgICAgIHRoaXMuYXNzaWdubWVudFVzZXJMYXRlcih2YWx1ZSk7CiAgICAgICAgfSBlbHNlIGlmIChhc3NpZ25tZW50RGF0ZSA8IGN1cnJlbnREYXRlKSB7CiAgICAgICAgICB2YWx1ZS5zdGFydERhdGUgPSBhc3NpZ25tZW50RGF0ZTsKICAgICAgICAgIHRoaXMucGFzdEFzc2lnbm1lbnRVc2VyQ3VycmVudERhdGUodmFsdWUpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICB1bmFzc2lnbkFzc2V0KGluZGV4LCBpZCkgewogICAgICB0aGlzLmxvYWRlckZsYWcgPSB0cnVlOwogICAgICB0aGlzLnVzZXJJbmRleCA9IGluZGV4OwogICAgICBBc3NldFBlcnNvbm5lbFNlcnZpY2UudW5hc3NpZ25Bc3NldCh0aGlzLmFzc2V0VXVpZCwgaWQpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgLy8gZGVidWdnZXI7CiAgICAgICAgICBsZXQgdXNlcnMgPSB0aGlzLmFzc2lnbmVkVXNlcnM7CiAgICAgICAgICBsZXQgaGlzdG9yeVVzZXJzID0gdGhpcy5hc3NpZ25tZW50SGlzdG9yeVVzZXJzOwogICAgICAgICAgbGV0IGhpc3RvcnlBZGRlZCA9IGZhbHNlOwogICAgICAgICAgaGlzdG9yeVVzZXJzLm1hcChoaXN0b3J5SXRlbSA9PiB7CiAgICAgICAgICAgIGlmIChoaXN0b3J5SXRlbS51dWlkID09PSBpZCkgewogICAgICAgICAgICAgIGhpc3RvcnlJdGVtLnVzZXJFbmRpbmdEYXRlcy5wdXNoKG1vbWVudCgpLmZvcm1hdCgiREQgTU1NIFlZWVkgaGg6bW0gYSIpKTsKICAgICAgICAgICAgICBoaXN0b3J5QWRkZWQgPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gaGlzdG9yeUl0ZW07CiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAoIWhpc3RvcnlBZGRlZCkgewogICAgICAgICAgICBsZXQgbmV3VXNlciA9IHsKICAgICAgICAgICAgICB1dWlkOiBpZCwKICAgICAgICAgICAgICBuYW1lOiB1c2Vyc1t0aGlzLnVzZXJJbmRleF0ubmFtZSwKICAgICAgICAgICAgICB1c2VyRW5kaW5nRGF0ZXM6IFttb21lbnQoKS5mb3JtYXQoIkREIE1NTSBZWVlZIGhoOm1tIGEiKV0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgaGlzdG9yeVVzZXJzLnB1c2gobmV3VXNlcik7CiAgICAgICAgICB9CgogICAgICAgICAgdXNlcnMuc3BsaWNlKHRoaXMudXNlckluZGV4LCAxKTsKICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KCJVc2VyIFVuLUFzc2lnbmVkIFN1Y2Nlc3NmdWxseSIsICJzdWNjZXNzIik7CiAgICAgICAgICB0aGlzLmxvYWRlckZsYWcgPSBmYWxzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5zaG93VG9hc3QoIkVycm9yIHdoaWxlIFVuLUFzc2lnbmluZyB0aGUgdXNlci4gUGxlYXNlIHRyeSBhZ2FpbiIsICJlcnJvciIpOyAvLyB0aGlzLnNuYWNrQmFyUmVmLmN1cnJlbnQuc2hvd1NuYWNrQmFyKCdFcnJvciB3aGlsZSBVbi1Bc3NpZ25pbmcgdGhlIHVzZXIuIFBsZWFzZSB0cnkgYWdhaW4nLCdlcnJvcicpOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZXJyb3IgPT4gewogICAgICAgIC8vICB0aGlzLnNldFN0YXRlKHsgbG9hZGluZzogZmFsc2V9KTsKICAgICAgICBpZiAoZXJyb3IucmVzcG9uc2Uuc3RhdHVzID09PSA0MDYpIHsKICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KCJFcnJvciB3aGlsZSBVbi1Bc3NpZ25pbmcgdGhlIHVzZXIuIFBsZWFzZSB0cnkgYWdhaW4iLCAiZXJyb3IiKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5zaG93VG9hc3QoIkVycm9yIHdoaWxlIFVuLUFzc2lnbmluZyB0aGUgdXNlci4gUGxlYXNlIHRyeSBhZ2FpbiIsICJlcnJvciIpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAoKICAgIHBhc3RBc3NpZ25tZW50VXNlckN1cnJlbnREYXRlKHZhbHVlKSB7CiAgICAgIHRoaXMubG9hZGVyRmxhZyA9IHRydWU7CiAgICAgIEluc3BlY3Rpb25TZXJ2aWNlLmdldEluc3BlY3Rpb25UZW1wYWx0ZXNCeUFzc2V0KHRoaXMuYXNzZXRVdWlkKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgIC8vCWRlYnVnZ2VyCiAgICAgICAgICBsZXQgYXNzaWdubWVudFJlY29yZCA9IFtdOwoKICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB2YWx1ZS51c2VyLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgICBjb25zdCB1c2VySWQgPSB2YWx1ZS51c2VyW2luZGV4XS51dWlkOwogICAgICAgICAgICBsZXQgb2JqID0gewogICAgICAgICAgICAgIGFzc2V0SWQ6IHRoaXMuYXNzZXRVdWlkLAogICAgICAgICAgICAgIGFzc2V0TWFuYWdlcklkOiB1c2VySWQsCiAgICAgICAgICAgICAgdHlwZTogIiIsCiAgICAgICAgICAgICAgc3RhcnRlZEF0OiB2YWx1ZS5zdGFydERhdGUKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYXNzaWdubWVudFJlY29yZC5wdXNoKG9iaik7CiAgICAgICAgICB9CgogICAgICAgICAgbGV0IGFkZEFzc2V0QXNzaWdubWVudFJlcXVlc3QgPSB7fTsKICAgICAgICAgIGFkZEFzc2V0QXNzaWdubWVudFJlcXVlc3QuaW5zcGVjdGlvblRlbXBsYXRlcyA9IHJlc3BvbnNlLmRhdGEuaW5zcGVjdGlvblRlbXBsYXRlczsKICAgICAgICAgIGFkZEFzc2V0QXNzaWdubWVudFJlcXVlc3QuYXNzaWdubWVudFJlY29yZCA9IGFzc2lnbm1lbnRSZWNvcmQ7IC8vCXJldHVybjsKCiAgICAgICAgICBBc3NldFBlcnNvbm5lbFNlcnZpY2UuYWRkQXNzaWdubWVudFJlY29yZChhZGRBc3NldEFzc2lnbm1lbnRSZXF1ZXN0KS50aGVuKHJlc3BvbnNlMSA9PiB7CiAgICAgICAgICAgIGlmIChyZXNwb25zZTEuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgICAgICB0aGlzLnNlbmROb3RpZmljYXRpb25Ub0Fzc2lnbmVkVXNlck9mQXNzZXRzKGFkZEFzc2V0QXNzaWdubWVudFJlcXVlc3QpOwogICAgICAgICAgICAgIGxldCB1c2VyZGV0YWlsID0gW107CiAgICAgICAgICAgICAgQXNzZXRQZXJzb25uZWxTZXJ2aWNlLmdldFVzZXJEZXRhaWxCeUFzc2V0SWRBbmRVc2VySWQodGhpcy5hc3NldFV1aWQsIHZhbHVlLnZhbHVlKS50aGVuKHJlc3BvbnNlMiA9PiB7CiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UyLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgIHVzZXJkZXRhaWwudXVpZCA9IHZhbHVlLnZhbHVlOwogICAgICAgICAgICAgICAgICB1c2VyZGV0YWlsLm5hbWUgPSB2YWx1ZS5kaXNwbGF5OwogICAgICAgICAgICAgICAgICB1c2VyZGV0YWlsLnN0YXJ0RGF0ZSA9IHJlc3BvbnNlMi5kYXRhLnVzZXIuc3RhcnREYXRlOwogICAgICAgICAgICAgICAgICB1c2VyZGV0YWlsLmNvdW50ID0gcmVzcG9uc2UyLmRhdGEudXNlci5jb3VudDsKICAgICAgICAgICAgICAgICAgdGhpcy5hc3NpZ25lZFVzZXJzLnB1c2godXNlcmRldGFpbCk7CiAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KCJBc3NldCBBc3NpZ25lZCB0byB1c2VyIFN1Y2Nlc3NmdWxseSIsICJzdWNjZXNzIik7CiAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0QXNzaWduZWRVc2Vyc09mQXNzZXQoKTsKICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkZXJGbGFnID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIHRoaXMuU2hvd1BvcFVwID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB0aGlzLnNob3dUb2FzdCgiRXJyb3Igd2hpbGUgYXNzaWduaW5nIHVzZXIgdG8gdGhlIGFzc2V0IiwgImVycm9yIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSkuY2F0Y2goZXJyb3IyID0+IHsKICAgICAgICAgICAgICAgIC8vICAgdGhpcy5zZXRTdGF0ZSh7bG9hZGluZzpmYWxzZX0pOwogICAgICAgICAgICAgICAgaWYgKGVycm9yMi5yZXNwb25zZS5zdGF0dXMgPT09IDQwNikgewogICAgICAgICAgICAgICAgICB0aGlzLnNob3dUb2FzdCgiRXJyb3Igd2hpbGUgYXNzaWduaW5nIHVzZXIgdG8gdGhlIGFzc2V0IiwgImVycm9yIik7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB0aGlzLnNob3dUb2FzdCgiRXJyb3Igd2hpbGUgYXNzaWduaW5nIHVzZXIgdG8gdGhlIGFzc2V0IiwgImVycm9yIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLmNhdGNoKGVycm9yMSA9PiB7CiAgICAgICAgICAgIC8vIHRoaXMuc2V0U3RhdGUoe2xvYWRpbmc6ZmFsc2V9KTsKICAgICAgICAgICAgaWYgKGVycm9yMS5yZXNwb25zZS5zdGF0dXMgPT09IDQwNikgewogICAgICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KCJFcnJvciB3aGlsZSBhc3NpZ25pbmcgdXNlciB0byB0aGUgYXNzZXQiLCAiZXJyb3IiKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLnNob3dUb2FzdCgiRXJyb3Igd2hpbGUgYXNzaWduaW5nIHVzZXIgdG8gdGhlIGFzc2V0IiwgImVycm9yIik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZXJyb3IgPT4gewogICAgICAgIGlmIChlcnJvcikgewogICAgICAgICAgdGhpcy5zaG93VG9hc3QoIkVycm9yIHdoaWxlIGFzc2lnbmluZyB1c2VyIHRvIHRoZSBhc3NldCIsICJlcnJvciIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnNob3dUb2FzdCgiRXJyb3Igd2hpbGUgYXNzaWduaW5nIHVzZXIgdG8gdGhlIGFzc2V0IiwgImVycm9yIik7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCgogICAgc2VuZE5vdGlmaWNhdGlvblRvQXNzaWduZWRVc2VyT2ZBc3NldHMoYWRkQXNzZXRBc3NpZ25tZW50UmVxdWVzdCkgewogICAgICBBc3NldFBlcnNvbm5lbFNlcnZpY2Uuc2VuZE5vdGlmaWNhdGlvblRvQXNzaWduZWRVc2VycyhhZGRBc3NldEFzc2lnbm1lbnRSZXF1ZXN0KS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGVycm9yID0+IHsKICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7CiAgICAgIH0pOwogICAgfSwKCiAgICBhc3NpZ25tZW50VXNlckN1cnJlbnREYXRlKHZhbHVlKSB7CiAgICAgIHRoaXMubG9hZGVyRmxhZyA9IHRydWU7CiAgICAgIEluc3BlY3Rpb25TZXJ2aWNlLmdldEluc3BlY3Rpb25UZW1wYWx0ZXNCeUFzc2V0KHRoaXMuYXNzZXRVdWlkKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICB2YXIgY3VycmVudERhdGUgPSBtb21lbnQoKS5mb3JtYXQoKTsKCiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAvLwlkZWJ1Z2dlcgogICAgICAgICAgbGV0IGFzc2lnbm1lbnRSZWNvcmQgPSBbXTsKCiAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdmFsdWUudXNlci5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgICAgY29uc3QgdXNlcklkID0gdmFsdWUudXNlcltpbmRleF0udXVpZDsKICAgICAgICAgICAgbGV0IG9iaiA9IHsKICAgICAgICAgICAgICBhc3NldElkOiB0aGlzLmFzc2V0VXVpZCwKICAgICAgICAgICAgICBhc3NldE1hbmFnZXJJZDogdXNlcklkLAogICAgICAgICAgICAgIHR5cGU6ICIiLAogICAgICAgICAgICAgIHN0YXJ0ZWRBdDogY3VycmVudERhdGUKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYXNzaWdubWVudFJlY29yZC5wdXNoKG9iaik7CiAgICAgICAgICB9CgogICAgICAgICAgbGV0IGFkZEFzc2V0QXNzaWdubWVudFJlcXVlc3QgPSB7fTsKICAgICAgICAgIGFkZEFzc2V0QXNzaWdubWVudFJlcXVlc3QuaW5zcGVjdGlvblRlbXBsYXRlcyA9IHJlc3BvbnNlLmRhdGEuaW5zcGVjdGlvblRlbXBsYXRlczsKICAgICAgICAgIGFkZEFzc2V0QXNzaWdubWVudFJlcXVlc3QuYXNzaWdubWVudFJlY29yZCA9IGFzc2lnbm1lbnRSZWNvcmQ7IC8vcmV0dXJuOwoKICAgICAgICAgIEFzc2V0UGVyc29ubmVsU2VydmljZS5hZGRBc3NpZ25tZW50UmVjb3JkKGFkZEFzc2V0QXNzaWdubWVudFJlcXVlc3QpLnRoZW4ocmVzcG9uc2UxID0+IHsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlMS5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgICAgIHRoaXMuc2VuZE5vdGlmaWNhdGlvblRvQXNzaWduZWRVc2VyT2ZBc3NldHMoYWRkQXNzZXRBc3NpZ25tZW50UmVxdWVzdCk7CiAgICAgICAgICAgICAgbGV0IHVzZXJkZXRhaWwgPSBbXTsKICAgICAgICAgICAgICBBc3NldFBlcnNvbm5lbFNlcnZpY2UuZ2V0VXNlckRldGFpbEJ5QXNzZXRJZEFuZFVzZXJJZCh0aGlzLmFzc2V0VXVpZCwgdmFsdWUudmFsdWUpLnRoZW4ocmVzcG9uc2UyID0+IHsKICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZTIuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgdXNlcmRldGFpbC51dWlkID0gdmFsdWUudmFsdWU7CiAgICAgICAgICAgICAgICAgIHVzZXJkZXRhaWwubmFtZSA9IHZhbHVlLmRpc3BsYXk7CiAgICAgICAgICAgICAgICAgIHVzZXJkZXRhaWwuc3RhcnREYXRlID0gcmVzcG9uc2UyLmRhdGEudXNlci5zdGFydERhdGU7CiAgICAgICAgICAgICAgICAgIHVzZXJkZXRhaWwuY291bnQgPSByZXNwb25zZTIuZGF0YS51c2VyLmNvdW50OwogICAgICAgICAgICAgICAgICB0aGlzLmFzc2lnbmVkVXNlcnMucHVzaCh1c2VyZGV0YWlsKTsKICAgICAgICAgICAgICAgICAgdGhpcy5zaG93VG9hc3QoIkFzc2V0IEFzc2lnbmVkIHRvIHVzZXIgU3VjY2Vzc2Z1bGx5IiwgInN1Y2Nlc3MiKTsKICAgICAgICAgICAgICAgICAgdGhpcy5nZXRBc3NpZ25lZFVzZXJzT2ZBc3NldCgpOwogICAgICAgICAgICAgICAgICB0aGlzLlNob3dQb3BVcCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICB0aGlzLmxvYWRlckZsYWcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KCJFcnJvciB3aGlsZSBhc3NpZ25pbmcgdXNlciB0byB0aGUgYXNzZXQiLCAiZXJyb3IiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KS5jYXRjaChlcnJvcjIgPT4gewogICAgICAgICAgICAgICAgLy8gICB0aGlzLnNldFN0YXRlKHtsb2FkaW5nOmZhbHNlfSk7CiAgICAgICAgICAgICAgICBpZiAoZXJyb3IyLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA2KSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KCJFcnJvciB3aGlsZSBhc3NpZ25pbmcgdXNlciB0byB0aGUgYXNzZXQiLCAiZXJyb3IiKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KCJFcnJvciB3aGlsZSBhc3NpZ25pbmcgdXNlciB0byB0aGUgYXNzZXQiLCAiZXJyb3IiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZXJyb3IxID0+IHsKICAgICAgICAgICAgLy8gdGhpcy5zZXRTdGF0ZSh7bG9hZGluZzpmYWxzZX0pOwogICAgICAgICAgICBpZiAoZXJyb3IxLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA2KSB7CiAgICAgICAgICAgICAgdGhpcy5zaG93VG9hc3QoIkVycm9yIHdoaWxlIGFzc2lnbmluZyB1c2VyIHRvIHRoZSBhc3NldCIsICJlcnJvciIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KCJFcnJvciB3aGlsZSBhc3NpZ25pbmcgdXNlciB0byB0aGUgYXNzZXQiLCAiZXJyb3IiKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgaWYgKGVycm9yKSB7CiAgICAgICAgICB0aGlzLnNob3dUb2FzdCgiRXJyb3Igd2hpbGUgYXNzaWduaW5nIHVzZXIgdG8gdGhlIGFzc2V0IiwgImVycm9yIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KCJFcnJvciB3aGlsZSBhc3NpZ25pbmcgdXNlciB0byB0aGUgYXNzZXQiLCAiZXJyb3IiKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICBhc3NpZ25tZW50VXNlckxhdGVyKHZhbHVlKSB7CiAgICAgIHRoaXMubG9hZGVyRmxhZyA9IHRydWU7CiAgICAgIEluc3BlY3Rpb25TZXJ2aWNlLmdldEluc3BlY3Rpb25UZW1wYWx0ZXNCeUFzc2V0KHRoaXMuYXNzZXRVdWlkKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgIGxldCBwb3N0QXNzaWdubWVudCA9IFtdOwoKICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB2YWx1ZS51c2VyLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgICBjb25zdCB1c2VySWQgPSB2YWx1ZS51c2VyW2luZGV4XS51dWlkOwogICAgICAgICAgICBsZXQgb2JqID0gewogICAgICAgICAgICAgIGFzc2lnbm1lbnRVVUlEOiAiIiwKICAgICAgICAgICAgICBhc3NldElkOiB0aGlzLmFzc2V0VXVpZCwKICAgICAgICAgICAgICB1c2VySWQ6IHVzZXJJZCwKICAgICAgICAgICAgICBhc3NpZ246IHRydWUsCiAgICAgICAgICAgICAgc3RhcnREYXRlOiB2YWx1ZS5zdGFydERhdGUKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcG9zdEFzc2lnbm1lbnQucHVzaChvYmopOwogICAgICAgICAgfQoKICAgICAgICAgIGxldCBVcGRhdGVBc3NldEFzc2lnbm1lbnRSZXF1ZXN0ID0ge307CiAgICAgICAgICBVcGRhdGVBc3NldEFzc2lnbm1lbnRSZXF1ZXN0Lmluc3BlY3Rpb25UZW1wbGF0ZXMgPSByZXNwb25zZS5kYXRhLmluc3BlY3Rpb25UZW1wbGF0ZXM7CiAgICAgICAgICBVcGRhdGVBc3NldEFzc2lnbm1lbnRSZXF1ZXN0LnBvc3RBc3NpZ25tZW50ID0gcG9zdEFzc2lnbm1lbnQ7IC8vCXJldHVybjsKCiAgICAgICAgICBBc3NldFBlcnNvbm5lbFNlcnZpY2UuYWRkUG9zdEFzc2lnbm1lbnRPclVuQXNzaWdubWVudChVcGRhdGVBc3NldEFzc2lnbm1lbnRSZXF1ZXN0KS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KHJlcy5kYXRhLmRlc2NyaXB0aW9uLCAic3VjY2VzcyIpOwogICAgICAgICAgICB0aGlzLlNob3dQb3BVcCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmxvYWRlckZsYWcgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5nZXRBc3NpZ25lZFVzZXJzT2ZBc3NldCgpOwogICAgICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChlID0+IHsKICAgICAgICBjb25zb2xlLmxvZygiZXJyb3IiLCBlKTsKICAgICAgfSk7CiAgICB9LAoKICAgIHVwZGF0ZUFzc2lnblVzZXIodmFsdWUpIHsKICAgICAgdGhpcy5sb2FkZXJGbGFnID0gdHJ1ZTsKICAgICAgdmFyIHNlbGVjdGVkRGF0ZSA9IG1vbWVudCh2YWx1ZS5hc3NpZ25tZW50RGF0ZSkuZm9ybWF0KCJZWVlZLU1NLUREVEhIOk1NOlNTWiIpOwogICAgICB2YXIgZGF0ZVNwbGl0ID0gc2VsZWN0ZWREYXRlLnNwbGl0KCJUIik7CiAgICAgIHZhciBvYmpEYXRlID0gZGF0ZVNwbGl0WzBdOwogICAgICB2YXIgdGltZVNwbGl0ID0gdmFsdWUuYXNzaWdubWVudFRpbWUuc3BsaXQoIjoiKTsKICAgICAgdmFyIGhvdXIgPSB0aW1lU3BsaXRbMF07CiAgICAgIHZhciBtaW4gPSB0aW1lU3BsaXRbMV07CiAgICAgIGxldCBhc3NpZ25tZW50RGF0ZSA9IG9iakRhdGUgKyAiVCIgKyBob3VyICsgIjoiICsgbWluICsgIjoiICsgIjAwKzA1OjAwIjsKICAgICAgdmFsdWUuc3RhcnREYXRlID0gYXNzaWdubWVudERhdGU7CiAgICAgIHRoaXMudXBkYXRlQ3VycmVudEFzc2lnbm1lbnQodmFsdWUpOwogICAgfSwKCiAgICB1cGRhdGVDdXJyZW50QXNzaWdubWVudCh2YWx1ZSkgewogICAgICBpZiAodmFsdWUudXNlci5sZW5ndGggPiAxKSB7CiAgICAgICAgdGhpcy5zaG93VG9hc3QoIlNlbGVjdCBvbmx5IG9uZSB1c2VyIiwgImVycm9yIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBJbnNwZWN0aW9uU2VydmljZS5nZXRJbnNwZWN0aW9uVGVtcGFsdGVzQnlBc3NldCh0aGlzLmFzc2V0VXVpZCkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PSAyMDApIHsKICAgICAgICAgIGxldCBVcGRhdGVBc3NldEFzc2lnbm1lbnRSZXF1ZXN0ID0gewogICAgICAgICAgICBhc3NpZ25tZW50SWQ6IHZhbHVlLmFzc2lnbm1lbnRJZCwKICAgICAgICAgICAgYXNzZXRJZDogdGhpcy5hc3NldFV1aWQsCiAgICAgICAgICAgIHVzZXJJZDogdmFsdWUudXNlclswXS51dWlkCiAgICAgICAgICB9OyAvL2xldCBkYXRlID0gRGF0ZSgpOwoKICAgICAgICAgIHZhciBjdXJyZW50RGF0ZSA9IG1vbWVudCgpLmZvcm1hdCgpOwoKICAgICAgICAgIGlmICh2YWx1ZS5jdXJyZW50RGF0ZVRpbWUgPT0gdHJ1ZSkgewogICAgICAgICAgICBVcGRhdGVBc3NldEFzc2lnbm1lbnRSZXF1ZXN0LnN0YXJ0RGF0ZSA9IGN1cnJlbnREYXRlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgVXBkYXRlQXNzZXRBc3NpZ25tZW50UmVxdWVzdC5zdGFydERhdGUgPSB2YWx1ZS5zdGFydERhdGU7CiAgICAgICAgICB9CgogICAgICAgICAgQXNzZXRQZXJzb25uZWxTZXJ2aWNlLmVkaXRBc3NpZ25tZW50UmVjb3JkKFVwZGF0ZUFzc2V0QXNzaWdubWVudFJlcXVlc3QpLnRoZW4ocmVzcG9uc2UxID0+IHsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlMS5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgICAgIGRlYnVnZ2VyOwogICAgICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KCJVc2VyIFVwZGF0ZSBzdWNjZXNzZnVsbHkiLCAic3VjY2VzcyIpOwogICAgICAgICAgICAgIHRoaXMuZ2V0QXNzaWduZWRVc2Vyc09mQXNzZXQoKTsKICAgICAgICAgICAgICB0aGlzLlNob3dQb3BVcCA9IGZhbHNlOwogICAgICAgICAgICAgIHRoaXMubG9hZGVyRmxhZyA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChlcnJvcjEgPT4gewogICAgICAgICAgICAvLyB0aGlzLnNldFN0YXRlKHtsb2FkaW5nOmZhbHNlfSk7CiAgICAgICAgICAgIGlmIChlcnJvcjEucmVzcG9uc2Uuc3RhdHVzID09PSA0MDYpIHsKICAgICAgICAgICAgICB0aGlzLnNob3dUb2FzdCgiRXJyb3Igd2hpbGUgYXNzaWduaW5nIHVzZXIgdG8gdGhlIGFzc2V0IiwgImVycm9yIik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy5zaG93VG9hc3QoIkVycm9yIHdoaWxlIGFzc2lnbmluZyB1c2VyIHRvIHRoZSBhc3NldCIsICJlcnJvciIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGVycm9yID0+IHsKICAgICAgICBpZiAoZXJyb3IpIHsKICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KCJFcnJvciB3aGlsZSBhc3NpZ25pbmcgdXNlciB0byB0aGUgYXNzZXQiLCAiZXJyb3IiKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5zaG93VG9hc3QoIkVycm9yIHdoaWxlIGFzc2lnbmluZyB1c2VyIHRvIHRoZSBhc3NldCIsICJlcnJvciIpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAoKICAgIGZ1dHVyZWRVbkFzc2lnbm1lbnQodXVpZCkgewogICAgICB0aGlzLmxvYWRlckZsYWcgPSB0cnVlOwogICAgICBBc3NldFBlcnNvbm5lbFNlcnZpY2UuZGVsZXRlUG9zdEFzc2lnbm1lbnRCeVVVSUQodXVpZCkudGhlbihyZXMgPT4gewogICAgICAgIHRoaXMuc2hvd1RvYXN0KHJlcy5kYXRhLmRlc2NyaXB0aW9uLCAic3VjY2VzcyIpOwogICAgICAgIHRoaXMuZ2V0QXNzaWduZWRVc2Vyc09mQXNzZXQoKTsKICAgICAgICB0aGlzLmxvYWRlckZsYWcgPSBmYWxzZTsKICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgIH0pOwogICAgfSwKCiAgICBlZGl0QXNzaWduZWQoaW5kZXgsIHZhbCkgewogICAgICB0aGlzLlNob3dQb3BVcCA9IHRydWU7CiAgICAgIHRoaXMudmFsdWVFZGl0QXNzaWduID0gdmFsOwogICAgICB0aGlzLmluZGV4Kys7CiAgICB9LAoKICAgIHNlbGVjdFVzZXIoKSB7CiAgICAgIGxldCBjdXJyZW50VXNlckRldGFpbHMgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJjdXJyZW50VXNlckRldGFpbHMiKSk7CiAgICAgIEFzc2V0UGVyc29ubmVsU2VydmljZS5nZXRBbGxVc2VycyhjdXJyZW50VXNlckRldGFpbHMucHJvZmlsZS5vcmdhbml6YXRpb25JZCkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgbGV0IHVzZXJzID0gW107CgogICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCByZXNwb25zZS5kYXRhLnVzZXJzLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgbGV0IHVzZXIgPSB7fTsKICAgICAgICAgIHVzZXIubGFiZWwgPSByZXNwb25zZS5kYXRhLnVzZXJzW2luZGV4XS5uYW1lOwogICAgICAgICAgdXNlci52YWx1ZSA9IHJlc3BvbnNlLmRhdGEudXNlcnNbaW5kZXhdLm5hbWU7CiAgICAgICAgICB1c2VyLnV1aWQgPSByZXNwb25zZS5kYXRhLnVzZXJzW2luZGV4XS51dWlkOwogICAgICAgICAgdXNlci5uYW1lID0gcmVzcG9uc2UuZGF0YS51c2Vyc1tpbmRleF0ubmFtZTsKICAgICAgICAgIHVzZXJzLnB1c2godXNlcik7CiAgICAgICAgICB0aGlzLmFsbFVzZXJzLnB1c2goewogICAgICAgICAgICBmaXJzdE5hbWU6IHJlc3BvbnNlLmRhdGEudXNlcnNbaW5kZXhdLmZpcnN0TmFtZSwKICAgICAgICAgICAgbGFzdE5hbWU6IHJlc3BvbnNlLmRhdGEudXNlcnNbaW5kZXhdLmxhc3ROYW1lLAogICAgICAgICAgICBwcm9maWxlSW1hZ2U6IHJlc3BvbnNlLmRhdGEudXNlcnNbaW5kZXhdLmltYWdlVXJsLAogICAgICAgICAgICB1dWlkOiByZXNwb25zZS5kYXRhLnVzZXJzW2luZGV4XS51dWlkCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHRoaXMuVXNlcnMgPSB1c2VyczsKICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgIH0pOwogICAgfSwKCiAgICBnZXRBc3NpZ25lZFVzZXJzT2ZBc3NldCgpIHsKICAgICAgQXNzZXRQZXJzb25uZWxTZXJ2aWNlLmdldEFzc2lnbmVkVXNlcnNPZkFzc2V0KHRoaXMuYXNzZXRVdWlkKS50aGVuKHJlc3BvbnNlMSA9PiB7CiAgICAgICAgaWYgKHJlc3BvbnNlMS5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgbGV0IHVzZXJzID0gW107CgogICAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHJlc3BvbnNlMS5kYXRhLmRldGFpbHMubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICAgIGxldCBvYmogPSB7fTsKICAgICAgICAgICAgb2JqLm5hbWUgPSByZXNwb25zZTEuZGF0YS5kZXRhaWxzW2luZGV4XS5uYW1lOwogICAgICAgICAgICBvYmouY291bnQgPSByZXNwb25zZTEuZGF0YS5kZXRhaWxzW2luZGV4XS5jb3VudDsKICAgICAgICAgICAgb2JqLnN0YXR1cyA9IHJlc3BvbnNlMS5kYXRhLmRldGFpbHNbaW5kZXhdLnN0YXR1czsKICAgICAgICAgICAgb2JqLnN0YXJ0RGF0ZSA9IG1vbWVudChyZXNwb25zZTEuZGF0YS5kZXRhaWxzW2luZGV4XS5zdGFydERhdGUpLmZvcm1hdCgiREQgTU1NIFlZWVkgaGg6bW0gYSIpOwogICAgICAgICAgICBvYmoudXVpZCA9IHJlc3BvbnNlMS5kYXRhLmRldGFpbHNbaW5kZXhdLnV1aWQ7CiAgICAgICAgICAgIG9iai51c2VyRW5kaW5nRGF0ZXMgPSByZXNwb25zZTEuZGF0YS5kZXRhaWxzW2luZGV4XS51c2VyRW5kaW5nRGF0ZXM7CiAgICAgICAgICAgIG9iai5hc3NpZ25tZW50SWQgPSByZXNwb25zZTEuZGF0YS5kZXRhaWxzW2luZGV4XS5hc3NpZ25tZW50SWQ7CiAgICAgICAgICAgIHVzZXJzLnB1c2gob2JqKTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLmFzc2lnbmVkVXNlcnMgPSB1c2VyczsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGVycm9yID0+IHsKICAgICAgICBpZiAoZXJyb3IucmVzcG9uc2Uuc3RhdHVzID09PSA0MDYpIHsKICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KCJBbiB1bmV4cGVjdGVkIEVycm9yIE9jY3VycmVkIiwgImVycm9yIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KCJFcnJvciBPY2N1cnJlZCB3aGlsZSBnZXR0aW5nIEFzc2V0IEFzc2lnbm1lbnQiLCAiZXJyb3IiKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICBnZXRBc3NpZ25tZW50SGlzdG9yeUJ5QXNzZXQoKSB7CiAgICAgIEFzc2V0UGVyc29ubmVsU2VydmljZS5nZXRBc3NpZ25tZW50SGlzdG9yeUJ5QXNzZXQodGhpcy5hc3NldFV1aWQsIHRoaXMucGFnZSwgdGhpcy5yb3dzUGVyUGFnZSkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICBsZXQgdXNlcnMgPSBbXTsKCiAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgcmVzcG9uc2UuZGF0YS5kZXRhaWxzLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgICBsZXQgb2JqID0ge307CiAgICAgICAgICAgIG9iai5uYW1lID0gcmVzcG9uc2UuZGF0YS5kZXRhaWxzW2luZGV4XS5uYW1lOwogICAgICAgICAgICBvYmouY291bnQgPSByZXNwb25zZS5kYXRhLmRldGFpbHNbaW5kZXhdLmNvdW50OwogICAgICAgICAgICBvYmoudXNlclN0YXJ0RGF0ZXMgPSBtb21lbnQocmVzcG9uc2UuZGF0YS5kZXRhaWxzW2luZGV4XS5zdGFydERhdGUpLmZvcm1hdCgiREQgTU1NIFlZWVkgaGg6bW0gYSIpOwogICAgICAgICAgICBvYmoudXNlckVuZGluZ0RhdGVzID0gbW9tZW50KHJlc3BvbnNlLmRhdGEuZGV0YWlsc1tpbmRleF0uZW5kRGF0ZSkuZm9ybWF0KCJERCBNTU0gWVlZWSBoaDptbSBhIik7CiAgICAgICAgICAgIG9iai51dWlkID0gcmVzcG9uc2UuZGF0YS5kZXRhaWxzW2luZGV4XS51dWlkOwogICAgICAgICAgICBvYmouZHVyYXRpb25zID0gcmVzcG9uc2UuZGF0YS5kZXRhaWxzW2luZGV4XS5kdXJhdGlvbjsgLy8gb2JqLnN0YXR1cyA9IHJlc3BvbnNlLmRhdGEuZGV0YWlsc1tpbmRleF0uc3RhdHVzOwoKICAgICAgICAgICAgdXNlcnMucHVzaChvYmopOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuYXNzaWdubWVudEhpc3RvcnlVc2VycyA9IHVzZXJzOwogICAgICAgICAgdGhpcy5hc3NpZ25tZW50SGlzdG9yeVVzZXJzLnRvdGFsUGFnZXMgPSByZXNwb25zZS5kYXRhLnRvdGFsUGFnZXM7CiAgICAgICAgICB0aGlzLmFzc2lnbm1lbnRIaXN0b3J5VXNlcnMudG90YWxFbGVtZW50cyA9IHJlc3BvbnNlLmRhdGEudG90YWxFbGVtZW50czsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGVycm9yID0+IHsKICAgICAgICBpZiAoZXJyb3IucmVzcG9uc2Uuc3RhdHVzID09PSA0MDYpIHsKICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KCJPcHBzIGl0cyBsb29rIGxpa2Ugb3VyIHNlcnZlciBpcyBvZmZsaW5lIiwgImVycm9yIik7CiAgICAgICAgfSAvLyAgIHRoaXMuc2V0U3RhdGUoeyBsb2FkaW5nOiBmYWxzZX0pOwogICAgICAgIGVsc2UgewogICAgICAgICAgdGhpcy5zaG93VG9hc3QoIk9wcHMgaXRzIGxvb2sgbGlrZSBvdXIgc2VydmVyIGlzIG9mZmxpbmUiLCAiZXJyb3IiKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICBkZWxldGVBc3NldEltYWdlKGlkKSB7CiAgICAgIEFzc2V0TWFuYWdlbWVudFNlcnZpY2UuZGVsZXRlQXNzZXRJbWFnZShpZCkudGhlbihyZXMgPT4gewogICAgICAgIHRoaXMuZ2V0QXNzZXRJbWFnZXMoKTsKICAgICAgICB0aGlzLnNob3dUb2FzdCgiSW1hZ2VzIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5IiwgInN1Y2Nlc3MiKTsKICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgIH0pOwogICAgfSwKCiAgICBnZXRNYWludGFpbmFuY2VDb3N0KGFzc2V0SWQpIHsKICAgICAgewogICAgICAgIFdvcmtPcmRlclNlcnZpY2UuZ2V0QXNzZXRNYWludGVuYW5jZUNvc3RCeUFzc2V0VVVJRChhc3NldElkKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICB0aGlzLmNvc3QgPSByZXMuZGF0YS5tYWludGVuYW5jZUNvc3Q7CiAgICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKCiAgICBzaG93VG9hc3QobWVzc2FnZSwgdHlwZSkgewogICAgICB0aGlzLnRvYXN0TWVzc2FnZSA9IG1lc3NhZ2U7CiAgICAgIHRoaXMudG9hc3RUeXBlID0gdHlwZTsKICAgICAgdGhpcy50b2FzdEZsYWcrKzsKICAgIH0KCiAgfSwKCiAgbW91bnRlZCgpIHt9LAoKICBjcmVhdGVkKCkgewogICAgdGhpcy5sb2FkZXJGbGFnID0gdHJ1ZTsKICAgIHRoaXMuYXNzZXRVdWlkID0gdGhpcy4kcm91dGUucGFyYW1zLmFzc2V0SUQ7CiAgICB0aGlzLmdldE1haW50YWluYW5jZUNvc3QodGhpcy5hc3NldFV1aWQpOwogICAgdGhpcy5Bc3NldHNEZXRhaWxzKCk7CiAgICB0aGlzLmdldFBhZ2luYXRlZENvbnN1bXB0aW9uc0J5QXNzZXQoKTsKICAgIHRoaXMuZ2V0UGFnaW5hdGVkVXNhZ2VzQnlBc3NldCgpOwogICAgdGhpcy5zZWxlY3RVc2VyKCk7CiAgICB0aGlzLmdldEFzc2lnbmVkVXNlcnNPZkFzc2V0KCk7CiAgICB0aGlzLmdldEFzc2lnbm1lbnRIaXN0b3J5QnlBc3NldCgpOwogICAgdGhpcy5nZXRBc3NldFJlbGF0ZWRJc3N1ZSgpOwogICAgdGhpcy5nZXRDdXJyZW5jeSgpOwogICAgdGhpcy5nZXRBc3NldFdvcmtPcmRlcnMoKTsgLy8JdGhpcy5nZXRNYWludGFpbmFuY2VDb3N0KHRoaXMuYXNzZXRVdWlkKTsKICB9LAoKICBjb21wdXRlZDoge30KfTs="},null]}