{"remainingRequest":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/node_modules/babel-loader/lib/index.js!/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/node_modules/cache-loader/dist/cjs.js??ref--1-0!/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/src/views/calendar/Scheduler.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/src/views/calendar/Scheduler.vue","mtime":1661968702432},{"path":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/babel.config.js","mtime":1661968702388},{"path":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/node_modules/vue-loader/lib/index.js","mtime":1655715099000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgU2NoZWR1bGVQbHVnaW4sIERheSwgV2VlaywgV29ya1dlZWssIE1vbnRoLCBBZ2VuZGEsIFJlc2l6ZSwgRHJhZ0FuZERyb3AgfSBmcm9tICJAc3luY2Z1c2lvbi9lajItdnVlLXNjaGVkdWxlIjsKaW1wb3J0IGxvYWRlciBmcm9tICJAL2NvbXBvbmVudHMvTG9hZGVyLnZ1ZSI7CmltcG9ydCBpbnNwZWN0aW9uU2VydmljZSBmcm9tICIuLi8uLi9zZXJ2aWNlcy9JbnNwZWN0aW9uU2VydmljZSI7CmltcG9ydCBHSW5zcGVjdGlvblRlbXBsYXRlcyBmcm9tICIuLi8uLi9jb21wb25lbnRzL0dfSW5zcGVjdGlvblRlbXBsYXRlLnZ1ZSI7CmltcG9ydCBJbnNwZWN0aW9uQXNzaWdubWVudCBmcm9tICIuLi9jYWxlbmRhci9jb21wb25lbnRzL0luc3BlY3Rpb25Bc3NpZ25tZW50LnZ1ZSI7CmltcG9ydCBTZXJ2aWNlUmVxdWVzdEFzc2lnbm1lbnQgZnJvbSAiLi4vY2FsZW5kYXIvY29tcG9uZW50cy9TZXJ2aWNlUmVxdWVzdEFzc2lnbm1lbnQudnVlIjsKaW1wb3J0IElzc3VlQXNzaWdubWVudCBmcm9tICIuLi9jYWxlbmRhci9jb21wb25lbnRzL0lzc3VlQXNzaWdubWVudC52dWUiOwppbXBvcnQgQXNzZXRBc3NpZ25tZW50VW5Bc3NpZ25tZW50IGZyb20gIi4vY29tcG9uZW50cy9Bc3NldEFzc2lnbm1lbnRVbkFzc2lnbm1lbnQudnVlIjsKaW1wb3J0IFdvcmtPcmRlckFzc2lnbm1lbnQgZnJvbSAiLi4vY2FsZW5kYXIvY29tcG9uZW50cy9Xb3JrT3JkZXJBc3NpZ25tZW50LnZ1ZSI7CmltcG9ydCBBc3NpZ25Vc2VyUG9wVXAgZnJvbSAiLi4vY2FsZW5kYXIvY29tcG9uZW50cy9Bc3NpZ25Vc2VyUG9wVXAudnVlIjsKaW1wb3J0IFVuQXNzaWduVXNlclBvcFVwIGZyb20gIi4uL2NhbGVuZGFyL2NvbXBvbmVudHMvVW5Bc3NpZ25Vc2VyUG9wVXAudnVlIjsgLy8gaW1wb3J0IHsgc2NoZWR1bGVEYXRhIH0gZnJvbSAnLi9kYXRhc291cmNlJzsgLy8gb25seSBmb3IgdGVzdGluZwovLyBTY2hlZHVsZXIgQXBpCgppbXBvcnQgc2NoZWR1bGVyU2VydmljZSBmcm9tICIuLi8uLi9zZXJ2aWNlcy9zY2hlZHVsZXJTZXJ2aWNlIjsgLy8KCmltcG9ydCBJbnNwZWN0aW9uU2VydmljZSBmcm9tICIuLi8uLi9zZXJ2aWNlcy9JbnNwZWN0aW9uU2VydmljZSI7CmltcG9ydCBXb3JrT3JkZXJTZXJ2aWNlIGZyb20gIi4uLy4uL3NlcnZpY2VzL1dvcmtPcmRlclNlcnZpY2UiOwppbXBvcnQgQXNzZXRQZXJzb25uZWxTZXJ2aWNlIGZyb20gIi4uLy4uL3NlcnZpY2VzL0Fzc2V0UGVyc29ubmVsU2VydmljZSI7CmltcG9ydCBTaWRlQmFyRmlsdGVyIGZyb20gIi4uL2NhbGVuZGFyL2NvbXBvbmVudHMvU2lkZUJhckZpbHRlci52dWUiOwppbXBvcnQgRGVsZXRlRGlhbG9nIGZyb20gIi4uLy4uL2NvbXBvbmVudHMvRGVsZXRlRGlhbG9nIjsKaW1wb3J0IG1vbWVudCBmcm9tICJtb21lbnQiOwp2YXIgc2NoZWR1bGVEYXRhID0gW107CmV4cG9ydCBkZWZhdWx0IHsKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgaGVpZ2h0OiAiNTUwcHgiLAogICAgICBldmVudFNldHRpbmdzOiB7CiAgICAgICAgZGF0YVNvdXJjZTogc2NoZWR1bGVEYXRhCiAgICAgIH0sCiAgICAgIFVzZXJzOiBbXSwKICAgICAgYWxsVXNlcnM6IFtdLAogICAgICBTaG93UG9wVXA6IGZhbHNlLAogICAgICBTaG93VW5Qb3BVcDogZmFsc2UsCiAgICAgIGFzc2lnbmVkVXNlcnM6IFtdLAogICAgICB2YWx1ZUVkaXRBc3NpZ246IHt9LAogICAgICBhc3NpZ25tZW50SGlzdG9yeVVzZXJzOiBbXSwKICAgICAgcGFnZTogMCwKICAgICAgcm93c1BlclBhZ2U6IDUsCiAgICAgIGN1cnJlbnRVc2VyRGV0YWlsczogbnVsbCwKICAgICAga2V5SW5kZXg6IDAsCiAgICAgIGZpbHRlckluZGV4OiAwLAogICAgICBzY2hlZHVsZUtleTogMCwKICAgICAgaW5kZXg6IDAsCiAgICAgIHdvcmtIb3VyczogewogICAgICAgIGhpZ2hsaWdodDogdHJ1ZSwKICAgICAgICBzdGFydDogIjA4OjAwIiwKICAgICAgICBlbmQ6ICIxNjowMCIKICAgICAgfSwKICAgICAgc2VsZWN0ZWREYXRlOiBuZXcgRGF0ZSgpLAogICAgICBFdmVudERpYWxvZzogZmFsc2UsCiAgICAgIGV2ZW50VGFiczogImluc3BlY3Rpb24iLAogICAgICBhc3NldFV1aWQ6ICIiLAogICAgICBldmVudFRhYnNPcHRpb25zOiBbewogICAgICAgIGxhYmVsOiAiSW5zcGVjdGlvbiIsCiAgICAgICAgdmFsdWU6ICJpbnNwZWN0aW9uIgogICAgICB9LCB7CiAgICAgICAgbGFiZWw6ICJXb3JrIE9yZGVyIiwKICAgICAgICB2YWx1ZTogIndvcmtPcmRlciIKICAgICAgfSwgewogICAgICAgIGxhYmVsOiAiQXNzaWdubWVudCIsCiAgICAgICAgdmFsdWU6ICJhc3NpZ25tZW50IgogICAgICB9LCB7CiAgICAgICAgbGFiZWw6ICJSZXBvcnQgSXNzdWUiLAogICAgICAgIHZhbHVlOiAiaXNzdWVzIiwKICAgICAgICBpZDogImdqaGdqIgogICAgICB9LCB7CiAgICAgICAgbGFiZWw6ICJTZXJ2aWNlIFJlcXVlc3QiLAogICAgICAgIHZhbHVlOiAic3JSZXF1ZXN0IgogICAgICB9XSwKICAgICAgQ2F0ZWdvcnlPcHRpb246IFtdLAogICAgICBzZWFyY2hNb2RlbDogIiIsCiAgICAgIENhdGVnb3J5VmFsdWU6ICIiLAogICAgICB0ZW1wT2JqOiB7fSwKICAgICAgbG9hZGVyRmxhZzogZmFsc2UsCiAgICAgIHRvYXN0RmxhZzogZmFsc2UsCiAgICAgIHRvYXN0TWVzc2FnZTogIiIsCiAgICAgIHRvYXN0VHlwZTogIiIsCiAgICAgIGNhbGVuZGVyRGF0ZU9iajogIiIsCiAgICAgIHN1Ym1pdHRlZGJ5VXNlclVVSUQ6ICIiLAogICAgICBpc3N1ZUNhdGVnb3J5OiAiIiwKICAgICAgZWRpdEZsYWc6IGZhbHNlLAogICAgICBpc3N1ZUlEOiAiIiwKICAgICAgc2VydmljZVJlcXVlc3RVVUlEOiAiIiwKICAgICAgdGVtcFNjaGVkdWxlTmFtZTogIiIsCiAgICAgIGZsYWc6IGZhbHNlLAogICAgICBzY2hlZHVsZXJOYW1lOiAic2NoZWR1bGVyIiwKICAgICAgRWRpdFNjaGVUZW5hbnRVVUlkOiAiIiwKICAgICAgRWRpdFNjaGVJZDogIiIsCiAgICAgIGRlbGV0ZUlkOiAiIiwKICAgICAgZGVsZXRlSW5zcGVjdGlvbkRpYWxvZzogZmFsc2UsCiAgICAgIGFyY2hpdmVJbnNwZWN0aW9uRGlhbG9nOiBmYWxzZSwKICAgICAgc2NoZWR1bGVyU3RhcnRUaW1lOiAiIiwKICAgICAgc2NoZWR1bGVyRW5kVGltZTogIiIKICAgIH07CiAgfSwKCiAgcHJvdmlkZTogewogICAgc2NoZWR1bGU6IFtEYXksIFdlZWssIFdvcmtXZWVrLCBNb250aCwgQWdlbmRhLCBSZXNpemUsIERyYWdBbmREcm9wXQogIH0sCiAgY29tcG9uZW50czogewogICAgR0luc3BlY3Rpb25UZW1wbGF0ZXMsCiAgICBJbnNwZWN0aW9uQXNzaWdubWVudCwKICAgIGxvYWRlciwKICAgIFdvcmtPcmRlckFzc2lnbm1lbnQsCiAgICBTZXJ2aWNlUmVxdWVzdEFzc2lnbm1lbnQsCiAgICBJc3N1ZUFzc2lnbm1lbnQsCiAgICBBc3NldEFzc2lnbm1lbnRVbkFzc2lnbm1lbnQsCiAgICBBc3NpZ25Vc2VyUG9wVXAsCiAgICBVbkFzc2lnblVzZXJQb3BVcCwKICAgIFNpZGVCYXJGaWx0ZXIsCiAgICBEZWxldGVEaWFsb2cKICB9LAogIG1ldGhvZHM6IHsKICAgIGdldERhdGVOYXZpZ2F0ZSgpIHsKICAgICAgdmFyIHNjaGVkdWxlT2JqID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIlNjaGVkdWxlIikuZWoyX2luc3RhbmNlc1swXTsKICAgICAgdmFyIHNlbERhdGUgPSBzY2hlZHVsZU9iai5zZWxlY3RlZERhdGU7CiAgICAgIHZhciBjdXJyZW50Vmlld0RhdGVzID0gc2NoZWR1bGVPYmouZ2V0Q3VycmVudFZpZXdEYXRlcygpOwogICAgICB2YXIgc3RhcnREYXRlID0gY3VycmVudFZpZXdEYXRlc1swXTsKICAgICAgdmFyIGVuZERhdGUgPSBjdXJyZW50Vmlld0RhdGVzW2N1cnJlbnRWaWV3RGF0ZXMubGVuZ3RoIC0gMV07CiAgICAgIHRoaXMuc2NoZWR1bGVTdGFydFRpbWUgPSBlbmREYXRlLCB0aGlzLnNjaGVkdWxlckVuZFRpbWUgPSBzdGFydERhdGU7CiAgICB9LAoKICAgIGNsb3NlRGlhbG9nKCkgewogICAgICB0aGlzLmRlbGV0ZUluc3BlY3Rpb25EaWFsb2cgPSBmYWxzZTsKICAgICAgdGhpcy5hcmNoaXZlSW5zcGVjdGlvbkRpYWxvZyA9IGZhbHNlOwogICAgfSwKCiAgICBkZWxldGVEaWFsb2coKSB7CiAgICAgIHRoaXMubG9hZGVyRmxhZyA9IHRydWU7CiAgICAgIHRoaXMuZGVsZXRlSW5zcGVjdGlvbkRpYWxvZyA9IHRydWU7CiAgICAgIGluc3BlY3Rpb25TZXJ2aWNlLmRlbGV0ZUluc3BlY3Rpb25UZW1wbGF0ZUJ5VVVJRCh0aGlzLmRlbGV0ZUlkLCAiZGVsZXRlIikudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PSAyMDApIHsKICAgICAgICAgIHRoaXMuJGVtaXQoInNob3dUb2FzdCIsICJQZW5kaW5nIEluc3BlY3Rpb24gRGVsZXRlZCBTdWNjZXNzZnVsbHkiLCAic3VjY2VzcyIpOwogICAgICAgICAgbGV0IHNjaGVkdWxlT2JqID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIlNjaGVkdWxlIikuZWoyX2luc3RhbmNlc1swXTsKICAgICAgICAgIHZhciBsaXN0ID0gc2NoZWR1bGVPYmouZXZlbnRTZXR0aW5ncy5kYXRhU291cmNlOwogICAgICAgICAgdmFyIGxpc3RzID0gbGlzdC5maWx0ZXIoeCA9PiB7CiAgICAgICAgICAgIHJldHVybiB4LmlkICE9IHRoaXMuZGVsZXRlSWQ7CiAgICAgICAgICB9KTsKICAgICAgICAgIHNjaGVkdWxlT2JqLmV2ZW50U2V0dGluZ3MuZGF0YVNvdXJjZSA9IFt7fV07CiAgICAgICAgICBzY2hlZHVsZU9iai5ldmVudFNldHRpbmdzLmRhdGFTb3VyY2UgPSBsaXN0czsKICAgICAgICAgIHRoaXMubG9hZGVyRmxhZyA9IGZhbHNlOwogICAgICAgICAgdGhpcy5kZWxldGVJbnNwZWN0aW9uRGlhbG9nID0gZmFsc2U7IC8vIHRoaXMuR2V0U2NoZWR1bGVyVGlja2V0cygpOwogICAgICAgICAgLy8gdGhpcy5zY2hlZHVsZXJTdGFydFRpbWUgPSAiIjsKICAgICAgICAgIC8vIHRoaXMuc2NoZWR1bGVyRW5kVGltZSA9ICIiOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZXJyb3IgPT4gewogICAgICAgIGlmIChlcnJvci5yZXNwb25zZSAhPT0gdW5kZWZpbmVkICYmIGVycm9yLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA2KSB7CiAgICAgICAgICB0aGlzLiRlbWl0KCJzaG93VG9hc3QiLCBlcnJvci5yZXNwb25zZS5kYXRhLmRlc2NyaXB0aW9uLCAiZXJyb3IiKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy4kZW1pdCgic2hvd1RvYXN0IiwgIkFuIHVuZXhwZWN0ZWQgRXJyb3IgT2NjdXJyZWQuIiwgImVycm9yIik7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCgogICAgYWRkRXZlbnQ6IGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICB0aGlzLmtleUluZGV4Kys7CiAgICAgIHRoaXMuRXZlbnREaWFsb2cgPSB0cnVlOwogICAgfSwKICAgIGRlbGV0ZUV2ZW50OiBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgdGhpcy5rZXlJbmRleCsrOwogICAgfSwKICAgIG9uQ2VsbENsaWNrOiBmdW5jdGlvbiAoYXJncykgewogICAgICAvLwogICAgICBhcmdzLmNhbmNlbCA9IHRydWU7CiAgICAgIHRoaXMuY2FsZW5kZXJEYXRlT2JqID0gYXJnczsKICAgICAgdGhpcy5rZXlJbmRleCsrOwogICAgICB0aGlzLkV2ZW50RGlhbG9nID0gdHJ1ZTsgLy8gRGF0ZQoKICAgICAgdGhpcy5zY2hlZHVsZXJTdGFydFRpbWUgPSBhcmdzLnN0YXJ0VGltZTsKICAgICAgbGV0IG51bVdlZWtzID0gMjsKICAgICAgbGV0IG5vdyA9IGFyZ3MuZW5kVGltZTsKICAgICAgbm93LnNldERhdGUobm93LmdldERhdGUoKSArIG51bVdlZWtzICogNyk7CiAgICAgIHRoaXMuc2NoZWR1bGVyRW5kVGltZSA9IG5vdzsKICAgIH0sCiAgICBvbmV2ZW50UmVuZGVyZWQ6IGZ1bmN0aW9uIChhcmdzKSB7CiAgICAgIC8vCWNvbnNvbGUubG9nKCJvbiBldmVudCByZW5kZXIiLCAgYXJncy5kYXRhLkNhdGVnb3J5Q29sb3IpOwogICAgICBsZXQgY2F0ZWdvcnlDb2xvciA9IGFyZ3MuZGF0YS5DYXRlZ29yeUNvbG9yOwoKICAgICAgaWYgKCFhcmdzLmVsZW1lbnQgfHwgIWNhdGVnb3J5Q29sb3IpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGFyZ3MuZWxlbWVudC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBjYXRlZ29yeUNvbG9yOwogICAgfSwKICAgIG9uU2F2ZTogZnVuY3Rpb24gKGFyZ3MpIHsKICAgICAgbGV0IHNjaGVkdWxlT2JqID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIlNjaGVkdWxlIikuZWoyX2luc3RhbmNlc1swXTsgLy8JY29uc29sZS5sb2coc2NoZWR1bGVPYmopOwoKICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpOwogICAgICB2YXIgc3ViT25lSG91ciA9IG1vbWVudChkYXRlKS5zdWJ0cmFjdCgxLCAiaCIpLmZvcm1hdCgpOwogICAgICBsZXQgZXZlbnREYXRhID0gewogICAgICAgIC8vCUlkOiBpbmRleCwKICAgICAgICBTdWJqZWN0OiAiIiwKICAgICAgICBTdGFydFRpbWU6IG5ldyBEYXRlKHN1Yk9uZUhvdXIpLAogICAgICAgIEVuZFRpbWU6IG5ldyBEYXRlKCksCiAgICAgICAgSXNBbGxEYXk6IGZhbHNlLAogICAgICAgIGNhcmRUeXBlOiAiU2VydmljZSBSZXF1ZXN0IiwKICAgICAgICBpc3N1ZUlkOiAiYzA2Mjk1YzEtMDM1NS00YTRkLThiOGQtMzU0M2Y3ZjUwYTk1IiwKICAgICAgICBzcklkOiAiYzA2Mjk1YzEtMDM1NS00YTRkLThiOGQtMzU0M2Y3ZjUwYTk1IiwKICAgICAgICAvLyBTdGFydFRpbWV6b25lOiBudWxsLAogICAgICAgIC8vIERlc2NyaXB0aW9uOiAidW5kZWZpbmVkIiwKICAgICAgICAvLyBFbmRUaW1lem9uZTogbnVsbCwKICAgICAgICAvLyBHdWlkOiAiOGI1MzcwYTItOWNmYS1iOTU3LTBiNWYtMWU4NmI5NGFiZWJiIiwKICAgICAgICBJZDogMSAvLyBMb2NhdGlvbjogInVuZGVmaW5lZCIsCiAgICAgICAgLy8gUmVjdXJyZW5jZVJ1bGU6IG51bGwsCgogICAgICB9OwogICAgICBjb25zb2xlLmxvZygic2F2ZSIsIGV2ZW50RGF0YSk7CiAgICAgIHNjaGVkdWxlT2JqLmFkZEV2ZW50KGV2ZW50RGF0YSk7CiAgICAgIGNvbnNvbGUubG9nKCJzY2hlZHVsZURhdGEiLCBzY2hlZHVsZURhdGEpOyAvL2RvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoIi5lLXNjaGVkdWxlIC5lLXZlcnRpY2FsLXZpZXcgLmUtZGF5LXdyYXBwZXIgLmUtYXBwb2ludG1lbnQuZS1saWIuZS1kcmFnZ2FibGUiKS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAiZ3JlZW4iOwogICAgfSwKICAgIG9uQWN0aW9uQmVnaW46IGZ1bmN0aW9uIChhcmdzKSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKCJvbkFjdGlvbkJlZ2luIixhcmdzKQogICAgICBpZiAoYXJncy5yZXF1ZXN0VHlwZSA9PT0gImV2ZW50UmVtb3ZlIikgewogICAgICAgIHZhciBjaGFuZ2VkUmVjb3JkcyA9IGFyZ3MuY2hhbmdlZFJlY29yZHM7CgogICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBjaGFuZ2VkUmVjb3Jkcy5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgIHZhciByZWNvcmRJZCA9IGNoYW5nZWRSZWNvcmRzW2luZGV4XS5pZDsKICAgICAgICB9CgogICAgICAgIGFyZ3MuY2FuY2VsID0gdHJ1ZTsKICAgICAgICB0aGlzLmRlbGV0ZUluc3BlY3Rpb25EaWFsb2cgPSB0cnVlOwogICAgICAgIHRoaXMuZGVsZXRlSWQgPSByZWNvcmRJZDsKICAgICAgfSAvLyBpZiAoYXJncy5yZXF1ZXN0VHlwZSA9PT0gImRhdGVOYXZpZ2F0ZSIpIHsKICAgICAgLy8gICBjb25zb2xlLmxvZygiIyMjIG5hdmlnYXRpbmcgdG86ICIsIGFyZ3MuY3VycmVudERhdGUpOwogICAgICAvLyAgIC8vIHRoaXMuc2NoZWR1bGVPYmouc2Nyb2xsVG8oJzEyOjAwJywgYXJncy5jdXJyZW50RGF0ZSk7CiAgICAgIC8vIH0KICAgICAgLy8gbGV0IHNjaGVkdWxlT2JqID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIlNjaGVkdWxlIikuZWoyX2luc3RhbmNlc1swXTsKICAgICAgLy8gICBpZiAoYXJncy5yZXF1ZXN0VHlwZSA9PT0gJ2V2ZW50Q3JlYXRlJyB8fCBhcmdzLnJlcXVlc3RUeXBlID09PSAnZXZlbnRDaGFuZ2UnKSB7CiAgICAgIC8vICAgICAgIGxldCBkYXRhOwogICAgICAvLyAgICAgICBpZiAoYXJncy5yZXF1ZXN0VHlwZSA9PT0gJ2V2ZW50Q3JlYXRlJykgewogICAgICAvLyAgICAgICAgICAgZGF0YSA9IGFyZ3MuZGF0YVswXTsKICAgICAgLy8gICAgICAgfSBlbHNlIGlmIChhcmdzLnJlcXVlc3RUeXBlID09PSAnZXZlbnRDaGFuZ2UnKSB7CiAgICAgIC8vICAgICAgICAgICBkYXRhID0gYXJncy5kYXRhOwogICAgICAvLyAJLy8JZGF0YS5TdWJqZWN0ID0gdGhpcy50ZW1wU2NoZWR1bGVOYW1lOwogICAgICAvLyAJCWNvbnNvbGUubG9nKCJ1cGRhdGUgZGF0YSBzYXZlIGZ1bmN0aW9uIixkYXRhKTsKICAgICAgLy8gCQlyZXR1cm4gZGF0YTsKICAgICAgLy8gICAgICAgfQogICAgICAvLyAgICAgICBpZiAoIXNjaGVkdWxlT2JqLmlzU2xvdEF2YWlsYWJsZShkYXRhLlN0YXJ0VGltZSwgZGF0YS5FbmRUaW1lKSkgewogICAgICAvLyAJCWNvbnNvbGUubG9nKCJpcyBzbG90IGF2YWxhIik7CiAgICAgIC8vICAgICAgICAgLy8gIGFyZ3MuY2FuY2VsID0gdHJ1ZTsKICAgICAgLy8gICAgICAgfWVsc2V7CiAgICAgIC8vIAkJY29uc29sZS5sb2coImNyZWF0ZSBuZXciKTsKICAgICAgLy8gCQkvL3NjaGVkdWxlT2JqLnNhdmVFdmVudChkYXRhKQogICAgICAvLyAJfWVuZERhdGUKICAgICAgLy8gICB9CgogICAgfSwKICAgIG9uQWN0aW9uQ29tcGxldGU6IGZ1bmN0aW9uIChhcmdzKSB7CiAgICAgIGlmIChhcmdzLnJlcXVlc3RUeXBlID09PSAidmlld05hdmlnYXRlIiB8fCBhcmdzLnJlcXVlc3RUeXBlID09PSAiZGF0ZU5hdmlnYXRlIikgewogICAgICAgIHZhciBzY2hlZHVsZU9iaiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJTY2hlZHVsZSIpLmVqMl9pbnN0YW5jZXNbMF07CiAgICAgICAgdmFyIHNlbERhdGUgPSBzY2hlZHVsZU9iai5zZWxlY3RlZERhdGU7CiAgICAgICAgdmFyIGN1cnJlbnRWaWV3RGF0ZXMgPSBzY2hlZHVsZU9iai5nZXRDdXJyZW50Vmlld0RhdGVzKCk7CiAgICAgICAgdmFyIHN0YXJ0RGF0ZSA9IGN1cnJlbnRWaWV3RGF0ZXNbMF07CiAgICAgICAgdmFyIGVuZERhdGUgPSBjdXJyZW50Vmlld0RhdGVzW2N1cnJlbnRWaWV3RGF0ZXMubGVuZ3RoIC0gMV07IC8vIGNvbnNvbGUubG9nKCJlLW1vbnRoLXZpZXctc3RhcnREYXRlOiAiICsgc3RhcnREYXRlKTsKICAgICAgICAvLyBjb25zb2xlLmxvZygiZS1tb250aC12aWV3LWVuZERhdGVlbmREYXRlOiAiICsgZW5kRGF0ZSk7CgogICAgICAgIGlmIChzY2hlZHVsZU9iai5hY3RpdmVWaWV3LnZpZXdDbGFzcyA9PT0gImUtbW9udGgtdmlldyIpIHsvLyBjb25zb2xlLmxvZygiZS1tb250aC12aWV3Iik7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgb25Qb3B1cE9wZW46IGZ1bmN0aW9uIChhcmdzKSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKCJzY2hlZHVsZXIiLCBhcmdzKTsKICAgICAgaWYgKGFyZ3MudHlwZSA9PT0gIkVkaXRvciIpIHsKICAgICAgICBhcmdzLmNhbmNlbCA9IHRydWU7CiAgICAgICAgdGhpcy5FZGl0U2NoZVRlbmFudFVVSWQgPSBhcmdzLmRhdGEudGVuYW50VVVJRDsKICAgICAgICB0aGlzLkVkaXRTY2hlSWQgPSBhcmdzLmRhdGEuaWQ7CiAgICAgICAgdGhpcy50ZW1wT2JqLmVkaXRGbGFnID0gdHJ1ZTsgLy8gdGhpcy5lZGl0RmxhZyA9IHRydWU7CgogICAgICAgIHRoaXMuaXNzdWVJRCA9IGFyZ3MuZGF0YS5zcklkOwogICAgICAgIHRoaXMuc2VydmljZVJlcXVlc3RVVUlEID0gYXJncy5kYXRhLnNySWQ7CiAgICAgICAgdGhpcy5FdmVudERpYWxvZyA9IHRydWU7IC8vIGZvciBkYXRlCgogICAgICAgIHRoaXMuc2NoZWR1bGVyU3RhcnRUaW1lID0gYXJncy5kYXRhLlN0YXJ0VGltZTsKICAgICAgICBsZXQgbnVtV2Vla3MgPSAyOwogICAgICAgIGxldCBub3cgPSBhcmdzLmRhdGEuRW5kVGltZTsKICAgICAgICBub3cuc2V0RGF0ZShub3cuZ2V0RGF0ZSgpICsgbnVtV2Vla3MgKiA3KTsKICAgICAgICB0aGlzLnNjaGVkdWxlckVuZFRpbWUgPSBub3c7CiAgICAgIH0gZWxzZSBpZiAoYXJncy50eXBlID09PSAiRGVsZXRlQWxlcnQiKSB7CiAgICAgICAgYXJncy5jYW5jZWwgPSB0cnVlOwogICAgICAgIHRoaXMuZGVsZXRlSW5zcGVjdGlvbkRpYWxvZyA9IHRydWU7CiAgICAgICAgdGhpcy5kZWxldGVJZCA9IGFyZ3MuZGF0YS5pZDsgLy8gdGhpcy4kcmVmcy5TY2hlZHVsZU9iai5kZWxldGVFdmVudChhcmdzLmRhdGEpOwogICAgICB9IGVsc2UgaWYgKGFyZ3MudHlwZSA9PT0gIlJlY3VycmVuY2VBbGVydCIpIHt9CiAgICB9LAoKICAgIHNlbGVjdEV2ZW50VHlwZShvYmopIHsKICAgICAgdGhpcy5ldmVudFRhYnMgPSBvYmoudmFsdWU7IC8vCXRoaXMuY2FsZW5kZXJEYXRlT2JqID0gIiI7CiAgICB9LAoKICAgIGNsb3NlKCkgewogICAgICB0aGlzLmV2ZW50VGFicyA9ICJpbnNwZWN0aW9uIiwgdGhpcy5FdmVudERpYWxvZyA9IGZhbHNlOwogICAgICB0aGlzLnRlbXBPYmouZWRpdEZsYWcgPSBmYWxzZTsKCiAgICAgIGlmICh0aGlzLkVkaXRTY2hlVGVuYW50VVVJZCAhPT0gIiIgJiYgdGhpcy5FZGl0U2NoZUlkICE9PSAiIikgewogICAgICAgIHRoaXMuRWRpdFNjaGVUZW5hbnRVVUlkID0gIiIsIHRoaXMuRWRpdFNjaGVJZCA9ICIiOwogICAgICB9CiAgICB9LAoKICAgIGNsb3NlUG9wVXAoKSB7CiAgICAgIHRoaXMuU2hvd1BvcFVwID0gZmFsc2U7CiAgICAgIHRoaXMuU2hvd1VuUG9wVXAgPSBmYWxzZTsKICAgIH0sCgogICAgb25TZWxlY3RlZCh2YWx1ZSkgewogICAgICBjb25zb2xlLmxvZygic2VsZXRlZCB2YWx1ZSIsIHZhbHVlKTsKICAgIH0sCgogICAgb25TZWxlY3RlZENhdGVnb3J5KCkge30sCgogICAgc2VhcmNoRnVuY3Rpb24oKSB7fSwKCiAgICBmaWx0ZXJGdW4oKSB7CiAgICAgIHRoaXMuZmxhZzsKICAgICAgdGhpcy5mbGFnID0gIXRoaXMuZmxhZzsKICAgICAgdGhpcy5maWx0ZXJJbmRleCsrOwogICAgfSwKCiAgICBTY2hlZHVsZXJFZGl0RnVuYygpIHsKICAgICAgbGV0IHNjaGVkdWxlT2JqID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIlNjaGVkdWxlIikuZWoyX2luc3RhbmNlc1swXTsKICAgICAgdmFyIGFyck9mT2JqID0gc2NoZWR1bGVPYmouZXZlbnRTZXR0aW5ncy5kYXRhU291cmNlOwogICAgICB2YXIgZGF0YUFyciA9IGFyck9mT2JqLm1hcChpdGVtID0+IHsKICAgICAgICByZXR1cm4gW2l0ZW0uaWQsIGl0ZW1dOwogICAgICB9KTsKICAgICAgdmFyIG1hcGFyciA9IG5ldyBNYXAoZGF0YUFycik7CiAgICAgIHZhciByZXN1bHQgPSBbLi4ubWFwYXJyLnZhbHVlcygpXTsKICAgICAgc2NoZWR1bGVPYmouZXZlbnRTZXR0aW5ncy5kYXRhU291cmNlID0gW3t9XTsKICAgICAgc2NoZWR1bGVPYmouZXZlbnRTZXR0aW5ncy5kYXRhU291cmNlID0gcmVzdWx0OwogICAgfSwKCiAgICBhc3luYyBpbnNwZWN0aW9uQXNzaWdubWVudChvYmopIHsKICAgICAgLy8gY29uc29sZS5sb2coIm9iaiIsb2JqKQogICAgICB0cnkgewogICAgICAgIHRoaXMubG9hZGVyRmxhZyA9IHRydWU7CgogICAgICAgIGlmIChvYmouZnJlcXVlbmN5VHlwZSA9PT0gImFkLWhvYyIpIHsKICAgICAgICAgIGxldCBkYXRlID0gb2JqLmRlYWRMaW5lRGF0ZTsKICAgICAgICAgIGxldCB0aW1lID0gb2JqLmRlYWRMaW5lVGltZTsKICAgICAgICAgIHZhciBkYXRlU3BsaXQgPSBkYXRlLnNwbGl0KCJUIik7CiAgICAgICAgICB2YXIgb2JqRGF0ZSA9IGRhdGVTcGxpdFswXTsKICAgICAgICAgIHZhciB0aW1lU3BsaXQgPSB0aW1lLnNwbGl0KCI6Iik7CiAgICAgICAgICB2YXIgaG91ciA9IHRpbWVTcGxpdFswXTsKICAgICAgICAgIHZhciBtaW4gPSB0aW1lU3BsaXRbMV07CiAgICAgICAgICB2YXIgc3RhcnREYXRlID0gb2JqRGF0ZSArICJUIiArIGhvdXIgKyAiOiIgKyBtaW4gKyAiOiIgKyAiMDArMDU6MDAiOwogICAgICAgICAgdmFyIHN1Yk9uZUhvdXIgPSBtb21lbnQoc3RhcnREYXRlKS5zdWJ0cmFjdCgxLCAiaCIpLmZvcm1hdCgpOwogICAgICAgICAgbGV0IGVuZFRpbWUgPSBuZXcgRGF0ZShzdGFydERhdGUpOwogICAgICAgICAgbGV0IHN0YXJ0VGltZSA9IG5ldyBEYXRlKHN1Yk9uZUhvdXIpOwogICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgSW5zcGVjdGlvblNlcnZpY2UuYXNzaWduU2NoZWR1bGVJbnNwZWN0aW9uVGVtcGxhdGUob2JqKTsKCiAgICAgICAgICBpZiAocmVzLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAgIHRoaXMudGVtcEFzc2lnbm1lbnQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5jbG9zZSgpOwogICAgICAgICAgICB0aGlzLnNob3dUb2FzdChyZXMuZGF0YS5kZXNjcmlwdGlvbiwgInN1Y2Nlc3MiKTsKICAgICAgICAgICAgYXdhaXQgdGhpcy5HZXRTY2hlZHVsZXJUaWNrZXRzKCk7CiAgICAgICAgICAgIGF3YWl0IHRoaXMuU2NoZWR1bGVyRWRpdEZ1bmMoKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKG9iai5mcmVxdWVuY3lUeXBlID09PSAiZGFpbHkiKSB7CiAgICAgICAgICBsZXQgY2VpbERhdGUgPSBtb21lbnQodGhpcy5jZWlsU3RhcnREYXRlVGltZSkuZm9ybWF0KCJZWVlZLU1NLUREIik7CiAgICAgICAgICBsZXQgYXBwZW5kVGltZSA9IG1vbWVudChvYmouZGVhZExpbmVEYXRlKS5mb3JtYXQoIkhIOm1tIik7CiAgICAgICAgICBsZXQgdGltZSA9IGFwcGVuZFRpbWUgKyAiOjAwKzA1OjAwIjsKICAgICAgICAgIHN0YXJ0RGF0ZSA9IGNlaWxEYXRlICsgIlQiICsgdGltZTsgLy8gb2JqLmRlYWRMaW5lRGF0ZSA9IG1vbWVudChzdGFydERhdGUpLmZvcm1hdCgpOwoKICAgICAgICAgIGxldCByZXMgPSBhd2FpdCBJbnNwZWN0aW9uU2VydmljZS5hc3NpZ25TY2hlZHVsZUluc3BlY3Rpb25UZW1wbGF0ZShvYmopOwoKICAgICAgICAgIGlmIChyZXMuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgICAgdGhpcy50ZW1wQXNzaWdubWVudCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmNsb3NlKCk7CiAgICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KHJlcy5kYXRhLmRlc2NyaXB0aW9uLCAic3VjY2VzcyIpOwogICAgICAgICAgICBhd2FpdCB0aGlzLkdldFNjaGVkdWxlclRpY2tldHMoKTsKICAgICAgICAgICAgYXdhaXQgdGhpcy5TY2hlZHVsZXJFZGl0RnVuYygpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAob2JqLmZyZXF1ZW5jeVR5cGUgPT09ICJ3ZWVrbHkiIHx8IG9iai5mcmVxdWVuY3lUeXBlID09PSAibW9udGhseSIgfHwgb2JqLmZyZXF1ZW5jeVR5cGUgPT09ICJ5ZWFybHkiKSB7CiAgICAgICAgICBsZXQgcmVzID0gYXdhaXQgSW5zcGVjdGlvblNlcnZpY2UuYXNzaWduU2NoZWR1bGVJbnNwZWN0aW9uVGVtcGxhdGUob2JqKTsKCiAgICAgICAgICBpZiAocmVzLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAgIHRoaXMudGVtcEFzc2lnbm1lbnQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5jbG9zZSgpOwogICAgICAgICAgICB0aGlzLnNob3dUb2FzdChyZXMuZGF0YS5kZXNjcmlwdGlvbiwgInN1Y2Nlc3MiKTsKICAgICAgICAgICAgYXdhaXQgdGhpcy5HZXRTY2hlZHVsZXJUaWNrZXRzKCk7CiAgICAgICAgICAgIGF3YWl0IHRoaXMuU2NoZWR1bGVyRWRpdEZ1bmMoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICB0aGlzLmxvYWRlckZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLnNob3dUb2FzdChlLmRhdGEuZGVzY3JpcHRpb24sICJlcnJvciIpOwogICAgICAgIHRocm93IGU7CiAgICAgIH0KICAgIH0sCgogICAgcG9wdXBPcGVuKGFyZ3MpIHsKICAgICAgY29uc29sZS5sb2coJ3BvcHVwT3BlbicpOwogICAgfSwKCiAgICBhc3luYyB1cGRhdGVBc3NpZ25lZFRlbXBsYXRlKG9iaikgewogICAgICB0cnkgewogICAgICAgIGxldCByZXMgPSBhd2FpdCBpbnNwZWN0aW9uU2VydmljZS51cGRhdGVBc3NpZ25TY2hlZHVsZUluc3BlY3Rpb25UZW1wbGF0ZShvYmopOwoKICAgICAgICBpZiAocmVzLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICB0aGlzLnRlbXBBc3NpZ25tZW50ID0gZmFsc2U7CiAgICAgICAgICB0aGlzLiRlbWl0KCJzaG93VG9hc3QiLCByZXMuZGF0YS5kZXNjcmlwdGlvbiwgInN1Y2Nlc3MiKTsKICAgICAgICAgIGF3YWl0IHRoaXMuR2V0U2NoZWR1bGVyVGlja2V0cygpOwogICAgICAgICAgYXdhaXQgdGhpcy5TY2hlZHVsZXJFZGl0RnVuYygpOwogICAgICAgICAgdGhpcy5sb2FkZXJGbGFnID0gZmFsc2U7CiAgICAgICAgICB0aGlzLmNsb3NlKCk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgdGhpcy4kZW1pdCgic2hvd1RvYXN0IiwgZS5kYXRhLnJlc3BvbnNlLCAiZXJyb3IiKTsKICAgICAgICB0aHJvdyBlOwogICAgICB9CiAgICB9LAoKICAgIHdvcmtPcmRlckFzc2lnbm1lbnQoY3JlYXRlV29ya09yZGVyUmVxdWVzdCkgewogICAgICBjb25zb2xlLmxvZyhjcmVhdGVXb3JrT3JkZXJSZXF1ZXN0KTsKICAgICAgV29ya09yZGVyU2VydmljZS5hZGRXb3JrT3JkZXIoY3JlYXRlV29ya09yZGVyUmVxdWVzdCwgdGhpcy5jdXJyZW50VXNlckRldGFpbHMucHJvZmlsZS5vcmdhbml6YXRpb25JZCkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgaWYgKHJlc3BvbnNlKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygicmVzcG9uc2UiLCByZXNwb25zZSk7CiAgICAgICAgICBsZXQgc3RhcnREYXRlID0gY3JlYXRlV29ya09yZGVyUmVxdWVzdC53b3JrT3JkZXIuc2NoZWR1bGUuZm9ybWF0KCJNTSBERCBZWVlZIik7CiAgICAgICAgICB2YXIgdG9kYXkgPSBuZXcgRGF0ZSgpOwogICAgICAgICAgdmFyIHRpbWUgPSB0b2RheS5nZXRIb3VycygpICsgIjoiICsgdG9kYXkuZ2V0TWludXRlcygpICsgIjoiICsgdG9kYXkuZ2V0U2Vjb25kcygpOwogICAgICAgICAgdmFyIGRhdGVUaW1lID0gc3RhcnREYXRlICsgIiAiICsgdGltZTsKICAgICAgICAgIHZhciBkYXRlID0gbW9tZW50KGRhdGVUaW1lKS5mb3JtYXQoKTsKICAgICAgICAgIGxldCBlbmREYXRlID0gbW9tZW50KGRhdGUpLnN1YnRyYWN0KDEsICJoIikuZm9ybWF0KCk7CiAgICAgICAgICBsZXQgc2NoZWR1bGVPYmogPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiU2NoZWR1bGUiKS5lajJfaW5zdGFuY2VzWzBdOwogICAgICAgICAgbGV0IGV2ZW50RGF0YSA9IHsKICAgICAgICAgICAgSWQ6IHRoaXMuZ2VuZXJhdGVVVUlEKCksCiAgICAgICAgICAgIFN1YmplY3Q6ICJXb3JrIE9yZGVyIiwKICAgICAgICAgICAgU3RhcnRUaW1lOiBuZXcgRGF0ZShlbmREYXRlKSwKICAgICAgICAgICAgRW5kVGltZTogbmV3IERhdGUoZGF0ZVRpbWUpLAogICAgICAgICAgICBJc0FsbERheTogZmFsc2UKICAgICAgICAgIH07CiAgICAgICAgICBjb25zb2xlLmxvZygiZGF0YSIsIGV2ZW50RGF0YSk7CiAgICAgICAgICBzY2hlZHVsZU9iai5hZGRFdmVudChldmVudERhdGEpOwogICAgICAgICAgdGhpcy5sb2FkZXJGbGFnID0gZmFsc2U7CiAgICAgICAgICB0aGlzLmNsb3NlKCk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgaWYgKGVycm9yKSB7CiAgICAgICAgICB0aGlzLmxvYWRlckZsYWcgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KGVycm9yLmRhdGEucmVzcG9uc2UsICJlcnJvciIpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAoKICAgIGlzc3VlQXNzaWdubWVudChpc3N1ZVJlcXVlc3QpIHsKICAgICAgY29uc29sZS5sb2coImlzc3VlUmVxdWVzdCIsIGlzc3VlUmVxdWVzdCk7IC8vcmV0dXJuOwoKICAgICAgSW5zcGVjdGlvblNlcnZpY2UuYWRkSXNzdWUoaXNzdWVSZXF1ZXN0KS50aGVuKHJlcyA9PiB7CiAgICAgICAgY29uc29sZS5sb2cocmVzKTsKCiAgICAgICAgaWYgKHJlcy5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgbGV0IHNjaGVkdWxlT2JqID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIlNjaGVkdWxlIikuZWoyX2luc3RhbmNlc1swXTsKICAgICAgICAgIGxldCBldmVudERhdGEgPSB7CiAgICAgICAgICAgIElkOiB0aGlzLmdlbmVyYXRlVVVJRCgpLAogICAgICAgICAgICBTdWJqZWN0OiBpc3N1ZVJlcXVlc3QuaXNzdWVSZXBvcnRpbmcuaXNzdWVOYW1lLAogICAgICAgICAgICBTdGFydFRpbWU6IHRoaXMuY2FsZW5kZXJEYXRlT2JqLnN0YXJ0VGltZSwKICAgICAgICAgICAgRW5kVGltZTogdGhpcy5jYWxlbmRlckRhdGVPYmouZW5kVGltZSwKICAgICAgICAgICAgSXNBbGxEYXk6IGZhbHNlLAogICAgICAgICAgICBJc3N1ZUlkOiByZXMuZGF0YS5vYmplY3RJZAogICAgICAgICAgfTsKICAgICAgICAgIGNvbnNvbGUubG9nKCJkYXRhIiwgZXZlbnREYXRhKTsKICAgICAgICAgIHNjaGVkdWxlT2JqLmFkZEV2ZW50KGV2ZW50RGF0YSk7CiAgICAgICAgICB0aGlzLmNsb3NlKCk7CiAgICAgICAgICB0aGlzLmxvYWRlckZsYWcgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGVyciA9PiB7CiAgICAgICAgY29uc29sZS5sb2coZXJyKTsKICAgICAgICB0aGlzLmxvYWRlckZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLnNob3dUb2FzdChlcnIucmVzcG9uc2UuZGF0YS5kZXNjcmlwdGlvbiwgImVycm9yIik7CiAgICAgIH0pOwogICAgfSwKCiAgICB1cGRhdGVJc3N1ZUFzc2lnbm1lbnQodXBkYXRlSXNzdWVSZXF1ZXN0KSB7CiAgICAgIHRoaXMudGVtcFNjaGVkdWxlTmFtZSA9IHVwZGF0ZUlzc3VlUmVxdWVzdC5pc3N1ZVJlcG9ydGluZy5pc3N1ZU5hbWU7CiAgICAgIEluc3BlY3Rpb25TZXJ2aWNlLnVwZGF0ZUlzc3VlKHVwZGF0ZUlzc3VlUmVxdWVzdCkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAvL3RoaXMub25BY3Rpb25CZWdpbigpOwogICAgICAgICAgdGhpcy5sb2FkZXJGbGFnID0gZmFsc2U7CiAgICAgICAgICB0aGlzLmNsb3NlKCk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgdGhpcy5zaG93VG9hc3QoZXJyb3IuZGF0YS5yZXNwb25zZSwgImVycm9yIik7CiAgICAgIH0pOwogICAgfSwKCiAgICBjcmVhdGVTZXJ2aWNlUmVxdWVzdChpc3N1ZVJlcXVlc3QpIHsKICAgICAgY29uc29sZS5sb2coaXNzdWVSZXF1ZXN0KTsKICAgICAgY29uc29sZS5sb2codGhpcy5jYWxlbmRlckRhdGVPYmopOwogICAgICBJbnNwZWN0aW9uU2VydmljZS5hZGRJc3N1ZShpc3N1ZVJlcXVlc3QpLnRoZW4ocmVzID0+IHsKICAgICAgICBpZiAocmVzLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICB0aGlzLmxvYWRlckZsYWcgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KHJlcy5kYXRhLmRlc2NyaXB0aW9uLCAic3VjY2VzcyIpOwogICAgICAgICAgbGV0IHNjaGVkdWxlT2JqID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIlNjaGVkdWxlIikuZWoyX2luc3RhbmNlc1swXTsKICAgICAgICAgIGxldCBldmVudERhdGEgPSB7CiAgICAgICAgICAgIElkOiB0aGlzLmdlbmVyYXRlVVVJRCgpLAogICAgICAgICAgICBTdWJqZWN0OiBpc3N1ZVJlcXVlc3QuaXNzdWVSZXBvcnRpbmcuaXNzdWVOYW1lLAogICAgICAgICAgICBTdGFydFRpbWU6IHRoaXMuY2FsZW5kZXJEYXRlT2JqLnN0YXJ0VGltZSwKICAgICAgICAgICAgRW5kVGltZTogdGhpcy5jYWxlbmRlckRhdGVPYmouZW5kVGltZSwKICAgICAgICAgICAgSXNBbGxEYXk6IGZhbHNlCiAgICAgICAgICB9OwogICAgICAgICAgY29uc29sZS5sb2coImRhdGEiLCBldmVudERhdGEpOwogICAgICAgICAgc2NoZWR1bGVPYmouYWRkRXZlbnQoZXZlbnREYXRhKTsKICAgICAgICAgIHRoaXMuY2xvc2UoKTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGVyciA9PiB7CiAgICAgICAgdGhpcy5sb2FkZXJGbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy5zaG93VG9hc3QoZXJyLCAiZXJyb3IiKTsKICAgICAgICBjb25zb2xlLmxvZyhlcnIpOwogICAgICB9KTsKICAgIH0sCgogICAgc2hvd1RvYXN0KG1lc3NhZ2UsIHR5cGUpIHsKICAgICAgdGhpcy50b2FzdE1lc3NhZ2UgPSBtZXNzYWdlOwogICAgICB0aGlzLnRvYXN0VHlwZSA9IHR5cGU7CiAgICAgIHRoaXMudG9hc3RGbGFnKys7CiAgICB9LAoKICAgIGdlbmVyYXRlVVVJRCgpIHsKICAgICAgbGV0IGQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKCiAgICAgIGlmIChEYXRlLm5vdygpKSB7CiAgICAgICAgZCA9IERhdGUubm93KCk7CiAgICAgIH0KCiAgICAgIGxldCB1dWlkID0gInh4eHh4eHh4LXh4eHgtNHh4eC15eHh4LXh4eHh4eHh4eHh4eCIucmVwbGFjZSgvW3h5XS9nLCBjID0+IHsKICAgICAgICBsZXQgciA9IChkICsgTWF0aC5yYW5kb20oKSAqIDE2KSAlIDE2IHwgMDsKICAgICAgICBkID0gTWF0aC5mbG9vcihkIC8gMTYpOwogICAgICAgIHJldHVybiAoYyA9PT0gIngiID8gciA6IHIgJiAweDMgfCAweDgpLnRvU3RyaW5nKDE2KTsKICAgICAgfSk7CiAgICAgIHJldHVybiB1dWlkOwogICAgfSwKCiAgICBzZWxlY3RVc2VyKCkgewogICAgICBsZXQgY3VycmVudFVzZXJEZXRhaWxzID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiY3VycmVudFVzZXJEZXRhaWxzIikpOwogICAgICBBc3NldFBlcnNvbm5lbFNlcnZpY2UuZ2V0QWxsVXNlcnMoY3VycmVudFVzZXJEZXRhaWxzLnByb2ZpbGUub3JnYW5pemF0aW9uSWQpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgIGxldCB1c2VycyA9IFtdOwoKICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgcmVzcG9uc2UuZGF0YS51c2Vycy5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgIGxldCB1c2VyID0ge307CiAgICAgICAgICB1c2VyLmxhYmVsID0gcmVzcG9uc2UuZGF0YS51c2Vyc1tpbmRleF0ubmFtZTsKICAgICAgICAgIHVzZXIudmFsdWUgPSByZXNwb25zZS5kYXRhLnVzZXJzW2luZGV4XS5uYW1lOwogICAgICAgICAgdXNlci51dWlkID0gcmVzcG9uc2UuZGF0YS51c2Vyc1tpbmRleF0udXVpZDsKICAgICAgICAgIHVzZXIubmFtZSA9IHJlc3BvbnNlLmRhdGEudXNlcnNbaW5kZXhdLm5hbWU7CiAgICAgICAgICB1c2Vycy5wdXNoKHVzZXIpOwogICAgICAgICAgdGhpcy5hbGxVc2Vycy5wdXNoKHsKICAgICAgICAgICAgZmlyc3ROYW1lOiByZXNwb25zZS5kYXRhLnVzZXJzW2luZGV4XS5maXJzdE5hbWUsCiAgICAgICAgICAgIGxhc3ROYW1lOiByZXNwb25zZS5kYXRhLnVzZXJzW2luZGV4XS5sYXN0TmFtZSwKICAgICAgICAgICAgcHJvZmlsZUltYWdlOiByZXNwb25zZS5kYXRhLnVzZXJzW2luZGV4XS5pbWFnZVVybCwKICAgICAgICAgICAgdXVpZDogcmVzcG9uc2UuZGF0YS51c2Vyc1tpbmRleF0udXVpZAogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLlVzZXJzID0gdXNlcnM7CiAgICAgIH0pLmNhdGNoKGUgPT4gewogICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICB9KTsKICAgIH0sCgogICAgdW5Bc3NpZ25Bc3NldChpbmRleCwgdmFsdWUpIHsKICAgICAgdGhpcy5hc3NpZ25UYWJsZVZhbHVlID0gdmFsdWU7CiAgICAgIHZhciBjdXJyZW50RGF0ZSA9IG1vbWVudCgpLmZvcm1hdCgpOwoKICAgICAgaWYgKG1vbWVudCh2YWx1ZS5zdGFydERhdGUpLmZvcm1hdCgpID4gY3VycmVudERhdGUpIHsKICAgICAgICB0aGlzLmZ1dHVyZWRVbkFzc2lnbm1lbnQodmFsdWUuYXNzaWdubWVudElkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zb2xlLmxvZyh2YWx1ZSk7CiAgICAgICAgdGhpcy52YWx1ZUVkaXRBc3NpZ24gPSB2YWx1ZTsKICAgICAgICB0aGlzLnVzZXJJbmRleCA9IGluZGV4OwogICAgICAgIHRoaXMuYXNzZXRVdWlkID0gdmFsdWUuYXNzZXRVdWlkOwogICAgICAgIHRoaXMua2V5SW5kZXgrKzsKICAgICAgICB0aGlzLlNob3dVblBvcFVwID0gdHJ1ZTsKICAgICAgfQogICAgfSwKCiAgICBmdXR1cmVkVW5Bc3NpZ25tZW50KHV1aWQpIHsKICAgICAgdGhpcy5sb2FkZXJGbGFnID0gdHJ1ZTsKICAgICAgQXNzZXRQZXJzb25uZWxTZXJ2aWNlLmRlbGV0ZVBvc3RBc3NpZ25tZW50QnlVVUlEKHV1aWQpLnRoZW4ocmVzID0+IHsKICAgICAgICB0aGlzLnNob3dUb2FzdChyZXMuZGF0YS5kZXNjcmlwdGlvbiwgInN1Y2Nlc3MiKTsgLy8gICB0aGlzLmdldEFzc2lnbmVkVXNlcnNPZkFzc2V0KCk7CgogICAgICAgIHRoaXMubG9hZGVyRmxhZyA9IGZhbHNlOwogICAgICB9KS5jYXRjaChlID0+IHsKICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgfSk7CiAgICB9LAoKICAgIGVkaXRBc3NpZ25lZChpbmRleCwgdmFsKSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKCJlZGl0IiwgdmFsKTsKICAgICAgdGhpcy52YWx1ZUVkaXRBc3NpZ24gPSB2YWw7CiAgICAgIHRoaXMuYXNzZXRVdWlkID0gdmFsLmFzc2V0VXVpZDsKICAgICAgdGhpcy5rZXlJbmRleCsrOwogICAgICB0aGlzLlNob3dQb3BVcCA9IHRydWU7IC8vY29uc29sZS5sb2coInRlc3QiKTsKICAgIH0sCgogICAgb3BlblBvcFVwKHZhbCkgewogICAgICB0aGlzLmFzc2V0VXVpZCA9IHZhbDsKICAgICAgdGhpcy5TaG93UG9wVXAgPSB0cnVlOwogICAgfSwKCiAgICB1bkFzc2lnblVzZXIodmFsdWUpIHsKICAgICAgdGhpcy5sb2FkZXJGbGFnID0gdHJ1ZTsKICAgICAgY29uc29sZS5sb2codmFsdWUpOwogICAgICB2YXIgY3VycmVudERhdGUgPSBtb21lbnQoKS5mb3JtYXQoKTsKICAgICAgdmFyIHNlbGVjdGVkRGF0ZSA9IG1vbWVudCh2YWx1ZS5hc3NpZ25tZW50RGF0ZSkuZm9ybWF0KCJZWVlZLU1NLUREVEhIOk1NOlNTWiIpOwogICAgICB2YXIgZGF0ZVNwbGl0ID0gc2VsZWN0ZWREYXRlLnNwbGl0KCJUIik7CiAgICAgIHZhciBvYmpEYXRlID0gZGF0ZVNwbGl0WzBdOwogICAgICB2YXIgdGltZVNwbGl0ID0gdmFsdWUuYXNzaWdubWVudFRpbWUuc3BsaXQoIjoiKTsKICAgICAgdmFyIGhvdXIgPSB0aW1lU3BsaXRbMF07CiAgICAgIHZhciBtaW4gPSB0aW1lU3BsaXRbMV07CiAgICAgIHZhciBhc3NpZ25tZW50RGF0ZSA9IG9iakRhdGUgKyAiVCIgKyBob3VyICsgIjoiICsgbWluICsgIjoiICsgIjAwKzA1OjAwIjsKCiAgICAgIGlmIChEYXRlLnBhcnNlKHRoaXMuYXNzaWduVGFibGVWYWx1ZS5zdGFydERhdGUpID4gRGF0ZS5wYXJzZShhc3NpZ25tZW50RGF0ZSkpIHsKICAgICAgICB0aGlzLnNob3dUb2FzdCgiU2VsZWN0IERhdGUgYW5kIHRpbWUgbGF0ZXIgdG8gY3VycmVudCBhc3NpZ25tZW50IGRhdGUgYW5kIHRpbWUuIiwgInN1Y2Nlc3MiKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh2YWx1ZS5jdXJyZW50RGF0ZVRpbWUgPT0gdHJ1ZSkgewogICAgICAgIGxldCBEZWxldGVBc3NpZ25tZW50UmVjb3JkUmVxdWVzdCA9IHsKICAgICAgICAgIGFzc2V0VVVJRDogdGhpcy5hc3NldFV1aWQsCiAgICAgICAgICB1c2VyVVVJRDogdmFsdWUudXVpZCwKICAgICAgICAgIGVuZGluZ0RhdGU6IGN1cnJlbnREYXRlCiAgICAgICAgfTsKICAgICAgICBjb25zb2xlLmxvZygiRGVsZXRlQXNzaWdubWVudFJlY29yZFJlcXVlc3QiLCBEZWxldGVBc3NpZ25tZW50UmVjb3JkUmVxdWVzdCk7IC8vcmV0dXJuOwoKICAgICAgICBBc3NldFBlcnNvbm5lbFNlcnZpY2UudW5hc3NpZ25Bc3NldChEZWxldGVBc3NpZ25tZW50UmVjb3JkUmVxdWVzdCkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpOwogICAgICAgICAgfSAvLwlsZXQgdXNlcnMgPSB0aGlzLmFzc2lnbmVkVXNlcnM7CiAgICAgICAgICAvLwlsZXQgaGlzdG9yeVVzZXJzID0gdGhpcy5hc3NpZ25tZW50SGlzdG9yeVVzZXJzOwogICAgICAgICAgLy8JbGV0IGhpc3RvcnlBZGRlZCA9IGZhbHNlOwogICAgICAgICAgLy8JY29uc29sZS5sb2codXNlcnMpOwogICAgICAgICAgLy8JZGVidWdnZXIKICAgICAgICAgIC8vCXRoaXMuZGVsZXRlTW9kZWwgPSBmYWxzZTsKICAgICAgICAgIC8vIGhpc3RvcnlVc2Vycy5tYXAoKGhpc3RvcnlJdGVtKSA9PiB7CiAgICAgICAgICAvLyAJaWYgKGhpc3RvcnlJdGVtLnV1aWQgPT09IHZhbHVlLnV1aWQpIHsKICAgICAgICAgIC8vIAkJaGlzdG9yeUl0ZW0udXNlckVuZGluZ0RhdGVzOwogICAgICAgICAgLy8gCQloaXN0b3J5SXRlbS51c2VyU3RhcnREYXRlczsKICAgICAgICAgIC8vIAkJaGlzdG9yeUFkZGVkID0gdHJ1ZTsKICAgICAgICAgIC8vIAl9CiAgICAgICAgICAvLyAJcmV0dXJuIGhpc3RvcnlJdGVtOwogICAgICAgICAgLy8gfSk7CiAgICAgICAgICAvLyBpZiAoIWhpc3RvcnlBZGRlZCkgewogICAgICAgICAgLy8gCWxldCBuZXdVc2VyID0gewogICAgICAgICAgLy8gCQl1dWlkOiB2YWx1ZS51dWlkLAogICAgICAgICAgLy8gCQluYW1lOiB1c2Vyc1t0aGlzLnVzZXJJbmRleF0ubmFtZSwKICAgICAgICAgIC8vIAkJZHVyYXRpb25zOiB1c2Vyc1t0aGlzLnVzZXJJbmRleF0uZHVyYXRpb25zLAogICAgICAgICAgLy8gCQl1c2VyU3RhcnREYXRlczogdXNlcnNbdGhpcy51c2VySW5kZXhdLnVzZXJTdGFydERhdGVzLAogICAgICAgICAgLy8gCQl1c2VyRW5kaW5nRGF0ZXM6IHVzZXJzW3RoaXMudXNlckluZGV4XS51c2VyRW5kaW5nRGF0ZXMsCiAgICAgICAgICAvLyAJfTsKICAgICAgICAgIC8vIGhpc3RvcnlVc2Vycy5wdXNoKG5ld1VzZXIpOwogICAgICAgICAgLy99CiAgICAgICAgICAvLwl1c2Vycy5zcGxpY2UodGhpcy51c2VySW5kZXgsIDEpOwoKCiAgICAgICAgICB0aGlzLnNob3dUb2FzdCgiVXNlciBVbi1Bc3NpZ25lZCBTdWNjZXNzZnVsbHkiLCAic3VjY2VzcyIpOyAvL3RoaXMuZ2V0QXNzaWduZWRVc2Vyc09mQXNzZXQoKTsKICAgICAgICAgIC8vdGhpcy5nZXRBc3NpZ25tZW50SGlzdG9yeUJ5QXNzZXQoKTsKCiAgICAgICAgICB0aGlzLlNob3dVblBvcFVwID0gZmFsc2U7CiAgICAgICAgICB0aGlzLmxvYWRlckZsYWcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICh2YWx1ZS5jdXJyZW50RGF0ZVRpbWUgPT0gZmFsc2UgJiYgY3VycmVudERhdGUgPiBtb21lbnQodmFsdWUuYXNzaWdubWVudERhdGUpLmZvcm1hdCgpKSB7CiAgICAgICAgc2VsZWN0ZWREYXRlID0gbW9tZW50KHZhbHVlLmFzc2lnbm1lbnREYXRlKS5mb3JtYXQoIllZWVktTU0tRERUSEg6TU06U1NaIik7CiAgICAgICAgZGF0ZVNwbGl0ID0gc2VsZWN0ZWREYXRlLnNwbGl0KCJUIik7CiAgICAgICAgb2JqRGF0ZSA9IGRhdGVTcGxpdFswXTsKICAgICAgICB0aW1lU3BsaXQgPSB2YWx1ZS5hc3NpZ25tZW50VGltZS5zcGxpdCgiOiIpOwogICAgICAgIGhvdXIgPSB0aW1lU3BsaXRbMF07CiAgICAgICAgbWluID0gdGltZVNwbGl0WzFdOwogICAgICAgIGxldCBhc3NpZ25tZW50RGF0ZSA9IG9iakRhdGUgKyAiVCIgKyBob3VyICsgIjoiICsgbWluICsgIjoiICsgIjAwKzA1OjAwIjsKICAgICAgICBsZXQgRGVsZXRlQXNzaWdubWVudFJlY29yZFJlcXVlc3QgPSB7CiAgICAgICAgICBhc3NldFVVSUQ6IHZhbHVlLmFzc2V0VXVpZCwKICAgICAgICAgIHVzZXJVVUlEOiB2YWx1ZS51dWlkLAogICAgICAgICAgZW5kaW5nRGF0ZTogbW9tZW50KGFzc2lnbm1lbnREYXRlKS5mb3JtYXQoKQogICAgICAgIH07CiAgICAgICAgQXNzZXRQZXJzb25uZWxTZXJ2aWNlLnVuYXNzaWduQXNzZXQoRGVsZXRlQXNzaWdubWVudFJlY29yZFJlcXVlc3QpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBsZXQgdXNlcnMgPSB0aGlzLmFzc2lnbmVkVXNlcnM7CiAgICAgICAgICBsZXQgaGlzdG9yeVVzZXJzID0gdGhpcy5hc3NpZ25tZW50SGlzdG9yeVVzZXJzOwogICAgICAgICAgbGV0IGhpc3RvcnlBZGRlZCA9IGZhbHNlOwogICAgICAgICAgaGlzdG9yeVVzZXJzLm1hcChoaXN0b3J5SXRlbSA9PiB7CiAgICAgICAgICAgIGlmIChoaXN0b3J5SXRlbS51dWlkID09PSB2YWx1ZS51dWlkKSB7CiAgICAgICAgICAgICAgaGlzdG9yeUl0ZW0udXNlckVuZGluZ0RhdGVzOwogICAgICAgICAgICAgIGhpc3RvcnlJdGVtLnVzZXJTdGFydERhdGVzOwogICAgICAgICAgICAgIGhpc3RvcnlBZGRlZCA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBoaXN0b3J5SXRlbTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmICghaGlzdG9yeUFkZGVkKSB7CiAgICAgICAgICAgIGxldCBuZXdVc2VyID0gewogICAgICAgICAgICAgIHV1aWQ6IHZhbHVlLnV1aWQsCiAgICAgICAgICAgICAgbmFtZTogdXNlcnNbdGhpcy51c2VySW5kZXhdLm5hbWUsCiAgICAgICAgICAgICAgZHVyYXRpb25zOiB1c2Vyc1t0aGlzLnVzZXJJbmRleF0uZHVyYXRpb25zLAogICAgICAgICAgICAgIHVzZXJTdGFydERhdGVzOiB1c2Vyc1t0aGlzLnVzZXJJbmRleF0udXNlclN0YXJ0RGF0ZXMsCiAgICAgICAgICAgICAgdXNlckVuZGluZ0RhdGVzOiB1c2Vyc1t0aGlzLnVzZXJJbmRleF0udXNlckVuZGluZ0RhdGVzCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGhpc3RvcnlVc2Vycy5wdXNoKG5ld1VzZXIpOwogICAgICAgICAgfQoKICAgICAgICAgIHVzZXJzLnNwbGljZSh0aGlzLnVzZXJJbmRleCwgMSk7CiAgICAgICAgICB0aGlzLnNob3dUb2FzdCgiVXNlciBVbi1Bc3NpZ25lZCBTdWNjZXNzZnVsbHkiLCAic3VjY2VzcyIpOyAvLwl0aGlzLmdldEFzc2lnbmVkVXNlcnNPZkFzc2V0KCk7CiAgICAgICAgICAvL3RoaXMuZ2V0QXNzaWdubWVudEhpc3RvcnlCeUFzc2V0KCk7CgogICAgICAgICAgdGhpcy5TaG93VW5Qb3BVcCA9IGZhbHNlOwogICAgICAgICAgdGhpcy5sb2FkZXJGbGFnID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAoY3VycmVudERhdGUgPCBtb21lbnQodmFsdWUuYXNzaWdubWVudERhdGUpLmZvcm1hdCgpICYmIHZhbHVlLmN1cnJlbnREYXRlVGltZSA9PSBmYWxzZSkgewogICAgICAgIHNlbGVjdGVkRGF0ZSA9IG1vbWVudCh2YWx1ZS5hc3NpZ25tZW50RGF0ZSkuZm9ybWF0KCJZWVlZLU1NLUREVEhIOk1NOlNTWiIpOwogICAgICAgIGRhdGVTcGxpdCA9IHNlbGVjdGVkRGF0ZS5zcGxpdCgiVCIpOwogICAgICAgIG9iakRhdGUgPSBkYXRlU3BsaXRbMF07CiAgICAgICAgdGltZVNwbGl0ID0gdmFsdWUuYXNzaWdubWVudFRpbWUuc3BsaXQoIjoiKTsKICAgICAgICBob3VyID0gdGltZVNwbGl0WzBdOwogICAgICAgIG1pbiA9IHRpbWVTcGxpdFsxXTsKICAgICAgICBsZXQgYXNzaWdubWVudERhdGUgPSBvYmpEYXRlICsgIlQiICsgaG91ciArICI6IiArIG1pbiArICI6IiArICIwMCswNTowMCI7CiAgICAgICAgdmFsdWUuc3RhcnREYXRlID0gYXNzaWdubWVudERhdGU7CiAgICAgICAgdGhpcy51bkFzc2lnbm1lbnRVc2VyTGF0ZXIodmFsdWUpOwogICAgICB9CiAgICB9LAoKICAgIHVuQXNzaWdubWVudFVzZXJMYXRlcih2YWx1ZSkgewogICAgICB0aGlzLmxvYWRlckZsYWcgPSB0cnVlOwogICAgICBJbnNwZWN0aW9uU2VydmljZS5nZXRJbnNwZWN0aW9uVGVtcGFsdGVzQnlBc3NldCh0aGlzLmFzc2V0VXVpZCkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICBsZXQgcG9zdEFzc2lnbm1lbnQgPSBbXTsKICAgICAgICAgIGxldCBvYmogPSB7CiAgICAgICAgICAgIGFzc2lnbm1lbnRVVUlEOiB2YWx1ZS5hc3NpZ25tZW50VVVJRCwKICAgICAgICAgICAgYXNzZXRJZDogdGhpcy5hc3NldFV1aWQsCiAgICAgICAgICAgIHVzZXJJZDogdmFsdWUudXVpZCwKICAgICAgICAgICAgYXNzaWduOiBmYWxzZSwKICAgICAgICAgICAgZW5kRGF0ZTogdmFsdWUuc3RhcnREYXRlCiAgICAgICAgICB9OwogICAgICAgICAgcG9zdEFzc2lnbm1lbnQucHVzaChvYmopOwogICAgICAgICAgbGV0IFVwZGF0ZUFzc2V0QXNzaWdubWVudFJlcXVlc3QgPSB7fTsKICAgICAgICAgIFVwZGF0ZUFzc2V0QXNzaWdubWVudFJlcXVlc3QuaW5zcGVjdGlvblRlbXBsYXRlcyA9IHJlc3BvbnNlLmRhdGEuaW5zcGVjdGlvblRlbXBsYXRlczsKICAgICAgICAgIFVwZGF0ZUFzc2V0QXNzaWdubWVudFJlcXVlc3QucG9zdEFzc2lnbm1lbnQgPSBwb3N0QXNzaWdubWVudDsKICAgICAgICAgIEFzc2V0UGVyc29ubmVsU2VydmljZS5hZGRQb3N0QXNzaWdubWVudE9yVW5Bc3NpZ25tZW50KFVwZGF0ZUFzc2V0QXNzaWdubWVudFJlcXVlc3QpLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgdGhpcy5zaG93VG9hc3QocmVzLmRhdGEuZGVzY3JpcHRpb24sICJzdWNjZXNzIik7CiAgICAgICAgICAgIHRoaXMuU2hvd1VuUG9wVXAgPSBmYWxzZTsgLy8JdGhpcy5nZXRBc3NpZ25lZFVzZXJzT2ZBc3NldCgpOwogICAgICAgICAgICAvLwl0aGlzLmdldEFzc2lnbm1lbnRIaXN0b3J5QnlBc3NldCgpOwoKICAgICAgICAgICAgdGhpcy5sb2FkZXJGbGFnID0gZmFsc2U7CiAgICAgICAgICB9KS5jYXRjaChlID0+IHsKICAgICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGUgPT4gewogICAgICAgIGNvbnNvbGUubG9nKCJlcnJvciIsIGUpOwogICAgICB9KTsKICAgIH0sCgogICAgdXBkYXRlQXNzaWduVXNlcih2YWx1ZSkgewogICAgICBjb25zb2xlLmxvZygiYmVmb3JlIHZhbHVlIiwgdmFsdWUpOyAvLwl0aGlzLmxvYWRlckZsYWcgPSB0cnVlOwoKICAgICAgdmFyIHNlbGVjdGVkRGF0ZSA9IG1vbWVudCh2YWx1ZS5hc3NpZ25tZW50RGF0ZSkuZm9ybWF0KCJZWVlZLU1NLUREVEhIOk1NOlNTWiIpOwogICAgICB2YXIgZGF0ZVNwbGl0ID0gc2VsZWN0ZWREYXRlLnNwbGl0KCJUIik7CiAgICAgIHZhciBvYmpEYXRlID0gZGF0ZVNwbGl0WzBdOwogICAgICB2YXIgdGltZVNwbGl0ID0gdmFsdWUuYXNzaWdubWVudFRpbWUuc3BsaXQoIjoiKTsKICAgICAgdmFyIGhvdXIgPSB0aW1lU3BsaXRbMF07CiAgICAgIHZhciBtaW4gPSB0aW1lU3BsaXRbMV07CiAgICAgIGxldCBmdXR1cmVBc3NpZ25tZW50RGF0ZSA9IG9iakRhdGUgKyAiVCIgKyBob3VyICsgIjoiICsgbWluICsgIjoiICsgIjAwKzA1OjAwIjsKICAgICAgdmFsdWUuc3RhcnREYXRlID0gZnV0dXJlQXNzaWdubWVudERhdGU7CiAgICAgIHZhciBjdXJyZW50RGF0ZSA9IG1vbWVudCgpLmZvcm1hdCgpOwogICAgICBjb25zb2xlLmxvZygiYWZ0ZXIgdmFsdWUiLCB2YWx1ZSk7CiAgICAgIGNvbnNvbGUubG9nKG5ldyBEYXRlKGN1cnJlbnREYXRlKSk7IC8vIGVuZCBEYXRlIEhhbmRsZXIKCiAgICAgIHZhciB1bkFzc2lnbm1lbnREYXRlID0gbW9tZW50KHZhbHVlLnVuQXNzaWdubWVudERhdGUpLmZvcm1hdCgiWVlZWS1NTS1ERCIpOwogICAgICB2YXIgdW5UaW1lU3BsaXQgPSB2YWx1ZS51bkFzc2lnbm1lbnRUaW1lLnNwbGl0KCI6Iik7CiAgICAgIHZhciBlbmRIb3VyID0gdW5UaW1lU3BsaXRbMF07CiAgICAgIHZhciBlbmRNaW4gPSB1blRpbWVTcGxpdFsxXTsKICAgICAgbGV0IGVuZEFzc2lnbm1lbnREYXRlID0gdW5Bc3NpZ25tZW50RGF0ZSArICJUIiArIGVuZEhvdXIgKyAiOiIgKyBlbmRNaW4gKyAiOiIgKyAiMDArMDU6MDAiOwogICAgICBsZXQgc2NoZWR1bGVPYmogPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiU2NoZWR1bGUiKS5lajJfaW5zdGFuY2VzWzBdOwogICAgICBsZXQgZXZlbnREYXRhID0gewogICAgICAgIElkOiB0aGlzLmdlbmVyYXRlVVVJRCgpLAogICAgICAgIFN1YmplY3Q6ICJBc3NldCBBc3NpZ25tZW50IiwKICAgICAgICAvLyBTdGFydFRpbWU6IGN1cnJlbnREYXRlLAogICAgICAgIC8vIEVuZFRpbWU6IG5ldyBEYXRlKGZ1dHVyZUFzc2lnbm1lbnREYXRlKSwKICAgICAgICBJc0FsbERheTogZmFsc2UKICAgICAgfTsKCiAgICAgIGlmICh2YWx1ZS5jdXJyZW50RGF0ZVRpbWUgJiYgdmFsdWUuZW5kQ3VycmVudERhdGVUaW1lKSB7CiAgICAgICAgY29uc29sZS5sb2coIjEiKTsKICAgICAgICBldmVudERhdGEuU3RhcnRUaW1lID0gbmV3IERhdGUoY3VycmVudERhdGUpOwogICAgICAgIGV2ZW50RGF0YS5FbmRUaW1lID0gbmV3IERhdGUoY3VycmVudERhdGUpOwogICAgICB9IGVsc2UgaWYgKHZhbHVlLmN1cnJlbnREYXRlVGltZSA9PT0gZmFsc2UgJiYgdmFsdWUuZW5kQ3VycmVudERhdGVUaW1lID09PSBmYWxzZSkgewogICAgICAgIGNvbnNvbGUubG9nKCIyIik7CiAgICAgICAgZXZlbnREYXRhLlN0YXJ0VGltZSA9IG5ldyBEYXRlKGZ1dHVyZUFzc2lnbm1lbnREYXRlKSwgZXZlbnREYXRhLkVuZFRpbWUgPSBuZXcgRGF0ZShlbmRBc3NpZ25tZW50RGF0ZSk7CiAgICAgIH0KCiAgICAgIGlmICh2YWx1ZS5lbmRDdXJyZW50RGF0ZVRpbWUgJiYgdmFsdWUuY3VycmVudERhdGVUaW1lID09PSBmYWxzZSkgewogICAgICAgIGNvbnNvbGUubG9nKCIzIik7CiAgICAgICAgZXZlbnREYXRhLlN0YXJ0VGltZSA9IG5ldyBEYXRlKGZ1dHVyZUFzc2lnbm1lbnREYXRlKTsKICAgICAgICBldmVudERhdGEuZW5kVGltZSA9IG5ldyBEYXRlKGN1cnJlbnREYXRlKTsKICAgICAgfSBlbHNlIGlmICh2YWx1ZS5lbmRDdXJyZW50RGF0ZVRpbWUgPT09IGZhbHNlICYmIHZhbHVlLmN1cnJlbnREYXRlVGltZSA9PT0gdHJ1ZSkgewogICAgICAgIGNvbnNvbGUubG9nKCI0Iik7CiAgICAgICAgZXZlbnREYXRhLlN0YXJ0VGltZSA9IG5ldyBEYXRlKGN1cnJlbnREYXRlKTsKICAgICAgICBldmVudERhdGEuZW5kVGltZSA9IG5ldyBEYXRlKGVuZEFzc2lnbm1lbnREYXRlKTsKICAgICAgfQoKICAgICAgY29uc29sZS5sb2coImRhdGEiLCBldmVudERhdGEpOwogICAgICBzY2hlZHVsZU9iai5hZGRFdmVudChldmVudERhdGEpOwogICAgICB0aGlzLnVwZGF0ZUN1cnJlbnRBc3NpZ25tZW50KHZhbHVlKTsKICAgIH0sCgogICAgdXBkYXRlQ3VycmVudEFzc2lnbm1lbnQodmFsdWUpIHsKICAgICAgaWYgKHZhbHVlLnVzZXIubGVuZ3RoID4gMSkgewogICAgICAgIHRoaXMuc2hvd1RvYXN0KCJTZWxlY3Qgb25seSBvbmUgdXNlciIsICJlcnJvciIpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgSW5zcGVjdGlvblNlcnZpY2UuZ2V0SW5zcGVjdGlvblRlbXBhbHRlc0J5QXNzZXQodmFsdWUuYXNzZXRVdWlkKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09IDIwMCkgewogICAgICAgICAgbGV0IFVwZGF0ZUFzc2V0QXNzaWdubWVudFJlcXVlc3QgPSB7CiAgICAgICAgICAgIGFzc2lnbm1lbnRJZDogdmFsdWUuYXNzaWdubWVudElkLAogICAgICAgICAgICBhc3NldElkOiB2YWx1ZS5hc3NldFV1aWQsCiAgICAgICAgICAgIHVzZXJJZDogdmFsdWUudXNlclswXS51dWlkCiAgICAgICAgICB9OyAvL2xldCBkYXRlID0gRGF0ZSgpOwoKICAgICAgICAgIHZhciBjdXJyZW50RGF0ZSA9IG1vbWVudCgpLmZvcm1hdCgpOwoKICAgICAgICAgIGlmICh2YWx1ZS5jdXJyZW50RGF0ZVRpbWUgPT0gdHJ1ZSkgewogICAgICAgICAgICBVcGRhdGVBc3NldEFzc2lnbm1lbnRSZXF1ZXN0LnN0YXJ0RGF0ZSA9IGN1cnJlbnREYXRlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgVXBkYXRlQXNzZXRBc3NpZ25tZW50UmVxdWVzdC5zdGFydERhdGUgPSB2YWx1ZS5zdGFydERhdGU7CiAgICAgICAgICB9CgogICAgICAgICAgQXNzZXRQZXJzb25uZWxTZXJ2aWNlLmVkaXRBc3NpZ25tZW50UmVjb3JkKFVwZGF0ZUFzc2V0QXNzaWdubWVudFJlcXVlc3QpLnRoZW4ocmVzcG9uc2UxID0+IHsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlMS5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KCJBc3NldCBVcGRhdGUgc3VjY2Vzc2Z1bGx5IiwgInN1Y2Nlc3MiKTsgLy8gIHRoaXMuZ2V0QXNzaWduZWRVc2Vyc09mQXNzZXQoKTsKCiAgICAgICAgICAgICAgdGhpcy5TaG93UG9wVXAgPSBmYWxzZTsKICAgICAgICAgICAgICB0aGlzLmxvYWRlckZsYWcgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZXJyb3IxID0+IHsKICAgICAgICAgICAgLy8gdGhpcy5zZXRTdGF0ZSh7bG9hZGluZzpmYWxzZX0pOwogICAgICAgICAgICBpZiAoZXJyb3IxLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA2KSB7CiAgICAgICAgICAgICAgdGhpcy5zaG93VG9hc3QoIkVycm9yIHdoaWxlIGFzc2lnbmluZyB1c2VyIHRvIHRoZSBhc3NldCIsICJlcnJvciIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KCJFcnJvciB3aGlsZSBhc3NpZ25pbmcgdXNlciB0byB0aGUgYXNzZXQiLCAiZXJyb3IiKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgaWYgKGVycm9yKSB7CiAgICAgICAgICB0aGlzLnNob3dUb2FzdCgiRXJyb3Igd2hpbGUgYXNzaWduaW5nIHVzZXIgdG8gdGhlIGFzc2V0IiwgImVycm9yIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KCJFcnJvciB3aGlsZSBhc3NpZ25pbmcgdXNlciB0byB0aGUgYXNzZXQiLCAiZXJyb3IiKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICBhc3NpZ25Vc2VyKHZhbHVlKSB7CiAgICAgIGlmICh0aGlzLnZhbHVlICE9PSBudWxsKSB7CiAgICAgICAgdmFyIHNlbGVjdGVkRGF0ZSA9IG1vbWVudCh2YWx1ZS5hc3NpZ25tZW50RGF0ZSkuZm9ybWF0KCJZWVlZLU1NLUREVEhIOk1NOlNTWiIpOwogICAgICAgIHZhciBkYXRlU3BsaXQgPSBzZWxlY3RlZERhdGUuc3BsaXQoIlQiKTsKICAgICAgICB2YXIgb2JqRGF0ZSA9IGRhdGVTcGxpdFswXTsKICAgICAgICB2YXIgdGltZVNwbGl0ID0gdmFsdWUuYXNzaWdubWVudFRpbWUuc3BsaXQoIjoiKTsKICAgICAgICB2YXIgaG91ciA9IHRpbWVTcGxpdFswXTsKICAgICAgICB2YXIgbWluID0gdGltZVNwbGl0WzFdOwogICAgICAgIGxldCBhc3NpZ25tZW50RGF0ZSA9IG9iakRhdGUgKyAiVCIgKyBob3VyICsgIjoiICsgbWluICsgIjoiICsgIjAwKzA1OjAwIjsKICAgICAgICB2YXIgY3VycmVudERhdGUgPSBtb21lbnQoKS5mb3JtYXQoKTsKCiAgICAgICAgaWYgKHZhbHVlLmN1cnJlbnREYXRlVGltZSA9PSB0cnVlKSB7CiAgICAgICAgICB2YWx1ZS5zdGFydERhdGUgPSBhc3NpZ25tZW50RGF0ZTsKICAgICAgICAgIHRoaXMuYXNzaWdubWVudFVzZXJDdXJyZW50RGF0ZSh2YWx1ZSk7CiAgICAgICAgfSBlbHNlIGlmIChhc3NpZ25tZW50RGF0ZSA+IGN1cnJlbnREYXRlICYmIHZhbHVlLmN1cnJlbnREYXRlVGltZSA9PSBmYWxzZSkgewogICAgICAgICAgdmFsdWUuc3RhcnREYXRlID0gYXNzaWdubWVudERhdGU7CiAgICAgICAgICB0aGlzLmFzc2lnbm1lbnRVc2VyTGF0ZXIodmFsdWUpOwogICAgICAgIH0gZWxzZSBpZiAoYXNzaWdubWVudERhdGUgPCBjdXJyZW50RGF0ZSkgewogICAgICAgICAgdmFsdWUuc3RhcnREYXRlID0gYXNzaWdubWVudERhdGU7CiAgICAgICAgICB0aGlzLnBhc3RBc3NpZ25tZW50VXNlckN1cnJlbnREYXRlKHZhbHVlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgYXNzaWdubWVudFVzZXJDdXJyZW50RGF0ZSh2YWx1ZSkgewogICAgICB2YXIgdW5Bc3NpZ25tZW50RGF0ZSA9IG1vbWVudCh2YWx1ZS51bkFzc2lnbm1lbnREYXRlKS5mb3JtYXQoIllZWVktTU0tREQiKTsKICAgICAgdmFyIHRpbWVTcGxpdCA9IHZhbHVlLnVuQXNzaWdubWVudFRpbWUuc3BsaXQoIjoiKTsKICAgICAgdmFyIGhvdXIgPSB0aW1lU3BsaXRbMF07CiAgICAgIHZhciBtaW4gPSB0aW1lU3BsaXRbMV07CiAgICAgIGxldCBhc3NpZ25tZW50RGF0ZSA9IHVuQXNzaWdubWVudERhdGUgKyAiVCIgKyBob3VyICsgIjoiICsgbWluICsgIjoiICsgIjAwKzA1OjAwIjsKICAgICAgdmFyIGN1cnJlbnREYXRlID0gbW9tZW50KCkuZm9ybWF0KCk7CiAgICAgIHRoaXMubG9hZGVyRmxhZyA9IHRydWU7CiAgICAgIEluc3BlY3Rpb25TZXJ2aWNlLmdldEluc3BlY3Rpb25UZW1wYWx0ZXNCeUFzc2V0KHRoaXMuYXNzZXRVdWlkKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAvLwl2YXIgY3VycmVudERhdGUgPSBtb21lbnQoKS5mb3JtYXQoKTsKICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgIGxldCBhc3NpZ25tZW50UmVjb3JkID0gW107CgogICAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHZhbHVlLnVzZXIubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICAgIGNvbnN0IHVzZXJJZCA9IHZhbHVlLnVzZXJbaW5kZXhdLnV1aWQ7CiAgICAgICAgICAgIGxldCBvYmogPSB7CiAgICAgICAgICAgICAgYXNzZXRJZDogdGhpcy5hc3NldFV1aWQsCiAgICAgICAgICAgICAgYXNzZXRNYW5hZ2VySWQ6IHVzZXJJZCwKICAgICAgICAgICAgICB0eXBlOiAiIiwKICAgICAgICAgICAgICBzdGFydGVkQXQ6IGN1cnJlbnREYXRlCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGFzc2lnbm1lbnRSZWNvcmQucHVzaChvYmopOwogICAgICAgICAgfQoKICAgICAgICAgIGxldCBhZGRBc3NldEFzc2lnbm1lbnRSZXF1ZXN0ID0ge307CiAgICAgICAgICBhZGRBc3NldEFzc2lnbm1lbnRSZXF1ZXN0Lmluc3BlY3Rpb25UZW1wbGF0ZXMgPSByZXNwb25zZS5kYXRhLmluc3BlY3Rpb25UZW1wbGF0ZXM7CiAgICAgICAgICBhZGRBc3NldEFzc2lnbm1lbnRSZXF1ZXN0LmFzc2lnbm1lbnRSZWNvcmQgPSBhc3NpZ25tZW50UmVjb3JkOwogICAgICAgICAgY29uc29sZS5sb2coImFzc2lnbm1lbnRSZWNvcmQiLCBhc3NpZ25tZW50UmVjb3JkKTsKICAgICAgICAgIEFzc2V0UGVyc29ubmVsU2VydmljZS5hZGRBc3NpZ25tZW50UmVjb3JkKGFkZEFzc2V0QXNzaWdubWVudFJlcXVlc3QpLnRoZW4ocmVzcG9uc2UxID0+IHsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlMS5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgICAgIHRoaXMuc2VuZE5vdGlmaWNhdGlvblRvQXNzaWduZWRVc2VyT2ZBc3NldHMoYWRkQXNzZXRBc3NpZ25tZW50UmVxdWVzdCk7CiAgICAgICAgICAgICAgbGV0IHVzZXJkZXRhaWwgPSBbXTsKICAgICAgICAgICAgICBBc3NldFBlcnNvbm5lbFNlcnZpY2UuZ2V0VXNlckRldGFpbEJ5QXNzZXRJZEFuZFVzZXJJZCh0aGlzLmFzc2V0VXVpZCwgdmFsdWUudmFsdWUpLnRoZW4ocmVzcG9uc2UyID0+IHsKICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZTIuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgdXNlcmRldGFpbC51dWlkID0gdmFsdWUudmFsdWU7CiAgICAgICAgICAgICAgICAgIHVzZXJkZXRhaWwubmFtZSA9IHZhbHVlLmRpc3BsYXk7CiAgICAgICAgICAgICAgICAgIHVzZXJkZXRhaWwuc3RhcnREYXRlID0gcmVzcG9uc2UyLmRhdGEudXNlci5zdGFydERhdGU7CiAgICAgICAgICAgICAgICAgIHVzZXJkZXRhaWwuY291bnQgPSByZXNwb25zZTIuZGF0YS51c2VyLmNvdW50OwogICAgICAgICAgICAgICAgICB0aGlzLmFzc2lnbmVkVXNlcnMucHVzaCh1c2VyZGV0YWlsKTsKICAgICAgICAgICAgICAgICAgbGV0IHNjaGVkdWxlT2JqID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIlNjaGVkdWxlIikuZWoyX2luc3RhbmNlc1swXTsKICAgICAgICAgICAgICAgICAgbGV0IGV2ZW50RGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICBJZDogdGhpcy5nZW5lcmF0ZVVVSUQoKSwKICAgICAgICAgICAgICAgICAgICBTdWJqZWN0OiAiQXNzZXQgQXNzaWdubWVudCIsCiAgICAgICAgICAgICAgICAgICAgU3RhcnRUaW1lOiBjdXJyZW50RGF0ZSwKICAgICAgICAgICAgICAgICAgICBFbmRUaW1lOiBuZXcgRGF0ZShhc3NpZ25tZW50RGF0ZSksCiAgICAgICAgICAgICAgICAgICAgSXNBbGxEYXk6IGZhbHNlCiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJkYXRhIiwgZXZlbnREYXRhKTsKICAgICAgICAgICAgICAgICAgc2NoZWR1bGVPYmouYWRkRXZlbnQoZXZlbnREYXRhKTsKICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coImFzc2lnbm1lbnRSZWNvcmQiLCBhc3NpZ25tZW50UmVjb3JkKTsKICAgICAgICAgICAgICAgICAgdGhpcy5zaG93VG9hc3QoIkFzc2V0IEFzc2lnbmVkIHRvIHVzZXIgU3VjY2Vzc2Z1bGx5IiwgInN1Y2Nlc3MiKTsKICAgICAgICAgICAgICAgICAgdGhpcy5TaG93UG9wVXAgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkZXJGbGFnID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KCJFcnJvciB3aGlsZSBhc3NpZ25pbmcgdXNlciB0byB0aGUgYXNzZXQiLCAiZXJyb3IiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KS5jYXRjaChlcnJvcjIgPT4gewogICAgICAgICAgICAgICAgaWYgKGVycm9yMi5yZXNwb25zZS5zdGF0dXMgPT09IDQwNikgewogICAgICAgICAgICAgICAgICB0aGlzLnNob3dUb2FzdCgiRXJyb3Igd2hpbGUgYXNzaWduaW5nIHVzZXIgdG8gdGhlIGFzc2V0IiwgImVycm9yIik7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB0aGlzLnNob3dUb2FzdCgiRXJyb3Igd2hpbGUgYXNzaWduaW5nIHVzZXIgdG8gdGhlIGFzc2V0IiwgImVycm9yIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coImVycm9yIik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLmNhdGNoKGVycm9yMSA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yMS5yZXNwb25zZSk7CgogICAgICAgICAgICBpZiAoZXJyb3IxLnJlc3BvbnNlID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICB0aGlzLnNob3dUb2FzdCgiRXJyb3Igd2hpbGUgYXNzaWduaW5nIHVzZXIgdG8gdGhlIGFzc2V0IiwgImVycm9yIik7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3IxLnJlc3BvbnNlLmRhdGEucmVzcG9uc2VDb2RlID09PSAiRjUwMCIpIHsKICAgICAgICAgICAgICB0aGlzLnNob3dUb2FzdChlcnJvcjEucmVzcG9uc2UuZGF0YS5kZXNjcmlwdGlvbiwgImVycm9yIik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZXJyb3IgPT4gewogICAgICAgIGlmIChlcnJvcikgewogICAgICAgICAgdGhpcy5zaG93VG9hc3QoIkVycm9yIHdoaWxlIGFzc2lnbmluZyB1c2VyIHRvIHRoZSBhc3NldCIsICJlcnJvciIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnNob3dUb2FzdCgiRXJyb3Igd2hpbGUgYXNzaWduaW5nIHVzZXIgdG8gdGhlIGFzc2V0IiwgImVycm9yIik7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCgogICAgYXNzaWdubWVudFVzZXJMYXRlcih2YWx1ZSkgewogICAgICAvL2NvbWJpbmUgc3RhcnQgRGF0ZSBhbmQgdGltZS4uLi4KICAgICAgdmFyIGFzc2lnbm1lbnREYXRlID0gbW9tZW50KHZhbHVlLmFzc2lnbm1lbnREYXRlKS5mb3JtYXQoIllZWVktTU0tREQiKTsKICAgICAgdmFyIHN0YXJ0VGltZVNwbGl0ID0gdmFsdWUuYXNzaWdubWVudFRpbWUuc3BsaXQoIjoiKTsKICAgICAgdmFyIHN0YXJ0SG91ciA9IHN0YXJ0VGltZVNwbGl0WzBdOwogICAgICB2YXIgc3RhcnRNaW4gPSBzdGFydFRpbWVTcGxpdFsxXTsKICAgICAgbGV0IHN0YXJ0RGF0ZSA9IGFzc2lnbm1lbnREYXRlICsgIlQiICsgc3RhcnRIb3VyICsgIjoiICsgc3RhcnRNaW4gKyAiOiIgKyAiMDArMDU6MDAiOyAvL2NvbWJpbmUgZW5kIERhdGUgYW5kIHRpbWUuLi4uCgogICAgICB2YXIgdW5Bc3NpZ25tZW50RGF0ZSA9IG1vbWVudCh2YWx1ZS51bkFzc2lnbm1lbnREYXRlKS5mb3JtYXQoIllZWVktTU0tREQiKTsKICAgICAgdmFyIGVuZFRpbWVTcGxpdCA9IHZhbHVlLnVuQXNzaWdubWVudFRpbWUuc3BsaXQoIjoiKTsKICAgICAgdmFyIGVuZEhvdXIgPSBlbmRUaW1lU3BsaXRbMF07CiAgICAgIHZhciBlbmRNaW4gPSBlbmRUaW1lU3BsaXRbMV07CiAgICAgIGxldCBlbmREYXRlID0gdW5Bc3NpZ25tZW50RGF0ZSArICJUIiArIGVuZEhvdXIgKyAiOiIgKyBlbmRNaW4gKyAiOiIgKyAiMDArMDU6MDAiOwogICAgICB0aGlzLmxvYWRlckZsYWcgPSB0cnVlOwogICAgICBJbnNwZWN0aW9uU2VydmljZS5nZXRJbnNwZWN0aW9uVGVtcGFsdGVzQnlBc3NldCh0aGlzLmFzc2V0VXVpZCkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICBsZXQgcG9zdEFzc2lnbm1lbnQgPSBbXTsKCiAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdmFsdWUudXNlci5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgICAgY29uc3QgdXNlcklkID0gdmFsdWUudXNlcltpbmRleF0udXVpZDsKICAgICAgICAgICAgbGV0IG9iaiA9IHsKICAgICAgICAgICAgICBhc3NpZ25tZW50VVVJRDogIiIsCiAgICAgICAgICAgICAgYXNzZXRJZDogdGhpcy5hc3NldFV1aWQsCiAgICAgICAgICAgICAgdXNlcklkOiB1c2VySWQsCiAgICAgICAgICAgICAgYXNzaWduOiB0cnVlLAogICAgICAgICAgICAgIHN0YXJ0RGF0ZTogdmFsdWUuc3RhcnREYXRlCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHBvc3RBc3NpZ25tZW50LnB1c2gob2JqKTsKICAgICAgICAgIH0KCiAgICAgICAgICBsZXQgVXBkYXRlQXNzZXRBc3NpZ25tZW50UmVxdWVzdCA9IHt9OwogICAgICAgICAgVXBkYXRlQXNzZXRBc3NpZ25tZW50UmVxdWVzdC5pbnNwZWN0aW9uVGVtcGxhdGVzID0gcmVzcG9uc2UuZGF0YS5pbnNwZWN0aW9uVGVtcGxhdGVzOwogICAgICAgICAgVXBkYXRlQXNzZXRBc3NpZ25tZW50UmVxdWVzdC5wb3N0QXNzaWdubWVudCA9IHBvc3RBc3NpZ25tZW50OyAvLwlyZXR1cm47CgogICAgICAgICAgQXNzZXRQZXJzb25uZWxTZXJ2aWNlLmFkZFBvc3RBc3NpZ25tZW50T3JVbkFzc2lnbm1lbnQoVXBkYXRlQXNzZXRBc3NpZ25tZW50UmVxdWVzdCkudGhlbihyZXMgPT4gewogICAgICAgICAgICBsZXQgc2NoZWR1bGVPYmogPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiU2NoZWR1bGUiKS5lajJfaW5zdGFuY2VzWzBdOwogICAgICAgICAgICBsZXQgZXZlbnREYXRhID0gewogICAgICAgICAgICAgIElkOiB0aGlzLmdlbmVyYXRlVVVJRCgpLAogICAgICAgICAgICAgIFN1YmplY3Q6ICJBc3NldCBBc3NpZ25tZW50IiwKICAgICAgICAgICAgICBTdGFydFRpbWU6IG5ldyBEYXRlKHN0YXJ0RGF0ZSksCiAgICAgICAgICAgICAgRW5kVGltZTogbmV3IERhdGUoZW5kRGF0ZSksCiAgICAgICAgICAgICAgSXNBbGxEYXk6IGZhbHNlCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJkYXRhIiwgZXZlbnREYXRhKTsKICAgICAgICAgICAgc2NoZWR1bGVPYmouYWRkRXZlbnQoZXZlbnREYXRhKTsKICAgICAgICAgICAgdGhpcy5zaG93VG9hc3QocmVzLmRhdGEuZGVzY3JpcHRpb24sICJzdWNjZXNzIik7CiAgICAgICAgICAgIHRoaXMuU2hvd1BvcFVwID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMubG9hZGVyRmxhZyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmNsb3NlKCk7IC8vCXRoaXMuZ2V0QXNzaWduZWRVc2Vyc09mQXNzZXQoKTsKICAgICAgICAgIH0pLmNhdGNoKGUgPT4gewogICAgICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgY29uc29sZS5sb2coImVycm9yIiwgZSk7CiAgICAgIH0pOwogICAgfSwKCiAgICBwYXN0QXNzaWdubWVudFVzZXJDdXJyZW50RGF0ZSh2YWx1ZSkgewogICAgICB0aGlzLmxvYWRlckZsYWcgPSB0cnVlOwogICAgICBJbnNwZWN0aW9uU2VydmljZS5nZXRJbnNwZWN0aW9uVGVtcGFsdGVzQnlBc3NldCh0aGlzLmFzc2V0VXVpZCkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAvLwlkZWJ1Z2dlcgogICAgICAgICAgbGV0IGFzc2lnbm1lbnRSZWNvcmQgPSBbXTsKCiAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdmFsdWUudXNlci5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgICAgY29uc3QgdXNlcklkID0gdmFsdWUudXNlcltpbmRleF0udXVpZDsKICAgICAgICAgICAgbGV0IG9iaiA9IHsKICAgICAgICAgICAgICBhc3NldElkOiB0aGlzLmFzc2V0VXVpZCwKICAgICAgICAgICAgICBhc3NldE1hbmFnZXJJZDogdXNlcklkLAogICAgICAgICAgICAgIHR5cGU6ICIiLAogICAgICAgICAgICAgIHN0YXJ0ZWRBdDogdmFsdWUuc3RhcnREYXRlCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGFzc2lnbm1lbnRSZWNvcmQucHVzaChvYmopOwogICAgICAgICAgfQoKICAgICAgICAgIGxldCBhZGRBc3NldEFzc2lnbm1lbnRSZXF1ZXN0ID0ge307CiAgICAgICAgICBhZGRBc3NldEFzc2lnbm1lbnRSZXF1ZXN0Lmluc3BlY3Rpb25UZW1wbGF0ZXMgPSByZXNwb25zZS5kYXRhLmluc3BlY3Rpb25UZW1wbGF0ZXM7CiAgICAgICAgICBhZGRBc3NldEFzc2lnbm1lbnRSZXF1ZXN0LmFzc2lnbm1lbnRSZWNvcmQgPSBhc3NpZ25tZW50UmVjb3JkOyAvLwlyZXR1cm47CgogICAgICAgICAgQXNzZXRQZXJzb25uZWxTZXJ2aWNlLmFkZEFzc2lnbm1lbnRSZWNvcmQoYWRkQXNzZXRBc3NpZ25tZW50UmVxdWVzdCkudGhlbihyZXNwb25zZTEgPT4gewogICAgICAgICAgICBpZiAocmVzcG9uc2UxLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgdGhpcy5zZW5kTm90aWZpY2F0aW9uVG9Bc3NpZ25lZFVzZXJPZkFzc2V0cyhhZGRBc3NldEFzc2lnbm1lbnRSZXF1ZXN0KTsKICAgICAgICAgICAgICBsZXQgdXNlcmRldGFpbCA9IFtdOwogICAgICAgICAgICAgIEFzc2V0UGVyc29ubmVsU2VydmljZS5nZXRVc2VyRGV0YWlsQnlBc3NldElkQW5kVXNlcklkKHRoaXMuYXNzZXRVdWlkLCB2YWx1ZS52YWx1ZSkudGhlbihyZXNwb25zZTIgPT4gewogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlMi5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICB1c2VyZGV0YWlsLnV1aWQgPSB2YWx1ZS52YWx1ZTsKICAgICAgICAgICAgICAgICAgdXNlcmRldGFpbC5uYW1lID0gdmFsdWUuZGlzcGxheTsKICAgICAgICAgICAgICAgICAgdXNlcmRldGFpbC5zdGFydERhdGUgPSByZXNwb25zZTIuZGF0YS51c2VyLnN0YXJ0RGF0ZTsKICAgICAgICAgICAgICAgICAgdXNlcmRldGFpbC5jb3VudCA9IHJlc3BvbnNlMi5kYXRhLnVzZXIuY291bnQ7CiAgICAgICAgICAgICAgICAgIHRoaXMuYXNzaWduZWRVc2Vycy5wdXNoKHVzZXJkZXRhaWwpOwogICAgICAgICAgICAgICAgICB0aGlzLnNob3dUb2FzdCgiQXNzZXQgQXNzaWduZWQgdG8gdXNlciBTdWNjZXNzZnVsbHkiLCAic3VjY2VzcyIpOyAvL3RoaXMuZ2V0QXNzaWduZWRVc2Vyc09mQXNzZXQoKTsKCiAgICAgICAgICAgICAgICAgIHRoaXMubG9hZGVyRmxhZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICB0aGlzLlNob3dQb3BVcCA9IGZhbHNlOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgdGhpcy5zaG93VG9hc3QoIkVycm9yIHdoaWxlIGFzc2lnbmluZyB1c2VyIHRvIHRoZSBhc3NldCIsICJlcnJvciIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pLmNhdGNoKGVycm9yMiA9PiB7CiAgICAgICAgICAgICAgICAvLyAgIHRoaXMuc2V0U3RhdGUoe2xvYWRpbmc6ZmFsc2V9KTsKICAgICAgICAgICAgICAgIGlmIChlcnJvcjIucmVzcG9uc2Uuc3RhdHVzID09PSA0MDYpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5zaG93VG9hc3QoIkVycm9yIHdoaWxlIGFzc2lnbmluZyB1c2VyIHRvIHRoZSBhc3NldCIsICJlcnJvciIpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgdGhpcy5zaG93VG9hc3QoIkVycm9yIHdoaWxlIGFzc2lnbmluZyB1c2VyIHRvIHRoZSBhc3NldCIsICJlcnJvciIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChlcnJvcjEgPT4gewogICAgICAgICAgICBpZiAoZXJyb3IxLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA2KSB7CiAgICAgICAgICAgICAgdGhpcy5zaG93VG9hc3QoIkVycm9yIHdoaWxlIGFzc2lnbmluZyB1c2VyIHRvIHRoZSBhc3NldCIsICJlcnJvciIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KCJFcnJvciB3aGlsZSBhc3NpZ25pbmcgdXNlciB0byB0aGUgYXNzZXQiLCAiZXJyb3IiKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgaWYgKGVycm9yKSB7CiAgICAgICAgICB0aGlzLnNob3dUb2FzdCgiRXJyb3Igd2hpbGUgYXNzaWduaW5nIHVzZXIgdG8gdGhlIGFzc2V0IiwgImVycm9yIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KCJFcnJvciB3aGlsZSBhc3NpZ25pbmcgdXNlciB0byB0aGUgYXNzZXQiLCAiZXJyb3IiKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICBzZW5kTm90aWZpY2F0aW9uVG9Bc3NpZ25lZFVzZXJPZkFzc2V0cyhhZGRBc3NldEFzc2lnbm1lbnRSZXF1ZXN0KSB7CiAgICAgIEFzc2V0UGVyc29ubmVsU2VydmljZS5zZW5kTm90aWZpY2F0aW9uVG9Bc3NpZ25lZFVzZXJzKGFkZEFzc2V0QXNzaWdubWVudFJlcXVlc3QpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZXJyb3IgPT4gewogICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTsKICAgICAgfSk7CiAgICB9LAoKICAgIC8vIHJlbW92ZSBhZnRlciBDb21wbGV0aW5nCiAgICBnZXRQYWdpbmF0ZWRJbnNwZWN0aW9uVGVtcGxhdGVzKCkgewogICAgICBsZXQgcmVxdWVzdE9iaiA9IHsKICAgICAgICAvLyBzZWFyY2hRdWVyeTogc2VhcmNoUXVlcnksCiAgICAgICAgLy8gc2VhcmNoQ29sdW1uczogc2VhcmNoQ29sdW1ucywKICAgICAgICBmaWx0ZXJzOiBbXSwKICAgICAgICBzb3J0RmllbGQ6ICJjcmVhdGVkQXQiLAogICAgICAgIHNvcnREaXJlY3Rpb246ICJkZXNjIiwKICAgICAgICBvZmZzZXQ6IDAsCiAgICAgICAgbGltaXQ6IDEwMCwKICAgICAgICB0ZW5hbnRVVUlEOiB0aGlzLmN1cnJlbnRVc2VyRGV0YWlscy5wcm9maWxlLm9yZ2FuaXphdGlvbklkLAogICAgICAgIGFzc2lnbmVkOiB0cnVlCiAgICAgIH07CiAgICAgIEluc3BlY3Rpb25TZXJ2aWNlLmdldFBhZ2luYXRlZFBlbmRpbmdJbnNwZWN0aW9uUmVwb3J0c0ZvclNEVChyZXF1ZXN0T2JqKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09IDIwMCkgewogICAgICAgICAgcmVzcG9uc2UuZGF0YS5zZHREYXRhLmNvbnRlbnQubWFwKGl0ZW0gPT4gewogICAgICAgICAgICBpdGVtLmNyZWF0ZWRBdCA9IG1vbWVudC51dGMoaXRlbS5jcmVhdGVkQXQpLmxvY2FsKCkuZm9ybWF0KCk7CiAgICAgICAgICB9KTsKICAgICAgICAgIGxldCBpbnNwZWN0aW9uVGVtcGxhdGVzID0gcmVzcG9uc2UuZGF0YS5zZHREYXRhLmNvbnRlbnQ7CiAgICAgICAgICBsZXQgYXJyYXkgPSBbXTsKCiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGluc3BlY3Rpb25UZW1wbGF0ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGluc3BlY3Rpb25UZW1wbGF0ZXNbaV0uZGVhZExpbmVEYXRlICE9PSBudWxsICYmIGluc3BlY3Rpb25UZW1wbGF0ZXNbaV0uZGVhZExpbmVUaW1lICE9PSBudWxsIHx8IGluc3BlY3Rpb25UZW1wbGF0ZXNbaV0uZGVhZExpbmVEYXRlICE9PSAiIiAmJiBpbnNwZWN0aW9uVGVtcGxhdGVzW2ldLmRlYWRMaW5lVGltZSAhPT0gIiIpIHsKICAgICAgICAgICAgICAvLyBlbmQgRGF0ZSBIYW5kbGVyCiAgICAgICAgICAgICAgdmFyIGRlYWRMaW5lRGF0ZSA9IG1vbWVudChpbnNwZWN0aW9uVGVtcGxhdGVzW2ldLmRlYWRMaW5lRGF0ZSkuZm9ybWF0KCJZWVlZLU1NLUREIik7CiAgICAgICAgICAgICAgdmFyIGRlYWRMaW5lVGltZSA9IGluc3BlY3Rpb25UZW1wbGF0ZXNbaV0uZGVhZExpbmVUaW1lLnNwbGl0KCI6Iik7CiAgICAgICAgICAgICAgdmFyIGVuZEhvdXIgPSBkZWFkTGluZVRpbWVbMF07CiAgICAgICAgICAgICAgdmFyIGVuZE1pbiA9IGRlYWRMaW5lVGltZVsxXTsKICAgICAgICAgICAgICBsZXQgZW5kQXNzaWdubWVudERhdGUgPSBkZWFkTGluZURhdGUgKyAiVCIgKyBlbmRIb3VyICsgIjoiICsgZW5kTWluICsgIjoiICsgIjAwKzA1OjAwIjsKICAgICAgICAgICAgICBsZXQgU2NoZWR1bGVPYmogPSB7CiAgICAgICAgICAgICAgICBpZDogMSwKICAgICAgICAgICAgICAgIC8vIEdJZDogaW5zcGVjdGlvblRlbXBsYXRlc1tpXS51dWlkLAogICAgICAgICAgICAgICAgU3ViamVjdDogaW5zcGVjdGlvblRlbXBsYXRlc1tpXS5uYW1lLAogICAgICAgICAgICAgICAgU3RhcnRUaW1lOiBuZXcgRGF0ZShpbnNwZWN0aW9uVGVtcGxhdGVzW2ldLmNyZWF0ZWRBdCksCiAgICAgICAgICAgICAgICBFbmRUaW1lOiBuZXcgRGF0ZShlbmRBc3NpZ25tZW50RGF0ZSksCiAgICAgICAgICAgICAgICBJc0FsbERheTogZmFsc2UKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIHNjaGVkdWxlRGF0YS5wdXNoKFNjaGVkdWxlT2JqKTsgLy9jb25zb2xlLmxvZyhzY2hlZHVsZURhdGEpCgogICAgICAgICAgICAgIHRoaXMuc2NoZWR1bGVLZXkrKzsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMubG9hZGVyRmxhZyA9IGZhbHNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuJGVtaXQoInNob3dUb2FzdCIsICJPcHBzIGl0cyBsb29rIGxpa2Ugb3VyIHNlcnZlciBpcyBvZmZsaW5lIiwgImVycm9yIik7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgaWYgKGVycm9yLnJlc3BvbnNlICE9PSB1bmRlZmluZWQgJiYgZXJyb3IucmVzcG9uc2Uuc3RhdHVzID09PSA0MDYpIHsKICAgICAgICAgIC8vIGFsZXJ0KGVycm9yLnJlc3BvbnNlLmRhdGEuZGVzY3JpcHRpb24pOwogICAgICAgICAgdGhpcy4kZW1pdCgic2hvd1RvYXN0IiwgZXJyb3IucmVzcG9uc2UuZGF0YS5kZXNjcmlwdGlvbiwgImVycm9yIik7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCgogICAgLy8gcmVtb3ZlIGFmdGVyIENvbXBsZXRpbmcKICAgIGFzeW5jIEdldFNjaGVkdWxlclRpY2tldHMoKSB7CiAgICAgIHRoaXMubG9hZGVyRmxhZyA9IHRydWU7CiAgICAgIHZhciBzdGFydERhdGUgPSBtb21lbnQoKS5zdGFydE9mKCJ3ZWVrIik7CiAgICAgIHZhciBlbmREYXRlID0gbW9tZW50KCkuZW5kT2YoIndlZWsiKTsKICAgICAgbGV0IHJlcXVlc3RPYmogPSB7CiAgICAgICAgdGVuYW50VVVJRDogdGhpcy5jdXJyZW50VXNlckRldGFpbHMucHJvZmlsZS5vcmdhbml6YXRpb25JZCwKICAgICAgICBkYXRhQnk6ICJ3ZWVrIiwKICAgICAgICBzdGFydERhdGU6IHRoaXMuc2NoZWR1bGVTdGFydFRpbWUgPT0gIiIgJiYgdGhpcy5zY2hlZHVsZXJFbmRUaW1lID09ICIiID8gdGhpcy5zY2hlZHVsZVN0YXJ0VGltZSA6IHN0YXJ0RGF0ZSwKICAgICAgICBlbmREYXRlOiB0aGlzLnNjaGVkdWxlU3RhcnRUaW1lID09ICIiICYmIHRoaXMuc2NoZWR1bGVyRW5kVGltZSA9PSAiIiA/IHRoaXMuc2NoZWR1bGVFbmRUaW1lIDogZW5kRGF0ZSwKICAgICAgICBzZWFyY2hRdWVyeTogIiIsCiAgICAgICAgaW5zcGVjdGlvbkZpbHRlcnM6IHt9LAogICAgICAgIGFzc2lnbm1lbnRGaWx0ZXJzOiB7fSwKICAgICAgICBzZXJ2aWNlUmVxdWVzdEZpbHRlcnM6IHt9LAogICAgICAgIGlzc3VlRmlsdGVyczoge30sCiAgICAgICAgd29ya09yZGVyRmlsdGVyczoge30KICAgICAgfTsgLy8gY29uc29sZS5sb2coInJlcXVlc3RPYmoiLCByZXF1ZXN0T2JqKTsKCiAgICAgIHRoaXMuY3VycmVudFVzZXJEZXRhaWxzLnByb2ZpbGUub3JnYW5pemF0aW9uSWQ7CgogICAgICB0cnkgewogICAgICAgIGxldCByZXNwb25zZSA9IGF3YWl0IHNjaGVkdWxlclNlcnZpY2UuZ2V0U2NoZWR1bGFyVGlja2V0cyhyZXF1ZXN0T2JqKTsKCiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PSAyMDApIHsKICAgICAgICAgIGxldCBzY2hlZHVsZXJUZW1wbGF0ZXMgPSByZXNwb25zZS5kYXRhLnNjaGVkdWxlcnM7CiAgICAgICAgICBsZXQgYXJyYXkgPSBbXTsKCiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNjaGVkdWxlclRlbXBsYXRlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgdGVtcGxhdGVEYXRhID0gSlNPTi5wYXJzZShzY2hlZHVsZXJUZW1wbGF0ZXNbaV0udGVtcGxhdGVEYXRhKTsKICAgICAgICAgICAgdmFyIHJlT2N1cnJlbmNlUnVsZSA9ICIiOwoKICAgICAgICAgICAgaWYgKHNjaGVkdWxlclRlbXBsYXRlc1tpXS5mcmVxdWVuY3lUeXBlID09ICJhZC1ob2MiKSB7CiAgICAgICAgICAgICAgdGhpcy5zY2hlZHVsZU9ialN0YXJ0RGF0ZSA9IG1vbWVudC51dGModGVtcGxhdGVEYXRhLmRlYWRMaW5lRGF0ZSkuZm9ybWF0KCk7CiAgICAgICAgICAgICAgdGhpcy5zY2hlZHVsZU9iakVuZERhdGUgPSBtb21lbnQudXRjKHRoaXMuc2NoZWR1bGVPYmpTdGFydERhdGUpLmFkZCgzMCwgIm1pbnV0ZXMiKS5mb3JtYXQoKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChzY2hlZHVsZXJUZW1wbGF0ZXNbaV0uZnJlcXVlbmN5VHlwZSA9PSAiZGFpbHkiKSB7CiAgICAgICAgICAgICAgdGhpcy5zY2hlZHVsZU9ialN0YXJ0RGF0ZSA9IG1vbWVudC51dGModGVtcGxhdGVEYXRhLmRlYWRMaW5lRGF0ZSkuZm9ybWF0KCk7CiAgICAgICAgICAgICAgdGhpcy5zY2hlZHVsZU9iakVuZERhdGUgPSBtb21lbnQudXRjKHRoaXMuc2NoZWR1bGVPYmpTdGFydERhdGUpLmFkZCgzMCwgIm1pbnV0ZXMiKS5mb3JtYXQoKTsKCiAgICAgICAgICAgICAgaWYgKHRlbXBsYXRlRGF0YS5lbmRUeXBlID09ICJuZXZlciIpIHsKICAgICAgICAgICAgICAgIHJlT2N1cnJlbmNlUnVsZSA9ICJGUkVRPSIgKyBzY2hlZHVsZXJUZW1wbGF0ZXNbaV0uZnJlcXVlbmN5VHlwZS50b1VwcGVyQ2FzZSgpICsgIjtJTlRFUlZBTD0iICsgdGVtcGxhdGVEYXRhLnJlcGVhdEV2ZXJ5ICsgIjsiOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAodGVtcGxhdGVEYXRhLmVuZFR5cGUgPT0gIm9uIikgewogICAgICAgICAgICAgICAgbGV0IGRhdGUgPSBtb21lbnQodGVtcGxhdGVEYXRhLmVuZERhdGUpLmZvcm1hdCgiWVlZWS1NTS1ERCIpOwogICAgICAgICAgICAgICAgbGV0IHRpbWUgPSBtb21lbnQodGVtcGxhdGVEYXRhLmRlYWRMaW5lRGF0ZSkuZm9ybWF0KCJISDptbTpzcyIpOwogICAgICAgICAgICAgICAgc3RhcnREYXRlID0gZGF0ZSArICJUIiArIHRpbWU7CiAgICAgICAgICAgICAgICBsZXQgRGF0ZUZvcm1hdFN0cmluZyA9IG1vbWVudChzdGFydERhdGUpLmZvcm1hdCgiWVlZWU1NRERUSEhtbXNzIik7CiAgICAgICAgICAgICAgICByZU9jdXJyZW5jZVJ1bGUgPSAiRlJFUT0iICsgc2NoZWR1bGVyVGVtcGxhdGVzW2ldLmZyZXF1ZW5jeVR5cGUudG9VcHBlckNhc2UoKSArICI7SU5URVJWQUw9IiArIHRlbXBsYXRlRGF0YS5yZXBlYXRFdmVyeSArICI7VU5USUw9IiArIERhdGVGb3JtYXRTdHJpbmcgKyAiOyI7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0ZW1wbGF0ZURhdGEuZW5kVHlwZSA9PT0gImFmdGVyIikgewogICAgICAgICAgICAgICAgcmVPY3VycmVuY2VSdWxlID0gIkZSRVE9IiArIHNjaGVkdWxlclRlbXBsYXRlc1tpXS5mcmVxdWVuY3lUeXBlLnRvVXBwZXJDYXNlKCkgKyAiO0lOVEVSVkFMPSIgKyB0ZW1wbGF0ZURhdGEucmVwZWF0RXZlcnkgKyAiO0NPVU5UPSIgKyB0ZW1wbGF0ZURhdGEub2NjdXJyZW5jZSArICI7IjsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmVPY3VycmVuY2VSdWxlID0gIiI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHNjaGVkdWxlclRlbXBsYXRlc1tpXS5mcmVxdWVuY3lUeXBlID09ICJ3ZWVrbHkiKSB7CiAgICAgICAgICAgICAgdGhpcy5zY2hlZHVsZU9ialN0YXJ0RGF0ZSA9IG1vbWVudC51dGModGVtcGxhdGVEYXRhLnN0YXJ0RGF0ZSkuZm9ybWF0KCk7CiAgICAgICAgICAgICAgdGhpcy5zY2hlZHVsZU9iakVuZERhdGUgPSBtb21lbnQudXRjKHRoaXMuc2NoZWR1bGVPYmpTdGFydERhdGUpLmFkZCgzMCwgIm1pbnV0ZXMiKS5mb3JtYXQoKTsKICAgICAgICAgICAgICBsZXQgZnJlRGF5ID0gSlNPTi5wYXJzZSh0ZW1wbGF0ZURhdGEuZnJlcXVlbmN5RGF5cyk7CiAgICAgICAgICAgICAgbGV0IGFycmF5ID0gW107CgogICAgICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBmcmVEYXkubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9IGZyZURheVtpbmRleF0udmFsdWUuc2xpY2UoMCwgMik7CiAgICAgICAgICAgICAgICBhcnJheS5wdXNoKGVsZW1lbnQpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgbGV0IGZyZURheXMgPSBhcnJheS5qb2luKCk7CgogICAgICAgICAgICAgIGlmICh0ZW1wbGF0ZURhdGEuZW5kVHlwZSA9PT0gIm5ldmVyIiAmJiBzY2hlZHVsZXJUZW1wbGF0ZXNbaV0uZnJlcXVlbmN5VHlwZSA9PSAid2Vla2x5IikgewogICAgICAgICAgICAgICAgcmVPY3VycmVuY2VSdWxlID0gIkZSRVE9IiArIHNjaGVkdWxlclRlbXBsYXRlc1tpXS5mcmVxdWVuY3lUeXBlLnRvVXBwZXJDYXNlKCkgKyAiO0lOVEVSVkFMPSIgKyB0ZW1wbGF0ZURhdGEucmVwZWF0RXZlcnkgKyAiO0JZREFZPSIgKyBmcmVEYXlzICsgIjsiOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAodGVtcGxhdGVEYXRhLmVuZFR5cGUgPT09ICJvbiIgJiYgc2NoZWR1bGVyVGVtcGxhdGVzW2ldLmZyZXF1ZW5jeVR5cGUgPT0gIndlZWtseSIpIHsKICAgICAgICAgICAgICAgIGxldCBkYXRlID0gbW9tZW50KHRlbXBsYXRlRGF0YS5lbmREYXRlKS5mb3JtYXQoIllZWVktTU0tREQiKTsKICAgICAgICAgICAgICAgIGxldCB0aW1lID0gIjAwOjAwOjAwLjAwMCswMDowMCI7CiAgICAgICAgICAgICAgICBzdGFydERhdGUgPSBkYXRlICsgIlQiICsgdGltZTsKICAgICAgICAgICAgICAgIGxldCBEYXRlRm9ybWF0U3RyaW5nID0gbW9tZW50KHN0YXJ0RGF0ZSkuZm9ybWF0KCJZWVlZTU1ERFRISG1tc3MiKTsKICAgICAgICAgICAgICAgIHJlT2N1cnJlbmNlUnVsZSA9ICJGUkVRPSIgKyBzY2hlZHVsZXJUZW1wbGF0ZXNbaV0uZnJlcXVlbmN5VHlwZS50b1VwcGVyQ2FzZSgpICsgIjtJTlRFUlZBTD0iICsgdGVtcGxhdGVEYXRhLnJlcGVhdEV2ZXJ5ICsgIjtVTlRJTD0iICsgRGF0ZUZvcm1hdFN0cmluZyArICI7QllEQVk9IiArIGZyZURheXMgKyAiOyI7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0ZW1wbGF0ZURhdGEuZW5kVHlwZSA9PT0gImFmdGVyIiAmJiBzY2hlZHVsZXJUZW1wbGF0ZXNbaV0uZnJlcXVlbmN5VHlwZSA9PSAid2Vla2x5IikgewogICAgICAgICAgICAgICAgcmVPY3VycmVuY2VSdWxlID0gIkZSRVE9IiArIHNjaGVkdWxlclRlbXBsYXRlc1tpXS5mcmVxdWVuY3lUeXBlLnRvVXBwZXJDYXNlKCkgKyAiO0lOVEVSVkFMPSIgKyB0ZW1wbGF0ZURhdGEucmVwZWF0RXZlcnkgKyAiO0NPVU5UPSIgKyB0ZW1wbGF0ZURhdGEub2NjdXJyZW5jZSArICI7QllEQVk9IiArIGZyZURheXMgKyAiOyI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHNjaGVkdWxlclRlbXBsYXRlc1tpXS5mcmVxdWVuY3lUeXBlID09ICJtb250aGx5IikgewogICAgICAgICAgICAgIHRoaXMuc2NoZWR1bGVPYmpTdGFydERhdGUgPSBtb21lbnQudXRjKHRlbXBsYXRlRGF0YS5zdGFydERhdGUpLmZvcm1hdCgpOwogICAgICAgICAgICAgIHRoaXMuc2NoZWR1bGVPYmpFbmREYXRlID0gbW9tZW50LnV0Yyh0aGlzLnNjaGVkdWxlT2JqU3RhcnREYXRlKS5hZGQoMzAsICJtaW51dGVzIikuZm9ybWF0KCk7CgogICAgICAgICAgICAgIGlmICh0ZW1wbGF0ZURhdGEuZW5kVHlwZSA9PT0gIm5ldmVyIikgewogICAgICAgICAgICAgICAgcmVPY3VycmVuY2VSdWxlID0gIkZSRVE9IiArIHNjaGVkdWxlclRlbXBsYXRlc1tpXS5mcmVxdWVuY3lUeXBlLnRvVXBwZXJDYXNlKCkgKyAiO0lOVEVSVkFMPSIgKyB0ZW1wbGF0ZURhdGEucmVwZWF0RXZlcnkgKyAiO0JZTU9OVEhEQVk9IiArIHRlbXBsYXRlRGF0YS5yZXBlYXRNb250aERheSArICI7IjsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRlbXBsYXRlRGF0YS5lbmRUeXBlID09PSAib24iICYmIHNjaGVkdWxlclRlbXBsYXRlc1tpXS5mcmVxdWVuY3lUeXBlID09PSAibW9udGhseSIpIHsKICAgICAgICAgICAgICAgIGxldCBkYXRlID0gdGVtcGxhdGVEYXRhLmVuZERhdGU7CiAgICAgICAgICAgICAgICB2YXIgb2JqRGF0ZSA9IG1vbWVudChkYXRlKS5mb3JtYXQoIllZWVlNTUREIik7CiAgICAgICAgICAgICAgICBsZXQgRGF0ZUZvcm1hdFN0cmluZyA9IG9iakRhdGUgKyAiVCIgKyAiMDAwMCIgKyAiMDBaIjsKICAgICAgICAgICAgICAgIHJlT2N1cnJlbmNlUnVsZSA9ICJGUkVRPSIgKyBzY2hlZHVsZXJUZW1wbGF0ZXNbaV0uZnJlcXVlbmN5VHlwZS50b1VwcGVyQ2FzZSgpICsgIjtJTlRFUlZBTD0iICsgdGVtcGxhdGVEYXRhLnJlcGVhdEV2ZXJ5ICsgIjtVTlRJTD0iICsgRGF0ZUZvcm1hdFN0cmluZyArICI7QllNT05USERBWT0iICsgdGVtcGxhdGVEYXRhLnJlcGVhdE1vbnRoRGF5ICsgIjsiOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAodGVtcGxhdGVEYXRhLmVuZFR5cGUgPT09ICJhZnRlciIpIHsKICAgICAgICAgICAgICAgIHJlT2N1cnJlbmNlUnVsZSA9ICJGUkVRPSIgKyBzY2hlZHVsZXJUZW1wbGF0ZXNbaV0uZnJlcXVlbmN5VHlwZS50b1VwcGVyQ2FzZSgpICsgIjtJTlRFUlZBTD0iICsgdGVtcGxhdGVEYXRhLnJlcGVhdEV2ZXJ5ICsgIjtDT1VOVD0iICsgdGVtcGxhdGVEYXRhLm9jY3VycmVuY2UgKyAiO0JZTU9OVEhEQVk9IiArIHRlbXBsYXRlRGF0YS5yZXBlYXRNb250aERheSArICI7IjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc2NoZWR1bGVyVGVtcGxhdGVzW2ldLmZyZXF1ZW5jeVR5cGUgPT0gInllYXJseSIpIHsKICAgICAgICAgICAgICB0aGlzLnNjaGVkdWxlT2JqU3RhcnREYXRlID0gbW9tZW50LnV0Yyh0ZW1wbGF0ZURhdGEuc3RhcnREYXRlKS5mb3JtYXQoKTsKICAgICAgICAgICAgICB0aGlzLnNjaGVkdWxlT2JqRW5kRGF0ZSA9IG1vbWVudC51dGModGhpcy5zY2hlZHVsZU9ialN0YXJ0RGF0ZSkuYWRkKDMwLCAibWludXRlcyIpLmZvcm1hdCgpOwogICAgICAgICAgICAgIGxldCBtb250aE5vID0gSlNPTi5wYXJzZSh0ZW1wbGF0ZURhdGEuZnJlcXVlbmN5RGF5cyk7CgogICAgICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBtb250aE5vLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgICAgICAgdmFyIG1vbnRoVmFsdWUgPSBtb250aE5vW2luZGV4XS52YWx1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICh0ZW1wbGF0ZURhdGEuZW5kVHlwZSA9PT0gIm5ldmVyIikgewogICAgICAgICAgICAgICAgcmVPY3VycmVuY2VSdWxlID0gIkZSRVE9IiArIHNjaGVkdWxlclRlbXBsYXRlc1tpXS5mcmVxdWVuY3lUeXBlLnRvVXBwZXJDYXNlKCkgKyAiO0lOVEVSVkFMPSIgKyB0ZW1wbGF0ZURhdGEucmVwZWF0RXZlcnkgKyAiO0JZTU9OVEhEQVk9IiArIHRlbXBsYXRlRGF0YS5yZXBlYXRNb250aERheSArICI7QllNT05USD0iICsgbW9udGhWYWx1ZSArICI7IjsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRlbXBsYXRlRGF0YS5lbmRUeXBlID09PSAib24iICYmIHNjaGVkdWxlclRlbXBsYXRlc1tpXS5mcmVxdWVuY3lUeXBlID09PSAieWVhcmx5IikgewogICAgICAgICAgICAgICAgbGV0IGRhdGUgPSB0ZW1wbGF0ZURhdGEuZW5kRGF0ZTsKICAgICAgICAgICAgICAgIGxldCBvYmpEYXRlID0gbW9tZW50KGRhdGUpLmZvcm1hdCgiWVlZWU1NREQiKTsKICAgICAgICAgICAgICAgIGxldCBEYXRlRm9ybWF0U3RyaW5nID0gb2JqRGF0ZSArICJUIiArICIwMDAwIiArICIwMFoiOwogICAgICAgICAgICAgICAgcmVPY3VycmVuY2VSdWxlID0gIkZSRVE9IiArIHNjaGVkdWxlclRlbXBsYXRlc1tpXS5mcmVxdWVuY3lUeXBlLnRvVXBwZXJDYXNlKCkgKyAiO0lOVEVSVkFMPSIgKyB0ZW1wbGF0ZURhdGEucmVwZWF0RXZlcnkgKyAiO1VOVElMPSIgKyBEYXRlRm9ybWF0U3RyaW5nICsgIjtCWU1PTlRIREFZPSIgKyB0ZW1wbGF0ZURhdGEucmVwZWF0TW9udGhEYXkgKyAiO0JZTU9OVEg9IiArIG1vbnRoVmFsdWUgKyAiOyI7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0ZW1wbGF0ZURhdGEuZW5kVHlwZSA9PT0gImFmdGVyIikgewogICAgICAgICAgICAgICAgcmVPY3VycmVuY2VSdWxlID0gIkZSRVE9IiArIHNjaGVkdWxlclRlbXBsYXRlc1tpXS5mcmVxdWVuY3lUeXBlLnRvVXBwZXJDYXNlKCkgKyAiO0lOVEVSVkFMPSIgKyB0ZW1wbGF0ZURhdGEucmVwZWF0RXZlcnkgKyAiO0NPVU5UPSIgKyB0ZW1wbGF0ZURhdGEub2NjdXJyZW5jZSArICI7QllNT05USERBWT0iICsgdGVtcGxhdGVEYXRhLnJlcGVhdE1vbnRoRGF5ICsgIjtCWU1PTlRIPSIgKyBtb250aFZhbHVlICsgIjsiOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHt9IC8vIGNvbnNvbGUubG9nKCJzY2hlZHVsZXJUZW1wbGF0ZXNbaV0iLCBzY2hlZHVsZXJUZW1wbGF0ZXNbaV0pOwoKCiAgICAgICAgICAgIGxldCBTY2hlZHVsZU9iaiA9IHsKICAgICAgICAgICAgICBpZDogc2NoZWR1bGVyVGVtcGxhdGVzW2ldLmRhdGFVdWlkLAogICAgICAgICAgICAgIHRlbmFudFVVSUQ6IHRoaXMuY3VycmVudFVzZXJEZXRhaWxzLnByb2ZpbGUub3JnYW5pemF0aW9uSWQsCiAgICAgICAgICAgICAgU3ViamVjdDogc2NoZWR1bGVyVGVtcGxhdGVzW2ldLmV2ZW50TmFtZSwKICAgICAgICAgICAgICBTdGFydFRpbWU6IG5ldyBEYXRlKHRoaXMuc2NoZWR1bGVPYmpTdGFydERhdGUpLAogICAgICAgICAgICAgIEVuZFRpbWU6IG5ldyBEYXRlKHRoaXMuc2NoZWR1bGVPYmpFbmREYXRlKSwKICAgICAgICAgICAgICBJc0FsbERheTogZmFsc2UsCiAgICAgICAgICAgICAgUmVjdXJyZW5jZVJ1bGU6IHJlT2N1cnJlbmNlUnVsZQogICAgICAgICAgICB9OwogICAgICAgICAgICBzY2hlZHVsZURhdGEucHVzaChTY2hlZHVsZU9iaik7IC8vIGNvbnNvbGUubG9nKCJTY2hlZHVsZU9iaiIsIFNjaGVkdWxlT2JqKTsKCiAgICAgICAgICAgIGxldCBzY2hlZHVsZU9iaiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJTY2hlZHVsZSIpLmVqMl9pbnN0YW5jZXNbMF07CiAgICAgICAgICAgIHNjaGVkdWxlT2JqLmV2ZW50U2V0dGluZ3MuZGF0YVNvdXJjZSA9IHNjaGVkdWxlRGF0YTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnNjaGVkdWxlS2V5Kys7CiAgICAgICAgICB0aGlzLmxvYWRlckZsYWcgPSBmYWxzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy4kZW1pdCgic2hvd1RvYXN0IiwgIk9wcHMgaXRzIGxvb2sgbGlrZSBvdXIgc2VydmVyIGlzIG9mZmxpbmUiLCAiZXJyb3IiKTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgaWYgKGVycm9yLnJlc3BvbnNlICE9PSB1bmRlZmluZWQgJiYgZXJyb3IucmVzcG9uc2Uuc3RhdHVzID09PSA0MDYpIHsKICAgICAgICAgIC8vIGFsZXJ0KGVycm9yLnJlc3BvbnNlLmRhdGEuZGVzY3JpcHRpb24pOwogICAgICAgICAgdGhpcy4kZW1pdCgic2hvd1RvYXN0IiwgZXJyb3IucmVzcG9uc2UuZGF0YS5kZXNjcmlwdGlvbiwgImVycm9yIik7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogIH0sCgogIGNyZWF0ZWQoKSB7CiAgICB0aGlzLmN1cnJlbnRVc2VyRGV0YWlscyA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oImN1cnJlbnRVc2VyRGV0YWlscyIpKTsKICAgIHRoaXMuc2VsZWN0VXNlcigpOyAvLyB0aGlzLmdldFBhZ2luYXRlZEluc3BlY3Rpb25UZW1wbGF0ZXMoKTsKCiAgICB0aGlzLkdldFNjaGVkdWxlclRpY2tldHMoKTsgLy90aGlzLm9uQWN0aW9uQmVnaW4oKTsKICAgIC8vdGhpcy5nZXRBc3NpZ25lZFVzZXJzT2ZBc3NldCgpOwogICAgLy90aGlzLmdldEFzc2lnbm1lbnRIaXN0b3J5QnlBc3NldCgpOwogIH0KCn07"},null]}