{"remainingRequest":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/src/views/work-orders/WorkOrderDetails.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/src/views/work-orders/WorkOrderDetails.vue","mtime":1661968702452},{"path":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/node_modules/vue-loader/lib/index.js","mtime":1655715099000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBTaWRlYmFyIGZyb20gIi4vY29tcG9uZW50cy9TaWRlYmFyIjsKaW1wb3J0IEFzc2V0SW5mbyBmcm9tICIuL2NvbXBvbmVudHMvQXNzZXRJbmZvIjsKaW1wb3J0IEluc3BlY3Rpb25SZXBvcnRzIGZyb20gIi4vY29tcG9uZW50cy9JbnNwZWN0aW9uUmVwb3J0cyI7CmltcG9ydCBBc3NpZ25tZW50IGZyb20gIi4vY29tcG9uZW50cy9Bc3NpZ25tZW50IjsKaW1wb3J0IFdvcmtPcmRlclNlcnZpY2UgZnJvbSAiLi4vLi4vc2VydmljZXMvV29ya09yZGVyU2VydmljZSI7CmltcG9ydCBBc3NldE1hbmFnZW1lbnRTZXJ2aWNlIGZyb20gIi4uLy4uL3NlcnZpY2VzL0Fzc2V0TWFuYWdlbWVudFNlcnZpY2UiOwppbXBvcnQgQXNzZXRQZXJzb25uZWxTZXJ2aWNlIGZyb20gIi4uLy4uL3NlcnZpY2VzL0Fzc2V0UGVyc29ubmVsU2VydmljZSI7CmltcG9ydCBJbnNwZWN0aW9uU2VydmljZSBmcm9tICIuLi8uLi9zZXJ2aWNlcy9JbnNwZWN0aW9uU2VydmljZSI7CmltcG9ydCBJc3N1ZSBmcm9tICIuL2NvbXBvbmVudHMvSXNzdWUiOwppbXBvcnQgV29ya09yZGVyVGltZSBmcm9tICIuL2NvbXBvbmVudHMvVGltZSI7CmltcG9ydCBXb3JrT3JkZXJTdW1tYXJ5IGZyb20gIi4vY29tcG9uZW50cy93b3JrT3JkZXJTdW1tYXJ5IjsKaW1wb3J0IG1vbWVudCBmcm9tICJtb21lbnQiOwppbXBvcnQgVmlld0lzc3VlIGZyb20gIi4uLy4uL3ZpZXdzL2lzc3Vlcy9jb21wb25lbnRzL1ZpZXdJc3N1ZSI7CmltcG9ydCB7IEZ1bmN0aW9ucyB9IGZyb20gIkAvc2hhcmVkL0Z1bmN0aW9ucyI7CmltcG9ydCB7IHJlcXVpcmVkLCBtYXhMZW5ndGggfSBmcm9tICJ2dWVsaWRhdGUvbGliL3ZhbGlkYXRvcnMiOwoKaW1wb3J0IGxvYWRlciBmcm9tICJAL2NvbXBvbmVudHMvTG9hZGVyLnZ1ZSI7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiV29ya09yZGVyRGV0YWlscyIsCiAgY29tcG9uZW50czogewogICAgU2lkZWJhciwKICAgIEFzc2V0SW5mbywKICAgIEluc3BlY3Rpb25SZXBvcnRzLAogICAgQXNzaWdubWVudCwKICAgIFdvcmtPcmRlclRpbWUsCiAgICBJc3N1ZSwKICAgIFdvcmtPcmRlclN1bW1hcnksCiAgICBWaWV3SXNzdWUsCiAgICBsb2FkZXIsCiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgbG9hZGVyRmxhZzogZmFsc2UsCiAgICAgIC8qIFRvYXN0IFByb3BlcnRpZXMgKi8KICAgICAgdG9hc3RUaW1lT3V0OiAzMDAwLAogICAgICB0b2FzdE1lc3NhZ2U6ICIiLAogICAgICB0b2FzdFR5cGU6ICIiLAogICAgICB0b2FzdEZsYWc6IDAsCiAgICAgIC8qIFRvYXN0IFByb3BlcnRpZXMgKi8KICAgICAgc2lkZWJhclVwZGF0ZTogMCwKICAgICAgYXNzZXRJbmZvOiBudWxsLAogICAgICB3b3JrT3JkZXJEZXRhaWw6IG51bGwsCiAgICAgIGN1cnJlbmN5OiAiIiwKICAgICAgY3VycmVudFVzZXJEZXRhaWxzOiAiIiwKICAgICAgcG9vbGVkSXNzdWVzOiBbXSwKICAgICAgd29ya09yZGVyVHlwZTogIiIsCiAgICAgIHdvcmtPcmRlclVVSUQ6ICIiLAogICAgICB2aWV3UG9vbElzc3VlOiBmYWxzZSwKICAgICAgaXNzdWVVVUlEOiAiIiwKICAgICAgdG90YWxXb3JrT3JkZXJDb3N0OiAwLAogICAgICBkaXNhYmxlRmllbGRzOiBmYWxzZSwKICAgICAgaXNzdWVzQXJyYXlMaXN0OiBbXSwKICAgICAgaXNzdWVzU2VsZWN0ZWQ6IFtdLAogICAgICAvLyBpc3N1ZU51bWJlcjogIiIsCiAgICAgIGluaXRpYWxJbnNwZWN0aW9uUmVwb3J0OiBudWxsLAogICAgICBmaW5hbEluc3BlY3Rpb25SZXBvcnQ6IG51bGwsCiAgICAgIGNoZWNrRXhpc3RpbmdJbml0aWFsSW5zcGVjdGlvbjogZmFsc2UsCiAgICAgIGNoZWNrRXhpc3RpbmdGaW5hbEluc3BlY3Rpb246IGZhbHNlLAogICAgICBzYW1lQXNJbml0aWFsSW5zcGVjdGlvbjogdHJ1ZSwKICAgICAgaW5pdGlhbEluc3BlY3Rpb25CeUFzc2V0OiAiIiwKICAgICAgaW5pdGlhbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnk6ICIiLAogICAgICBpbml0aWFsSW5zcGVjdGlvbkJ5V29ya09yZGVyOiAiIiwKICAgICAgZmluYWxJbnNwZWN0aW9uQnlBc3NldDogIiIsCiAgICAgIGZpbmFsSW5zcGVjdGlvbkJ5QXNzZXRDYXRlZ29yeTogIiIsCiAgICAgIGZpbmFsSW5zcGVjdGlvbkJ5V29ya09yZGVyOiAiIiwKICAgICAgc2VsZWN0ZWRJbml0aWFsSW5zcGVjdGlvbkJ5QXNzZXQ6ICIiLAogICAgICBzZWxlY3RlZEluaXRpYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5OiAiIiwKICAgICAgc2VsZWN0ZWRJbml0aWFsSW5zcGVjdGlvbkJ5V29ya09yZGVyOiAiIiwKICAgICAgc2VsZWN0ZWRGaW5hbEluc3BlY3Rpb25CeUFzc2V0OiAiIiwKICAgICAgc2VsZWN0ZWRGaW5hbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnk6ICIiLAogICAgICBzZWxlY3RlZEZpbmFsSW5zcGVjdGlvbkJ5V29ya09yZGVyOiAiIiwKICAgICAgaW5zcGVjdGlvbkJ5QXNzZXRPcHRpb25zOiBbXSwKICAgICAgaW5wc2VjdGlvbkJ5QXNzZXRDYXRlZ29yeU9wdGlvbnM6IFtdLAogICAgICBpbnBzZWN0aW9uQnlXb3JrT3JkZXJPcHRpb25zOiBbXSwKICAgICAgaW5pdGlhbEluc3BlY3Rpb25UZW1wOiAiIiwKICAgICAgZmluYWxJbnNwZWN0aW9uVGl0bGU6ICIiLAogICAgICBhbnN3ZXJUeXBlT3B0aW9uczogWwogICAgICAgIHsgbGFiZWw6ICJUZXh0L0ltYWdlL0F1ZGlvIiwgdmFsdWU6ICJpbnB1dCIgfSwKICAgICAgICB7IGxhYmVsOiAiWWVzL05vIiwgdmFsdWU6ICJib29sZWFuIiB9LAogICAgICAgIHsgbGFiZWw6ICJNdWx0aXBsZSBDaG9pY2UiLCB2YWx1ZTogIm11bHRpcGxlIiB9LAogICAgICBdLAogICAgICBxdWVzdGlvblR5cGVGb3JtSW5pdGlhbDogW10sCiAgICAgIHF1ZXN0aW9uVHlwZUZvcm1GaW5hbDogW10sCiAgICAgIGZpbmFsSW5zcGVjdGlvbk9wdGlvbnM6IFsKICAgICAgICB7IGxhYmVsOiAiU2FtZSBBcyBJbml0aWFsIiwgdmFsdWU6ICJzYW1lIiB9LAogICAgICAgIHsgbGFiZWw6ICJTZWxlY3QgRXhpc3RpbmciLCB2YWx1ZTogImV4aXN0aW5nIiB9LAogICAgICAgIHsgbGFiZWw6ICJDcmVhdGUgTmV3IEluc3BlY3Rpb24gVGVtcGxhdGUiLCB2YWx1ZTogImNyZWF0ZU5ldyIgfSwKICAgICAgXSwKICAgICAgZmluYWxJbnNwZWN0aW9uU2VsZWN0aW9uOiAiU2FtZSBBcyBJbml0aWFsIiwKICAgICAgc2FtZTogdHJ1ZSwKICAgICAgd29ya09yZGVyU3VtbWFyeUluZGV4OiAwLAogICAgICBpbml0aWFsQXNzZXRJbmRleDogMCwKICAgICAgaW5zcGVjdGlvblJlc2V0OiAwLAogICAgICBmaW5hbEluc3BlY3Rpb25SZXNldDogMCwKICAgICAgd29ya09yZGVyU3VtbWFyeTogewogICAgICAgIHByaW9yaXR5OiAiIiwKICAgICAgICBzaGlmdDogIiIsCiAgICAgICAgc2hlZHVsZTogIiIsCiAgICAgICAgdXNlckdyb3VwOiAiIiwKICAgICAgICB1c2VyOiAiIiwKICAgICAgICBpc3N1ZXM6IFtdLAogICAgICAgIGluaXRpYWxJbnNwZWN0aW9uVGl0bGU6ICIiLAogICAgICAgIGZpbmFsSW5zcGVjdGlvblRpdGxlOiAiIiwKICAgICAgICBjYXRlZ29yeTogIiIsCiAgICAgICAgbmFtZTogIiIsCiAgICAgICAgc2VsZWN0ZWRJbml0aWFsSW5zcGVjdGlvbkJ5QXNzZXRDYXRlZ29yeTogIiIsCiAgICAgICAgc2VsZWN0ZWRGaW5hbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnk6ICIiLAogICAgICB9LAogICAgICBwZXJpdm91c0luaXRpYWxUZW1wbGF0ZToge30sCiAgICAgIHByZXZpb3VzRmluYWxUZW1wbGF0ZToge30sCiAgICAgIHBlcml2b3VzSW5pdGlhbEV4aXN0aW5nOiB7fSwKICAgICAgcGVyaXZvdXNGaW5hbEV4aXN0aW5nOiB7fSwKICAgIH07CiAgfSwKICBwcm9wczogewogICAgd29ya3V1aWQ6IHt9LAogIH0sCgogIG1ldGhvZHM6IHsKICAgIHNldFR5cGVMYWJlbChpdGVtcykgewogICAgICBpdGVtcy5tYXAoKGl0ZW0pID0+IHsKICAgICAgICBpZiAoaXRlbS50eXBlID09PSAiaW5wdXQiKSB7CiAgICAgICAgICBpdGVtLnR5cGVMYWJlbCA9ICJUZXh0L0ltYWdlL0F1ZGlvIjsKICAgICAgICB9IGVsc2UgaWYgKGl0ZW0udHlwZSA9PT0gImJvb2xlYW4iKSB7CiAgICAgICAgICBpdGVtLnR5cGVMYWJlbCA9ICJZZXMvTm8iOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpdGVtLnR5cGVMYWJlbCA9ICJNdWx0aXBsZSBDaG9pY2UiOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHJldHVybiBpdGVtczsKICAgIH0sCgogICAgZ2V0SW5zcGVjdGlvblRlbXBsYXRlQnlVVUlEKHV1aWQsIHR5cGUpIHsKICAgICAgV29ya09yZGVyU2VydmljZS5nZXRJbnNwZWN0aW9uVGVtcGxhdGVCeUluc3BlY3Rpb25VVUlEKHV1aWQpCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgICAgbGV0IHdvcmtPcmRlckluc3BlY3Rpb25UZW1wbGF0ZSA9CiAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS53b3JrT3JkZXJJbnNwZWN0aW9uVGVtcGxhdGU7CiAgICAgICAgICAgIGlmICh0eXBlID09PSAic2FtZSIpIHsKICAgICAgICAgICAgICB0aGlzLndvcmtPcmRlclN1bW1hcnkuaW5pdGlhbEluc3BlY3Rpb25UaXRsZSA9CiAgICAgICAgICAgICAgICB3b3JrT3JkZXJJbnNwZWN0aW9uVGVtcGxhdGUubmFtZTsKICAgICAgICAgICAgICB0aGlzLndvcmtPcmRlclN1bW1hcnkuZmluYWxJbnNwZWN0aW9uVGl0bGUgPQogICAgICAgICAgICAgICAgd29ya09yZGVySW5zcGVjdGlvblRlbXBsYXRlLm5hbWU7CiAgICAgICAgICAgICAgdGhpcy5xdWVzdGlvblR5cGVGb3JtSW5pdGlhbCA9IHRoaXMuc2V0VHlwZUxhYmVsKAogICAgICAgICAgICAgICAgd29ya09yZGVySW5zcGVjdGlvblRlbXBsYXRlLmluc3BlY3Rpb25JdGVtcwogICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgdGhpcy5wZXJpdm91c0luaXRpYWxUZW1wbGF0ZSA9IHdvcmtPcmRlckluc3BlY3Rpb25UZW1wbGF0ZTsKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAiTmV3IEluaXRpYWwiKSB7CiAgICAgICAgICAgICAgdGhpcy53b3JrT3JkZXJTdW1tYXJ5LmluaXRpYWxJbnNwZWN0aW9uVGl0bGUgPQogICAgICAgICAgICAgICAgd29ya09yZGVySW5zcGVjdGlvblRlbXBsYXRlLm5hbWU7CiAgICAgICAgICAgICAgdGhpcy5xdWVzdGlvblR5cGVGb3JtSW5pdGlhbCA9IHRoaXMuc2V0VHlwZUxhYmVsKAogICAgICAgICAgICAgICAgd29ya09yZGVySW5zcGVjdGlvblRlbXBsYXRlLmluc3BlY3Rpb25JdGVtcwogICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgdGhpcy5wZXJpdm91c0luaXRpYWxUZW1wbGF0ZSA9IHdvcmtPcmRlckluc3BlY3Rpb25UZW1wbGF0ZTsKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAiTmV3IEZpbmFsIikgewogICAgICAgICAgICAgIHRoaXMud29ya09yZGVyU3VtbWFyeS5maW5hbEluc3BlY3Rpb25UaXRsZSA9CiAgICAgICAgICAgICAgICB3b3JrT3JkZXJJbnNwZWN0aW9uVGVtcGxhdGUubmFtZTsKICAgICAgICAgICAgICB0aGlzLnF1ZXN0aW9uVHlwZUZvcm1GaW5hbCA9IHRoaXMuc2V0VHlwZUxhYmVsKAogICAgICAgICAgICAgICAgd29ya09yZGVySW5zcGVjdGlvblRlbXBsYXRlLmluc3BlY3Rpb25JdGVtcwogICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgdGhpcy5wcmV2aW91c0ZpbmFsVGVtcGxhdGUgPSB3b3JrT3JkZXJJbnNwZWN0aW9uVGVtcGxhdGU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTsKICAgICAgICB9KTsKICAgIH0sCiAgICAvL2Z1bmN0aW9uIHdpbGwgbWFwIGV4aXN0aW5nIEluaXRpYWwgSW5zcGVjdGlvbiBUZW1wbGF0ZSBEYXRhCiAgICBtYXBJbml0aWFsRXhpc3RpbmdUZW1wbGF0ZShwbGFubmluZykgewogICAgICBsZXQgc2VsZWN0ZWRPcHRpb24gPSB0aGlzLmlucHNlY3Rpb25CeUFzc2V0Q2F0ZWdvcnlPcHRpb25zLmZpbmQoCiAgICAgICAgKHZhbCkgPT4gdmFsLnV1aWQgPT09IHBsYW5uaW5nLmluaXRpYWxJbnNwZWN0aW9uVVVJRAogICAgICApOwogICAgICB0aGlzLmluaXRpYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5ID0gc2VsZWN0ZWRPcHRpb24ubmFtZTsKICAgICAgdGhpcy5wZXJpdm91c0luaXRpYWxFeGlzdGluZyA9IHNlbGVjdGVkT3B0aW9uOwogICAgICB0aGlzLmluaXRpYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5U2VsZWN0ZWQoewogICAgICAgIHNlbGVjdGVkT2JqZWN0OiBzZWxlY3RlZE9wdGlvbiwKICAgICAgfSk7CiAgICB9LAoKICAgIC8vZnVuY3Rpb24gd2lsbCBtYXAgZXhpc3RpbmcgRmluYWwgSW5zcGVjdGlvbiBUZW1wbGF0ZSBEYXRhCiAgICBtYXBGaW5hbEV4aXN0aW5nVGVtcGxhdGUocGxhbm5pbmcpIHsKICAgICAgbGV0IHNlbGVjdGVkT3B0aW9uID0gdGhpcy5pbnBzZWN0aW9uQnlBc3NldENhdGVnb3J5T3B0aW9ucy5maW5kKAogICAgICAgICh2YWwpID0+IHZhbC51dWlkID09PSBwbGFubmluZy5maW5hbEluc3BlY3Rpb25VVUlECiAgICAgICk7CiAgICAgIHRoaXMuZmluYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5ID0gc2VsZWN0ZWRPcHRpb24ubmFtZTsKICAgICAgdGhpcy5wZXJpdm91c0ZpbmFsRXhpc3RpbmcgPSBzZWxlY3RlZE9wdGlvbjsKICAgICAgdGhpcy5maW5hbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnlTZWxlY3RlZCh7CiAgICAgICAgc2VsZWN0ZWRPYmplY3Q6IHNlbGVjdGVkT3B0aW9uLAogICAgICB9KTsKICAgIH0sCgogICAgLy9mdW5jdGlvbiB3aWxsIG1hcCBGaW5hbCBhbmQgSW5pdGlhbCBUZW1wbGF0ZXMgRGF0YQogICAgbWFwSW5pdGlhbEFuZEZpbmFsSW5zcGVjdGlvblRlbXBsYXRlc0RhdGEocGxhbm5pbmcpIHsKICAgICAgLy9jaGVja2luZyBpZiBmaW5hbCBhbmQgaW5pdGlhbCBpbnNwZWN0aW9uIFRlbXBsYXRlcyBhcmUgc2FtZQogICAgICBpZiAocGxhbm5pbmcuc2FtZUluc3BlY3Rpb24pIHsKICAgICAgICAvL2NoZWNraW5nIGlmIGl0cyBuZXcgdGVtcGxhdGUgb3IgZXhpc3Rpbmcgb25lCiAgICAgICAgaWYgKAogICAgICAgICAgIXBsYW5uaW5nLmZyb21FeGlzdGluZ0luaXRpYWwgJiYKICAgICAgICAgICFwbGFubmluZy5mcm9tRXhpc3RpbmdGaW5hbCAmJgogICAgICAgICAgIXBsYW5uaW5nLmZyb21JbnNwZWN0aW9uSW5pdGlhbCAmJgogICAgICAgICAgIXBsYW5uaW5nLmZyb21JbnNwZWN0aW9uRmluYWwKICAgICAgICApIHsKICAgICAgICAgIHRoaXMuZmluYWxJbnNwZWN0aW9uU2VsZWN0aW9uID0gIlNhbWUgQXMgSW5pdGlhbCI7CiAgICAgICAgICB0aGlzLmNoZWNrRXhpc3RpbmdJbml0aWFsSW5zcGVjdGlvbiA9IGZhbHNlOwogICAgICAgICAgdGhpcy5nZXRJbnNwZWN0aW9uVGVtcGxhdGVCeVVVSUQoCiAgICAgICAgICAgIHBsYW5uaW5nLmluaXRpYWxJbnNwZWN0aW9uVVVJRCwKICAgICAgICAgICAgInNhbWUiCiAgICAgICAgICApOyAvLyBjYWxsaW5nIGZ1bmN0aW9uIHRvIGdldCBuZXcgdGVtcGxhdGUKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5maW5hbEluc3BlY3Rpb25TZWxlY3Rpb24gPSAiU2FtZSBBcyBJbml0aWFsIjsKICAgICAgICAgIHRoaXMuY2hlY2tFeGlzdGluZ0luaXRpYWxJbnNwZWN0aW9uID0gdHJ1ZTsKICAgICAgICAgIHRoaXMubWFwSW5pdGlhbEV4aXN0aW5nVGVtcGxhdGUocGxhbm5pbmcpOyAvL2NhbGxpbmcgZnVuY3Rpb24gdG8gbWFwIGV4aXN0aW5nIHRlbXBsYXRlCiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2FtZSA9IGZhbHNlOwogICAgICAgIC8vY2hlY2tpbmcgaWYgbmV3IGluaXRpYWwgaW5wc2VjaXRvbiB0ZW1wbGF0ZSBvciBFeGlzdGluZyBvbmUKICAgICAgICBpZiAoIXBsYW5uaW5nLmZyb21FeGlzdGluZ0luaXRpYWwgJiYgIXBsYW5uaW5nLmZyb21JbnNwZWN0aW9uSW5pdGlhbCkgewogICAgICAgICAgdGhpcy5jaGVja0V4aXN0aW5nSW5pdGlhbEluc3BlY3Rpb24gPSBmYWxzZTsKICAgICAgICAgIHRoaXMuZ2V0SW5zcGVjdGlvblRlbXBsYXRlQnlVVUlEKAogICAgICAgICAgICBwbGFubmluZy5pbml0aWFsSW5zcGVjdGlvblVVSUQsCiAgICAgICAgICAgICJOZXcgSW5pdGlhbCIKICAgICAgICAgICk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuY2hlY2tFeGlzdGluZ0luaXRpYWxJbnNwZWN0aW9uID0gdHJ1ZTsKICAgICAgICAgIHRoaXMubWFwSW5pdGlhbEV4aXN0aW5nVGVtcGxhdGUocGxhbm5pbmcpOwogICAgICAgIH0KICAgICAgICAvL2NoZWNraW5nIGlmIG5ldyBmaW5hbCBpbnBzZWNpdG9uIHRlbXBsYXRlIG9yIEV4aXN0aW5nIG9uZQogICAgICAgIGlmICghcGxhbm5pbmcuZnJvbUV4aXN0aW5nRmluYWwgJiYgIXBsYW5uaW5nLmZyb21JbnNwZWN0aW9uRmluYWwpIHsKICAgICAgICAgIHRoaXMuZmluYWxJbnNwZWN0aW9uU2VsZWN0aW9uID0gIkNyZWF0ZSBOZXcgSW5zcGVjdGlvbiBUZW1wbGF0ZSI7CiAgICAgICAgICB0aGlzLmdldEluc3BlY3Rpb25UZW1wbGF0ZUJ5VVVJRCgKICAgICAgICAgICAgcGxhbm5pbmcuZmluYWxJbnNwZWN0aW9uVVVJRCwKICAgICAgICAgICAgIk5ldyBGaW5hbCIKICAgICAgICAgICk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuZmluYWxJbnNwZWN0aW9uU2VsZWN0aW9uID0gIlNlbGVjdCBFeGlzdGluZyI7CiAgICAgICAgICB0aGlzLm1hcEZpbmFsRXhpc3RpbmdUZW1wbGF0ZShwbGFubmluZyk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAoKICAgIGdldEluc3BlY3Rpb25UZW1wbGF0ZXMoYXNzZXRVVUlELCB0ZW5hbnRVVUlEKSB7CiAgICAgIEluc3BlY3Rpb25TZXJ2aWNlLmdldEluc3BlY3Rpb25UZW1wbGF0ZU5hbWVBbmRVVUlEKGFzc2V0VVVJRCwgdGVuYW50VVVJRCkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgICB0aGlzLmluc3BlY3Rpb25CeUFzc2V0T3B0aW9ucyA9IHJlc3BvbnNlLmRhdGEuaW5zcGVjdGlvbnM7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7CiAgICAgICAgfSk7CiAgICB9LAoKICAgIGdldEluc3BlY3Rpb25UZW1wbGF0ZUZyb21Xb3JrT3JkZXIodGVuYW50VVVJRCkgewogICAgICBXb3JrT3JkZXJTZXJ2aWNlLmdldFdvcmtPcmRlckluc3BlY3Rpb25UZW1wbGF0ZXModGVuYW50VVVJRCkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgICB0aGlzLmlucHNlY3Rpb25CeVdvcmtPcmRlck9wdGlvbnMgPSByZXNwb25zZS5kYXRhLmluc3BlY3Rpb25zOwogICAgICAgICAgICBmb3IgKGxldCBpbnNwZWN0aW9uIG9mIHRoaXMuaW5wc2VjdGlvbkJ5V29ya09yZGVyT3B0aW9ucykgewogICAgICAgICAgICAgIGlmIChpbnNwZWN0aW9uLm5hbWUgPT09ICIiIHx8ICFpbnNwZWN0aW9uLm5hbWUpIHsKICAgICAgICAgICAgICAgIGluc3BlY3Rpb24ubmFtZSA9ICItIjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTsKICAgICAgICB9KTsKICAgIH0sCgogICAgZ2V0SW5zcGVjdGlvblRlbWFwbGF0ZXNCeUFzc2V0Q2F0ZWdvcnkoY2F0ZWdvcnlVVUlEKSB7CiAgICAgIEluc3BlY3Rpb25TZXJ2aWNlLmdldEluc3BlY3Rpb25UZW1wbGF0ZU5hbWVBbmRVVUlEQnlDYXRlZ29yeVVVSUQoCiAgICAgICAgY2F0ZWdvcnlVVUlECiAgICAgICkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgICB0aGlzLmlucHNlY3Rpb25CeUFzc2V0Q2F0ZWdvcnlPcHRpb25zID0gcmVzcG9uc2UuZGF0YS5pbnNwZWN0aW9uczsKICAgICAgICAgICAgaWYgKHRoaXMud29ya09yZGVyRGV0YWlsLndvcmtPcmRlci5zdGF0dXMgPT09ICJPcGVuIikgewogICAgICAgICAgICAgIHRoaXMubWFwSW5pdGlhbEFuZEZpbmFsSW5zcGVjdGlvblRlbXBsYXRlc0RhdGEoCiAgICAgICAgICAgICAgICB0aGlzLndvcmtPcmRlckRldGFpbC53b3JrT3JkZXIucGxhbm5pbmcKICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7CiAgICAgICAgfSk7CiAgICB9LAoKICAgIHJlbW92ZU11bHRpcGxlQ2hvaWNlSW5pdGlhbChpbmRleCwgbSkgewogICAgICB0aGlzLnF1ZXN0aW9uVHlwZUZvcm1Jbml0aWFsW2luZGV4XS5hbnN3ZXJzLnNwbGljZShtLCAxKTsKICAgIH0sCgogICAgcmVtb3ZlTXVsdGlwbGVDaG9pY2VGaW5hbChpbmRleCwgbSkgewogICAgICB0aGlzLnF1ZXN0aW9uVHlwZUZvcm1GaW5hbFtpbmRleF0uYW5zd2Vycy5zcGxpY2UobSwgMSk7CiAgICB9LAoKICAgIGFkZEFuc3dlcnNBcnJheSh2YWx1ZSwgaW5kZXgpIHsKICAgICAgdGhpcy5xdWVzdGlvblR5cGVGb3JtSW5pdGlhbFtpbmRleF0udHlwZSA9IHZhbHVlLnNlbGVjdGVkT2JqZWN0LnZhbHVlOwogICAgICBpZiAodmFsdWUudmFsdWUgPT09ICJNdWx0aXBsZSBDaG9pY2UiKSB7CiAgICAgICAgdGhpcy5xdWVzdGlvblR5cGVGb3JtSW5pdGlhbFtpbmRleF0uYW5zd2Vycy5wdXNoKCIiLCAiIik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5xdWVzdGlvblR5cGVGb3JtSW5pdGlhbFtpbmRleF0uYW5zd2VycyA9IFtdOwogICAgICB9CiAgICB9LAoKICAgIGFkZEFuc3dlcnNBcnJheUZpbmFsKHZhbHVlLCBpbmRleCkgewogICAgICB0aGlzLnF1ZXN0aW9uVHlwZUZvcm1GaW5hbFtpbmRleF0udHlwZSA9IHZhbHVlLnNlbGVjdGVkT2JqZWN0LnZhbHVlOwogICAgICBpZiAodmFsdWUudmFsdWUgPT09ICJNdWx0aXBsZSBDaG9pY2UiKSB7CiAgICAgICAgdGhpcy5xdWVzdGlvblR5cGVGb3JtRmluYWxbaW5kZXhdLmFuc3dlcnMucHVzaCgiIiwgIiIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMucXVlc3Rpb25UeXBlRm9ybUZpbmFsW2luZGV4XS5hbnN3ZXJzID0gW107CiAgICAgIH0KICAgIH0sCgogICAgYWRkTXVsdGlwbGVDaG9pY2VJbml0aWFsKGluZGV4KSB7CiAgICAgIHRoaXMucXVlc3Rpb25UeXBlRm9ybUluaXRpYWxbaW5kZXhdLmFuc3dlcnMucHVzaCgiIik7CiAgICB9LAoKICAgIGFkZE11bHRpcGxlQ2hvaWNlRmluYWwoaW5kZXgpIHsKICAgICAgdGhpcy5xdWVzdGlvblR5cGVGb3JtRmluYWxbaW5kZXhdLmFuc3dlcnMucHVzaCgiIik7CiAgICB9LAoKICAgIHJlbW92ZUlucHV0RmllbGRzSW5pdGlhbChpbmRleCkgewogICAgICB0aGlzLnF1ZXN0aW9uVHlwZUZvcm1Jbml0aWFsLnNwbGljZShpbmRleCwgMSk7CiAgICB9LAoKICAgIHJlbW92ZUlucHV0RmllbGRzRmluYWwoaW5kZXgpIHsKICAgICAgdGhpcy5xdWVzdGlvblR5cGVGb3JtRmluYWwuc3BsaWNlKGluZGV4LCAxKTsKICAgIH0sCgogICAgYWRkSW5wdXRGaWVsZHNJbml0aWFsKCkgewogICAgICB0aGlzLnF1ZXN0aW9uVHlwZUZvcm1Jbml0aWFsLnB1c2goewogICAgICAgIG5hbWU6ICIiLAogICAgICAgIHR5cGU6ICIiLAogICAgICAgIHF1ZXN0aW9uOiAiIiwKICAgICAgICBhbnN3ZXJzOiBbXSwKICAgICAgICBtYW5kYXRvcnk6IHRydWUsCiAgICAgIH0pOwogICAgfSwKCiAgICBhZGRJbnB1dEZpZWxkc0ZpbmFsKCkgewogICAgICB0aGlzLnF1ZXN0aW9uVHlwZUZvcm1GaW5hbC5wdXNoKHsKICAgICAgICBuYW1lOiAiIiwKICAgICAgICB0eXBlOiAiIiwKICAgICAgICBxdWVzdGlvbjogIiIsCiAgICAgICAgYW5zd2VyczogW10sCiAgICAgICAgbWFuZGF0b3J5OiB0cnVlLAogICAgICB9KTsKICAgIH0sCgogICAgZmluYWxJbnNwZWN0aW9uQnlBc3NldFNlbGVjdGVkKHZhbHVlKSB7CiAgICAgIHRoaXMuc2VsZWN0ZWRGaW5hbEluc3BlY3Rpb25CeUFzc2V0ID0gdmFsdWUuc2VsZWN0ZWRPYmplY3Q7CiAgICAgIHRoaXMuZmluYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5ID0gIiI7CiAgICAgIHRoaXMuc2VsZWN0ZWRGaW5hbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnkgPSAiIjsKICAgICAgdGhpcy5maW5hbEluc3BlY3Rpb25CeVdvcmtPcmRlciA9ICIiOwogICAgICB0aGlzLnNlbGVjdGVkRmluYWxJbnNwZWN0aW9uQnlXb3JrT3JkZXIgPSAiIjsKICAgICAgdGhpcy5maW5hbEluc3BlY3Rpb25SZXNldCsrOwogICAgfSwKCiAgICBmaW5hbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnlTZWxlY3RlZCh2YWx1ZSkgewogICAgICB0aGlzLnNlbGVjdGVkRmluYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5ID0gdmFsdWUuc2VsZWN0ZWRPYmplY3Q7CiAgICAgIHRoaXMud29ya09yZGVyU3VtbWFyeS5zZWxlY3RlZEZpbmFsSW5zcGVjdGlvbkJ5QXNzZXRDYXRlZ29yeSA9CiAgICAgICAgdGhpcy5zZWxlY3RlZEZpbmFsSW5zcGVjdGlvbkJ5QXNzZXRDYXRlZ29yeTsKICAgICAgdGhpcy5maW5hbEluc3BlY3Rpb25CeUFzc2V0ID0gIiI7CiAgICAgIHRoaXMuc2VsZWN0ZWRGaW5hbEluc3BlY3Rpb25CeUFzc2V0ID0gIiI7CiAgICAgIHRoaXMuZmluYWxJbnNwZWN0aW9uQnlXb3JrT3JkZXIgPSAiIjsKICAgICAgdGhpcy5zZWxlY3RlZEZpbmFsSW5zcGVjdGlvbkJ5V29ya09yZGVyID0gIiI7CiAgICAgIHRoaXMuZmluYWxJbnNwZWN0aW9uUmVzZXQrKzsKICAgIH0sCgogICAgZmluYWxJbnNwZWN0aW9uQnlXb3JrT3JkZXJTZWxlY3RlZCh2YWx1ZSkgewogICAgICB0aGlzLnNlbGVjdGVkRmluYWxJbnNwZWN0aW9uQnlXb3JrT3JkZXIgPSB2YWx1ZS5zZWxlY3RlZE9iamVjdDsKICAgICAgdGhpcy5maW5hbEluc3BlY3Rpb25CeUFzc2V0ID0gIiI7CiAgICAgIHRoaXMuc2VsZWN0ZWRGaW5hbEluc3BlY3Rpb25CeUFzc2V0ID0gIiI7CiAgICAgIHRoaXMuZmluYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5ID0gIiI7CiAgICAgIHRoaXMuc2VsZWN0ZWRGaW5hbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnkgPSAiIjsKICAgICAgdGhpcy5maW5hbEluc3BlY3Rpb25SZXNldCsrOwogICAgfSwKCiAgICBpbml0aWFsSW5zcGVjdGlvbkJ5QXNzZXRTZWxlY3RlZCh2YWx1ZSkgewogICAgICB0aGlzLnNlbGVjdGVkSW5pdGlhbEluc3BlY3Rpb25CeUFzc2V0ID0gdmFsdWUuc2VsZWN0ZWRPYmplY3Q7CiAgICAgIHRoaXMuaW5pdGlhbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnkgPSAiIjsKICAgICAgdGhpcy5zZWxlY3RlZEluaXRpYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5ID0gIiI7CiAgICAgIHRoaXMuaW5pdGlhbEluc3BlY3Rpb25CeVdvcmtPcmRlciA9ICIiOwogICAgICB0aGlzLnNlbGVjdGVkSW5pdGlhbEluc3BlY3Rpb25CeVdvcmtPcmRlciA9ICIiOwogICAgICB0aGlzLmluc3BlY3Rpb25SZXNldCsrOwogICAgfSwKCiAgICBpbml0aWFsSW5zcGVjdGlvbkJ5QXNzZXRDYXRlZ29yeVNlbGVjdGVkKHZhbHVlKSB7CiAgICAgIHRoaXMuaW5pdGlhbEluc3BlY3Rpb25UZW1wID0gdmFsdWUuc2VsZWN0ZWRPYmplY3Q7CiAgICAgIGlmICh0aGlzLnNhbWUgPT09IHRydWUpIHsKICAgICAgICBpZiAodGhpcy5jaGVja0V4aXN0aW5nSW5pdGlhbEluc3BlY3Rpb24gPT09IHRydWUpIHsKICAgICAgICAgIHRoaXMud29ya09yZGVyU3VtbWFyeS5zZWxlY3RlZEZpbmFsSW5zcGVjdGlvbkJ5QXNzZXRDYXRlZ29yeSA9CiAgICAgICAgICAgIHZhbHVlLnNlbGVjdGVkT2JqZWN0OwogICAgICAgICAgdGhpcy53b3JrT3JkZXJTdW1tYXJ5SW5kZXgrKzsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuc2VsZWN0ZWRJbml0aWFsSW5zcGVjdGlvbkJ5QXNzZXRDYXRlZ29yeSA9IHZhbHVlLnNlbGVjdGVkT2JqZWN0OwogICAgICB0aGlzLndvcmtPcmRlclN1bW1hcnkuc2VsZWN0ZWRJbml0aWFsSW5zcGVjdGlvbkJ5QXNzZXRDYXRlZ29yeSA9CiAgICAgICAgdGhpcy5zZWxlY3RlZEluaXRpYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5OwogICAgICB0aGlzLmluaXRpYWxJbnNwZWN0aW9uQnlBc3NldCA9ICIiOwogICAgICB0aGlzLnNlbGVjdGVkSW5pdGlhbEluc3BlY3Rpb25CeUFzc2V0ID0gIiI7CiAgICAgIHRoaXMuaW5pdGlhbEluc3BlY3Rpb25CeVdvcmtPcmRlciA9ICIiOwogICAgICB0aGlzLnNlbGVjdGVkSW5pdGlhbEluc3BlY3Rpb25CeVdvcmtPcmRlciA9ICIiOwogICAgICB0aGlzLmluc3BlY3Rpb25SZXNldCsrOwogICAgfSwKCiAgICBjbGVhckluaXRpYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5KCkgewogICAgICB0aGlzLmluaXRpYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5ID0gbnVsbDsKICAgICAgdGhpcy5pbml0aWFsQXNzZXRJbmRleCsrOwogICAgfSwKCiAgICBpbml0aWFsSW5zcGVjdGlvbkJ5V29ya09yZGVyU2VsZWN0ZWQodmFsdWUpIHsKICAgICAgdGhpcy5zZWxlY3RlZEluaXRpYWxJbnNwZWN0aW9uQnlXb3JrT3JkZXIgPSB2YWx1ZS5zZWxlY3RlZE9iamVjdDsKICAgICAgdGhpcy5pbml0aWFsSW5zcGVjdGlvbkJ5QXNzZXQgPSAiIjsKICAgICAgdGhpcy5zZWxlY3RlZEluaXRpYWxJbnNwZWN0aW9uQnlBc3NldCA9ICIiOwogICAgICB0aGlzLmluaXRpYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5ID0gIiI7CiAgICAgIHRoaXMuc2VsZWN0ZWRJbml0aWFsSW5zcGVjdGlvbkJ5QXNzZXRDYXRlZ29yeSA9ICIiOwogICAgICB0aGlzLmluc3BlY3Rpb25SZXNldCsrOwogICAgfSwKCiAgICBmaW5hbEluc3BlY3Rpb25PcHRpb25TZWxlY3RlZCh2YWx1ZSkgewogICAgICB0aGlzLndvcmtPcmRlclN1bW1hcnkuZmluYWxJbnNwZWN0aW9uVGl0bGUgPSAiIjsKICAgICAgdGhpcy53b3JrT3JkZXJTdW1tYXJ5LnNlbGVjdGVkRmluYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5ID0gIiI7CgogICAgICB0aGlzLmZpbmFsSW5zcGVjdGlvbkJ5QXNzZXRDYXRlZ29yeSA9IFtdOwogICAgICB0aGlzLnNlbGVjdGVkRmluYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5ID0gIiI7CiAgICAgIGlmICh2YWx1ZS52YWx1ZSA9PT0gIlNhbWUgQXMgSW5pdGlhbCIpIHsKICAgICAgICB0aGlzLnNhbWUgPSB0cnVlOwogICAgICAgIGlmICh0aGlzLmNoZWNrRXhpc3RpbmdJbml0aWFsSW5zcGVjdGlvbikgewogICAgICAgICAgdGhpcy53b3JrT3JkZXJTdW1tYXJ5LnNlbGVjdGVkRmluYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5ID0KICAgICAgICAgICAgdGhpcy53b3JrT3JkZXJTdW1tYXJ5LnNlbGVjdGVkSW5pdGlhbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMud29ya09yZGVyU3VtbWFyeS5maW5hbEluc3BlY3Rpb25UaXRsZSA9CiAgICAgICAgICAgIHRoaXMud29ya09yZGVyU3VtbWFyeS5pbml0aWFsSW5zcGVjdGlvblRpdGxlOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNhbWUgPSBmYWxzZTsKICAgICAgICBpZiAodmFsdWUudmFsdWUgPT09ICJTZWxlY3QgRXhpc3RpbmciKSB7CiAgICAgICAgICAvL2NoZWNraW5nIGlmIGV4aXN0aW5nIHRlbXBsYXRlIHdhcyB0aGUgcGVyaXZvdXMgdGVtcGxhdGUKICAgICAgICAgIGlmICgKICAgICAgICAgICAgdGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLnBsYW5uaW5nLmZyb21FeGlzdGluZ0ZpbmFsIHx8CiAgICAgICAgICAgIHRoaXMud29ya09yZGVyRGV0YWlsLndvcmtPcmRlci5wbGFubmluZy5mcm9tSW5zcGVjdGlvbkZpbmFsCiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy5tYXBGaW5hbEV4aXN0aW5nVGVtcGxhdGUoCiAgICAgICAgICAgICAgdGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLnBsYW5uaW5nCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHRoaXMucXVlc3Rpb25UeXBlRm9ybUZpbmFsID0gW107CiAgICAgICAgICAgIHRoaXMuYWRkSW5wdXRGaWVsZHNGaW5hbCgpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvL2NoZWNraW5nIGlmIG5ldyB0ZW1wbGF0ZSB3YXMgdGhlIHBlcml2b3VzIHRlbXBsYXRlCiAgICAgICAgICBpZiAoCiAgICAgICAgICAgICF0aGlzLndvcmtPcmRlckRldGFpbC53b3JrT3JkZXIucGxhbm5pbmcuZnJvbUV4aXN0aW5nRmluYWwgJiYKICAgICAgICAgICAgIXRoaXMud29ya09yZGVyRGV0YWlsLndvcmtPcmRlci5wbGFubmluZy5mcm9tSW5zcGVjdGlvbkZpbmFsCiAgICAgICAgICApIHsKICAgICAgICAgICAgaWYgKCF0aGlzLndvcmtPcmRlckRldGFpbC53b3JrT3JkZXIucGxhbm5pbmcuc2FtZUluc3BlY3Rpb24pIHsKICAgICAgICAgICAgICB0aGlzLndvcmtPcmRlclN1bW1hcnkuZmluYWxJbnNwZWN0aW9uVGl0bGUgPQogICAgICAgICAgICAgICAgdGhpcy5wcmV2aW91c0ZpbmFsVGVtcGxhdGUubmFtZTsKICAgICAgICAgICAgICB0aGlzLnF1ZXN0aW9uVHlwZUZvcm1GaW5hbCA9IHRoaXMuc2V0VHlwZUxhYmVsKAogICAgICAgICAgICAgICAgdGhpcy5wcmV2aW91c0ZpbmFsVGVtcGxhdGUuaXRlbXMKICAgICAgICAgICAgICApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMucXVlc3Rpb25UeXBlRm9ybUZpbmFsID0gW107CiAgICAgICAgICAgICAgdGhpcy5hZGRJbnB1dEZpZWxkc0ZpbmFsKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMucXVlc3Rpb25UeXBlRm9ybUZpbmFsID0gW107CiAgICAgICAgICAgIHRoaXMuYWRkSW5wdXRGaWVsZHNGaW5hbCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLndvcmtPcmRlclN1bW1hcnlJbmRleCsrOwogICAgfSwKCiAgICBpbml0aWFsSW5zcGVjdGlvbkZ1bmModmFsdWUpIHsKICAgICAgaWYgKHRoaXMuc2FtZSA9PT0gdHJ1ZSkgewogICAgICAgIGlmICh0aGlzLmNoZWNrRXhpc3RpbmdJbml0aWFsSW5zcGVjdGlvbiA9PT0gZmFsc2UpIHsKICAgICAgICAgIHRoaXMud29ya09yZGVyU3VtbWFyeS5maW5hbEluc3BlY3Rpb25UaXRsZSA9IHZhbHVlOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLndvcmtPcmRlclN1bW1hcnlJbmRleCsrOwogICAgfSwKCiAgICBleGlzdGluZ0Z1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHRoaXMud29ya09yZGVyU3VtbWFyeS5pbml0aWFsSW5zcGVjdGlvblRpdGxlID0gIiI7CiAgICAgIHRoaXMud29ya09yZGVyU3VtbWFyeS5zZWxlY3RlZEluaXRpYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5ID0gIiI7CgogICAgICBpZiAodGhpcy5zYW1lID09PSB0cnVlKSB7CiAgICAgICAgdGhpcy53b3JrT3JkZXJTdW1tYXJ5LmZpbmFsSW5zcGVjdGlvblRpdGxlID0gIiI7CiAgICAgICAgdGhpcy53b3JrT3JkZXJTdW1tYXJ5LnNlbGVjdGVkRmluYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5ID0gIiI7CiAgICAgIH0KICAgICAgLy93aGVuIGNoZWNrIG9yIHVuLWNoZWNrIGNoZWNrLWJveCBjaGVja2luZyB0aGVuIG1hcHBpbmcgVGVtcGxhdGVzIGRhdGEgYWdhaW4KICAgICAgaWYgKHRoaXMud29ya09yZGVyRGV0YWlsLndvcmtPcmRlci5wbGFubmluZy5zYW1lSW5zcGVjdGlvbikgewogICAgICAgIHRoaXMuZmluYWxJbnNwZWN0aW9uU2VsZWN0aW9uID0gIlNhbWUgQXMgSW5pdGlhbCI7CiAgICAgIH0KCiAgICAgIGlmICh2YWx1ZSA9PT0gdHJ1ZSkgewogICAgICAgIC8vY2hlY2tpbmcgaWYgZXhpc3RpbmcgdGVtcGxhdGUgd2FzIHRoZSBwZXJpdm91cyB0ZW1wbGF0ZQogICAgICAgIGlmICgKICAgICAgICAgIHRoaXMud29ya09yZGVyRGV0YWlsLndvcmtPcmRlci5wbGFubmluZy5mcm9tRXhpc3RpbmdJbml0aWFsIHx8CiAgICAgICAgICB0aGlzLndvcmtPcmRlckRldGFpbC53b3JrT3JkZXIucGxhbm5pbmcuZnJvbUluc3BlY3Rpb25Jbml0aWFsCiAgICAgICAgKSB7CiAgICAgICAgICB0aGlzLm1hcEluaXRpYWxFeGlzdGluZ1RlbXBsYXRlKAogICAgICAgICAgICB0aGlzLndvcmtPcmRlckRldGFpbC53b3JrT3JkZXIucGxhbm5pbmcKICAgICAgICAgICk7CiAgICAgICAgICB0aGlzLnF1ZXN0aW9uVHlwZUZvcm1Jbml0aWFsID0gW107CiAgICAgICAgICB0aGlzLmFkZElucHV0RmllbGRzSW5pdGlhbCgpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvL2NoZWNraW5nIGlmIG5ldyB0ZW1wbGF0ZSB3YXMgdGhlIHBlcml2b3VzIHRlbXBsYXRlCiAgICAgICAgaWYgKAogICAgICAgICAgIXRoaXMud29ya09yZGVyRGV0YWlsLndvcmtPcmRlci5wbGFubmluZy5mcm9tRXhpc3RpbmdJbml0aWFsICYmCiAgICAgICAgICAhdGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLnBsYW5uaW5nLmZyb21JbnNwZWN0aW9uSW5pdGlhbAogICAgICAgICkgewogICAgICAgICAgdGhpcy53b3JrT3JkZXJTdW1tYXJ5LmluaXRpYWxJbnNwZWN0aW9uVGl0bGUgPQogICAgICAgICAgICB0aGlzLnBlcml2b3VzSW5pdGlhbFRlbXBsYXRlLm5hbWU7CiAgICAgICAgICBpZiAodGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLnBsYW5uaW5nLnNhbWVJbnNwZWN0aW9uKSB7CiAgICAgICAgICAgIHRoaXMud29ya09yZGVyU3VtbWFyeS5maW5hbEluc3BlY3Rpb25UaXRsZSA9CiAgICAgICAgICAgICAgdGhpcy53b3JrT3JkZXJTdW1tYXJ5LmluaXRpYWxJbnNwZWN0aW9uVGl0bGU7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLnF1ZXN0aW9uVHlwZUZvcm1Jbml0aWFsID0gdGhpcy5zZXRUeXBlTGFiZWwoCiAgICAgICAgICAgIHRoaXMucGVyaXZvdXNJbml0aWFsVGVtcGxhdGUuaW5zcGVjdGlvbkl0ZW1zCiAgICAgICAgICApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnF1ZXN0aW9uVHlwZUZvcm1Jbml0aWFsID0gW107CiAgICAgICAgICB0aGlzLmFkZElucHV0RmllbGRzSW5pdGlhbCgpOwogICAgICAgIH0KICAgICAgICB0aGlzLmluaXRpYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5ID0gIiI7CiAgICAgICAgdGhpcy5zZWxlY3RlZEluaXRpYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5ID0gIiI7CiAgICAgICAgdGhpcy5pbml0aWFsQXNzZXRJbmRleCsrOwogICAgICB9CiAgICAgIHRoaXMud29ya09yZGVyU3VtbWFyeUluZGV4Kys7CiAgICB9LAoKICAgIHNpZGVCYXJJbmRleCgpIHsKICAgICAgdGhpcy5zaWRlYmFyVXBkYXRlKys7CiAgICB9LAoKICAgIGdldEZvcm1FcnJvck1lc3NhZ2UoZmllbGRWYWxpZGF0aW9uKSB7CiAgICAgIGlmIChmaWVsZFZhbGlkYXRpb24gJiYgZmllbGRWYWxpZGF0aW9uLiRkaXJ0eSkgewogICAgICAgIHJldHVybiBGdW5jdGlvbnMuZ2V0Rm9ybUZpZWxkRXJyb3JNZXNzYWdlKGZpZWxkVmFsaWRhdGlvbik7CiAgICAgIH0KICAgIH0sCgogICAgb25Jc3N1ZU51bWJlclNlbGVjdCh2YWx1ZSkgewogICAgICB0aGlzLndvcmtPcmRlckRldGFpbC53b3JrT3JkZXIuaXNzdWVzID0gW107CiAgICAgIGlmICh2YWx1ZS5sZW5ndGggPiAwKSB7CiAgICAgICAgdGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLmlzc3VlcyA9IHZhbHVlLmZpbHRlcigKICAgICAgICAgICh2KSA9PiB2LmlkICE9PSBudWxsICYmIHYuaWQgIT09IHVuZGVmaW5lZAogICAgICAgICk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLmlzc3VlcyA9IG51bGw7CiAgICAgIH0KICAgIH0sCgogICAgY2xvc2VJc3N1ZURpYWxvZygpIHsKICAgICAgdGhpcy52aWV3UG9vbElzc3VlID0gZmFsc2U7CiAgICB9LAoKICAgIHZpZXdJc3N1ZShpc3N1ZSkgewogICAgICB0aGlzLmlzc3VlVVVJRCA9IGlzc3VlLnV1aWQ7CiAgICAgIHRoaXMudmlld1Bvb2xJc3N1ZSA9IHRydWU7CiAgICB9LAoKICAgIHVwZGF0ZVdvcmtPcmRlcigpIHsKICAgICAgdGhpcy4kdi4kdG91Y2goKTsKICAgICAgaWYgKHRoaXMuJHYuJGludmFsaWQpIHsKICAgICAgICB0aGlzLnNob3dUb2FzdCgiUGxlYXNlIGZpbGwgYWxsIHJlcXVpcmVkIGZpZWxkcyIsICJ3YXJuaW5nIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBsZXQgc3VtbWFyeV9mb3JtX3ZhbGRpYXRpb25zID0KICAgICAgICB0aGlzLiRyZWZzLndvcmtPcmRlclN1bW1hcnlGb3JtICYmCiAgICAgICAgdGhpcy4kcmVmcy53b3JrT3JkZXJTdW1tYXJ5Rm9ybS5jaGVja1ZhbGlkYXRpb25zKCkKICAgICAgICAgID8gdGhpcy4kcmVmcy53b3JrT3JkZXJTdW1tYXJ5Rm9ybS5jaGVja1ZhbGlkYXRpb25zKCkKICAgICAgICAgIDogbnVsbDsKICAgICAgbGV0IGFzc2lnbm1lbnRfZm9ybV92YWxpZGF0aW9ucyA9CiAgICAgICAgdGhpcy4kcmVmcy53b3JrT3JkZXJBc3NpZ25tZW50Rm9ybSAmJgogICAgICAgIHRoaXMuJHJlZnMud29ya09yZGVyQXNzaWdubWVudEZvcm0uY2hlY2tWYWxpZGF0aW9ucygpCiAgICAgICAgICA/IHRoaXMuJHJlZnMud29ya09yZGVyQXNzaWdubWVudEZvcm0uY2hlY2tWYWxpZGF0aW9ucygpCiAgICAgICAgICA6IG51bGw7CgogICAgICBpZiAoc3VtbWFyeV9mb3JtX3ZhbGRpYXRpb25zKSB7CiAgICAgICAgdGhpcy5zaG93VG9hc3QoIlBsZWFzZSBmaWxsIGFsbCByZXF1aXJlZCBmaWVsZHMiLCAid2FybmluZyIpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKGFzc2lnbm1lbnRfZm9ybV92YWxpZGF0aW9ucykgewogICAgICAgIHRoaXMuc2hvd1RvYXN0KCJQbGVhc2UgZmlsbCBhbGwgcmVxdWlyZWQgZmllbGRzIiwgIndhcm5pbmciKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMubG9hZGVyRmxhZyA9IHRydWU7CgogICAgICBsZXQgaW5pdGlhbEluc3BlY3Rpb25UZW1wbGF0ZSA9IG51bGw7CiAgICAgIGxldCBmaW5hbEluc3BlY3Rpb25UZW1wbGF0ZSA9IG51bGw7CiAgICAgIGxldCBmcm9tSW5zcGVjdGlvbkluaXRpYWwgPSBmYWxzZTsKICAgICAgbGV0IGZyb21JbnNwZWN0aW9uRmluYWwgPSBmYWxzZTsKCiAgICAgIGxldCBpbml0aWFsSW5zcGVjdGlvbk9wdGlvbiA9IG51bGw7CiAgICAgIGxldCBmaW5hbEluc3BlY3Rpb25PcHRpb24gPSBudWxsOwoKICAgICAgdmFyIGluaXRpYWxJbnNwZWN0aW9uVGVtcGxhdGVMaW5raW5nVVVJRCA9IG51bGw7CiAgICAgIGxldCBmaW5hbEluc3BlY3Rpb25UZW1wbGF0ZUxpbmtpbmdVVUlEID0gbnVsbDsKICAgICAgbGV0IGluaXRpYWxMaW5rSW5zcGVjdGlvblR5cGUgPSBudWxsOwogICAgICBsZXQgZmluYWxMaW5rSW5zcGVjdGlvblR5cGUgPSBudWxsOwogICAgICB0aGlzLiRyZWZzLmlzc3Vlc0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICBpZiAodGhpcy5jaGVja0V4aXN0aW5nSW5pdGlhbEluc3BlY3Rpb24gPT09IHRydWUpIHsKICAgICAgICBpZiAodGhpcy5zZWxlY3RlZEluaXRpYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5ICE9PSAiIikgewogICAgICAgICAgaW5pdGlhbExpbmtJbnNwZWN0aW9uVHlwZSA9ICJpbnNwZWN0aW9uIjsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHRoaXMuZmluYWxJbnNwZWN0aW9uU2VsZWN0aW9uID09PSAiU2VsZWN0IEV4aXN0aW5nIikgewogICAgICAgIGlmICh0aGlzLnNlbGVjdGVkRmluYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5ICE9PSAiIikgewogICAgICAgICAgZmluYWxMaW5rSW5zcGVjdGlvblR5cGUgPSAiaW5zcGVjdGlvbiI7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAodGhpcy5xdWVzdGlvblR5cGVGb3JtSW5pdGlhbC5sZW5ndGggPiAwKSB7CiAgICAgICAgaW5pdGlhbEluc3BlY3Rpb25UZW1wbGF0ZSA9IHsKICAgICAgICAgIG5hbWU6IHRoaXMud29ya09yZGVyU3VtbWFyeS5pbml0aWFsSW5zcGVjdGlvblRpdGxlLAogICAgICAgICAgaW5zcGVjdGlvbkl0ZW1zOiB0aGlzLnF1ZXN0aW9uVHlwZUZvcm1Jbml0aWFsLAogICAgICAgICAgdXVpZDoKICAgICAgICAgICAgdGhpcy5wZXJpdm91c0luaXRpYWxUZW1wbGF0ZS51dWlkICE9PSBudWxsICYmCiAgICAgICAgICAgIHRoaXMucGVyaXZvdXNJbml0aWFsVGVtcGxhdGUudXVpZCAhPT0gdW5kZWZpbmVkCiAgICAgICAgICAgICAgPyB0aGlzLnBlcml2b3VzSW5pdGlhbFRlbXBsYXRlLnV1aWQKICAgICAgICAgICAgICA6IG51bGwsCiAgICAgICAgfTsKICAgICAgICBpbml0aWFsSW5zcGVjdGlvbk9wdGlvbiA9ICJzYXZlIjsKICAgICAgICBmcm9tSW5zcGVjdGlvbkluaXRpYWwgPSBmYWxzZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBmcm9tSW5zcGVjdGlvbkluaXRpYWwgPSB0cnVlOwogICAgICB9CgogICAgICBpZiAodGhpcy5xdWVzdGlvblR5cGVGb3JtRmluYWwubGVuZ3RoID4gMCkgewogICAgICAgIGZpbmFsSW5zcGVjdGlvblRlbXBsYXRlID0gewogICAgICAgICAgbmFtZTogdGhpcy53b3JrT3JkZXJTdW1tYXJ5LmZpbmFsSW5zcGVjdGlvblRpdGxlLAogICAgICAgICAgaW5zcGVjdGlvbkl0ZW1zOiB0aGlzLnF1ZXN0aW9uVHlwZUZvcm1GaW5hbCwKICAgICAgICAgIHV1aWQ6CiAgICAgICAgICAgIHRoaXMucHJldmlvdXNGaW5hbFRlbXBsYXRlLnV1aWQgIT09IG51bGwgJiYKICAgICAgICAgICAgdGhpcy5wcmV2aW91c0ZpbmFsVGVtcGxhdGUudXVpZCAhPT0gdW5kZWZpbmVkCiAgICAgICAgICAgICAgPyB0aGlzLnByZXZpb3VzRmluYWxUZW1wbGF0ZS51dWlkCiAgICAgICAgICAgICAgOiBudWxsLAogICAgICAgIH07CiAgICAgICAgZmluYWxJbnNwZWN0aW9uT3B0aW9uID0gInNhdmUiOwogICAgICAgIGZyb21JbnNwZWN0aW9uRmluYWwgPSBmYWxzZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBmcm9tSW5zcGVjdGlvbkZpbmFsID0gdHJ1ZTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuc2FtZUFzSW5pdGlhbEluc3BlY3Rpb24pIHsKICAgICAgICB0aGlzLndvcmtPcmRlckRldGFpbC53b3JrT3JkZXIucGxhbm5pbmcuc2FtZUluc3BlY3Rpb24gPSB0cnVlOwogICAgICB9CgogICAgICBpZiAodGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLnBsYW5uaW5nLmZyb21JbnNwZWN0aW9uSW5pdGlhbCkgewogICAgICAgIGlmICh0aGlzLnNlbGVjdGVkSW5pdGlhbEluc3BlY3Rpb25CeUFzc2V0ICE9PSBudWxsKSB7CiAgICAgICAgICB0aGlzLndvcmtPcmRlckRldGFpbC53b3JrT3JkZXIucGxhbm5pbmcuaW5pdGlhbEluc3BlY3Rpb25VVUlEID0KICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEluaXRpYWxJbnNwZWN0aW9uQnlBc3NldC52YWx1ZTsKICAgICAgICB9IGVsc2UgaWYgKHRoaXMuc2VsZWN0ZWRJbml0aWFsSW5zcGVjdGlvbkJ5QXNzZXRDYXRlZ29yeSAhPT0gbnVsbCkgewogICAgICAgICAgdGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLnBsYW5uaW5nLmluaXRpYWxJbnNwZWN0aW9uVVVJRCA9CiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJbml0aWFsSW5zcGVjdGlvbkJ5QXNzZXRDYXRlZ29yeS52YWx1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLnBsYW5uaW5nLmluaXRpYWxJbnNwZWN0aW9uVVVJRCA9CiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRGaW5hbEluc3BlY3Rpb25CeVdvcmtPcmRlci52YWx1ZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLndvcmtPcmRlckRldGFpbC53b3JrT3JkZXIucGxhbm5pbmcuZnJvbUluc3BlY3Rpb25GaW5hbCkgewogICAgICAgIGlmICh0aGlzLnNhbWVBc0luaXRpYWxJbnNwZWN0aW9uKSB7CiAgICAgICAgICB0aGlzLndvcmtPcmRlckRldGFpbC53b3JrT3JkZXIucGxhbm5pbmcuZmluYWxJbnNwZWN0aW9uVVVJRCA9CiAgICAgICAgICAgIHRoaXMud29ya09yZGVyRGV0YWlsLndvcmtPcmRlci5wbGFubmluZy5pbml0aWFsSW5zcGVjdGlvblVVSUQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkRmluYWxJbnNwZWN0aW9uQnlBc3NldCAhPT0gbnVsbCkgewogICAgICAgICAgICB0aGlzLndvcmtPcmRlckRldGFpbC53b3JrT3JkZXIucGxhbm5pbmcuZmluYWxJbnNwZWN0aW9uVVVJRCA9CiAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEZpbmFsSW5zcGVjdGlvbkJ5QXNzZXQudmFsdWU7CiAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuc2VsZWN0ZWRGaW5hbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnkgIT09IG51bGwpIHsKICAgICAgICAgICAgdGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLnBsYW5uaW5nLmZpbmFsSW5zcGVjdGlvblVVSUQgPQogICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRGaW5hbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnkudmFsdWU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLndvcmtPcmRlckRldGFpbC53b3JrT3JkZXIucGxhbm5pbmcuZmluYWxJbnNwZWN0aW9uVVVJRCA9CiAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEZpbmFsSW5zcGVjdGlvbkJ5V29ya09yZGVyLnZhbHVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMuY2hlY2tFeGlzdGluZ0luaXRpYWxJbnNwZWN0aW9uKSB7CiAgICAgICAgdGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLnBsYW5uaW5nLmZyb21FeGlzdGluZ0luaXRpYWwgPSB0cnVlOwogICAgICAgIHRoaXMud29ya09yZGVyRGV0YWlsLndvcmtPcmRlci5wbGFubmluZy5mcm9tSW5zcGVjdGlvbkluaXRpYWwgPSBmYWxzZTsKICAgICAgICB0aGlzLndvcmtPcmRlckRldGFpbC53b3JrT3JkZXIucGxhbm5pbmcuaW5pdGlhbEluc3BlY3Rpb25VVUlEID0KICAgICAgICAgIHRoaXMuaW5pdGlhbEluc3BlY3Rpb25UZW1wLnV1aWQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLnBsYW5uaW5nLmluaXRpYWxJbnNwZWN0aW9uVVVJRCA9IG51bGw7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmZpbmFsSW5zcGVjdGlvblNlbGVjdGlvbiA9PT0gIlNlbGVjdCBFeGlzdGluZyIpIHsKICAgICAgICB0aGlzLndvcmtPcmRlckRldGFpbC53b3JrT3JkZXIucGxhbm5pbmcuZnJvbUV4aXN0aW5nRmluYWwgPSB0cnVlOwogICAgICAgIHRoaXMud29ya09yZGVyRGV0YWlsLndvcmtPcmRlci5wbGFubmluZy5mcm9tSW5zcGVjdGlvbkluaXRpYWwgPSBmYWxzZTsKICAgICAgICB0aGlzLndvcmtPcmRlckRldGFpbC53b3JrT3JkZXIucGxhbm5pbmcuZmluYWxJbnNwZWN0aW9uVVVJRCA9CiAgICAgICAgICB0aGlzLnNlbGVjdGVkRmluYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5LnV1aWQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLnBsYW5uaW5nLmZpbmFsSW5zcGVjdGlvblVVSUQgPSBudWxsOwogICAgICB9CgogICAgICBpZiAoCiAgICAgICAgdGhpcy5maW5hbEluc3BlY3Rpb25TZWxlY3Rpb24gPT09ICJTYW1lIEFzIEluaXRpYWwiICYmCiAgICAgICAgdGhpcy5jaGVja0V4aXN0aW5nSW5pdGlhbEluc3BlY3Rpb24KICAgICAgKSB7CiAgICAgICAgdGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLnBsYW5uaW5nLmZpbmFsSW5zcGVjdGlvblVVSUQgPQogICAgICAgICAgdGhpcy5pbml0aWFsSW5zcGVjdGlvblRlbXAudXVpZDsKICAgICAgICB0aGlzLndvcmtPcmRlckRldGFpbC53b3JrT3JkZXIucGxhbm5pbmcuZnJvbUV4aXN0aW5nRmluYWwgPSB0cnVlOwogICAgICB9CgogICAgICBpZiAoCiAgICAgICAgdGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLnBsYW5uaW5nLmluaXRpYWxJbnNwZWN0aW9uVVVJRCA9PT0KICAgICAgICB0aGlzLndvcmtPcmRlckRldGFpbC53b3JrT3JkZXIucGxhbm5pbmcuZmluYWxJbnNwZWN0aW9uVVVJRAogICAgICApIHsKICAgICAgICB0aGlzLndvcmtPcmRlckRldGFpbC53b3JrT3JkZXIucGxhbm5pbmcuc2FtZUluc3BlY3Rpb24gPSB0cnVlOwogICAgICB9IGVsc2UgaWYgKAogICAgICAgIHRoaXMud29ya09yZGVyRGV0YWlsLndvcmtPcmRlci5wbGFubmluZy5pbml0aWFsSW5zcGVjdGlvblVVSUQgPT0gbnVsbCB8fAogICAgICAgIHRoaXMud29ya09yZGVyRGV0YWlsLndvcmtPcmRlci5wbGFubmluZy5maW5hbEluc3BlY3Rpb25VVUlEID09IG51bGwKICAgICAgKSB7CiAgICAgICAgdGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLnBsYW5uaW5nLnNhbWVJbnNwZWN0aW9uID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLndvcmtPcmRlckRldGFpbC53b3JrT3JkZXIuc3RhcnRUaW1lID09PSAiLSIpIHsKICAgICAgICB0aGlzLndvcmtPcmRlckRldGFpbC53b3JrT3JkZXIuc3RhcnRUaW1lID0gbnVsbDsKICAgICAgfQogICAgICBpZiAodGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLmVuZFRpbWUgPT09ICItIikgewogICAgICAgIHRoaXMud29ya09yZGVyRGV0YWlsLndvcmtPcmRlci5lbmRUaW1lID0gbnVsbDsKICAgICAgfQoKICAgICAgaWYgKHRoaXMud29ya09yZGVyRGV0YWlsLndvcmtPcmRlci5lbmRUaW1lID09PSAiLSIpIHsKICAgICAgICB0aGlzLndvcmtPcmRlckRldGFpbC53b3JrT3JkZXIuZW5kVGltZSA9IG51bGw7CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGlzc3VlIG9mIHRoaXMud29ya09yZGVyRGV0YWlsLndvcmtPcmRlci5pc3N1ZXMpIHsKICAgICAgICBpc3N1ZS5vcmRlckluc3RydWN0aW9ucyA9IEpTT04uc3RyaW5naWZ5KGlzc3VlLm9yZGVySW5zdHJ1Y3Rpb25zKTsKICAgICAgfQoKICAgICAgdGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLnNjaGVkdWxlID0gbW9tZW50KAogICAgICAgIHRoaXMud29ya09yZGVyRGV0YWlsLndvcmtPcmRlci5zY2hlZHVsZQogICAgICApLnRvSVNPU3RyaW5nKCk7CiAgICAgIHRoaXMud29ya09yZGVyRGV0YWlsLndvcmtPcmRlci5zdGFydFRpbWUgPSBtb21lbnQoCiAgICAgICAgdGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLnN0YXJ0VGltZQogICAgICApLnRvSVNPU3RyaW5nKCk7CgogICAgICB0aGlzLndvcmtPcmRlckRldGFpbC53b3JrT3JkZXIuZW5kVGltZSA9IG1vbWVudCgKICAgICAgICB0aGlzLndvcmtPcmRlckRldGFpbC53b3JrT3JkZXIuZW5kVGltZQogICAgICApLnRvSVNPU3RyaW5nKCk7CgogICAgICBsZXQgdXBkYXRlV29ya09yZGVyUmVxID0gewogICAgICAgIHdvcmtPcmRlcjogdGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLAogICAgICAgIHVwZGF0ZVdvcmtPcmRlcjogdHJ1ZSwKICAgICAgICB0ZW1wbGF0ZVVwZGF0ZTogdHJ1ZSwKICAgICAgfTsKCiAgICAgIGlmICh0aGlzLmNoZWNrRXhpc3RpbmdJbml0aWFsSW5zcGVjdGlvbiA9PT0gdHJ1ZSkgewogICAgICAgIHVwZGF0ZVdvcmtPcmRlclJlcS5pbml0aWFsSW5zcGVjdGlvblRlbXBsYXRlID0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICB1cGRhdGVXb3JrT3JkZXJSZXEuaW5pdGlhbEluc3BlY3Rpb25UZW1wbGF0ZSA9CiAgICAgICAgICBpbml0aWFsSW5zcGVjdGlvblRlbXBsYXRlOwogICAgICAgIHRoaXMud29ya09yZGVyRGV0YWlsLndvcmtPcmRlci5wbGFubmluZy5mcm9tRXhpc3RpbmdJbml0aWFsID0gZmFsc2U7CiAgICAgICAgdGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLnBsYW5uaW5nLmZyb21JbnNwZWN0aW9uSW5pdGlhbCA9IGZhbHNlOwogICAgICB9CgogICAgICBpZiAodGhpcy5maW5hbEluc3BlY3Rpb25TZWxlY3Rpb24gPT09ICJDcmVhdGUgTmV3IEluc3BlY3Rpb24gVGVtcGxhdGUiKSB7CiAgICAgICAgdXBkYXRlV29ya09yZGVyUmVxLmZpbmFsSW5zcGVjdGlvblRlbXBsYXRlID0gZmluYWxJbnNwZWN0aW9uVGVtcGxhdGU7CiAgICAgICAgdGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLnBsYW5uaW5nLmZyb21FeGlzdGluZ0ZpbmFsID0gZmFsc2U7CiAgICAgICAgdGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLnBsYW5uaW5nLmZyb21JbnNwZWN0aW9uRmluYWwgPSBmYWxzZTsKICAgICAgICB0aGlzLndvcmtPcmRlckRldGFpbC53b3JrT3JkZXIucGxhbm5pbmcuc2FtZUluc3BlY3Rpb24gPSBmYWxzZTsKICAgICAgfSBlbHNlIGlmICgKICAgICAgICB0aGlzLmZpbmFsSW5zcGVjdGlvblNlbGVjdGlvbiA9PT0gIlNhbWUgQXMgSW5pdGlhbCIgJiYKICAgICAgICB0aGlzLmNoZWNrRXhpc3RpbmdJbml0aWFsSW5zcGVjdGlvbiAhPT0gdHJ1ZQogICAgICApIHsKICAgICAgICB1cGRhdGVXb3JrT3JkZXJSZXEuZmluYWxJbnNwZWN0aW9uVGVtcGxhdGUgPSBpbml0aWFsSW5zcGVjdGlvblRlbXBsYXRlOwogICAgICAgIHRoaXMud29ya09yZGVyRGV0YWlsLndvcmtPcmRlci5wbGFubmluZy5mcm9tRXhpc3RpbmdGaW5hbCA9CiAgICAgICAgICB0aGlzLndvcmtPcmRlckRldGFpbC53b3JrT3JkZXIucGxhbm5pbmcuZnJvbUV4aXN0aW5nSW5pdGlhbDsKICAgICAgICB0aGlzLndvcmtPcmRlckRldGFpbC53b3JrT3JkZXIucGxhbm5pbmcuZnJvbUluc3BlY3Rpb25GaW5hbCA9CiAgICAgICAgICB0aGlzLndvcmtPcmRlckRldGFpbC53b3JrT3JkZXIucGxhbm5pbmcuZnJvbUluc3BlY3Rpb25Jbml0aWFsOwogICAgICB9IGVsc2UgaWYgKHRoaXMuZmluYWxJbnNwZWN0aW9uU2VsZWN0aW9uID09PSAiU2VsZWN0IEV4aXN0aW5nIikgewogICAgICAgIHVwZGF0ZVdvcmtPcmRlclJlcS5maW5hbEluc3BlY3Rpb25UZW1wbGF0ZSA9IG51bGw7CiAgICAgICAgdGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLnBsYW5uaW5nLnNhbWVJbnNwZWN0aW9uID0gZmFsc2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdXBkYXRlV29ya09yZGVyUmVxLmZpbmFsSW5zcGVjdGlvblRlbXBsYXRlID0gbnVsbDsKICAgICAgfQogICAgICB1cGRhdGVXb3JrT3JkZXJSZXEuaW5pdGlhbEluc3BlY3Rpb25PcHRpb24gPSBpbml0aWFsSW5zcGVjdGlvbk9wdGlvbjsKICAgICAgdXBkYXRlV29ya09yZGVyUmVxLmZpbmFsSW5zcGVjdGlvbk9wdGlvbiA9IGZpbmFsSW5zcGVjdGlvbk9wdGlvbjsKICAgICAgdXBkYXRlV29ya09yZGVyUmVxLmluaXRpYWxJbnNwZWN0aW9uVGVtcGxhdGVMaW5raW5nVVVJRCA9CiAgICAgICAgaW5pdGlhbEluc3BlY3Rpb25UZW1wbGF0ZUxpbmtpbmdVVUlEOwogICAgICB1cGRhdGVXb3JrT3JkZXJSZXEuZmluYWxJbnNwZWN0aW9uVGVtcGxhdGVMaW5raW5nVVVJRCA9CiAgICAgICAgZmluYWxJbnNwZWN0aW9uVGVtcGxhdGVMaW5raW5nVVVJRDsKICAgICAgdXBkYXRlV29ya09yZGVyUmVxLmluaXRpYWxMaW5rSW5zcGVjdGlvblR5cGUgPSBpbml0aWFsTGlua0luc3BlY3Rpb25UeXBlOwogICAgICB1cGRhdGVXb3JrT3JkZXJSZXEuZmluYWxMaW5rSW5zcGVjdGlvblR5cGUgPSBmaW5hbExpbmtJbnNwZWN0aW9uVHlwZTsKCiAgICAgIC8vcmV0dXJuCiAgICAgIFdvcmtPcmRlclNlcnZpY2UudXBkYXRlV29ya09yZGVyKHVwZGF0ZVdvcmtPcmRlclJlcSkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICAgICAgbmFtZTogIndvcmstb3JkZXIiLAogICAgICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICAgICAgdG9hc3RGbGFnOiB0cnVlLAogICAgICAgICAgICAgICAgbWVzc2FnZTogIldvcmsgT3JkZXIgVXBkYXRlZCBTdWNjZXNzZnVsbHkiLAogICAgICAgICAgICAgICAgdG9hc3RUeXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMubG9hZGVyRmxhZyA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlcnJvcikgPT4gewogICAgICAgICAgdGhpcy5sb2FkZXJGbGFnID0gZmFsc2U7CiAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7CiAgICAgICAgfSk7CiAgICB9LAoKICAgIGdldFBvb2xlZElzc3VlcygpIHsKICAgICAgSW5zcGVjdGlvblNlcnZpY2UuZmlsdGVySXNzdWVzQnlBc3NldFVVSUQoCiAgICAgICAgdGhpcy5hc3NldEluZm8uYXNzZXREZXRhaWwudXVpZCwKICAgICAgICAiUE9PTEVEIgogICAgICApCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgICAgdGhpcy5wb29sZWRJc3N1ZXMgPSByZXNwb25zZS5kYXRhLmlzc3VlczsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTsKICAgICAgICB9KTsKICAgIH0sCgogICAgZ2V0SXNzdWVzQnlBc3NldFVVSUQoKSB7CiAgICAgIEluc3BlY3Rpb25TZXJ2aWNlLmZpbHRlcklzc3Vlc0J5QXNzZXRVVUlEKAogICAgICAgIHRoaXMuYXNzZXRJbmZvLmFzc2V0RGV0YWlsLnV1aWQsCiAgICAgICAgInJlcG9ydGVkIgogICAgICApCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgICAgdGhpcy5pc3N1ZXNBcnJheUxpc3QgPSByZXNwb25zZS5kYXRhLmlzc3VlczsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTsKICAgICAgICB9KTsKICAgIH0sCgogICAgZ2V0Q3VycmVuY3koKSB7CiAgICAgIEFzc2V0UGVyc29ubmVsU2VydmljZS5nZXRDb21wYW55Q3VycmVuY3koCiAgICAgICAgdGhpcy5jdXJyZW50VXNlckRldGFpbHMucHJvZmlsZS5vcmdhbml6YXRpb25JZAogICAgICApLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgdGhpcy5jdXJyZW5jeSA9IHJlc3BvbnNlLmRhdGEuY3VycmVuY3k7CiAgICAgIH0pOwogICAgfSwKCiAgICBnZXRXb3JrT3JkZXIoKSB7CiAgICAgIFdvcmtPcmRlclNlcnZpY2UuZ2V0V29ya09yZGVyQnlVVUlEKHRoaXMuJHJvdXRlLnBhcmFtcy53b3JrdXVpZCkudGhlbigKICAgICAgICAocmVzcG9uc2UpID0+IHsKCiAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgICAgZm9yIChsZXQgd29ya29yZGVyX2lzc3VlIG9mIHJlc3BvbnNlLmRhdGEud29ya09yZGVyLmlzc3VlcykgewogICAgICAgICAgICAgIHdvcmtvcmRlcl9pc3N1ZS5vcmRlckluc3RydWN0aW9ucyA9IEpTT04ucGFyc2UoCiAgICAgICAgICAgICAgICB3b3Jrb3JkZXJfaXNzdWUub3JkZXJJbnN0cnVjdGlvbnMKICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmlzc3Vlc0FycmF5TGlzdCA9IHJlc3BvbnNlLmRhdGEud29ya09yZGVyLmlzc3VlczsKICAgICAgICAgICAgdGhpcy5pc3N1ZXNTZWxlY3RlZCA9IHRoaXMuaXNzdWVzQXJyYXlMaXN0OwogICAgICAgICAgICAvLyBmb3IgKGxldCB4IGluIHRoaXMuaXNzdWVzQXJyYXlMaXN0KSB7CiAgICAgICAgICAgIC8vICAgdGhpcy5pc3N1ZU51bWJlciA9IHRoaXMuaXNzdWVzU2VsZWN0ZWRbeF0uaXNzdWVOdW1iZXI7CiAgICAgICAgICAgIC8vICAgY29uc29sZS5sb2coImlzc3VlTnVtYmVyIiwgdGhpcy5pc3N1ZU51bWJlcik7CiAgICAgICAgICAgIC8vIH0KCiAgICAgICAgICAgIHRoaXMud29ya09yZGVyRGV0YWlsID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgZG9jdW1lbnQudGl0bGUgPSBgJHt0aGlzLndvcmtPcmRlckRldGFpbC53b3JrT3JkZXIud29ya09yZGVyTnVtYmVyfSAke3RoaXMuJHJvdXRlLm1ldGEudGl0bGV9YDsKCiAgICAgICAgICAgIGRvY3VtZW50LnRpdGxlID0gYCR7dGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLndvcmtPcmRlck51bWJlcn0gJHt0aGlzLiRyb3V0ZS5tZXRhLnRpdGxlfWA7CgogICAgICAgICAgICBpZiAodGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLnN0YXJ0VGltZSA9PT0gbnVsbCkgewogICAgICAgICAgICAgIHRoaXMud29ya09yZGVyRGV0YWlsLndvcmtPcmRlci5zdGFydFRpbWUgPSAiLSI7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLnN0YXJ0VGltZSA9IG1vbWVudCgKICAgICAgICAgICAgICAgIHRoaXMud29ya09yZGVyRGV0YWlsLndvcmtPcmRlci5zdGFydFRpbWUKICAgICAgICAgICAgICApLmZvcm1hdCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLndvcmtPcmRlckRldGFpbC53b3JrT3JkZXIuZW5kVGltZSA9PT0gbnVsbCkgewogICAgICAgICAgICAgIHRoaXMud29ya09yZGVyRGV0YWlsLndvcmtPcmRlci5lbmRUaW1lID0gIi0iOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMud29ya09yZGVyRGV0YWlsLndvcmtPcmRlci5lbmRUaW1lID0gbW9tZW50KAogICAgICAgICAgICAgICAgdGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLmVuZFRpbWUKICAgICAgICAgICAgICApLmZvcm1hdCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLndvcmtPcmRlckRldGFpbC53b3JrT3JkZXIuZWxhcHNlZFRpbWVGb3JtYXR0ZWQgPT09IG51bGwpIHsKICAgICAgICAgICAgICB0aGlzLndvcmtPcmRlckRldGFpbC53b3JrT3JkZXIuZWxhcHNlZFRpbWVGb3JtYXR0ZWQgPSAiLSI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLnNjaGVkdWxlID0gbW9tZW50KAogICAgICAgICAgICAgIHRoaXMud29ya09yZGVyRGV0YWlsLndvcmtPcmRlci5zY2hlZHVsZQogICAgICAgICAgICApLmZvcm1hdCgiREQgTU1NIFlZWVkiKTsKICAgICAgICAgICAgdGhpcy5nZXRBc3NldChyZXNwb25zZS5kYXRhLndvcmtPcmRlci5hc3NldFVVSUQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgKTsKICAgIH0sCgogICAgZ2V0QXNzZXQoYXNzZXRVVUlEKSB7CiAgICAgIEFzc2V0TWFuYWdlbWVudFNlcnZpY2UuZ2V0QXNzZXRXaXRoRGV0YWlscyhhc3NldFVVSUQsIHRydWUsIHRydWUpCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgICAgdGhpcy5hc3NldEluZm8gPSByZXNwb25zZS5kYXRhLmFzc2V0RGV0YWlsOwogICAgICAgICAgICB0aGlzLmdldFBvb2xlZElzc3VlcygpOwogICAgICAgICAgICBpZiAodGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLnN0YXR1cyA9PT0gIk9wZW4iKSB7CiAgICAgICAgICAgICAgdGhpcy5nZXRJbnNwZWN0aW9uVGVtcGxhdGVzKAogICAgICAgICAgICAgICAgYXNzZXRVVUlELAogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50VXNlckRldGFpbHMucHJvZmlsZS5vcmdhbml6YXRpb25JZAogICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgdGhpcy5nZXRJbnNwZWN0aW9uVGVtcGxhdGVGcm9tV29ya09yZGVyKAogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50VXNlckRldGFpbHMucHJvZmlsZS5vcmdhbml6YXRpb25JZAogICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgdGhpcy5nZXRJbnNwZWN0aW9uVGVtYXBsYXRlc0J5QXNzZXRDYXRlZ29yeSgKICAgICAgICAgICAgICAgIHRoaXMuYXNzZXRJbmZvLmNhdGVnb3J5LnV1aWQKICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmxvYWRlckZsYWcgPSBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTsKICAgICAgICB9KTsKICAgIH0sCgogICAgYXNzZXRJbmZvQWNjb3JkaW9uRnVuY3Rpb24oKSB7CiAgICAgIGlmICh0aGlzLiRyZWZzLmFzc2V0SW5mb0FjY29yZGlvbi5vcGVuRmxhZyA9PT0gdHJ1ZSkgewogICAgICAgIGlmICh0aGlzLndvcmtPcmRlclR5cGUgPT09ICJlZGl0IikgewogICAgICAgICAgdGhpcy4kcmVmcy5hc3NpZ25tZW50QWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICB0aGlzLiRyZWZzLnRpbWluZ0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIGlmICh0aGlzLiRyZWZzLmluc3BlY3Rpb25SZXBvcnRzQWNjb3JkaW9uICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMuJHJlZnMuaW5zcGVjdGlvblJlcG9ydHNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgdGhpcy4kcmVmcy5pc3N1ZXNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLmlzc3VlUG9vbEFjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIGlmICh0aGlzLiRyZWZzLmZpbmFsSW5zcGVjdGlvbnNBY2NvcmRpb24gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdGhpcy4kcmVmcy5maW5hbEluc3BlY3Rpb25zQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLiRyZWZzLmluc3BlY3Rpb25zQWNjb3JkaW9uICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMuJHJlZnMuaW5zcGVjdGlvbnNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgYXNzaWdubWVudEFjY29yZGlvbkZ1bmN0aW9uKCkgewogICAgICBpZiAodGhpcy4kcmVmcy5hc3NpZ25tZW50QWNjb3JkaW9uLm9wZW5GbGFnID09PSB0cnVlKSB7CiAgICAgICAgdGhpcy4kcmVmcy50aW1pbmdBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICBpZiAodGhpcy4kcmVmcy5pbnNwZWN0aW9uUmVwb3J0c0FjY29yZGlvbiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0aGlzLiRyZWZzLmluc3BlY3Rpb25SZXBvcnRzQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHRoaXMuJHJlZnMuaXNzdWVzQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy5pc3N1ZVBvb2xBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICBpZiAodGhpcy4kcmVmcy5maW5hbEluc3BlY3Rpb25zQWNjb3JkaW9uICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMuJHJlZnMuZmluYWxJbnNwZWN0aW9uc0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy4kcmVmcy5pbnNwZWN0aW9uc0FjY29yZGlvbiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0aGlzLiRyZWZzLmluc3BlY3Rpb25zQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICB9LAoKICAgIHRpbWluZ0FjY29yZGlvbkZ1bmN0aW9uKCkgewogICAgICBpZiAodGhpcy4kcmVmcy50aW1pbmdBY2NvcmRpb24ub3BlbkZsYWcgPT09IHRydWUpIHsKICAgICAgICBpZiAodGhpcy53b3JrT3JkZXJUeXBlID09PSAiZWRpdCIpIHsKICAgICAgICAgIHRoaXMuJHJlZnMuYXNzaWdubWVudEFjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICB0aGlzLiRyZWZzLmFzc2V0SW5mb0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIGlmICh0aGlzLiRyZWZzLmluc3BlY3Rpb25SZXBvcnRzQWNjb3JkaW9uICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMuJHJlZnMuaW5zcGVjdGlvblJlcG9ydHNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgdGhpcy4kcmVmcy5pc3N1ZXNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLmlzc3VlUG9vbEFjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIGlmICh0aGlzLiRyZWZzLmZpbmFsSW5zcGVjdGlvbnNBY2NvcmRpb24gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdGhpcy4kcmVmcy5maW5hbEluc3BlY3Rpb25zQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLiRyZWZzLmluc3BlY3Rpb25zQWNjb3JkaW9uICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMuJHJlZnMuaW5zcGVjdGlvbnNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgaW5zcGVjdGlvblJlcG9ydHNBY2NvcmRpb25GdW5jdGlvbigpIHsKICAgICAgaWYgKHRoaXMuJHJlZnMuaW5zcGVjdGlvblJlcG9ydHNBY2NvcmRpb24ub3BlbkZsYWcgPT09IHRydWUpIHsKICAgICAgICB0aGlzLiRyZWZzLnRpbWluZ0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIGlmICh0aGlzLndvcmtPcmRlclR5cGUgPT09ICJlZGl0IikgewogICAgICAgICAgdGhpcy4kcmVmcy5hc3NpZ25tZW50QWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHRoaXMuJHJlZnMuYXNzZXRJbmZvQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy5pc3N1ZXNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLmlzc3VlUG9vbEFjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICB9CiAgICB9LAoKICAgIGlzc3Vlc0FjY29yZGlvbkZ1bmN0aW9uKCkgewogICAgICBpZiAodGhpcy4kcmVmcy5pc3N1ZXNBY2NvcmRpb24ub3BlbkZsYWcgPT09IHRydWUpIHsKICAgICAgICB0aGlzLiRyZWZzLnRpbWluZ0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIGlmICh0aGlzLndvcmtPcmRlclR5cGUgPT09ICJlZGl0IikgewogICAgICAgICAgdGhpcy4kcmVmcy5hc3NpZ25tZW50QWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHRoaXMuJHJlZnMuYXNzZXRJbmZvQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgaWYgKHRoaXMuJHJlZnMuaW5zcGVjdGlvblJlcG9ydHNBY2NvcmRpb24gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdGhpcy4kcmVmcy5pbnNwZWN0aW9uUmVwb3J0c0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICB0aGlzLiRyZWZzLmlzc3VlUG9vbEFjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIGlmICh0aGlzLiRyZWZzLmZpbmFsSW5zcGVjdGlvbnNBY2NvcmRpb24gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdGhpcy4kcmVmcy5maW5hbEluc3BlY3Rpb25zQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLiRyZWZzLmluc3BlY3Rpb25zQWNjb3JkaW9uICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMuJHJlZnMuaW5zcGVjdGlvbnNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgaW5zcGVjdGlvbnNBY2NvcmRpb25GdW5jdGlvbigpIHsKICAgICAgaWYgKHRoaXMuJHJlZnMuaW5zcGVjdGlvbnNBY2NvcmRpb24ub3BlbkZsYWcgPT09IHRydWUpIHsKICAgICAgICB0aGlzLiRyZWZzLnRpbWluZ0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIGlmICh0aGlzLndvcmtPcmRlclR5cGUgPT09ICJlZGl0IikgewogICAgICAgICAgdGhpcy4kcmVmcy5hc3NpZ25tZW50QWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHRoaXMuJHJlZnMuYXNzZXRJbmZvQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy5pc3N1ZVBvb2xBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLmZpbmFsSW5zcGVjdGlvbnNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgfQogICAgfSwKCiAgICBmaW5hbEluc3BlY3Rpb25zQWNjb3JkaW9uRnVuY3Rpb24oKSB7CiAgICAgIGlmICh0aGlzLiRyZWZzLmZpbmFsSW5zcGVjdGlvbnNBY2NvcmRpb24ub3BlbkZsYWcgPT09IHRydWUpIHsKICAgICAgICB0aGlzLiRyZWZzLnRpbWluZ0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIGlmICh0aGlzLndvcmtPcmRlclR5cGUgPT09ICJlZGl0IikgewogICAgICAgICAgdGhpcy4kcmVmcy5hc3NpZ25tZW50QWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHRoaXMuJHJlZnMuYXNzZXRJbmZvQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy5pc3N1ZVBvb2xBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLmluc3BlY3Rpb25zQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgIH0KICAgIH0sCgogICAgaXNzdWVBY2NvcmRpb25GdW5jdGlvbihpbmR4KSB7CiAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB0aGlzLiRyZWZzLmlzc3VlQWNjb3JkaW9uLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgIC8vIHRoaXMubG9hZGVyRmxhZyA9IHRydWUKICAgICAgICBpZiAoaW5kZXggIT09IGluZHgpIHsKICAgICAgICAgIHRoaXMuJHJlZnMuaXNzdWVBY2NvcmRpb25baW5kZXhdLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgbG9hZGVyRmFsc2UoKSB7CiAgICAgIHRoaXMubG9hZGVyRmxhZyA9IGZhbHNlOwogICAgfSwKICAgIGlzc3VlUG9vbEFjY29yZGlvbkZ1bmN0aW9uKCkgewogICAgICBpZiAodGhpcy4kcmVmcy5pc3N1ZVBvb2xBY2NvcmRpb24ub3BlbkZsYWcgPT09IHRydWUpIHsKICAgICAgICB0aGlzLiRyZWZzLnRpbWluZ0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIGlmICh0aGlzLndvcmtPcmRlclR5cGUgPT09ICJlZGl0IikgewogICAgICAgICAgdGhpcy4kcmVmcy5hc3NpZ25tZW50QWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHRoaXMuJHJlZnMuYXNzZXRJbmZvQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgaWYgKHRoaXMuJHJlZnMuaW5zcGVjdGlvblJlcG9ydHNBY2NvcmRpb24gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdGhpcy4kcmVmcy5pbnNwZWN0aW9uUmVwb3J0c0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy4kcmVmcy5maW5hbEluc3BlY3Rpb25zQWNjb3JkaW9uICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMuJHJlZnMuZmluYWxJbnNwZWN0aW9uc0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy4kcmVmcy5pbnNwZWN0aW9uc0FjY29yZGlvbiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0aGlzLiRyZWZzLmluc3BlY3Rpb25zQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICB9LAoKICAgIHNldFNpZGViYXJQb3MoKSB7CiAgICAgIGxldCBzaWRlQmFyQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNpZGViYXItY29udGFpbmVyIik7CiAgICAgIGxldCBzaWRlYmFyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNpZGViYXIiKTsKICAgICAgc2lkZWJhci5zdHlsZS53aWR0aCA9IHNpZGVCYXJDb250YWluZXIub2Zmc2V0V2lkdGggKyAicHgiOwogICAgICBzaWRlYmFyLnN0eWxlLnBvc2l0aW9uID0gImZpeGVkIjsKICAgICAgc2lkZWJhci5zdHlsZS5sZWZ0ID0gc2lkZUJhckNvbnRhaW5lci5vZmZzZXRMZWZ0OwogICAgfSwKCiAgICBjbGVhclNlbGVjdGVkQW5zd2VyKGluZGV4KSB7CiAgICAgIHRoaXMucXVlc3Rpb25UeXBlRm9ybUluaXRpYWxbaW5kZXhdLnR5cGVMYWJlbCA9ICIiOwogICAgICB0aGlzLmluaXRpYWxBc3NldEluZGV4Kys7CiAgICB9LAoKICAgIGNsZWFyU2VsZWN0ZWRGaW5hbEluc3BlY3Rpb25CeUFzc2V0KCkgewogICAgICB0aGlzLmZpbmFsSW5zcGVjdGlvbkJ5QXNzZXRDYXRlZ29yeSA9ICIiOwogICAgICB0aGlzLmZpbmFsSW5zcGVjdGlvblJlc2V0Kys7CiAgICB9LAoKICAgIGluc3BlY3Rpb25UZW1wbGF0ZVZhbGlkYXRpb24oKSB7CiAgICAgIGxldCB2YWxkaWF0aW9ucyA9IHt9OwogICAgICBpZiAodGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLnN0YXR1cyA9PSAiT3BlbiIpIHsKICAgICAgICBpZiAoCiAgICAgICAgICB0aGlzLmZpbmFsSW5zcGVjdGlvblNlbGVjdGlvbiA9PSAiQ3JlYXRlIE5ldyBJbnNwZWN0aW9uIFRlbXBsYXRlIiAmJgogICAgICAgICAgIXRoaXMuY2hlY2tFeGlzdGluZ0luaXRpYWxJbnNwZWN0aW9uCiAgICAgICAgKSB7CiAgICAgICAgICB2YWxkaWF0aW9ucyA9IHsKICAgICAgICAgICAgd29ya09yZGVyU3VtbWFyeTogewogICAgICAgICAgICAgIGluaXRpYWxJbnNwZWN0aW9uVGl0bGU6IHsgcmVxdWlyZWQsIG1heExlbmd0aDogbWF4TGVuZ3RoKDE5MCkgfSwKICAgICAgICAgICAgICBmaW5hbEluc3BlY3Rpb25UaXRsZTogeyByZXF1aXJlZCwgbWF4TGVuZ3RoOiBtYXhMZW5ndGgoMTkwKSB9LAogICAgICAgICAgICB9LAogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB2YWxkaWF0aW9uczsKICAgIH0sCgogICAgaW5pdGlhbEluc3BlY3Rpb25WYWxpZGF0aW9uKCkgewogICAgICBsZXQgdmFsaWRhdGlvbnMgPSB7fTsKICAgICAgaWYgKHRoaXMud29ya09yZGVyRGV0YWlsLndvcmtPcmRlci5zdGF0dXMgPT0gIk9wZW4iKSB7CiAgICAgICAgaWYgKHRoaXMuY2hlY2tFeGlzdGluZ0luaXRpYWxJbnNwZWN0aW9uKSB7CiAgICAgICAgICB2YWxpZGF0aW9ucyA9IHsKICAgICAgICAgICAgaW5pdGlhbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnk6IHsgcmVxdWlyZWQgfSwKICAgICAgICAgICAgcXVlc3Rpb25UeXBlRm9ybUluaXRpYWw6IHsKICAgICAgICAgICAgICAkZWFjaDogewogICAgICAgICAgICAgICAgbmFtZToge30sCiAgICAgICAgICAgICAgICBxdWVzdGlvbjoge30sCiAgICAgICAgICAgICAgICB0eXBlTGFiZWw6IHt9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YWxpZGF0aW9ucyA9IHsKICAgICAgICAgICAgaW5pdGlhbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnk6IHt9LAogICAgICAgICAgICBxdWVzdGlvblR5cGVGb3JtSW5pdGlhbDogewogICAgICAgICAgICAgICRlYWNoOiB7CiAgICAgICAgICAgICAgICBuYW1lOiB7IHJlcXVpcmVkLCBtYXhMZW5ndGg6IG1heExlbmd0aCgxOTApIH0sCiAgICAgICAgICAgICAgICBxdWVzdGlvbjogeyByZXF1aXJlZCwgbWF4TGVuZ3RoOiBtYXhMZW5ndGgoMTkwKSB9LAogICAgICAgICAgICAgICAgdHlwZUxhYmVsOiB7IHJlcXVpcmVkIH0sCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSwKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHZhbGlkYXRpb25zID0gewogICAgICAgICAgaW5pdGlhbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnk6IHt9LAogICAgICAgICAgcXVlc3Rpb25UeXBlRm9ybUluaXRpYWw6IHsKICAgICAgICAgICAgJGVhY2g6IHsKICAgICAgICAgICAgICBuYW1lOiB7fSwKICAgICAgICAgICAgICBxdWVzdGlvbjoge30sCiAgICAgICAgICAgICAgdHlwZUxhYmVsOiB7fSwKICAgICAgICAgICAgfSwKICAgICAgICAgIH0sCiAgICAgICAgfTsKICAgICAgfQogICAgICByZXR1cm4gdmFsaWRhdGlvbnM7CiAgICB9LAoKICAgIGZpbmFsSW5zcGVjdGlvblZhbGlkYXRpb24oKSB7CiAgICAgIGxldCB2YWxkaWF0aW9ucyA9IHt9OwogICAgICBpZiAodGhpcy53b3JrT3JkZXJEZXRhaWwud29ya09yZGVyLnN0YXR1cyA9PSAiT3BlbiIpIHsKICAgICAgICBpZiAodGhpcy5maW5hbEluc3BlY3Rpb25TZWxlY3Rpb24gPT0gIkNyZWF0ZSBOZXcgSW5zcGVjdGlvbiBUZW1wbGF0ZSIpIHsKICAgICAgICAgIHZhbGRpYXRpb25zID0gewogICAgICAgICAgICBxdWVzdGlvblR5cGVGb3JtRmluYWw6IHsKICAgICAgICAgICAgICAkZWFjaDogewogICAgICAgICAgICAgICAgbmFtZTogeyByZXF1aXJlZCwgbWF4TGVuZ3RoOiBtYXhMZW5ndGgoMTkwKSB9LAogICAgICAgICAgICAgICAgcXVlc3Rpb246IHsgcmVxdWlyZWQsIG1heExlbmd0aDogbWF4TGVuZ3RoKDE5MCkgfSwKICAgICAgICAgICAgICAgIHR5cGVMYWJlbDogeyByZXF1aXJlZCB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YWxkaWF0aW9ucyA9IHsKICAgICAgICAgICAgcXVlc3Rpb25UeXBlRm9ybUZpbmFsOiB7CiAgICAgICAgICAgICAgJGVhY2g6IHsKICAgICAgICAgICAgICAgIG5hbWU6IHt9LAogICAgICAgICAgICAgICAgcXVlc3Rpb246IHt9LAogICAgICAgICAgICAgICAgdHlwZUxhYmVsOiB7fSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLmZpbmFsSW5zcGVjdGlvblNlbGVjdGlvbiA9PT0gIlNlbGVjdCBFeGlzdGluZyIpIHsKICAgICAgICAgIHZhbGRpYXRpb25zLmZpbmFsSW5zcGVjdGlvbkJ5QXNzZXRDYXRlZ29yeSA9IHsgcmVxdWlyZWQgfTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFsZGlhdGlvbnMuZmluYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5ID0ge307CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHZhbGRpYXRpb25zID0gewogICAgICAgICAgZmluYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5OiB7fSwKICAgICAgICAgIHF1ZXN0aW9uVHlwZUZvcm1GaW5hbDogewogICAgICAgICAgICAkZWFjaDogewogICAgICAgICAgICAgIG5hbWU6IHt9LAogICAgICAgICAgICAgIHF1ZXN0aW9uOiB7fSwKICAgICAgICAgICAgICB0eXBlTGFiZWw6IHt9LAogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICB9OwogICAgICB9CiAgICAgIHJldHVybiB2YWxkaWF0aW9uczsKICAgIH0sCgogICAgc2hvd1RvYXN0KG1lc3NhZ2UsIHR5cGUpIHsKICAgICAgdGhpcy50b2FzdE1lc3NhZ2UgPSBtZXNzYWdlOwogICAgICB0aGlzLnRvYXN0VHlwZSA9IHR5cGU7CiAgICAgIHRoaXMudG9hc3RGbGFnKys7CiAgICB9LAogIH0sCiAgdXBkYXRlZCgpIHsKICAgIHRoaXMuc2V0U2lkZWJhclBvcygpOwogIH0sCgogIHZhbGlkYXRpb25zOiBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gewogICAgICBpc3N1ZXNTZWxlY3RlZDogeyByZXF1aXJlZCB9LAogICAgICAuLi50aGlzLmluaXRpYWxJbnNwZWN0aW9uVmFsaWRhdGlvbigpLAogICAgICAuLi50aGlzLmZpbmFsSW5zcGVjdGlvblZhbGlkYXRpb24oKSwKICAgIH07CiAgfSwKICBjcmVhdGVkKCkgewogICAgdGhpcy5jdXJyZW50VXNlckRldGFpbHMgPSBKU09OLnBhcnNlKAogICAgICBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiY3VycmVudFVzZXJEZXRhaWxzIikKICAgICk7CiAgICB0aGlzLndvcmtPcmRlclR5cGUgPSB0aGlzLiRyb3V0ZS5wYXJhbXMudHlwZTsKICAgIGlmICh0aGlzLiRyb3V0ZS5uYW1lID09PSAid29yay1vcmRlci1kZXRhaWxzIikgewogICAgICB0aGlzLmRpc2FibGVGaWVsZHMgPSB0cnVlOwogICAgfQogICAgdGhpcy5nZXRDdXJyZW5jeSgpOwogICAgdGhpcy5sb2FkZXJGbGFnID0gdHJ1ZTsKICAgIHRoaXMud29ya09yZGVyVVVJRCA9IHRoaXMuJHJvdXRlLnBhcmFtcy53b3JrdXVpZDsKICAgIHRoaXMuZ2V0V29ya09yZGVyKCk7CiAgfSwKfTsK"},null]}