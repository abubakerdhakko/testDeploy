{"remainingRequest":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/src/views/work-orders/CreateWorkOrder.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/src/views/work-orders/CreateWorkOrder.vue","mtime":1661968702452},{"path":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/node_modules/cache-loader/dist/cjs.js","mtime":1662622637759},{"path":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/node_modules/babel-loader/lib/index.js","mtime":1662622637719},{"path":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/node_modules/cache-loader/dist/cjs.js","mtime":1662622637759},{"path":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/node_modules/vue-loader/lib/index.js","mtime":1662622639723}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBXb3JrT3JkZXJTaWRlYmFyIGZyb20gIi4uL3dvcmstb3JkZXJzL2NvbXBvbmVudHMvV29ya09yZGVyU2lkZWJhciI7CmltcG9ydCBBc3NldFBlcnNvbm5lbFNlcnZpY2UgZnJvbSAiLi4vLi4vc2VydmljZXMvQXNzZXRQZXJzb25uZWxTZXJ2aWNlIjsKaW1wb3J0IEluc3BlY3Rpb25TZXJ2aWNlIGZyb20gIi4uLy4uL3NlcnZpY2VzL0luc3BlY3Rpb25TZXJ2aWNlIjsKaW1wb3J0IEFzc2V0TWFuYWdlbWVudFNlcnZpY2UgZnJvbSAiLi4vLi4vc2VydmljZXMvQXNzZXRNYW5hZ2VtZW50U2VydmljZSI7CmltcG9ydCBXb3JrT3JkZXJTZXJ2aWNlIGZyb20gIi4uLy4uL3NlcnZpY2VzL1dvcmtPcmRlclNlcnZpY2UiOwppbXBvcnQgbW9tZW50IGZyb20gIm1vbWVudCI7CmltcG9ydCB7IEZ1bmN0aW9ucyB9IGZyb20gIkAvc2hhcmVkL0Z1bmN0aW9ucyI7CmltcG9ydCB7IHJlcXVpcmVkLCBtYXhMZW5ndGggLG51bWVyaWMsIGludGVnZXJ9IGZyb20gInZ1ZWxpZGF0ZS9saWIvdmFsaWRhdG9ycyI7CgppbXBvcnQgbG9hZGVyIGZyb20gIkAvY29tcG9uZW50cy9Mb2FkZXIudnVlIjsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJDcmVhdGVXb3JrT3JkZXIiLAoKICBjb21wb25lbnRzOiB7CiAgICBXb3JrT3JkZXJTaWRlYmFyLAogICAgbG9hZGVyLAogIH0sCgogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBsb2FkZXJGbGFnOiBmYWxzZSwKICAgICAgLyogVG9hc3QgUHJvcGVydGllcyAqLwogICAgICB0b2FzdFRpbWVPdXQ6IDMwMDAsCiAgICAgIHRvYXN0TWVzc2FnZTogIiIsCiAgICAgIHRvYXN0VHlwZTogIiIsCiAgICAgIHRvYXN0RmxhZzogMCwKICAgICAgLyogVG9hc3QgUHJvcGVydGllcyAqLwogICAgICB1cGRhdGVTZWxlY3RDb21wOiAwLAogICAgICB0b3RhbENvc3Q6IDAsCiAgICAgIHNhbWU6IHRydWUsCiAgICAgIHdvcmtPcmRlclN1bW1hcnlJbmRleDogMCwKICAgICAgaW5pdGlhbEFzc2V0SW5kZXg6IDAsCiAgICAgIGluc3BlY3Rpb25SZXNldDogMCwKICAgICAgZmluYWxJbnNwZWN0aW9uUmVzZXQ6IDAsCiAgICAgIHVzZXJSZXNldDogMCwKICAgICAgY2F0ZWdvcnlJbmRleDogMCwKICAgICAgYXNzZXRJbmRleDogMCwKICAgICAgaXNzdWVJbmRleDogMCwKICAgICAgY3VycmVudFVzZXJEZXRhaWxzOiBudWxsLAogICAgICBkaXNiYWJsZWZpZWxkOiBmYWxzZSwKCiAgICAgIHByaW9yaXR5T3B0aW9uczogWwogICAgICAgIHsgbGFiZWw6ICJMb3ciIH0sCiAgICAgICAgeyBsYWJlbDogIk1lZGl1bSIgfSwKICAgICAgICB7IGxhYmVsOiAiSGlnaCIgfSwKICAgICAgXSwKICAgICAgc2hpZnRPcHRpb25zOiBbCiAgICAgICAgeyBsYWJlbDogIk1vcm5pbmciIH0sCiAgICAgICAgeyBsYWJlbDogIkFmdGVybm9vbiIgfSwKICAgICAgICB7IGxhYmVsOiAiRXZlbmluZyIgfSwKICAgICAgXSwKICAgICAgc2VsZWN0ZWRVc2VyR3JvdXA6ICIiLAogICAgICB1c2VyR3JvdXBPcHRpb25zOiBbXSwKCiAgICAgIHNlbGVjdGVkVXNlcjogIiIsCiAgICAgIHVzZXJPcHRpb25zOiBbXSwKICAgICAgYWxsVXNlcnM6IFtdLAogICAgICBhc3NldHM6IG51bGwsCiAgICAgIHdvcmtPcmRlclN1bW1hcnk6IHsKICAgICAgICBwcmlvcml0eTogIiIsCiAgICAgICAgc2hpZnQ6ICIiLAogICAgICAgIHNoZWR1bGU6ICIiLAogICAgICAgIHVzZXJHcm91cDogIiIsCiAgICAgICAgdXNlcjogIiIsCiAgICAgICAgaXNzdWVzOiBbXSwKICAgICAgICBpbml0aWFsSW5zcGVjdGlvblRpdGxlOiAiIiwKICAgICAgICBmaW5hbEluc3BlY3Rpb25UaXRsZTogIiIsCiAgICAgICAgY2F0ZWdvcnk6ICIiLAogICAgICAgIG5hbWU6ICIiLAogICAgICAgIHNlbGVjdGVkSW5pdGlhbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnk6ICIiLAogICAgICAgIHNlbGVjdGVkRmluYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5OiAiIiwKICAgICAgfSwKCiAgICAgIGNoZWNrRXhpc3RpbmdJbml0aWFsSW5zcGVjdGlvbjogZmFsc2UsCiAgICAgIGNoZWNrRXhpc3RpbmdGaW5hbEluc3BlY3Rpb246IGZhbHNlLAogICAgICBzYW1lQXNJbml0aWFsSW5zcGVjdGlvbjogdHJ1ZSwKICAgICAgaW5pdGlhbEluc3BlY3Rpb25CeUFzc2V0OiAiIiwKICAgICAgaW5pdGlhbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnk6ICIiLAogICAgICBpbml0aWFsSW5zcGVjdGlvbkJ5V29ya09yZGVyOiAiIiwKICAgICAgZmluYWxJbnNwZWN0aW9uQnlBc3NldDogIiIsCiAgICAgIGZpbmFsSW5zcGVjdGlvbkJ5QXNzZXRDYXRlZ29yeTogIiIsCiAgICAgIGZpbmFsSW5zcGVjdGlvbkJ5V29ya09yZGVyOiAiIiwKICAgICAgc2VsZWN0ZWRJbml0aWFsSW5zcGVjdGlvbkJ5QXNzZXQ6ICIiLAogICAgICBzZWxlY3RlZEluaXRpYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5OiAiIiwKICAgICAgc2VsZWN0ZWRJbml0aWFsSW5zcGVjdGlvbkJ5V29ya09yZGVyOiAiIiwKICAgICAgc2VsZWN0ZWRGaW5hbEluc3BlY3Rpb25CeUFzc2V0OiAiIiwKICAgICAgc2VsZWN0ZWRGaW5hbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnk6ICIiLAogICAgICBzZWxlY3RlZEZpbmFsSW5zcGVjdGlvbkJ5V29ya09yZGVyOiAiIiwKICAgICAgaW5zcGVjdGlvbkJ5QXNzZXRPcHRpb25zOiBbXSwKICAgICAgaW5wc2VjdGlvbkJ5QXNzZXRDYXRlZ29yeU9wdGlvbnM6IFtdLAogICAgICBpbnBzZWN0aW9uQnlXb3JrT3JkZXJPcHRpb25zOiBbXSwKICAgICAgaW5pdGlhbEluc3BlY3Rpb25UZW1wOiAiIiwKICAgICAgZmluYWxJbnNwZWN0aW9uVGl0bGU6ICIiLAogICAgICBhbnN3ZXJUeXBlT3B0aW9uczogWwogICAgICAgIHsgbGFiZWw6ICJUZXh0L0ltYWdlL0F1ZGlvIiwgdmFsdWU6ICJpbnB1dCIgfSwKICAgICAgICB7IGxhYmVsOiAiWWVzL05vIiwgdmFsdWU6ICJib29sZWFuIiB9LAogICAgICAgIHsgbGFiZWw6ICJNdWx0aXBsZSBDaG9pY2UiLCB2YWx1ZTogIm11bHRpcGxlIiB9LAogICAgICAgIHsgbGFiZWw6ICJOdW1lcmljIiwgdmFsdWU6ICJOdW1lcmljIiB9LAogICAgICBdLAogICAgICBxdWVzdGlvblR5cGVGb3JtSW5pdGlhbDogW10sCiAgICAgIHF1ZXN0aW9uVHlwZUZvcm1GaW5hbDogW10sCiAgICAgIG9yZGVySW5zdHJ1Y3Rpb25zOiBbCiAgICAgICAgewogICAgICAgICAgdmFsdWU6ICIiLAogICAgICAgIH0sCiAgICAgIF0sCiAgICAgIGFzc2V0Q2F0ZWdvcnlPcHRpb25zOiBbXSwKICAgICAgYWxsQXNzZXREYXRhOiBbXSwKICAgICAgYXNzZXROYW1lczogW10sCiAgICAgIGFzc2V0VVVJRDogIiIsCiAgICAgIGlzc3Vlc0FycmF5TGlzdDogW10sCiAgICAgIGlzc3Vlc1NlbGVjdGVkOiBbXSwKICAgICAgZmluYWxJbnNwZWN0aW9uT3B0aW9uczogWwogICAgICAgIHsgbGFiZWw6ICJTYW1lIEFzIEluaXRpYWwiLCB2YWx1ZTogInNhbWUiIH0sCiAgICAgICAgeyBsYWJlbDogIlNlbGVjdCBFeGlzdGluZyIsIHZhbHVlOiAiZXhpc3RpbmciIH0sCiAgICAgICAgeyBsYWJlbDogIkNyZWF0ZSBOZXcgSW5zcGVjdGlvbiBUZW1wbGF0ZSIsIHZhbHVlOiAiY3JlYXRlTmV3IiB9LAogICAgICBdLAogICAgICBmaW5hbEluc3BlY3Rpb25TZWxlY3Rpb246ICJTYW1lIEFzIEluaXRpYWwiLAogICAgICBxdWFudGl0eVZhbDogdHJ1ZSwKICAgICAgY29zdEFtb3VudFZhbDogdHJ1ZSwKICAgICAgdGF4QW1vdW50VmFsOnRydWUKICAgIH07CiAgfSwKCiAgbWV0aG9kczogewogICAgLy8gdmFsZGlhdGVEYXRlKCkgewogICAgLy8gICBsZXQgY3VycmVudERhdGUgPSBgJHtuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCl9LSR7CiAgICAvLyAgICAgbmV3IERhdGUoKS5nZXRNb250aCgpICsgMQogICAgLy8gICB9LSR7bmV3IERhdGUoKS5nZXREYXRlKCl9YDsKCiAgICAvLyAgIGlmICghbW9tZW50KHRoaXMud29ya09yZGVyU3VtbWFyeS5zaGVkdWxlKS5pc1NhbWVPckFmdGVyKGN1cnJlbnREYXRlKSkgewogICAgLy8gICAgIHRoaXMuc2hvd1RvYXN0KCJQbGVhc2Ugc2VsZWN0IGN1cnJlbnQgb3IgZnV0dXJlIGRhdGUiLCAiZXJyb3IiKTsKICAgIC8vICAgICByZXR1cm4gZmFsc2U7CiAgICAvLyAgIH0KICAgIC8vIH0sCiAgICBRdWFudGl0eUNoYW5nZSh2YWwpewogICAgICBpZih2YWwgPT0gMCl7CiAgICAgICAgICB0aGlzLnNob3dUb2FzdCgnTmVnYXRpdmUgdmFsdWUgbm90IGFsbG93ZWQnLCAiZXJyb3IiKTsKICAgICAgICAgIHRoaXMucXVhbnRpdHlWYWwgPSB0cnVlCiAgICAgIH1lbHNlewogICAgICAgICAgdGhpcy5xdWFudGl0eVZhbCA9IGZhbHNlCiAgICAgIH0KICAgIH0sCiAgICBjb3N0QW1vdW50Q2hhbmdlKHZhbCl7CiAgICAgIGlmKHZhbCA9PSAwKXsKICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KCdOZWdhdGl2ZSB2YWx1ZSBub3QgYWxsb3dlZCcsICJlcnJvciIpOwogICAgICAgICAgdGhpcy5jb3N0QW1vdW50VmFsID0gdHJ1ZQogICAgICB9ZWxzZXsKICAgICAgICAgIHRoaXMuY29zdEFtb3VudFZhbCA9IGZhbHNlCiAgICAgIH0KICAgIH0sCiAgICB0YXhBbW91bnRDaGFuZ2UodmFsKXsKCiAgICAgIGlmKHZhbCA9PSAwKXsKICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KCdOZWdhdGl2ZSB2YWx1ZSBub3QgYWxsb3dlZCcsICJlcnJvciIpOwogICAgICAgICAgdGhpcy50YXhBbW91bnRWYWwgPSB0cnVlCiAgICAgIH1lbHNlewogICAgICAgICAgdGhpcy50YXhBbW91bnRWYWwgPSBmYWxzZQogICAgICB9CiAgICB9LAogICAgaW5pdGlhbEluc3BlY3Rpb25GdW5jKHZhbHVlKSB7CiAgICAgIGlmICh0aGlzLnNhbWUgPT09IHRydWUpIHsKICAgICAgICBpZiAodGhpcy5jaGVja0V4aXN0aW5nSW5pdGlhbEluc3BlY3Rpb24gPT09IGZhbHNlKSB7CiAgICAgICAgICB0aGlzLndvcmtPcmRlclN1bW1hcnkuZmluYWxJbnNwZWN0aW9uVGl0bGUgPSB2YWx1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy53b3JrT3JkZXJTdW1tYXJ5SW5kZXgrKzsKICAgIH0sCgogICAgZXhpc3RpbmdGdW5jdGlvbih2YWx1ZSkgewogICAgICB0aGlzLndvcmtPcmRlclN1bW1hcnkuaW5pdGlhbEluc3BlY3Rpb25UaXRsZSA9ICIiOwogICAgICB0aGlzLndvcmtPcmRlclN1bW1hcnkuc2VsZWN0ZWRJbml0aWFsSW5zcGVjdGlvbkJ5QXNzZXRDYXRlZ29yeSA9ICIiOwoKICAgICAgaWYgKHRoaXMuc2FtZSA9PT0gdHJ1ZSkgewogICAgICAgIHRoaXMud29ya09yZGVyU3VtbWFyeS5maW5hbEluc3BlY3Rpb25UaXRsZSA9ICIiOwogICAgICAgIHRoaXMud29ya09yZGVyU3VtbWFyeS5zZWxlY3RlZEZpbmFsSW5zcGVjdGlvbkJ5QXNzZXRDYXRlZ29yeSA9ICIiOwogICAgICB9CiAgICAgIGlmICh2YWx1ZSA9PT0gdHJ1ZSkgewogICAgICAgIHRoaXMucXVlc3Rpb25UeXBlRm9ybUluaXRpYWwgPSBbXTsKICAgICAgICB0aGlzLmFkZElucHV0RmllbGRzSW5pdGlhbCgpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaW5pdGlhbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnkgPSAiIjsKICAgICAgICB0aGlzLnNlbGVjdGVkSW5pdGlhbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnkgPSAiIjsKICAgICAgICB0aGlzLmluaXRpYWxBc3NldEluZGV4Kys7CiAgICAgIH0KICAgICAgdGhpcy53b3JrT3JkZXJTdW1tYXJ5SW5kZXgrKzsKICAgIH0sCgogICAgZ2V0Q3VycmVuY3koKSB7CiAgICAgIEFzc2V0UGVyc29ubmVsU2VydmljZS5nZXRDb21wYW55Q3VycmVuY3koCiAgICAgICAgdGhpcy5jdXJyZW50VXNlckRldGFpbHMucHJvZmlsZS5vcmdhbml6YXRpb25JZAogICAgICApLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgdGhpcy5jdXJyZW5jeSA9IHJlc3BvbnNlLmRhdGEuY3VycmVuY3k7CiAgICAgIH0pOwogICAgfSwKCiAgICBmaW5hbEluc3BlY3Rpb25PcHRpb25TZWxlY3RlZCh2YWx1ZSkgewogICAgICB0aGlzLndvcmtPcmRlclN1bW1hcnkuZmluYWxJbnNwZWN0aW9uVGl0bGUgPSAiIjsKICAgICAgdGhpcy53b3JrT3JkZXJTdW1tYXJ5LnNlbGVjdGVkRmluYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5ID0gIiI7CiAgICAgIHRoaXMucXVlc3Rpb25UeXBlRm9ybUZpbmFsID0gW107CiAgICAgIHRoaXMuYWRkSW5wdXRGaWVsZHNGaW5hbCgpOwogICAgICB0aGlzLmZpbmFsSW5zcGVjdGlvbkJ5QXNzZXRDYXRlZ29yeSA9IFtdOwogICAgICB0aGlzLnNlbGVjdGVkRmluYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5ID0gIiI7CiAgICAgIGlmICh2YWx1ZS52YWx1ZSA9PT0gIlNhbWUgQXMgSW5pdGlhbCIpIHsKICAgICAgICB0aGlzLnNhbWUgPSB0cnVlOwogICAgICAgIGlmICh0aGlzLmNoZWNrRXhpc3RpbmdJbml0aWFsSW5zcGVjdGlvbikgewogICAgICAgICAgdGhpcy53b3JrT3JkZXJTdW1tYXJ5LnNlbGVjdGVkRmluYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5ID0gdGhpcy53b3JrT3JkZXJTdW1tYXJ5LnNlbGVjdGVkSW5pdGlhbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMud29ya09yZGVyU3VtbWFyeS5maW5hbEluc3BlY3Rpb25UaXRsZSA9IHRoaXMud29ya09yZGVyU3VtbWFyeS5pbml0aWFsSW5zcGVjdGlvblRpdGxlOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNhbWUgPSBmYWxzZTsKICAgICAgfQogICAgICB0aGlzLndvcmtPcmRlclN1bW1hcnlJbmRleCsrOwogICAgfSwKCiAgICBjbGVhclNlbGVjdGVkRmluYWxJbnNwZWN0aW9uT3B0aW9uKCkgewogICAgICB0aGlzLmZpbmFsSW5zcGVjdGlvblNlbGVjdGlvbiA9ICIiOwogICAgICB0aGlzLmZpbmFsSW5zcGVjdGlvblJlc2V0Kys7CiAgICB9LAoKICAgIG9uSXNzdWVOdW1iZXJTZWxlY3QodmFsdWUpIHsKICAgICAgdGhpcy53b3JrT3JkZXJTdW1tYXJ5Lmlzc3VlcyA9IFtdOwogICAgICBpZiAodmFsdWUubGVuZ3RoID4gMCkgewogICAgICAgIHRoaXMud29ya09yZGVyU3VtbWFyeS5pc3N1ZXMgPSB2YWx1ZTsKICAgICAgfQogICAgfSwKICAgIGdldElzc3Vlc0J5QXNzZXRVVUlEKEFzc2V0VVVJRCkgewogICAgICB0aGlzLmlzc3Vlc0FycmF5TGlzdCA9IFtdOwogICAgICBJbnNwZWN0aW9uU2VydmljZS5maWx0ZXJJc3N1ZXNCeUFzc2V0VVVJRChBc3NldFVVSUQsICJyZXBvcnRlZCIpCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgICAgZm9yIChsZXQgaXNzdWUgb2YgcmVzcG9uc2UuZGF0YS5pc3N1ZXMpIHsKICAgICAgICAgICAgICBsZXQgcGFydCA9IHsKICAgICAgICAgICAgICAgIG5hbWU6ICIiLAogICAgICAgICAgICAgICAgdXVpZDogdGhpcy5nZW5lcmF0ZVVVSUQoKSwKICAgICAgICAgICAgICAgIHF1YW50aXR5OiAwLAogICAgICAgICAgICAgICAgY29zdDogewogICAgICAgICAgICAgICAgICBjYXRlZ29yeTogInBhcnQtY29zdCIsCiAgICAgICAgICAgICAgICAgIGFtb3VudDogMCwKICAgICAgICAgICAgICAgICAgdGF4QW1vdW50OiAwLAogICAgICAgICAgICAgICAgICByZXBvcnRhYmxlOiB0cnVlLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGV4dHJhQ29zdDogWwogICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcnk6ICJ0YXgtY29zdCIsCiAgICAgICAgICAgICAgICAgICAgYW1vdW50OiAwLAogICAgICAgICAgICAgICAgICAgIHJlcG9ydGFibGU6IHRydWUsCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIGlzc3VlLmluc3RydWN0aW9uQ2hlY2tsaXN0ID0gSlNPTi5wYXJzZSgKICAgICAgICAgICAgICAgIGlzc3VlLmluc3RydWN0aW9uQ2hlY2tsaXN0CiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICBpZiAoaXNzdWUuaW5zdHJ1Y3Rpb25DaGVja2xpc3QgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIGlzc3VlLmluc3RydWN0aW9uQ2hlY2tsaXN0ID0gW107CiAgICAgICAgICAgICAgICBpc3N1ZS5pbnN0cnVjdGlvbkNoZWNrbGlzdC5wdXNoKHsKICAgICAgICAgICAgICAgICAgdmFsdWU6ICIiLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlzc3VlLnBhcnRzID0gW107CiAgICAgICAgICAgICAgaXNzdWUucGFydHMucHVzaChwYXJ0KTsKICAgICAgICAgICAgICBpc3N1ZS5yZXBvcnRlZEF0ID0gbW9tZW50KGlzc3VlLnJlcG9ydGVkQXQpLmZvcm1hdCgiREQgTU1NIFlZWVkiKTsKICAgICAgICAgICAgICBpc3N1ZS5uYW1lID0gaXNzdWUuaXNzdWVOYW1lICsgIiAtICIgKyBpc3N1ZS5pc3N1ZU51bWJlcjsKICAgICAgICAgICAgICB0aGlzLmlzc3Vlc0FycmF5TGlzdC5wdXNoKGlzc3VlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlcnJvcikgPT4gewogICAgICAgICAgdGhpcy5zaG93VG9hc3QoZXJyb3IuZGF0YS5yZXNwb25zZSwgImVycm9yIik7CiAgICAgICAgfSk7CiAgICB9LAoKICAgIG9uU2VsZWN0ZWRBc3NldENhdGVnb3J5KHZhbHVlKSB7CiAgICAgIHRoaXMuYXNzZXROYW1lcyA9IFtdOwogICAgICBmb3IgKGxldCBhc3NldCBvZiB0aGlzLmFsbEFzc2V0RGF0YSkgewogICAgICAgIGlmIChhc3NldC5jYXRlZ29yeVVVSUQgPT09IHZhbHVlLnNlbGVjdGVkT2JqZWN0LmNhdGVnb3J5VVVJRCkgewogICAgICAgICAgdGhpcy5hc3NldE5hbWVzLnB1c2goYXNzZXQpOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLmdldEluc3BlY3Rpb25UZW1hcGxhdGVzQnlBc3NldENhdGVnb3J5KAogICAgICAgIHZhbHVlLnNlbGVjdGVkT2JqZWN0LmNhdGVnb3J5VVVJRAogICAgICApOwogICAgICB0aGlzLndvcmtPcmRlclN1bW1hcnkubmFtZSA9ICIiOwogICAgICB0aGlzLmFzc2V0SW5kZXgrKzsKICAgIH0sCgogICAgY2xlYXJTZWxlY3RlZEFzc2V0Q2F0ZWdvcnkoKSB7CiAgICAgIHRoaXMuYXNzZXROYW1lcyA9IFtdOwogICAgICB0aGlzLndvcmtPcmRlclN1bW1hcnkuY2F0ZWdvcnkgPSAiIjsKICAgICAgdGhpcy53b3JrT3JkZXJTdW1tYXJ5Lm5hbWUgPSAiIjsKICAgICAgdGhpcy5jYXRlZ29yeUluZGV4Kys7CiAgICAgIHRoaXMuYXNzZXRJbmRleCsrOwogICAgfSwKCiAgICBvblNlbGVjdGVkQXNzZXROYW1lKHZhbHVlKSB7CiAgICAgIHRoaXMuYXNzZXRVVUlEID0gdmFsdWUuc2VsZWN0ZWRPYmplY3QudXVpZDsKICAgICAgdGhpcy5nZXRJc3N1ZXNCeUFzc2V0VVVJRCh0aGlzLmFzc2V0VVVJRCk7CiAgICB9LAoKICAgIGNsZWFyU2VsZWN0ZWRBc3NldE5hbWUoKSB7CiAgICAgIHRoaXMuYXNzZXRVVUlEID0gIiI7CiAgICAgIHRoaXMud29ya09yZGVyU3VtbWFyeS5uYW1lID0gIiI7CiAgICAgIHRoaXMuZ2V0SXNzdWVzQnlBc3NldFVVSUQodGhpcy5hc3NldFVVSUQpOwogICAgICB0aGlzLmFzc2V0SW5kZXgrKzsKICAgIH0sCgogICAgY2xlYXJTZWxlY3RlZFByaW9yaXR5KCkgewogICAgICB0aGlzLndvcmtPcmRlclN1bW1hcnkucHJpb3JpdHkgPSAiIjsKICAgICAgdGhpcy5hc3NldEluZGV4Kys7CiAgICB9LAoKICAgIGNsZWFyU2VsZWN0ZWRTaGlmdCgpIHsKICAgICAgdGhpcy53b3JrT3JkZXJTdW1tYXJ5LnNoaWZ0ID0gIiI7CiAgICAgIHRoaXMuYXNzZXRJbmRleCsrOwogICAgfSwKCiAgICBnZXRBbGxDYXRlZ29yaWVzKGN1cnJlbnRVc2VyRGV0YWlscykgewogICAgICB0aGlzLmxvYWRlckZsYWc9IHRydWUKICAgICAgQXNzZXRNYW5hZ2VtZW50U2VydmljZS5nZXRBbGxBc3NldENhdGVnb3JpZXMoCiAgICAgICAgY3VycmVudFVzZXJEZXRhaWxzLnByb2ZpbGUub3JnYW5pemF0aW9uSWQKICAgICAgKQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIGZvciAobGV0IGNhdGVnb3J5IG9mIHJlcy5kYXRhLmNhdGVnb3JpZXMpIHsKICAgICAgICAgICAgbGV0IG9iaiA9IHsKICAgICAgICAgICAgICBpZDogY2F0ZWdvcnkuaWQsCiAgICAgICAgICAgICAgY2F0ZWdvcnlVVUlEOiBjYXRlZ29yeS51dWlkLAogICAgICAgICAgICAgIGxhYmVsOiBjYXRlZ29yeS5uYW1lLAogICAgICAgICAgICB9OwogICAgICAgICAgICB0aGlzLmFzc2V0Q2F0ZWdvcnlPcHRpb25zLnB1c2gob2JqKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuZ2V0QWxsQXNzZXQoY3VycmVudFVzZXJEZXRhaWxzKTsKICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMud29ya3V1aWQgIT09ICIiKSB7CiAgICAgICAgICAgIHRoaXMuYXNzZXREZXRhaWxzZnJvbVN0ZCh0aGlzLiRyb3V0ZS5wYXJhbXMud29ya3V1aWQpOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5sb2FkZXJGbGFnPSBmYWxzZQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlcnIpID0+IHsKICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KGVyci5kYXRhLnJlc3BvbnNlLCAiZXJyb3IiKTsKICAgICAgICB9KTsKICAgIH0sCgogICAgZ2V0QWxsQXNzZXQoY3VycmVudFVzZXJEZXRhaWxzKSB7CiAgICAgIGxldCBjYXRlZ29yeVVVSUQgPSAiIjsKICAgICAgQXNzZXRNYW5hZ2VtZW50U2VydmljZS5nZXRBbGxBc3NldHMoCiAgICAgICAgY3VycmVudFVzZXJEZXRhaWxzLnByb2ZpbGUub3JnYW5pemF0aW9uSWQKICAgICAgKQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIGZvciAobGV0IGFzc2V0IG9mIHJlcy5kYXRhLmFzc2V0cykgewogICAgICAgICAgICBsZXQgb2JqID0gewogICAgICAgICAgICAgIHV1aWQ6IGFzc2V0LnV1aWQsCiAgICAgICAgICAgICAgY2F0ZWdvcnlVVUlEOiBhc3NldC5jYXRlZ29yeVVVSUQsCiAgICAgICAgICAgICAgbGFiZWw6IGFzc2V0Lm5hbWUsCiAgICAgICAgICAgICAgdHlwZTogYXNzZXQudHlwZSwKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdGhpcy5hbGxBc3NldERhdGEucHVzaChvYmopOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuY3JlYXRlV29ya09yZGVyID09PSB0cnVlKSB7CiAgICAgICAgICAgIGZvciAobGV0IGFzc2V0X2RhdGEgb2YgdGhpcy5hbGxBc3NldERhdGEpIHsKICAgICAgICAgICAgICBpZiAodGhpcy4kcm91dGUucGFyYW1zLmFzc2V0VVVJRCA9PT0gYXNzZXRfZGF0YS51dWlkKSB7CiAgICAgICAgICAgICAgICBjYXRlZ29yeVVVSUQgPSBhc3NldF9kYXRhLmNhdGVnb3J5VVVJRDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciAobGV0IGFzc2V0X29wdGlvbiBvZiB0aGlzLmFzc2V0Q2F0ZWdvcnlPcHRpb25zKSB7CiAgICAgICAgICAgICAgaWYgKGFzc2V0X29wdGlvbi5jYXRlZ29yeVVVSUQgPT09IGNhdGVnb3J5VVVJRCkgewogICAgICAgICAgICAgICAgdGhpcy53b3JrT3JkZXJTdW1tYXJ5LmNhdGVnb3J5ID0gYXNzZXRfb3B0aW9uLmxhYmVsOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9yIChsZXQgYXNzZXREYXRhIG9mIHRoaXMuYWxsQXNzZXREYXRhKSB7CiAgICAgICAgICAgICAgaWYgKGFzc2V0RGF0YS5jYXRlZ29yeVVVSUQgPT09IGNhdGVnb3J5VVVJRCkgewogICAgICAgICAgICAgICAgdGhpcy5hc3NldE5hbWVzLnB1c2goYXNzZXREYXRhKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChsZXQgYXNzZXRfbmFtZSBvZiB0aGlzLmFzc2V0TmFtZXMpIHsKICAgICAgICAgICAgICBpZiAoYXNzZXRfbmFtZS51dWlkID09PSB0aGlzLiRyb3V0ZS5wYXJhbXMuYXNzZXRVVUlEKSB7CiAgICAgICAgICAgICAgICB0aGlzLndvcmtPcmRlclN1bW1hcnkubmFtZSA9IGFzc2V0X25hbWUubGFiZWw7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuY2F0ZWdvcnlJbmRleCsrOwogICAgICAgICAgICB0aGlzLmFzc2V0SW5kZXgrKzsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7CiAgICAgICAgICB0aGlzLnNob3dUb2FzdChlcnIuZGF0YS5yZXNwb25zZSwgImVycm9yIik7CiAgICAgICAgfSk7CiAgICB9LAoKICAgIGJhc2ljRGV0YWlsc0FjY29yZGlvbkZ1bmN0aW9uKCkgewogICAgICBpZiAodGhpcy4kcmVmcy5iYXNpY0RldGFpbHNBY2NvcmRpb24ub3BlbkZsYWcgPT09IHRydWUpIHsKICAgICAgICB0aGlzLiRyZWZzLmZpbmFsSW5zcGVjdGlvbnNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLnVzZXJBc3NpZ25tZW50QWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy5pc3N1ZXNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLmluc3BlY3Rpb25zQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgIH0KICAgIH0sCiAgICB1c2VyQXNzaWdubWVudEFjY29yZGlvbkZ1bmN0aW9uKCkgewogICAgICBpZiAodGhpcy4kcmVmcy51c2VyQXNzaWdubWVudEFjY29yZGlvbi5vcGVuRmxhZyA9PT0gdHJ1ZSkgewogICAgICAgIHRoaXMuJHJlZnMuYmFzaWNEZXRhaWxzQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy5pc3N1ZXNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLmluc3BlY3Rpb25zQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy5maW5hbEluc3BlY3Rpb25zQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgIH0KICAgIH0sCiAgICBpc3N1ZXNBY2NvcmRpb25GdW5jdGlvbigpIHsKICAgICAgaWYgKHRoaXMuJHJlZnMuaXNzdWVzQWNjb3JkaW9uLm9wZW5GbGFnID09PSB0cnVlKSB7CiAgICAgICAgdGhpcy4kcmVmcy5iYXNpY0RldGFpbHNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLnVzZXJBc3NpZ25tZW50QWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy5pbnNwZWN0aW9uc0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIHRoaXMuJHJlZnMuZmluYWxJbnNwZWN0aW9uc0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICB9CiAgICB9LAogICAgaW5zcGVjdGlvbnNBY2NvcmRpb25GdW5jdGlvbigpIHsKICAgICAgaWYgKHRoaXMuJHJlZnMuaW5zcGVjdGlvbnNBY2NvcmRpb24ub3BlbkZsYWcgPT09IHRydWUpIHsKICAgICAgICB0aGlzLiRyZWZzLmJhc2ljRGV0YWlsc0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIHRoaXMuJHJlZnMudXNlckFzc2lnbm1lbnRBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLmlzc3Vlc0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIHRoaXMuJHJlZnMuZmluYWxJbnNwZWN0aW9uc0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICB9CiAgICB9LAogICAgZmluYWxJbnNwZWN0aW9uc0FjY29yZGlvbkZ1bmN0aW9uKCkgewogICAgICBpZiAodGhpcy4kcmVmcy5maW5hbEluc3BlY3Rpb25zQWNjb3JkaW9uLm9wZW5GbGFnID09PSB0cnVlKSB7CiAgICAgICAgdGhpcy4kcmVmcy5iYXNpY0RldGFpbHNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLnVzZXJBc3NpZ25tZW50QWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy5pc3N1ZXNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLmluc3BlY3Rpb25zQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgIH0KICAgIH0sCiAgICBjcmVhdGVXb3JrT3JkZXIoKSB7CiAgICAgIHRoaXMuJHYuJHRvdWNoKCk7CiAgICAgIGlmICh0aGlzLiR2LiRpbnZhbGlkKSB7CiAgICAgICAgdGhpcy5zaG93VG9hc3QoIlBsZWFzZSBmaWxsIGFsbCByZXF1aXJlZCBmaWVsZHMiLCAid2FybmluZyIpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuaXNzdWVzU2VsZWN0ZWQubGVuZ2h0IDwgMCkgewogICAgICAgIHRoaXMuc2hvd1RvYXN0KCJQbGVhc2Ugc2VsZWN0IGFuIGlzc3VlIiwgIndhcm5pbmciKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMubG9hZGVyRmxhZyA9IHRydWU7CiAgICAgIGxldCB3b3JrT3JkZXIgPSB7fTsKICAgICAgbGV0IHJlc29sdXRpb25zID0gW107CiAgICAgIGxldCBpc3N1ZXMgPSBbXTsKICAgICAgbGV0IHRlbXBPcmRlciA9IFtdOwogICAgICBsZXQgb3JkZXJKc29uID0gbnVsbDsKICAgICAgbGV0IGluaXRpYWxJbnNwZWN0aW9uVGVtcGxhdGUgPSBudWxsOwogICAgICBsZXQgZmluYWxJbnNwZWN0aW9uVGVtcGxhdGUgPSBudWxsOwogICAgICBsZXQgZnJvbUluc3BlY3Rpb25Jbml0aWFsID0gZmFsc2U7CiAgICAgIGxldCBmcm9tSW5zcGVjdGlvbkZpbmFsID0gZmFsc2U7CgogICAgICBsZXQgaW5pdGlhbEluc3BlY3Rpb25PcHRpb24gPSBudWxsOwogICAgICBsZXQgZmluYWxJbnNwZWN0aW9uT3B0aW9uID0gbnVsbDsKCiAgICAgIHZhciBpbml0aWFsSW5zcGVjdGlvblRlbXBsYXRlTGlua2luZ1VVSUQgPSBudWxsOwogICAgICBsZXQgZmluYWxJbnNwZWN0aW9uVGVtcGxhdGVMaW5raW5nVVVJRCA9IG51bGw7CiAgICAgIGxldCBpbml0aWFsTGlua0luc3BlY3Rpb25UeXBlID0gbnVsbDsKICAgICAgbGV0IGZpbmFsTGlua0luc3BlY3Rpb25UeXBlID0gbnVsbDsKICAgICAgbGV0IGNyZWF0ZVdvcmtPcmRlclJlcXVlc3QgPSB7fTsKCiAgICAgIGZvciAobGV0IHdvcmtfb3JkZXJfaXNzdWUgb2YgdGhpcy53b3JrT3JkZXJTdW1tYXJ5Lmlzc3VlcykgewogICAgICAgIGxldCBpc3N1ZSA9IHt9OwogICAgICAgIGxldCByZXNvbHV0aW9uID0ge307CiAgICAgICAgcmVzb2x1dGlvbi51dWlkID0gdGhpcy5nZW5lcmF0ZVVVSUQoKTsKICAgICAgICByZXNvbHV0aW9uLnBhcnRzVXNlZCA9IFtdOwogICAgICAgIHdvcmtfb3JkZXJfaXNzdWUucGFydHMubWFwKChwYXJ0KSA9PiB7CiAgICAgICAgICBsZXQgcGFydE9iamVjdCA9IHBhcnQ7CiAgICAgICAgICBwYXJ0T2JqZWN0LnBhcnROYW1lID0gcGFydC5uYW1lOwogICAgICAgICAgcGFydE9iamVjdC5pc3N1ZVVVSUQgPSB3b3JrX29yZGVyX2lzc3VlLnV1aWQ7CiAgICAgICAgICBwYXJ0T2JqZWN0LnBhcnRVVUlEID0gImR1bW15LXBhcnQtdXVpZC1saW5rLXdpdGgtaW52ZW50b3J5IjsKICAgICAgICAgIHBhcnRPYmplY3QuYWRkZWRCeVVzZXJOYW1lID0KICAgICAgICAgICAgdGhpcy5jdXJyZW50VXNlckRldGFpbHMucHJvZmlsZS5maXJzdE5hbWUgKwogICAgICAgICAgICAiICIgKwogICAgICAgICAgICB0aGlzLmN1cnJlbnRVc2VyRGV0YWlscy5wcm9maWxlLmxhc3ROYW1lOwogICAgICAgICAgcGFydE9iamVjdC5hZGRlZEJ5VXNlclVVSUQgPSB0aGlzLmN1cnJlbnRVc2VyRGV0YWlscy5wcm9maWxlLnVzZXJpZDsKICAgICAgICAgIHBhcnRPYmplY3QuY29zdC5hZGVkQnlVc2VyTmFtZSA9IHBhcnRPYmplY3QuYWRkZWRCeVVzZXJOYW1lOwogICAgICAgICAgcGFydE9iamVjdC5jb3N0LmFkZGVkQnlVc2VyVVVJRCA9IHBhcnRPYmplY3QuYWRkZWRCeVVzZXJVVUlEOwogICAgICAgICAgcGFydE9iamVjdC5jb3N0Lmlzc3VlVVVJRCA9IHdvcmtfb3JkZXJfaXNzdWUudXVpZDsKICAgICAgICAgIHJlc29sdXRpb24ucGFydHNVc2VkLnB1c2gocGFydE9iamVjdCk7CiAgICAgICAgICByZXR1cm4gcGFydDsKICAgICAgICB9KTsKCiAgICAgICAgcmVzb2x1dGlvbnMucHVzaChyZXNvbHV0aW9uKTsKICAgICAgICBpc3N1ZS5pc3N1ZU51bWJlciA9IHdvcmtfb3JkZXJfaXNzdWUuaXNzdWVOdW1iZXI7CiAgICAgICAgaXNzdWUuaXNzdWVVVUlEID0gd29ya19vcmRlcl9pc3N1ZS51dWlkOwogICAgICAgIGlzc3VlLnJlc29sdmVkID0gZmFsc2U7CiAgICAgICAgaXNzdWUuaW5zcGVjdGlvblVVSUQgPSB3b3JrX29yZGVyX2lzc3VlLmluc3BlY3Rpb25VVUlEOwogICAgICAgIGlzc3VlLnNlcnZpY2VVVUlEID0gd29ya19vcmRlcl9pc3N1ZS5zZXJ2aWNlVVVJRDsKICAgICAgICBpc3N1ZS5pbnN0cnVjdGlvbnMgPSB3b3JrX29yZGVyX2lzc3VlLmlzc3VlRGVzY3JpcHRpb247CiAgICAgICAgaXNzdWUucmVzb2x1dGlvblVVSUQgPSByZXNvbHV0aW9uLnV1aWQ7CiAgICAgICAgaXNzdWUuc3RhdHVzID0gd29ya19vcmRlcl9pc3N1ZS5zdGF0dXM7CiAgICAgICAgd29ya19vcmRlcl9pc3N1ZS5pbnN0cnVjdGlvbkNoZWNrbGlzdC5tYXAoKGVsZW1lbnQpID0+IHsKICAgICAgICAgIHRlbXBPcmRlci5wdXNoKHsgbmFtZTogZWxlbWVudC52YWx1ZSwgY2hlY2tlZDogZmFsc2UgfSk7CiAgICAgICAgICBvcmRlckpzb24gPSBKU09OLnN0cmluZ2lmeSh0ZW1wT3JkZXIpOwogICAgICAgICAgaXNzdWUub3JkZXJJbnN0cnVjdGlvbnMgPSBvcmRlckpzb247CiAgICAgICAgfSk7CiAgICAgICAgaXNzdWVzLnB1c2goaXNzdWUpOwogICAgICAgIG9yZGVySnNvbiA9IG51bGw7CiAgICAgICAgdGVtcE9yZGVyID0gW107CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmNoZWNrRXhpc3RpbmdJbml0aWFsSW5zcGVjdGlvbiA9PT0gdHJ1ZSkgewogICAgICAgIGlmICh0aGlzLnNlbGVjdGVkSW5pdGlhbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnkgIT09ICIiKSB7CiAgICAgICAgICBpbml0aWFsTGlua0luc3BlY3Rpb25UeXBlID0gImluc3BlY3Rpb24iOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAodGhpcy5maW5hbEluc3BlY3Rpb25TZWxlY3Rpb24gPT09ICJTZWxlY3QgRXhpc3RpbmciKSB7CiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRGaW5hbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnkgIT09ICIiKSB7CiAgICAgICAgICBmaW5hbExpbmtJbnNwZWN0aW9uVHlwZSA9ICJpbnNwZWN0aW9uIjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnF1ZXN0aW9uVHlwZUZvcm1Jbml0aWFsLmxlbmd0aCA+IDApIHsKICAgICAgICBpbml0aWFsSW5zcGVjdGlvblRlbXBsYXRlID0gewogICAgICAgICAgbmFtZTogdGhpcy53b3JrT3JkZXJTdW1tYXJ5LmluaXRpYWxJbnNwZWN0aW9uVGl0bGUsCiAgICAgICAgICBpbnNwZWN0aW9uSXRlbXM6IHRoaXMucXVlc3Rpb25UeXBlRm9ybUluaXRpYWwsCiAgICAgICAgfTsKICAgICAgICBpbml0aWFsSW5zcGVjdGlvbk9wdGlvbiA9ICJzYXZlIjsKICAgICAgICBmcm9tSW5zcGVjdGlvbkluaXRpYWwgPSBmYWxzZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBmcm9tSW5zcGVjdGlvbkluaXRpYWwgPSB0cnVlOwogICAgICB9CgogICAgICAvLyBpZiAoaW5pdGlhbEluc3BlY3Rpb25UZW1wbGF0ZSkgewogICAgICAvLyAJLy8JZmluYWxJbnNwZWN0aW9uVGVtcGxhdGUgPSBpbml0aWFsSW5zcGVjdGlvblRlbXBsYXRlOwogICAgICAvLyB9IGVsc2UgewogICAgICAvLyAJZnJvbUluc3BlY3Rpb25GaW5hbCA9IGZyb21JbnNwZWN0aW9uSW5pdGlhbDsKICAgICAgLy8gfQoKICAgICAgLy8gZmluYWxJbnNwZWN0aW9uT3B0aW9uID0gaW5pdGlhbEluc3BlY3Rpb25PcHRpb247CgogICAgICBpZiAodGhpcy5xdWVzdGlvblR5cGVGb3JtRmluYWwubGVuZ3RoID4gMCkgewogICAgICAgIGZpbmFsSW5zcGVjdGlvblRlbXBsYXRlID0gewogICAgICAgICAgbmFtZTogdGhpcy53b3JrT3JkZXJTdW1tYXJ5LmZpbmFsSW5zcGVjdGlvblRpdGxlLAogICAgICAgICAgaW5zcGVjdGlvbkl0ZW1zOiB0aGlzLnF1ZXN0aW9uVHlwZUZvcm1GaW5hbCwKICAgICAgICB9OwogICAgICAgIGZpbmFsSW5zcGVjdGlvbk9wdGlvbiA9ICJzYXZlIjsKICAgICAgICBmcm9tSW5zcGVjdGlvbkZpbmFsID0gZmFsc2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZnJvbUluc3BlY3Rpb25GaW5hbCA9IHRydWU7CiAgICAgIH0KCiAgICAgIHdvcmtPcmRlci5wbGFubmluZyA9IHsKICAgICAgICB1c2VyR3JvdXBVVUlEOiB0aGlzLnNlbGVjdGVkVXNlckdyb3VwCiAgICAgICAgICA/IHRoaXMuc2VsZWN0ZWRVc2VyR3JvdXAuZ3JvdXBVVUlECiAgICAgICAgICA6IG51bGwsCiAgICAgICAgdXNlckdyb3VwTmFtZTogdGhpcy5zZWxlY3RlZFVzZXJHcm91cAogICAgICAgICAgPyB0aGlzLnNlbGVjdGVkVXNlckdyb3VwLmdyb3VwTmFtZQogICAgICAgICAgOiBudWxsLAogICAgICAgIGZyb21JbnNwZWN0aW9uSW5pdGlhbDogZnJvbUluc3BlY3Rpb25Jbml0aWFsLAogICAgICAgIGZyb21JbnNwZWN0aW9uRmluYWw6IGZyb21JbnNwZWN0aW9uRmluYWwsCiAgICAgIH07CiAgICAgIGlmICh0aGlzLnNhbWVBc0luaXRpYWxJbnNwZWN0aW9uKSB7CiAgICAgICAgd29ya09yZGVyLnBsYW5uaW5nLnNhbWVJbnNwZWN0aW9uID0gdHJ1ZTsKICAgICAgfQoKICAgICAgaWYgKHdvcmtPcmRlci5wbGFubmluZy5mcm9tSW5zcGVjdGlvbkluaXRpYWwpIHsKICAgICAgICBpZiAodGhpcy5zZWxlY3RlZEluaXRpYWxJbnNwZWN0aW9uQnlBc3NldCAhPT0gbnVsbCkgewogICAgICAgICAgd29ya09yZGVyLnBsYW5uaW5nLmluaXRpYWxJbnNwZWN0aW9uVVVJRCA9IHRoaXMuc2VsZWN0ZWRJbml0aWFsSW5zcGVjdGlvbkJ5QXNzZXQudmFsdWU7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnNlbGVjdGVkSW5pdGlhbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnkgIT09IG51bGwpIHsKICAgICAgICAgIHdvcmtPcmRlci5wbGFubmluZy5pbml0aWFsSW5zcGVjdGlvblVVSUQgPSB0aGlzLnNlbGVjdGVkSW5pdGlhbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnkudmFsdWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHdvcmtPcmRlci5wbGFubmluZy5pbml0aWFsSW5zcGVjdGlvblVVSUQgPSB0aGlzLnNlbGVjdGVkRmluYWxJbnNwZWN0aW9uQnlXb3JrT3JkZXIudmFsdWU7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAod29ya09yZGVyLnBsYW5uaW5nLmZyb21JbnNwZWN0aW9uRmluYWwpIHsKICAgICAgICBpZiAodGhpcy5zYW1lQXNJbml0aWFsSW5zcGVjdGlvbikgewogICAgICAgICAgd29ya09yZGVyLnBsYW5uaW5nLmZpbmFsSW5zcGVjdGlvblVVSUQgPQogICAgICAgICAgICB3b3JrT3JkZXIucGxhbm5pbmcuaW5pdGlhbEluc3BlY3Rpb25VVUlEOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAodGhpcy5zZWxlY3RlZEZpbmFsSW5zcGVjdGlvbkJ5QXNzZXQgIT09IG51bGwpIHsKICAgICAgICAgICAgd29ya09yZGVyLnBsYW5uaW5nLmZpbmFsSW5zcGVjdGlvblVVSUQgPSB0aGlzLnNlbGVjdGVkRmluYWxJbnNwZWN0aW9uQnlBc3NldC52YWx1ZTsKICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5zZWxlY3RlZEZpbmFsSW5zcGVjdGlvbkJ5QXNzZXRDYXRlZ29yeSAhPT0gbnVsbCkgewogICAgICAgICAgICB3b3JrT3JkZXIucGxhbm5pbmcuZmluYWxJbnNwZWN0aW9uVVVJRCA9IHRoaXMuc2VsZWN0ZWRGaW5hbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnkudmFsdWU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB3b3JrT3JkZXIucGxhbm5pbmcuZmluYWxJbnNwZWN0aW9uVVVJRCA9IHRoaXMuc2VsZWN0ZWRGaW5hbEluc3BlY3Rpb25CeVdvcmtPcmRlci52YWx1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmNoZWNrRXhpc3RpbmdJbml0aWFsSW5zcGVjdGlvbikgewogICAgICAgIHdvcmtPcmRlci5wbGFubmluZy5mcm9tRXhpc3RpbmdJbml0aWFsID0gdHJ1ZTsKICAgICAgICB3b3JrT3JkZXIucGxhbm5pbmcuZnJvbUluc3BlY3Rpb25Jbml0aWFsID0gZmFsc2U7CiAgICAgICAgd29ya09yZGVyLnBsYW5uaW5nLmluaXRpYWxJbnNwZWN0aW9uVVVJRCA9IHRoaXMuaW5pdGlhbEluc3BlY3Rpb25UZW1wLnV1aWQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgd29ya09yZGVyLnBsYW5uaW5nLmluaXRpYWxJbnNwZWN0aW9uVVVJRCA9IG51bGw7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmZpbmFsSW5zcGVjdGlvblNlbGVjdGlvbiA9PT0gIlNlbGVjdCBFeGlzdGluZyIpIHsKICAgICAgICB3b3JrT3JkZXIucGxhbm5pbmcuZnJvbUV4aXN0aW5nRmluYWwgPSB0cnVlOwogICAgICAgIHdvcmtPcmRlci5wbGFubmluZy5mcm9tSW5zcGVjdGlvbkluaXRpYWwgPSBmYWxzZTsKICAgICAgICB3b3JrT3JkZXIucGxhbm5pbmcuZmluYWxJbnNwZWN0aW9uVVVJRCA9IHRoaXMuc2VsZWN0ZWRGaW5hbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnkudXVpZDsKICAgICAgfSBlbHNlIHsKICAgICAgICB3b3JrT3JkZXIucGxhbm5pbmcuZmluYWxJbnNwZWN0aW9uVVVJRCA9IG51bGw7CiAgICAgIH0KCiAgICAgIGlmICgKICAgICAgICB0aGlzLmZpbmFsSW5zcGVjdGlvblNlbGVjdGlvbiA9PT0gIlNhbWUgQXMgSW5pdGlhbCIgJiYKICAgICAgICB0aGlzLmNoZWNrRXhpc3RpbmdJbml0aWFsSW5zcGVjdGlvbiA9PSB0cnVlCiAgICAgICkgewogICAgICAgIHdvcmtPcmRlci5wbGFubmluZy5maW5hbEluc3BlY3Rpb25VVUlEID0gdGhpcy5pbml0aWFsSW5zcGVjdGlvblRlbXAudXVpZDsKICAgICAgICB3b3JrT3JkZXIucGxhbm5pbmcuZnJvbUV4aXN0aW5nRmluYWwgPSB0cnVlOwogICAgICB9CgogICAgICBpZiAoCiAgICAgICAgd29ya09yZGVyLnBsYW5uaW5nLmluaXRpYWxJbnNwZWN0aW9uVVVJRCA9PT0KICAgICAgICB3b3JrT3JkZXIucGxhbm5pbmcuZmluYWxJbnNwZWN0aW9uVVVJRAogICAgICApIHsKICAgICAgICB3b3JrT3JkZXIucGxhbm5pbmcuc2FtZUluc3BlY3Rpb24gPSB0cnVlOwogICAgICB9IGVsc2UgaWYgKAogICAgICAgIHdvcmtPcmRlci5wbGFubmluZy5pbml0aWFsSW5zcGVjdGlvblVVSUQgPT0gbnVsbCB8fAogICAgICAgIHdvcmtPcmRlci5wbGFubmluZy5maW5hbEluc3BlY3Rpb25VVUlEID09IG51bGwKICAgICAgKSB7CiAgICAgICAgd29ya09yZGVyLnBsYW5uaW5nLnNhbWVJbnNwZWN0aW9uID0gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRVc2VyKSB7CiAgICAgICAgd29ya09yZGVyLmFzc2lnbmVkVG9Vc2VyTmFtZSA9IHRoaXMuc2VsZWN0ZWRVc2VyLm5hbWU7CiAgICAgICAgd29ya09yZGVyLmFzc2lnbmVkVG9Vc2VyVVVJRCA9IHRoaXMuc2VsZWN0ZWRVc2VyLnV1aWQ7CiAgICAgIH0KICAgICAgaWYgKHdvcmtPcmRlci5hc3NpZ25lZFRvVXNlck5hbWUpIHsKICAgICAgICB3b3JrT3JkZXIuYXNzaWduZWVzID0gWwogICAgICAgICAgewogICAgICAgICAgICB1dWlkOiB3b3JrT3JkZXIuYXNzaWduZWRUb1VzZXJVVUlELAogICAgICAgICAgICBuYW1lOiB3b3JrT3JkZXIuYXNzaWduZWRUb1VzZXJOYW1lLAogICAgICAgICAgfSwKICAgICAgICBdOwogICAgICB9IGVsc2UgewogICAgICAgIGxldCByZXNwb25zZSA9IEFzc2V0UGVyc29ubmVsU2VydmljZS5nZXRVc2VyR3JvdXBCeVVVSUQoCiAgICAgICAgICB0aGlzLnNlbGVjdGVkVXNlckdyb3VwLnNlbGVjdGVkT2JqZWN0Lmdyb3VwVVVJRAogICAgICAgICk7CiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICB3b3JrT3JkZXIuYXNzaWduZWVzID0gW107CiAgICAgICAgICByZXNwb25zZS5kYXRhLnVzZXJHcm91cC51c2Vycy5tYXAoKHVzZXIpID0+IHsKICAgICAgICAgICAgd29ya09yZGVyLmFzc2lnbmVlcy5wdXNoKHsKICAgICAgICAgICAgICB1dWlkOiB1c2VyLnV1aWQsCiAgICAgICAgICAgICAgbmFtZTogdXNlci5maXJzdE5hbWUgKyAiICIgKyB1c2VyLmxhc3ROYW1lLAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIHVzZXI7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgd29ya09yZGVyLnByaW9yaXR5ID0gdGhpcy53b3JrT3JkZXJTdW1tYXJ5LnByaW9yaXR5OwogICAgICB3b3JrT3JkZXIuc2NoZWR1bGUgPSBtb21lbnQodGhpcy53b3JrT3JkZXJTdW1tYXJ5LnNoZWR1bGUpOwogICAgICB3b3JrT3JkZXIuYXNzZXRVVUlEID0gdGhpcy53b3JrT3JkZXJTdW1tYXJ5Lmlzc3Vlc1swXS5hc3NldFVVSUQ7CiAgICAgIHdvcmtPcmRlci5hc3NldE5hbWUgPSB0aGlzLndvcmtPcmRlclN1bW1hcnkubmFtZTsKICAgICAgd29ya09yZGVyLnRlbmFudFVVSUQgPSB0aGlzLmN1cnJlbnRVc2VyRGV0YWlscy5wcm9maWxlLm9yZ2FuaXphdGlvbklkOwogICAgICB3b3JrT3JkZXIuc3RhdHVzID0gdGhpcy53b3JrT3JkZXJTdW1tYXJ5Lmlzc3Vlc1swXS5zdGF0dXM7CiAgICAgIHdvcmtPcmRlci5zaGlmdCA9IHRoaXMud29ya09yZGVyU3VtbWFyeS5zaGlmdDsKCiAgICAgIHdvcmtPcmRlci5pc3N1ZXMgPSBpc3N1ZXM7CiAgICAgIGNyZWF0ZVdvcmtPcmRlclJlcXVlc3Qud29ya09yZGVyID0gd29ya09yZGVyOwoKICAgICAgaWYgKHRoaXMuY2hlY2tFeGlzdGluZ0luaXRpYWxJbnNwZWN0aW9uID09PSB0cnVlKSB7CiAgICAgICAgY3JlYXRlV29ya09yZGVyUmVxdWVzdC5pbml0aWFsSW5zcGVjdGlvblRlbXBsYXRlID0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICBjcmVhdGVXb3JrT3JkZXJSZXF1ZXN0LmluaXRpYWxJbnNwZWN0aW9uVGVtcGxhdGUgPSBpbml0aWFsSW5zcGVjdGlvblRlbXBsYXRlOwogICAgICAgIHdvcmtPcmRlci5wbGFubmluZy5mcm9tRXhpc3RpbmdJbml0aWFsID0gZmFsc2U7CiAgICAgICAgd29ya09yZGVyLnBsYW5uaW5nLmZyb21JbnNwZWN0aW9uSW5pdGlhbCA9IGZhbHNlOwogICAgICB9CgogICAgICBpZiAodGhpcy5maW5hbEluc3BlY3Rpb25TZWxlY3Rpb24gPT09ICJDcmVhdGUgTmV3IEluc3BlY3Rpb24gVGVtcGxhdGUiKSB7CiAgICAgICAgY3JlYXRlV29ya09yZGVyUmVxdWVzdC5maW5hbEluc3BlY3Rpb25UZW1wbGF0ZSA9IGZpbmFsSW5zcGVjdGlvblRlbXBsYXRlOwogICAgICAgIHdvcmtPcmRlci5wbGFubmluZy5mcm9tRXhpc3RpbmdGaW5hbCA9IGZhbHNlOwogICAgICAgIHdvcmtPcmRlci5wbGFubmluZy5mcm9tSW5zcGVjdGlvbkZpbmFsID0gZmFsc2U7CiAgICAgICAgd29ya09yZGVyLnBsYW5uaW5nLnNhbWVJbnNwZWN0aW9uID0gZmFsc2U7CiAgICAgIH0gZWxzZSBpZiAoCiAgICAgICAgdGhpcy5maW5hbEluc3BlY3Rpb25TZWxlY3Rpb24gPT09ICJTYW1lIEFzIEluaXRpYWwiICYmCiAgICAgICAgdGhpcy5jaGVja0V4aXN0aW5nSW5pdGlhbEluc3BlY3Rpb24gIT09IHRydWUKICAgICAgKSB7CiAgICAgICAgY3JlYXRlV29ya09yZGVyUmVxdWVzdC5maW5hbEluc3BlY3Rpb25UZW1wbGF0ZSA9IGluaXRpYWxJbnNwZWN0aW9uVGVtcGxhdGU7CiAgICAgICAgd29ya09yZGVyLnBsYW5uaW5nLmZyb21FeGlzdGluZ0ZpbmFsID0KICAgICAgICAgIHdvcmtPcmRlci5wbGFubmluZy5mcm9tRXhpc3RpbmdJbml0aWFsOwogICAgICAgIHdvcmtPcmRlci5wbGFubmluZy5mcm9tSW5zcGVjdGlvbkZpbmFsID0KICAgICAgICAgIHdvcmtPcmRlci5wbGFubmluZy5mcm9tSW5zcGVjdGlvbkluaXRpYWw7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5maW5hbEluc3BlY3Rpb25TZWxlY3Rpb24gPT09ICJTZWxlY3QgRXhpc3RpbmciKSB7CiAgICAgICAgY3JlYXRlV29ya09yZGVyUmVxdWVzdC5maW5hbEluc3BlY3Rpb25UZW1wbGF0ZSA9IG51bGw7CiAgICAgICAgd29ya09yZGVyLnBsYW5uaW5nLnNhbWVJbnNwZWN0aW9uID0gZmFsc2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY3JlYXRlV29ya09yZGVyUmVxdWVzdC5maW5hbEluc3BlY3Rpb25UZW1wbGF0ZSA9IG51bGw7CiAgICAgIH0KCiAgICAgIGNyZWF0ZVdvcmtPcmRlclJlcXVlc3QuaW5pdGlhbEluc3BlY3Rpb25PcHRpb24gPSBpbml0aWFsSW5zcGVjdGlvbk9wdGlvbjsKICAgICAgY3JlYXRlV29ya09yZGVyUmVxdWVzdC5maW5hbEluc3BlY3Rpb25PcHRpb24gPSBmaW5hbEluc3BlY3Rpb25PcHRpb247CiAgICAgIGNyZWF0ZVdvcmtPcmRlclJlcXVlc3QuaW5pdGlhbEluc3BlY3Rpb25UZW1wbGF0ZUxpbmtpbmdVVUlEID0gaW5pdGlhbEluc3BlY3Rpb25UZW1wbGF0ZUxpbmtpbmdVVUlEOwogICAgICBjcmVhdGVXb3JrT3JkZXJSZXF1ZXN0LmZpbmFsSW5zcGVjdGlvblRlbXBsYXRlTGlua2luZ1VVSUQgPSBmaW5hbEluc3BlY3Rpb25UZW1wbGF0ZUxpbmtpbmdVVUlEOwogICAgICBjcmVhdGVXb3JrT3JkZXJSZXF1ZXN0LmluaXRpYWxMaW5rSW5zcGVjdGlvblR5cGUgPSBpbml0aWFsTGlua0luc3BlY3Rpb25UeXBlOwogICAgICBjcmVhdGVXb3JrT3JkZXJSZXF1ZXN0LmZpbmFsTGlua0luc3BlY3Rpb25UeXBlID0gZmluYWxMaW5rSW5zcGVjdGlvblR5cGU7CiAgICAgIGNyZWF0ZVdvcmtPcmRlclJlcXVlc3QucmVzb2x1dGlvbnMgPSByZXNvbHV0aW9uczsKCiAgICAgIFdvcmtPcmRlclNlcnZpY2UuYWRkV29ya09yZGVyKAogICAgICAgIGNyZWF0ZVdvcmtPcmRlclJlcXVlc3QsCiAgICAgICAgdGhpcy5jdXJyZW50VXNlckRldGFpbHMucHJvZmlsZS5vcmdhbml6YXRpb25JZAogICAgICApCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICBpZiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgdGhpcy5sb2FkZXJGbGFnID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICAgICAgICBuYW1lOiAid29yay1vcmRlciIsCiAgICAgICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgICAgICB0b2FzdEZsYWc6IHRydWUsCiAgICAgICAgICAgICAgICB0b2FzdFR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHJlc3BvbnNlLmRhdGEuZGVzY3JpcHRpb24sCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICBpZiAoZXJyb3IpIHsKICAgICAgICAgICAgdGhpcy5sb2FkZXJGbGFnID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KGVycm9yLmRhdGEucmVzcG9uc2UsICJlcnJvciIpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKCiAgICBnZXRGb3JtRXJyb3JNZXNzYWdlKGZpZWxkVmFsaWRhdGlvbikgewogICAgICBpZiAoZmllbGRWYWxpZGF0aW9uLiRkaXJ0eSkgewogICAgICAgIHJldHVybiBGdW5jdGlvbnMuZ2V0Rm9ybUZpZWxkRXJyb3JNZXNzYWdlKGZpZWxkVmFsaWRhdGlvbik7CiAgICAgIH0KICAgIH0sCgogICAgYWRkSW5zdHJ1Y3Rpb24oaW5kZXgpIHsKICAgICAgdGhpcy53b3JrT3JkZXJTdW1tYXJ5Lmlzc3Vlc1tpbmRleF0uaW5zdHJ1Y3Rpb25DaGVja2xpc3QucHVzaCh7CiAgICAgICAgdmFsdWU6ICIiLAogICAgICB9KTsKICAgIH0sCgogICAgc3ViSW5zdHJ1Y3Rpb24oaW5kZXgsIGluc3RydWN0aW9uSW5kZXgpIHsKICAgICAgdGhpcy53b3JrT3JkZXJTdW1tYXJ5Lmlzc3Vlc1tpbmRleF0uaW5zdHJ1Y3Rpb25DaGVja2xpc3Quc3BsaWNlKAogICAgICAgIGluc3RydWN0aW9uSW5kZXgsCiAgICAgICAgMQogICAgICApOwogICAgfSwKCiAgICB1c2Vyc1NlbGVjdGVkKHZhbHVlKSB7CiAgICAgIHRoaXMuc2VsZWN0ZWRVc2VyID0gdmFsdWUuc2VsZWN0ZWRPYmplY3Q7CiAgICB9LAoKICAgIGNsZWFyU2VsZWN0ZWRVc2VyKCkgewogICAgICB0aGlzLndvcmtPcmRlclN1bW1hcnkudXNlciA9ICIiOwogICAgICB0aGlzLnNlbGVjdGVkVXNlciA9ICIiOwogICAgICB0aGlzLnVzZXJSZXNldCsrOwogICAgfSwKCiAgICBmaW5hbEluc3BlY3Rpb25CeUFzc2V0U2VsZWN0ZWQodmFsdWUpIHsKICAgICAgdGhpcy5zZWxlY3RlZEZpbmFsSW5zcGVjdGlvbkJ5QXNzZXQgPSB2YWx1ZS5zZWxlY3RlZE9iamVjdDsKICAgICAgdGhpcy5maW5hbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnkgPSAiIjsKICAgICAgdGhpcy5zZWxlY3RlZEZpbmFsSW5zcGVjdGlvbkJ5QXNzZXRDYXRlZ29yeSA9ICIiOwogICAgICB0aGlzLmZpbmFsSW5zcGVjdGlvbkJ5V29ya09yZGVyID0gIiI7CiAgICAgIHRoaXMuc2VsZWN0ZWRGaW5hbEluc3BlY3Rpb25CeVdvcmtPcmRlciA9ICIiOwogICAgICB0aGlzLmZpbmFsSW5zcGVjdGlvblJlc2V0Kys7CiAgICB9LAoKICAgIGZpbmFsSW5zcGVjdGlvbkJ5QXNzZXRDYXRlZ29yeVNlbGVjdGVkKHZhbHVlKSB7CiAgICAgIHRoaXMuc2VsZWN0ZWRGaW5hbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnkgPSB2YWx1ZS5zZWxlY3RlZE9iamVjdDsKICAgICAgdGhpcy53b3JrT3JkZXJTdW1tYXJ5LnNlbGVjdGVkRmluYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5ID0gdGhpcy5zZWxlY3RlZEZpbmFsSW5zcGVjdGlvbkJ5QXNzZXRDYXRlZ29yeTsKICAgICAgdGhpcy5maW5hbEluc3BlY3Rpb25CeUFzc2V0ID0gIiI7CiAgICAgIHRoaXMuc2VsZWN0ZWRGaW5hbEluc3BlY3Rpb25CeUFzc2V0ID0gIiI7CiAgICAgIHRoaXMuZmluYWxJbnNwZWN0aW9uQnlXb3JrT3JkZXIgPSAiIjsKICAgICAgdGhpcy5zZWxlY3RlZEZpbmFsSW5zcGVjdGlvbkJ5V29ya09yZGVyID0gIiI7CiAgICAgIHRoaXMuZmluYWxJbnNwZWN0aW9uUmVzZXQrKzsKICAgIH0sCgogICAgY2xlYXJTZWxlY3RlZEZpbmFsSW5zcGVjdGlvbkJ5QXNzZXQoKSB7CiAgICAgIHRoaXMuZmluYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5ID0gIiI7CiAgICAgIHRoaXMuZmluYWxJbnNwZWN0aW9uUmVzZXQrKzsKICAgIH0sCgogICAgZmluYWxJbnNwZWN0aW9uQnlXb3JrT3JkZXJTZWxlY3RlZCh2YWx1ZSkgewogICAgICB0aGlzLnNlbGVjdGVkRmluYWxJbnNwZWN0aW9uQnlXb3JrT3JkZXIgPSB2YWx1ZS5zZWxlY3RlZE9iamVjdDsKICAgICAgdGhpcy5maW5hbEluc3BlY3Rpb25CeUFzc2V0ID0gIiI7CiAgICAgIHRoaXMuc2VsZWN0ZWRGaW5hbEluc3BlY3Rpb25CeUFzc2V0ID0gIiI7CiAgICAgIHRoaXMuZmluYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5ID0gIiI7CiAgICAgIHRoaXMuc2VsZWN0ZWRGaW5hbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnkgPSAiIjsKICAgICAgdGhpcy5maW5hbEluc3BlY3Rpb25SZXNldCsrOwogICAgfSwKCiAgICBpbml0aWFsSW5zcGVjdGlvbkJ5QXNzZXRTZWxlY3RlZCh2YWx1ZSkgewogICAgICB0aGlzLnNlbGVjdGVkSW5pdGlhbEluc3BlY3Rpb25CeUFzc2V0ID0gdmFsdWUuc2VsZWN0ZWRPYmplY3Q7CiAgICAgIHRoaXMuaW5pdGlhbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnkgPSAiIjsKICAgICAgdGhpcy5zZWxlY3RlZEluaXRpYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5ID0gIiI7CiAgICAgIHRoaXMuaW5pdGlhbEluc3BlY3Rpb25CeVdvcmtPcmRlciA9ICIiOwogICAgICB0aGlzLnNlbGVjdGVkSW5pdGlhbEluc3BlY3Rpb25CeVdvcmtPcmRlciA9ICIiOwogICAgICB0aGlzLmluc3BlY3Rpb25SZXNldCsrOwogICAgfSwKCiAgICBpbml0aWFsSW5zcGVjdGlvbkJ5QXNzZXRDYXRlZ29yeVNlbGVjdGVkKHZhbHVlKSB7CiAgICAgIHRoaXMuaW5pdGlhbEluc3BlY3Rpb25UZW1wID0gdmFsdWUuc2VsZWN0ZWRPYmplY3Q7CiAgICAgIGlmICh0aGlzLnNhbWUgPT09IHRydWUpIHsKICAgICAgICBpZiAodGhpcy5jaGVja0V4aXN0aW5nSW5pdGlhbEluc3BlY3Rpb24gPT09IHRydWUpIHsKICAgICAgICAgIHRoaXMud29ya09yZGVyU3VtbWFyeS5zZWxlY3RlZEZpbmFsSW5zcGVjdGlvbkJ5QXNzZXRDYXRlZ29yeSA9CiAgICAgICAgICAgIHZhbHVlLnNlbGVjdGVkT2JqZWN0OwogICAgICAgICAgdGhpcy53b3JrT3JkZXJTdW1tYXJ5SW5kZXgrKzsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuc2VsZWN0ZWRJbml0aWFsSW5zcGVjdGlvbkJ5QXNzZXRDYXRlZ29yeSA9IHZhbHVlLnNlbGVjdGVkT2JqZWN0OwogICAgICB0aGlzLndvcmtPcmRlclN1bW1hcnkuc2VsZWN0ZWRJbml0aWFsSW5zcGVjdGlvbkJ5QXNzZXRDYXRlZ29yeSA9IHRoaXMuc2VsZWN0ZWRJbml0aWFsSW5zcGVjdGlvbkJ5QXNzZXRDYXRlZ29yeTsKICAgICAgdGhpcy5pbml0aWFsSW5zcGVjdGlvbkJ5QXNzZXQgPSAiIjsKICAgICAgdGhpcy5zZWxlY3RlZEluaXRpYWxJbnNwZWN0aW9uQnlBc3NldCA9ICIiOwogICAgICB0aGlzLmluaXRpYWxJbnNwZWN0aW9uQnlXb3JrT3JkZXIgPSAiIjsKICAgICAgdGhpcy5zZWxlY3RlZEluaXRpYWxJbnNwZWN0aW9uQnlXb3JrT3JkZXIgPSAiIjsKICAgICAgdGhpcy5pbnNwZWN0aW9uUmVzZXQrKzsKICAgIH0sCgogICAgaW5pdGlhbEluc3BlY3Rpb25CeVdvcmtPcmRlclNlbGVjdGVkKHZhbHVlKSB7CiAgICAgIHRoaXMuc2VsZWN0ZWRJbml0aWFsSW5zcGVjdGlvbkJ5V29ya09yZGVyID0gdmFsdWUuc2VsZWN0ZWRPYmplY3Q7CiAgICAgIHRoaXMuaW5pdGlhbEluc3BlY3Rpb25CeUFzc2V0ID0gIiI7CiAgICAgIHRoaXMuc2VsZWN0ZWRJbml0aWFsSW5zcGVjdGlvbkJ5QXNzZXQgPSAiIjsKICAgICAgdGhpcy5pbml0aWFsSW5zcGVjdGlvbkJ5QXNzZXRDYXRlZ29yeSA9ICIiOwogICAgICB0aGlzLnNlbGVjdGVkSW5pdGlhbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnkgPSAiIjsKICAgICAgdGhpcy5pbnNwZWN0aW9uUmVzZXQrKzsKICAgIH0sCgogICAgZ2V0SXNzdWVCeVVVSUQoaXNzdWVVVUlEUykgewogICAgICBpc3N1ZVVVSURTLm1hcCgoaXNzdWV1dWlkLCBpbmRleCkgPT4gewogICAgICAgIEluc3BlY3Rpb25TZXJ2aWNlLmdldElzc3VlQnlVVUlEKGlzc3VldXVpZCkKICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgICAgICBsZXQgcGFydCA9IHsKICAgICAgICAgICAgICAgIG5hbWU6ICIiLAogICAgICAgICAgICAgICAgdXVpZDogdGhpcy5nZW5lcmF0ZVVVSUQoKSwKICAgICAgICAgICAgICAgIHF1YW50aXR5OjAsCiAgICAgICAgICAgICAgICBjb3N0OiB7CiAgICAgICAgICAgICAgICAgIGNhdGVnb3J5OiAicGFydC1jb3N0IiwKICAgICAgICAgICAgICAgICAgYW1vdW50OiAwLAogICAgICAgICAgICAgICAgICByZXBvcnRhYmxlOiB0cnVlLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGV4dHJhQ29zdDogWwogICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcnk6ICJ0YXgtY29zdCIsCiAgICAgICAgICAgICAgICAgICAgYW1vdW50OiAwLAogICAgICAgICAgICAgICAgICAgIHJlcG9ydGFibGU6IHRydWUsCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5pc3N1ZVJlcG9ydGluZy5pbnN0cnVjdGlvbkNoZWNrbGlzdCA9IEpTT04ucGFyc2UoCiAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmlzc3VlUmVwb3J0aW5nLmluc3RydWN0aW9uQ2hlY2tsaXN0CiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5pc3N1ZVJlcG9ydGluZy5pbnN0cnVjdGlvbkNoZWNrbGlzdCA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5pc3N1ZVJlcG9ydGluZy5pbnN0cnVjdGlvbkNoZWNrbGlzdCA9IFtdOwogICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5pc3N1ZVJlcG9ydGluZy5pbnN0cnVjdGlvbkNoZWNrbGlzdC5wdXNoKHsKICAgICAgICAgICAgICAgICAgdmFsdWU6ICIiLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmlzc3VlUmVwb3J0aW5nLnBhcnRzID0gW107CiAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5pc3N1ZVJlcG9ydGluZy5wYXJ0cy5wdXNoKHBhcnQpOwogICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuaXNzdWVSZXBvcnRpbmcucmVwb3J0ZWRBdCA9IG1vbWVudCgKICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuaXNzdWVSZXBvcnRpbmcucmVwb3J0ZWRBdAogICAgICAgICAgICAgICkuZm9ybWF0KCJERCBNTU0gWVlZWSIpOwoKICAgICAgICAgICAgICB0aGlzLndvcmtPcmRlclN1bW1hcnkuaXNzdWVzLnB1c2gocmVzcG9uc2UuZGF0YS5pc3N1ZVJlcG9ydGluZyk7CiAgICAgICAgICAgICAgaWYgKGluZGV4ID09PSAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLmdldEFzc2V0KHRoaXMud29ya09yZGVyU3VtbWFyeS5pc3N1ZXNbaW5kZXhdLmFzc2V0VVVJRCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKChlcnJvcikgPT4gewogICAgICAgICAgICB0aGlzLnNob3dUb2FzdChlcnJvci5kYXRhLnJlc3BvbnNlLCAiZXJyb3IiKTsKICAgICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCgogICAgZ2V0QXNzZXQodXVpZCkgewogICAgICBBc3NldE1hbmFnZW1lbnRTZXJ2aWNlLmdldEFzc2V0V2l0aERldGFpbHModXVpZCwgdHJ1ZSwgdHJ1ZSkudGhlbigKICAgICAgICAocmVzcG9uc2UpID0+IHsKICAgICAgICAgIHRoaXMuYXNzZXRzID0gcmVzcG9uc2UuZGF0YS5hc3NldERldGFpbDsKICAgICAgICAgIHRoaXMuZ2V0SW5zcGVjdGlvblRlbXBsYXRlcygKICAgICAgICAgICAgdXVpZCwKICAgICAgICAgICAgdGhpcy5jdXJyZW50VXNlckRldGFpbHMucHJvZmlsZS5vcmdhbml6YXRpb25JZAogICAgICAgICAgKTsKICAgICAgICAgIHRoaXMuZ2V0SW5zcGVjdGlvblRlbXBsYXRlRnJvbVdvcmtPcmRlcigKICAgICAgICAgICAgdGhpcy5jdXJyZW50VXNlckRldGFpbHMucHJvZmlsZS5vcmdhbml6YXRpb25JZAogICAgICAgICAgKTsKICAgICAgICAgIHRoaXMuZ2V0SW5zcGVjdGlvblRlbWFwbGF0ZXNCeUFzc2V0Q2F0ZWdvcnkoCiAgICAgICAgICAgIHRoaXMuYXNzZXRzLmNhdGVnb3J5LnV1aWQKICAgICAgICAgICk7CiAgICAgICAgfQogICAgICApOwogICAgfSwKCiAgICBnZXRVc2Vyc0dyb3VwKHRlbmFudFVVSUQpIHsKICAgICAgQXNzZXRQZXJzb25uZWxTZXJ2aWNlLmdldEFsbFVzZXJHcm91cCh0ZW5hbnRVVUlEKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAgIHRoaXMudXNlckdyb3VwT3B0aW9ucyA9IHJlc3BvbnNlLmRhdGEuZ3JvdXBzOwogICAgICAgICAgICB0aGlzLnVzZXJHcm91cE9wdGlvbnMucHVzaCh7CiAgICAgICAgICAgICAgZ3JvdXBVVUlEOiAiQWxsIiwKICAgICAgICAgICAgICBncm91cE5hbWU6ICJBbGwiLAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgIGlmIChlcnJvcikgewogICAgICAgICAgICB0aGlzLnNob3dUb2FzdChlcnJvci5kYXRhLnJlc3BvbnNlLCAiZXJyb3IiKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0sCgogICAgZ2V0QWxsVXNlcnModGVuYW50VVVJRCkgewogICAgICBBc3NldFBlcnNvbm5lbFNlcnZpY2UuZ2V0QWxsVXNlcnModGVuYW50VVVJRCkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgICB0aGlzLmFsbFVzZXJzID0gcmVzcG9uc2UuZGF0YS51c2VyczsKICAgICAgICAgICAgdGhpcy51c2VyT3B0aW9ucyA9IHJlc3BvbnNlLmRhdGEudXNlcnM7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICB0aGlzLnNob3dUb2FzdChlcnJvci5kYXRhLnJlc3BvbnNlLCAiZXJyb3IiKTsKICAgICAgICB9KTsKICAgIH0sCgogICAgdXNlckdyb3Vwc0hhbmRsZXIoZGF0YSkgewogICAgICB0aGlzLnNlbGVjdGVkVXNlckdyb3VwID0gZGF0YS5zZWxlY3RlZE9iamVjdDsKICAgICAgaWYgKGRhdGEuc2VsZWN0ZWRPYmplY3QuZ3JvdXBOYW1lID09PSAiQWxsIikgewogICAgICAgIHRoaXMudXNlck9wdGlvbnMgPSB0aGlzLmFsbFVzZXJzOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMudXNlciA9ICIiOwogICAgICAgIEFzc2V0UGVyc29ubmVsU2VydmljZS5nZXRVc2VyR3JvdXBCeVVVSUQoCiAgICAgICAgICBkYXRhLnNlbGVjdGVkT2JqZWN0Lmdyb3VwVVVJRAogICAgICAgICkudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIHRoaXMudXNlck9wdGlvbnMgPSBbXTsKICAgICAgICAgIHRoaXMudXNlciA9ICIiOwogICAgICAgICAgdGhpcy51c2VyT3B0aW9ucyA9IHJlc3BvbnNlLmRhdGEudXNlckdyb3VwLnVzZXJzOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIHRoaXMudXNlciA9ICIiOwogICAgICB0aGlzLndvcmtPcmRlclN1bW1hcnkudXNlciA9ICIiOwogICAgICB0aGlzLnVzZXJSZXNldCsrOwogICAgfSwKCiAgICBjbGVhclNlbGVjdGVkVXNlckdyb3VwKCkgewogICAgICB0aGlzLndvcmtPcmRlclN1bW1hcnkudXNlckdyb3VwID0gIiI7CiAgICAgIHRoaXMudXNlck9wdGlvbnMgPSB0aGlzLmFsbFVzZXJzOwogICAgICB0aGlzLnVzZXJSZXNldCsrOwogICAgfSwKCiAgICBnZXRJbnNwZWN0aW9uVGVtcGxhdGVzKGFzc2V0VVVJRCwgdGVuYW50VVVJRCkgewogICAgICBJbnNwZWN0aW9uU2VydmljZS5nZXRJbnNwZWN0aW9uVGVtcGxhdGVOYW1lQW5kVVVJRChhc3NldFVVSUQsIHRlbmFudFVVSUQpCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgICAgdGhpcy5pbnNwZWN0aW9uQnlBc3NldE9wdGlvbnMgPSByZXNwb25zZS5kYXRhLmluc3BlY3Rpb25zOwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlcnJvcikgPT4gewogICAgICAgICAgdGhpcy5zaG93VG9hc3QoZXJyb3IuZGF0YS5yZXNwb25zZSwgImVycm9yIik7CiAgICAgICAgfSk7CiAgICB9LAoKICAgIGdldEluc3BlY3Rpb25UZW1wbGF0ZUZyb21Xb3JrT3JkZXIodGVuYW50VVVJRCkgewogICAgICBXb3JrT3JkZXJTZXJ2aWNlLmdldFdvcmtPcmRlckluc3BlY3Rpb25UZW1wbGF0ZXModGVuYW50VVVJRCkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgICB0aGlzLmlucHNlY3Rpb25CeVdvcmtPcmRlck9wdGlvbnMgPSByZXNwb25zZS5kYXRhLmluc3BlY3Rpb25zOwogICAgICAgICAgICBmb3IgKGxldCBpbnNwZWN0aW9uIG9mIHRoaXMuaW5wc2VjdGlvbkJ5V29ya09yZGVyT3B0aW9ucykgewogICAgICAgICAgICAgIGlmIChpbnNwZWN0aW9uLm5hbWUgPT09ICIiIHx8ICFpbnNwZWN0aW9uLm5hbWUpIHsKICAgICAgICAgICAgICAgIGluc3BlY3Rpb24ubmFtZSA9ICItIjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KGVycm9yLmRhdGEucmVzcG9uc2UsICJlcnJvciIpOwogICAgICAgIH0pOwogICAgfSwKCiAgICBnZXRJbnNwZWN0aW9uVGVtYXBsYXRlc0J5QXNzZXRDYXRlZ29yeShjYXRlZ29yeVVVSUQpIHsKICAgICAgSW5zcGVjdGlvblNlcnZpY2UuZ2V0SW5zcGVjdGlvblRlbXBsYXRlTmFtZUFuZFVVSURCeUNhdGVnb3J5VVVJRCgKICAgICAgICBjYXRlZ29yeVVVSUQKICAgICAgKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAgIHRoaXMuaW5wc2VjdGlvbkJ5QXNzZXRDYXRlZ29yeU9wdGlvbnMgPSByZXNwb25zZS5kYXRhLmluc3BlY3Rpb25zOwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlcnJvcikgPT4gewogICAgICAgICAgdGhpcy5zaG93VG9hc3QoZXJyb3IuZGF0YS5yZXNwb25zZSwgImVycm9yIik7CiAgICAgICAgfSk7CiAgICB9LAoKICAgIHJlbW92ZU11bHRpcGxlQ2hvaWNlSW5pdGlhbChpbmRleCwgbSkgewogICAgICB0aGlzLnF1ZXN0aW9uVHlwZUZvcm1Jbml0aWFsW2luZGV4XS5hbnN3ZXJzLnNwbGljZShtLCAxKTsKICAgIH0sCiAgICByZW1vdmVNdWx0aXBsZUNob2ljZUZpbmFsKGluZGV4LCBtKSB7CiAgICAgIHRoaXMucXVlc3Rpb25UeXBlRm9ybUZpbmFsW2luZGV4XS5hbnN3ZXJzLnNwbGljZShtLCAxKTsKICAgIH0sCiAgICBhZGRBbnN3ZXJzQXJyYXkodmFsdWUsIGluZGV4KSB7CiAgICAgIHRoaXMucXVlc3Rpb25UeXBlRm9ybUluaXRpYWxbaW5kZXhdLnR5cGUgPSB2YWx1ZS5zZWxlY3RlZE9iamVjdC52YWx1ZTsKICAgICAgaWYgKHZhbHVlLnZhbHVlID09PSAiTXVsdGlwbGUgQ2hvaWNlIikgewogICAgICAgIHRoaXMucXVlc3Rpb25UeXBlRm9ybUluaXRpYWxbaW5kZXhdLmFuc3dlcnMucHVzaCgiIiwgIiIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMucXVlc3Rpb25UeXBlRm9ybUluaXRpYWxbaW5kZXhdLmFuc3dlcnMgPSBbXTsKICAgICAgfQogICAgfSwKCiAgICBjbGVhclNlbGVjdGVkQW5zd2VyKGluZGV4KSB7CiAgICAgIHRoaXMucXVlc3Rpb25UeXBlRm9ybUluaXRpYWxbaW5kZXhdLnR5cGVMYWJlbCA9ICIiOwogICAgICB0aGlzLnVwZGF0ZVNlbGVjdENvbXArKzsKICAgIH0sCgogICAgYWRkQW5zd2Vyc0FycmF5RmluYWwodmFsdWUsIGluZGV4KSB7CiAgICAgIHRoaXMucXVlc3Rpb25UeXBlRm9ybUZpbmFsW2luZGV4XS50eXBlID0gdmFsdWUuc2VsZWN0ZWRPYmplY3QudmFsdWU7CiAgICAgIGlmICh2YWx1ZS52YWx1ZSA9PT0gIk11bHRpcGxlIENob2ljZSIpIHsKICAgICAgICB0aGlzLnF1ZXN0aW9uVHlwZUZvcm1GaW5hbFtpbmRleF0uYW5zd2Vycy5wdXNoKCIiLCAiIik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5xdWVzdGlvblR5cGVGb3JtRmluYWxbaW5kZXhdLmFuc3dlcnMgPSBbXTsKICAgICAgfQogICAgfSwKICAgIGFkZE11bHRpcGxlQ2hvaWNlSW5pdGlhbChpbmRleCkgewogICAgICB0aGlzLnF1ZXN0aW9uVHlwZUZvcm1Jbml0aWFsW2luZGV4XS5hbnN3ZXJzLnB1c2goIiIpOwogICAgfSwKICAgIGFkZE11bHRpcGxlQ2hvaWNlRmluYWwoaW5kZXgpIHsKICAgICAgdGhpcy5xdWVzdGlvblR5cGVGb3JtRmluYWxbaW5kZXhdLmFuc3dlcnMucHVzaCgiIik7CiAgICB9LAoKICAgIHJlbW92ZUlucHV0RmllbGRzSW5pdGlhbChpbmRleCkgewogICAgICB0aGlzLnF1ZXN0aW9uVHlwZUZvcm1Jbml0aWFsLnNwbGljZShpbmRleCwgMSk7CiAgICB9LAogICAgcmVtb3ZlSW5wdXRGaWVsZHNGaW5hbChpbmRleCkgewogICAgICB0aGlzLnF1ZXN0aW9uVHlwZUZvcm1GaW5hbC5zcGxpY2UoaW5kZXgsIDEpOwogICAgfSwKICAgIGFkZElucHV0RmllbGRzSW5pdGlhbCgpIHsKICAgICAgdGhpcy5xdWVzdGlvblR5cGVGb3JtSW5pdGlhbC5wdXNoKHsKICAgICAgICBuYW1lOiAiIiwKICAgICAgICB0eXBlOiAiIiwKICAgICAgICBxdWVzdGlvbjogIiIsCiAgICAgICAgYW5zd2VyczogW10sCiAgICAgICAgbWFuZGF0b3J5OiB0cnVlLAogICAgICB9KTsKICAgIH0sCgogICAgYWRkSW5wdXRGaWVsZHNGaW5hbCgpIHsKICAgICAgdGhpcy5xdWVzdGlvblR5cGVGb3JtRmluYWwucHVzaCh7CiAgICAgICAgbmFtZTogIiIsCiAgICAgICAgdHlwZTogIiIsCiAgICAgICAgcXVlc3Rpb246ICIiLAogICAgICAgIGFuc3dlcnM6IFtdLAogICAgICAgIG1hbmRhdG9yeTogdHJ1ZSwKICAgICAgfSk7CiAgICB9LAogICAgZ2VuZXJhdGVVVUlEKCkgewogICAgICBsZXQgZCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICBpZiAoRGF0ZS5ub3coKSkgewogICAgICAgIGQgPSBEYXRlLm5vdygpOwogICAgICB9CgogICAgICBsZXQgdXVpZCA9ICJ4eHh4eHh4eC14eHh4LTR4eHgteXh4eC14eHh4eHh4eHh4eHgiLnJlcGxhY2UoCiAgICAgICAgL1t4eV0vZywKICAgICAgICAoYykgPT4gewogICAgICAgICAgbGV0IHIgPSAoZCArIE1hdGgucmFuZG9tKCkgKiAxNikgJSAxNiB8IDA7CiAgICAgICAgICBkID0gTWF0aC5mbG9vcihkIC8gMTYpOwogICAgICAgICAgcmV0dXJuIChjID09PSAieCIgPyByIDogKHIgJiAweDMpIHwgMHg4KS50b1N0cmluZygxNik7CiAgICAgICAgfQogICAgICApOwogICAgICByZXR1cm4gdXVpZDsKICAgIH0sCiAgICBhZGRQYXJ0KGluZGV4KSB7CiAgICAgIGxldCBpc3N1ZXMgPSB0aGlzLndvcmtPcmRlclN1bW1hcnkuaXNzdWVzOwogICAgICBsZXQgcGFydCA9IHsKICAgICAgICBuYW1lOiAiIiwKICAgICAgICB1dWlkOiB0aGlzLmdlbmVyYXRlVVVJRCgpLAogICAgICAgIHF1YW50aXR5OiAwLAogICAgICAgIGNvc3Q6IHsKICAgICAgICAgIGNhdGVnb3J5OiAicGFydC1jb3N0IiwKICAgICAgICAgIGFtb3VudDogMCwKICAgICAgICAgIHJlcG9ydGFibGU6IHRydWUsCiAgICAgICAgfSwKICAgICAgICBleHRyYUNvc3Q6IFsKICAgICAgICAgIHsKICAgICAgICAgICAgY2F0ZWdvcnk6ICJ0YXgtY29zdCIsCiAgICAgICAgICAgIGFtb3VudDogMCwKICAgICAgICAgICAgcmVwb3J0YWJsZTogdHJ1ZSwKICAgICAgICAgIH0sCiAgICAgICAgXSwKICAgICAgfTsKCiAgICAgIGlzc3Vlc1tpbmRleF0ucGFydHMucHVzaChwYXJ0KTsKCiAgICAgIHRoaXMud29ya09yZGVyU3VtbWFyeS5pc3N1ZXMgPSBpc3N1ZXM7CiAgICB9LAoKICAgIHJlbW92ZVBhcnRzKGluZGV4LCBrKSB7CiAgICAgIHsKICAgICAgICBsZXQgcGFydCA9IHRoaXMud29ya09yZGVyU3VtbWFyeS5pc3N1ZXNbaW5kZXhdLnBhcnRzOwogICAgICAgIHBhcnQuc3BsaWNlKGssIDEpOwogICAgICB9CiAgICB9LAogICAgYXNzZXREZXRhaWxzZnJvbVN0ZCh1dWlkKSB7CiAgICAgIGlmICh1dWlkICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBBc3NldE1hbmFnZW1lbnRTZXJ2aWNlLmdldEFzc2V0KHV1aWQpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy53b3JrT3JkZXJTdW1tYXJ5Lm5hbWUgPSByZXMuZGF0YS5hc3NldC5uYW1lOwoKICAgICAgICAgIGlmICh0aGlzLmFzc2V0Q2F0ZWdvcnlPcHRpb25zICE9PSAiIikgewogICAgICAgICAgICBmb3IgKGxldCBhc3NldF9jYXRlZ29yeSBvZiB0aGlzLmFzc2V0Q2F0ZWdvcnlPcHRpb25zKSB7CiAgICAgICAgICAgICAgaWYgKGFzc2V0X2NhdGVnb3J5LmNhdGVnb3J5VVVJRCA9PT0gcmVzLmRhdGEuY2F0ZWdvcnlJZCkgewogICAgICAgICAgICAgICAgdGhpcy53b3JrT3JkZXJTdW1tYXJ5LmNhdGVnb3J5ID0gYXNzZXRfY2F0ZWdvcnkubGFiZWw7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLmdldElzc3Vlc0J5QXNzZXRVVUlEKHJlcy5kYXRhLmFzc2V0LnV1aWQpOwogICAgICAgICAgdGhpcy5hc3NldEluZGV4Kys7CiAgICAgICAgICB0aGlzLmNhdGVnb3J5SW5kZXgrKzsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKCiAgICBpbml0aWFsSW5zcGVjdGlvblZhbGlkYXRpb24oKSB7CiAgICAgIGxldCB2YWxpZGF0aW9ucyA9IHt9OwogICAgICBpZiAodGhpcy5jaGVja0V4aXN0aW5nSW5pdGlhbEluc3BlY3Rpb24pIHsKICAgICAgICB2YWxpZGF0aW9ucyA9IHsKICAgICAgICAgIGluaXRpYWxJbnNwZWN0aW9uQnlBc3NldENhdGVnb3J5OiB7IHJlcXVpcmVkIH0sCiAgICAgICAgICBxdWVzdGlvblR5cGVGb3JtSW5pdGlhbDogewogICAgICAgICAgICAkZWFjaDogewogICAgICAgICAgICAgIG5hbWU6IHt9LAogICAgICAgICAgICAgIHF1ZXN0aW9uOiB7fSwKICAgICAgICAgICAgICB0eXBlTGFiZWw6IHt9LAogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICB9OwogICAgICB9IGVsc2UgewogICAgICAgIHZhbGlkYXRpb25zID0gewogICAgICAgICAgaW5pdGlhbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnk6IHt9LAogICAgICAgICAgcXVlc3Rpb25UeXBlRm9ybUluaXRpYWw6IHsKICAgICAgICAgICAgJGVhY2g6IHsKICAgICAgICAgICAgICBuYW1lOiB7IHJlcXVpcmVkLCBtYXhMZW5ndGg6IG1heExlbmd0aCgxOTApIH0sCiAgICAgICAgICAgICAgcXVlc3Rpb246IHsgcmVxdWlyZWQsIG1heExlbmd0aDogbWF4TGVuZ3RoKDE5MCkgfSwKICAgICAgICAgICAgICB0eXBlTGFiZWw6IHsgcmVxdWlyZWQgfSwKICAgICAgICAgICAgfSwKICAgICAgICAgIH0sCiAgICAgICAgfTsKICAgICAgfQogICAgICByZXR1cm4gdmFsaWRhdGlvbnM7CiAgICB9LAoKICAgIHdvcmtPcmRlclZhbGlkYXRpb24oKSB7CiAgICAgIGxldCB2YWxpZGF0aW9ucyA9IHt9OwogICAgICBpZiAoCiAgICAgICAgIXRoaXMuY2hlY2tFeGlzdGluZ0luaXRpYWxJbnNwZWN0aW9uICYmCiAgICAgICAgdGhpcy5maW5hbEluc3BlY3Rpb25TZWxlY3Rpb24gPT0gIkNyZWF0ZSBOZXcgSW5zcGVjdGlvbiBUZW1wbGF0ZSIKICAgICAgKSB7CiAgICAgICAgdmFsaWRhdGlvbnMgPSB7CiAgICAgICAgICB3b3JrT3JkZXJTdW1tYXJ5OiB7CiAgICAgICAgICAgIHByaW9yaXR5OiB7IHJlcXVpcmVkIH0sCiAgICAgICAgICAgIHNoaWZ0OiB7IHJlcXVpcmVkIH0sCiAgICAgICAgICAgIHNoZWR1bGU6IHsgcmVxdWlyZWQgfSwKICAgICAgICAgICAgdXNlcjogeyByZXF1aXJlZCB9LAogICAgICAgICAgICBjYXRlZ29yeTogeyByZXF1aXJlZCB9LAogICAgICAgICAgICBuYW1lOiB7IHJlcXVpcmVkIH0sCiAgICAgICAgICAgIGluaXRpYWxJbnNwZWN0aW9uVGl0bGU6IHsgcmVxdWlyZWQsIG1heExlbmd0aDogbWF4TGVuZ3RoKDE5MCkgfSwKICAgICAgICAgICAgZmluYWxJbnNwZWN0aW9uVGl0bGU6IHsgcmVxdWlyZWQsIG1heExlbmd0aDogbWF4TGVuZ3RoKDE5MCkgfSwKICAgICAgICAgIH0sCiAgICAgICAgfTsKICAgICAgfSBlbHNlIGlmICgKICAgICAgICB0aGlzLmNoZWNrRXhpc3RpbmdJbml0aWFsSW5zcGVjdGlvbiAmJgogICAgICAgIHRoaXMuZmluYWxJbnNwZWN0aW9uU2VsZWN0aW9uID09ICJDcmVhdGUgTmV3IEluc3BlY3Rpb24gVGVtcGxhdGUiCiAgICAgICkgewogICAgICAgIHZhbGlkYXRpb25zID0gewogICAgICAgICAgd29ya09yZGVyU3VtbWFyeTogewogICAgICAgICAgICBwcmlvcml0eTogeyByZXF1aXJlZCB9LAogICAgICAgICAgICBzaGlmdDogeyByZXF1aXJlZCB9LAogICAgICAgICAgICBzaGVkdWxlOiB7IHJlcXVpcmVkIH0sCiAgICAgICAgICAgIHVzZXI6IHsgcmVxdWlyZWQgfSwKICAgICAgICAgICAgY2F0ZWdvcnk6IHsgcmVxdWlyZWQgfSwKICAgICAgICAgICAgbmFtZTogeyByZXF1aXJlZCB9LAogICAgICAgICAgICBpbml0aWFsSW5zcGVjdGlvblRpdGxlOiB7fSwKICAgICAgICAgICAgZmluYWxJbnNwZWN0aW9uVGl0bGU6IHsgcmVxdWlyZWQgfSwKICAgICAgICAgIH0sCiAgICAgICAgfTsKICAgICAgfSBlbHNlIGlmICgKICAgICAgICAhdGhpcy5jaGVja0V4aXN0aW5nSW5pdGlhbEluc3BlY3Rpb24gJiYKICAgICAgICB0aGlzLmZpbmFsSW5zcGVjdGlvblNlbGVjdGlvbiAhPT0gIkNyZWF0ZSBOZXcgSW5zcGVjdGlvbiBUZW1wbGF0ZSIKICAgICAgKSB7CiAgICAgICAgdmFsaWRhdGlvbnMgPSB7CiAgICAgICAgICB3b3JrT3JkZXJTdW1tYXJ5OiB7CiAgICAgICAgICAgIHByaW9yaXR5OiB7IHJlcXVpcmVkIH0sCiAgICAgICAgICAgIHNoaWZ0OiB7IHJlcXVpcmVkIH0sCiAgICAgICAgICAgIHNoZWR1bGU6IHsgcmVxdWlyZWQgfSwKICAgICAgICAgICAgdXNlcjogeyByZXF1aXJlZCB9LAogICAgICAgICAgICBjYXRlZ29yeTogeyByZXF1aXJlZCB9LAogICAgICAgICAgICBuYW1lOiB7IHJlcXVpcmVkIH0sCiAgICAgICAgICAgIGluaXRpYWxJbnNwZWN0aW9uVGl0bGU6IHsgcmVxdWlyZWQgfSwKICAgICAgICAgICAgZmluYWxJbnNwZWN0aW9uVGl0bGU6IHt9LAogICAgICAgICAgfSwKICAgICAgICB9OwogICAgICB9IGVsc2UgewogICAgICAgIHZhbGlkYXRpb25zID0gewogICAgICAgICAgd29ya09yZGVyU3VtbWFyeTogewogICAgICAgICAgICBwcmlvcml0eTogeyByZXF1aXJlZCB9LAogICAgICAgICAgICBzaGlmdDogeyByZXF1aXJlZCB9LAogICAgICAgICAgICBzaGVkdWxlOiB7IHJlcXVpcmVkIH0sCiAgICAgICAgICAgIHVzZXI6IHsgcmVxdWlyZWQgfSwKICAgICAgICAgICAgY2F0ZWdvcnk6IHsgcmVxdWlyZWQgfSwKICAgICAgICAgICAgbmFtZTogeyByZXF1aXJlZCB9LAogICAgICAgICAgICBpbml0aWFsSW5zcGVjdGlvblRpdGxlOiB7fSwKICAgICAgICAgICAgZmluYWxJbnNwZWN0aW9uVGl0bGU6IHt9LAogICAgICAgICAgfSwKICAgICAgICB9OwogICAgICB9CiAgICAgIHJldHVybiB2YWxpZGF0aW9uczsKICAgIH0sCgogICAgZmluYWxJbnNwZWN0aW9uVmFsaWRhdGlvbigpIHsKICAgICAgbGV0IHZhbGRpYXRpb25zID0ge307CiAgICAgIGlmICh0aGlzLmZpbmFsSW5zcGVjdGlvblNlbGVjdGlvbiA9PSAiQ3JlYXRlIE5ldyBJbnNwZWN0aW9uIFRlbXBsYXRlIikgewogICAgICAgIHZhbGRpYXRpb25zID0gewogICAgICAgICAgcXVlc3Rpb25UeXBlRm9ybUZpbmFsOiB7CiAgICAgICAgICAgICRlYWNoOiB7CiAgICAgICAgICAgICAgbmFtZTogeyByZXF1aXJlZCwgbWF4TGVuZ3RoOiBtYXhMZW5ndGgoMTkwKSB9LAogICAgICAgICAgICAgIHF1ZXN0aW9uOiB7IHJlcXVpcmVkLCBtYXhMZW5ndGg6IG1heExlbmd0aCgxOTApIH0sCiAgICAgICAgICAgICAgdHlwZUxhYmVsOiB7IHJlcXVpcmVkIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgIH07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFsZGlhdGlvbnMgPSB7CiAgICAgICAgICBxdWVzdGlvblR5cGVGb3JtRmluYWw6IHsKICAgICAgICAgICAgJGVhY2g6IHsKICAgICAgICAgICAgICBuYW1lOiB7fSwKICAgICAgICAgICAgICBxdWVzdGlvbjoge30sCiAgICAgICAgICAgICAgdHlwZUxhYmVsOiB7fSwKICAgICAgICAgICAgfSwKICAgICAgICAgIH0sCiAgICAgICAgfTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuZmluYWxJbnNwZWN0aW9uU2VsZWN0aW9uID09PSAiU2VsZWN0IEV4aXN0aW5nIikgewogICAgICAgIHZhbGRpYXRpb25zLmZpbmFsSW5zcGVjdGlvbkJ5QXNzZXRDYXRlZ29yeSA9IHsgcmVxdWlyZWQgfTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YWxkaWF0aW9ucy5maW5hbEluc3BlY3Rpb25CeUFzc2V0Q2F0ZWdvcnkgPSB7fTsKICAgICAgfQoKICAgICAgcmV0dXJuIHZhbGRpYXRpb25zOwogICAgfSwKCiAgICBzaG93VG9hc3QobWVzc2FnZSwgdHlwZSkgewogICAgICB0aGlzLnRvYXN0TWVzc2FnZSA9IG1lc3NhZ2U7CiAgICAgIHRoaXMudG9hc3RUeXBlID0gdHlwZTsKICAgICAgdGhpcy50b2FzdEZsYWcrKzsKICAgIH0sCiAgfSwKICB3YXRjaDogewogICAgcXVhbnRpdHlWYWw6ZnVuY3Rpb24oKXsKICAgICAgaWYodGhpcy5xdWFudGl0eVZhbCA9PSB0cnVlKXsKICAgICAgICAgIC8vIGRlY3JlbWVudCBiYWNrZ3JvdW5kLWUxZTFlMQogICAgICB9CiAgICB9CiAgfSwKICBjcmVhdGVkKCkgewogICAgdGhpcy5jdXJyZW50VXNlckRldGFpbHMgPSBKU09OLnBhcnNlKAogICAgICBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiY3VycmVudFVzZXJEZXRhaWxzIikKICAgICk7CiAgICB0aGlzLmdldEN1cnJlbmN5KCk7CiAgICB0aGlzLmdldEFsbENhdGVnb3JpZXModGhpcy5jdXJyZW50VXNlckRldGFpbHMpOwogICAgdGhpcy5nZXRVc2Vyc0dyb3VwKHRoaXMuY3VycmVudFVzZXJEZXRhaWxzLnByb2ZpbGUub3JnYW5pemF0aW9uSWQpOwogICAgdGhpcy5nZXRBbGxVc2Vycyh0aGlzLmN1cnJlbnRVc2VyRGV0YWlscy5wcm9maWxlLm9yZ2FuaXphdGlvbklkKTsKCiAgICBpZiAodGhpcy4kcm91dGUucGFyYW1zLmNyZWF0ZVdvcmtPcmRlcikgewogICAgICB0aGlzLmRpc2JhYmxlZmllbGQgPSB0cnVlOwogICAgICB0aGlzLmlzc3Vlc1NlbGVjdGVkID0gdGhpcy4kcm91dGUucGFyYW1zLmlzc3VldXVpZDsKICAgICAgdGhpcy5nZXRJc3N1ZUJ5VVVJRCh0aGlzLiRyb3V0ZS5wYXJhbXMuaXNzdWV1dWlkKTsKICAgIH0KICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuYXNzZXQpIHsKICAgICAgdGhpcy53b3JrT3JkZXJTdW1tYXJ5Lm5hbWUgPSB0aGlzLiRyb3V0ZS5wYXJhbXMuYXNzZXQubmFtZTsKICAgICAgdGhpcy53b3JrT3JkZXJTdW1tYXJ5LmNhdGVnb3J5ID0gdGhpcy4kcm91dGUucGFyYW1zLmFzc2V0LmNhdGVnb3J5OwogICAgfQogICAgdGhpcy5hZGRJbnB1dEZpZWxkc0luaXRpYWwoKTsKICAgIHRoaXMuYWRkSW5wdXRGaWVsZHNGaW5hbCgpOwogIH0sCgogIHZhbGlkYXRpb25zOiBmdW5jdGlvbigpIHsKICAgIHJldHVybiB7CiAgICAgIC4uLnRoaXMud29ya09yZGVyVmFsaWRhdGlvbigpLAogICAgICAuLi50aGlzLmluaXRpYWxJbnNwZWN0aW9uVmFsaWRhdGlvbigpLAogICAgICAuLi50aGlzLmZpbmFsSW5zcGVjdGlvblZhbGlkYXRpb24oKSwKICAgICAgZmluYWxJbnNwZWN0aW9uU2VsZWN0aW9uOiB7IHJlcXVpcmVkIH0sCiAgICAgIGlzc3Vlc1NlbGVjdGVkOiB7IHJlcXVpcmVkIH0sCiAgICAgIHBhcnQ6ewogICAgICAgIHF1YW50aXR5OntudW1lcmljfQogICAgICB9CiAgICAgICAgICAKICAgICAgCiAgICAgIC8qIGlzc3Vlczp7CgkJCSRlYWNoOnsKCQkJCWlzc3VlTmFtZTp7cmVxdWlyZWR9LAoJCQl9LAoJCX0sKi8KICAgIH07CiAgfSwKfTsK"},null]}