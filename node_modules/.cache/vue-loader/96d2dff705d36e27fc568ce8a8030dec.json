{"remainingRequest":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/src/views/assets/AssetDetails.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/src/views/assets/AssetDetails.vue","mtime":1661968702424},{"path":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/alsharqi/Desktop/Deploy Fe-ui/fe-erohal-ui/node_modules/vue-loader/lib/index.js","mtime":1655715099000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBTaWRlYmFyIGZyb20gIi4vY29tcG9uZW50cy9TaWRlYmFyIjsKaW1wb3J0IEFzc2V0TWFuYWdlbWVudFNlcnZpY2UgZnJvbSAiLi8uLi8uLi9zZXJ2aWNlcy9Bc3NldE1hbmFnZW1lbnRTZXJ2aWNlIjsKaW1wb3J0IFdvcmtPcmRlclNlcnZpY2UgZnJvbSAiLi8uLi8uLi9zZXJ2aWNlcy9Xb3JrT3JkZXJTZXJ2aWNlIjsKaW1wb3J0IEluc3BlY3Rpb25TZXJ2aWNlIGZyb20gIi4vLi4vLi4vc2VydmljZXMvSW5zcGVjdGlvblNlcnZpY2UiOwppbXBvcnQgQXNzZXRQZXJzb25uZWxTZXJ2aWNlIGZyb20gIi4vLi4vLi4vc2VydmljZXMvQXNzZXRQZXJzb25uZWxTZXJ2aWNlIjsKaW1wb3J0IEFzc2lnblVzZXJQb3BVcCBmcm9tICIuL2NvbXBvbmVudHMvQXNzaWduVXNlclBvcFVwIjsKaW1wb3J0IFVuQXNzaWduVXNlclBvcFVwIGZyb20gIi4vY29tcG9uZW50cy9VbkFzc2lnblVzZXJQb3BVcCI7CmltcG9ydCBDYXRlZ29yaWVzRmllbGRzIGZyb20gIi4vY29tcG9uZW50cy9DYXRlZ29yaWVzRmllbGRzIjsKaW1wb3J0IG1vbWVudCBmcm9tICJtb21lbnQiOwppbXBvcnQgQXNzaWdubWVudCBmcm9tICIuL2NvbXBvbmVudHMvQXNzaWdubWVudCI7CmltcG9ydCBXb3JrT3JkZXJzIGZyb20gIi4vY29tcG9uZW50cy9Xb3JrT3JkZXJzIjsKaW1wb3J0IElzc3VlcyBmcm9tICIuL2NvbXBvbmVudHMvSXNzdWVzIjsKaW1wb3J0IENvbnN1bXB0aW9ucyBmcm9tICIuL2NvbXBvbmVudHMvQ29uc3VtcHRpb25zIjsKaW1wb3J0IFVzYWdlcyBmcm9tICIuL2NvbXBvbmVudHMvVXNhZ2VzIjsKaW1wb3J0IEFzc2V0U3VtbWFyeSBmcm9tICIuL2NvbXBvbmVudHMvQXNzZXRTdW1tYXJ5IjsKaW1wb3J0IERlbGV0ZURpYWxvZyBmcm9tICIuLi8uLi9jb21wb25lbnRzL0RlbGV0ZURpYWxvZyI7CgppbXBvcnQgbG9hZGVyIGZyb20gIkAvY29tcG9uZW50cy9Mb2FkZXIudnVlIgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIkFzc2V0RGV0YWlscyIsCiAgY29tcG9uZW50czogewogICAgU2lkZWJhciwKICAgIEFzc2lnbm1lbnQsCiAgICBXb3JrT3JkZXJzLAogICAgSXNzdWVzLAogICAgQ29uc3VtcHRpb25zLAogICAgVXNhZ2VzLAogICAgQXNzaWduVXNlclBvcFVwLAogICAgQ2F0ZWdvcmllc0ZpZWxkcywKICAgIEFzc2V0U3VtbWFyeSwKICAgIFVuQXNzaWduVXNlclBvcFVwLAogICAgRGVsZXRlRGlhbG9nLAogICAgbG9hZGVyCiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgZGVsZXRlRGlhbG9nQXR0YWNobWVudDogZmFsc2UsCiAgICAgIGRlbGV0ZURpYWxvZzogZmFsc2UsCiAgICAgIHRvYXN0RmxhZzogMCwKICAgICAgdG9hc3RNZXNzYWdlOiAiIiwKICAgICAgdG9hc3RUeXBlOiAiIiwKICAgICAgV29ya09yZGVyTGlzdDoge30sCiAgICAgIGxvYWRlckZsYWc6IGZhbHNlLAogICAgICBpbmRleDogMCwKICAgICAga2V5SW5kZXg6IDAsCiAgICAgIHBvcHVwSW1hZ2U6ICIiLAogICAgICBpbWFnZVZvaWNlczogW10sCiAgICAgIGltYWdlRGlhbG9nOiBmYWxzZSwKICAgICAgYXNzZXRVdWlkOiAiIiwKICAgICAgcGFnZTogMCwKICAgICAgcm93c1BlclBhZ2U6IDUsCiAgICAgIGFzc2V0RGV0YWlsOiB7fSwKICAgICAgZmllbGRzOiBbXSwKICAgICAgYXNzZXRGaWVsZHM6IFtdLAogICAgICBhc3NldEltYWdlczogW10sCiAgICAgIGF0dGFjaG1lbnRzOiBbXSwKICAgICAgYXNzZXRzOiBbXSwKICAgICAgY29uc3VtcHRpb25zOiB7fSwKICAgICAgaXNzdWVzOiB7fSwKICAgICAgdXNhZ2VzOiB7fSwKICAgICAgVXNlcnM6IFtdLAogICAgICBhbGxVc2VyczogW10sCiAgICAgIFNob3dQb3BVcDogZmFsc2UsCiAgICAgIFNob3dVblBvcFVwOiBmYWxzZSwKICAgICAgYXNzaWduZWRVc2VyczogW10sCiAgICAgIGFzc2lnbm1lbnRIaXN0b3J5VXNlcnM6IFtdLAogICAgICBkaXNhYmxlRmllbGRzOiB0cnVlLAogICAgICB2YWx1ZUVkaXRBc3NpZ246IHt9LAogICAgICBjb3N0OiAiIiwKICAgICAgYXNzaWduVGFibGVWYWx1ZTogIiIsCiAgICAgIGltYWdlVm9pY2VzQ2hlY2s6IFtdLAogICAgICBjdXJyZW5jeTogIiIsCiAgICAgIGlzc3VlVGFibGU6IDAsCiAgICAgIGF0dGFjaG1lbnRJRDogIiIsCiAgICB9OwogIH0sCiAgcHJvcHM6IHt9LAogIG1ldGhvZHM6IHsKICAgIGRvd25sb2FkRmlsZShmaWxlVXJsLCBpbmRleCkgewogICAgICB0aGlzLmxvYWRlckZsYWcgPSB0cnVlOwogICAgICBBc3NldE1hbmFnZW1lbnRTZXJ2aWNlLmdldEZpbGUoZmlsZVVybCkKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICBpZiAocmVzLmRhdGEucmVzcG9uc2VJZGVudGlmaWVyID09PSAiU3VjY2VzcyIpIHsKICAgICAgICAgICAgdGhpcy5kb3dubG9hZFBERihyZXMuZGF0YSwgaW5kZXgpOwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICB9KTsKICAgIH0sCiAgICBjbG9zZURpYWxvZygpIHsKICAgICAgdGhpcy5kZWxldGVEaWFsb2dBdHRhY2htZW50ID0gZmFsc2U7CiAgICB9LAogICAgZG93bmxvYWRQREYocGRmLCBpbmRleCkgewogICAgICBjb25zdCBsaW5rU291cmNlID0gYGRhdGE6YXBwbGljYXRpb24vcGRmO2Jhc2U2NCwke3BkZi5jb250ZW50fWA7CiAgICAgIGNvbnN0IGRvd25sb2FkTGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKICAgICAgbGV0IGZpbGVOYW1lID0gbnVsbDsKICAgICAgZm9yIChsZXQgaW5kZXgyID0gMDsgaW5kZXgyIDwgdGhpcy5hdHRhY2htZW50cy5sZW5ndGg7IGluZGV4MisrKSB7CiAgICAgICAgZmlsZU5hbWUgPSB0aGlzLmF0dGFjaG1lbnRzW2luZGV4XS5maWxlTmFtZS5zcGxpdCgiLSIpLnBvcCgpOwogICAgICB9CiAgICAgIGRvd25sb2FkTGluay5ocmVmID0gbGlua1NvdXJjZTsKICAgICAgZG93bmxvYWRMaW5rLmRvd25sb2FkID0gZmlsZU5hbWU7CiAgICAgIGRvd25sb2FkTGluay5jbGljaygpOwogICAgICB0aGlzLmxvYWRlckZsYWcgPSBmYWxzZTsKICAgIH0sCiAgICBkaXNwbGF5TWVzc2FnZSgpIHsKICAgICAgdGhpcy5zaG93VG9hc3QoIklzc3VlIENyZWF0ZWQgU3VjY3Vzc2Z1bGx5LiIsICJzdWNjZXNzIik7CiAgICB9LAogICAgZGVsZXRlQXNzZXRBdHRhY2htZW50KGlkKSB7CiAgICAgIHRoaXMuYXR0YWNobWVudElEID0gaWQ7CiAgICAgIHRoaXMuZGVsZXRlRGlhbG9nQXR0YWNobWVudCA9IHRydWU7CiAgICB9LAogICAgZGVsZXRlQXR0YWNobWVudEZ1bigpIHsKICAgICAgQXNzZXRNYW5hZ2VtZW50U2VydmljZS5kZWxldGVBc3NldEF0dGFjaG1lbnQodGhpcy5hdHRhY2htZW50SUQpCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgaWYgKHJlcy5kYXRhLnJlc3BvbnNlQ29kZSA9PT0gIjIwMCIpIHsKICAgICAgICAgICAgdGhpcy5jbG9zZSgpOwogICAgICAgICAgICB0aGlzLkFzc2V0c0RldGFpbHMoKTsKICAgICAgICAgICAgdGhpcy5zaG93VG9hc3QocmVzLmRhdGEuZGVzY3JpcHRpb24sICJzdWNjZXNzIik7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KGUucmVzcG9uc2UuZGVzY3JpcHRpb24sICJlcnJvciIpOwogICAgICAgIH0pOwogICAgfSwKICAgIGV4cG9ydENzdigpIHsKICAgICAgdGhpcy5sb2FkZXJGbGFnID0gdHJ1ZTsKICAgICAgbGV0IHJlcXVlc3QgPSB7CiAgICAgICAgYXNzZXRFeGNlbERhdGE6IHRoaXMuYnVpbGRFeHBvcnREYXRhUmVxdWVzdCgpLAogICAgICAgIGFzc2lnbm1lbnRzOiB0aGlzLmJ1aWxkQXNzaWdubWVudFJlcXVlc3QoKSwKICAgICAgICBhc3NpZ25tZW50SGlzdG9yaWVzOiB0aGlzLmJ1aWxkQXNzaWdubWVudEhpc3RvcmllcygpLAogICAgICAgIGlzc3VlczogdGhpcy5idWlsZElzc3VlcygpLAogICAgICAgIHdvcmtPcmRlcnM6IHRoaXMuYnVpbGRXb3JrT3JkZXJzKCksCiAgICAgICAgY29uc3VtcHRpb25zOiB0aGlzLmJ1aWxkQ29uc3VtcHRpb25zKCksCiAgICAgICAgdXNhZ2VzOiB0aGlzLmJ1aWxkVXNhZ2VzKCksCiAgICAgIH07CiAgICAgIEFzc2V0TWFuYWdlbWVudFNlcnZpY2UuZXhwb3J0QXNzZXREZXRhaWxzKHJlcXVlc3QpCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgICAgdGhpcy5sb2FkZXJGbGFnID0gZmFsc2U7CiAgICAgICAgICAgIHZhciBzYW1wbGVBcnJheSA9IHRoaXMuYmFzZTY0VG9BcnJheUJ1ZmZlcihyZXNwb25zZS5kYXRhLmZpbGUpOwogICAgICAgICAgICBsZXQgZmlsZVVybCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKAogICAgICAgICAgICAgIG5ldyBCbG9iKFtzYW1wbGVBcnJheV0sIHsKICAgICAgICAgICAgICAgIHR5cGU6ICJhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQuc3ByZWFkc2hlZXRtbC5zaGVldCIsCiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgKTsKICAgICAgICAgICAgdmFyIGZpbGVMaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwogICAgICAgICAgICBmaWxlTGluay5ocmVmID0gZmlsZVVybDsKICAgICAgICAgICAgZmlsZUxpbmsuc2V0QXR0cmlidXRlKCJkb3dubG9hZCIsIHJlc3BvbnNlLmRhdGEuZmlsZU5hbWUpOwogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGZpbGVMaW5rKTsKICAgICAgICAgICAgZmlsZUxpbmsuY2xpY2soKTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTsKICAgICAgICB9KTsKICAgIH0sCgogICAgYnVpbGRXb3JrT3JkZXJzKCkgewogICAgICBsZXQgd29ya09yZGVyc0RhdGEgPSBbXTsKICAgICAgdGhpcy5Xb3JrT3JkZXJMaXN0LndvcmtPcmRlcnMubWFwKCh3b3JrT3JkZXJzKSA9PiB7CiAgICAgICAgd29ya09yZGVyc0RhdGEucHVzaCh7CiAgICAgICAgICB3b3JrT3JkZXJOdW1iZXI6IHdvcmtPcmRlcnMud29ya09yZGVyTnVtYmVyLAogICAgICAgICAgYXNzZXROYW1lOiB3b3JrT3JkZXJzLmFzc2V0TmFtZSwKICAgICAgICAgIGlzc3Vlczogd29ya09yZGVycy5pc3N1ZUNvdW50LAogICAgICAgICAgY3JlYXRlZEF0OgogICAgICAgICAgICB3b3JrT3JkZXJzLmNyZWF0ZWRBdCAhPT0gbnVsbAogICAgICAgICAgICAgID8gbW9tZW50KHdvcmtPcmRlcnMuY3JlYXRlZEF0KS50b0lTT1N0cmluZygpCiAgICAgICAgICAgICAgOiBudWxsLAogICAgICAgICAgcHJpb3JpdHk6IHdvcmtPcmRlcnMucHJpb3JpdHksCiAgICAgICAgICBhc3NpZ25lZFRvOiB3b3JrT3JkZXJzLmFzc2lnbmVkVG9Vc2VyTmFtZSwKICAgICAgICAgIHN0YXR1czogd29ya09yZGVycy5zdGF0dXMsCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICByZXR1cm4gd29ya09yZGVyc0RhdGE7CiAgICB9LAoKICAgIGJ1aWxkVXNhZ2VzKCkgewogICAgICBsZXQgdXNhZ2VzID0gW107CiAgICAgIHRoaXMudXNhZ2VzLmNvbnRlbnQubWFwKCh1c2FnZSkgPT4gewogICAgICAgIHVzYWdlcy5wdXNoKHsKICAgICAgICAgIGRhdGU6CiAgICAgICAgICAgIHVzYWdlLnByaW1hcnlVc2FnZVRpbWUgIT09IG51bGwKICAgICAgICAgICAgICA/IG1vbWVudCh1c2FnZS5wcmltYXJ5VXNhZ2VUaW1lKS50b0lTT1N0cmluZygpCiAgICAgICAgICAgICAgOiB1c2FnZS5zZWNvbmRhcnlVc2FnZVRpbWUgIT09IG51bGwKICAgICAgICAgICAgICA/IG1vbWVudCh1c2FnZS5zZWNvbmRhcnlVc2FnZVRpbWUpLnRvSVNPU3RyaW5nKCkKICAgICAgICAgICAgICA6IG51bGwsCiAgICAgICAgICB2YWx1ZTogdXNhZ2UucHJpbWFyeVVzYWdlVmFsdWUsCiAgICAgICAgICBzZWNvbmRhcnlWYWx1ZTogdXNhZ2Uuc2Vjb25kYXJ5VXNhZ2VWYWx1ZSwKICAgICAgICB9KTsKICAgICAgfSk7CiAgICAgIHJldHVybiB1c2FnZXM7CiAgICB9LAoKICAgIGJ1aWxkQ29uc3VtcHRpb25zKCkgewogICAgICBsZXQgY29uc3VtcHRpb25zID0gW107CiAgICAgIHRoaXMuY29uc3VtcHRpb25zLmNvbnRlbnQubWFwKChjb25zdW1wdGlvbikgPT4gewogICAgICAgIGNvbnN1bXB0aW9ucy5wdXNoKHsKICAgICAgICAgIGRhdGU6CiAgICAgICAgICAgIGNvbnN1bXB0aW9uLmNyZWF0ZWRBdCAhPT0gbnVsbAogICAgICAgICAgICAgID8gbW9tZW50KGNvbnN1bXB0aW9uLmNyZWF0ZWRBdCkudG9JU09TdHJpbmcoKQogICAgICAgICAgICAgIDogbnVsbCwKICAgICAgICAgIGNvbnN1bXB0aW9uVmFsdWU6IGNvbnN1bXB0aW9uLmNvbnN1bXB0aW9uVmFsdWUsCiAgICAgICAgICB1bml0OiB0aGlzLmFzc2V0RGV0YWlsLmNvbnN1bXB0aW9uVW5pdCwKICAgICAgICB9KTsKICAgICAgfSk7CiAgICAgIHJldHVybiBjb25zdW1wdGlvbnM7CiAgICB9LAoKICAgIGJ1aWxkSXNzdWVzKCkgewogICAgICBsZXQgaXNzdWVzID0gW107CiAgICAgIHRoaXMuaXNzdWVzLmlzc3Vlcy5tYXAoKGlzc3VlKSA9PiB7CiAgICAgICAgaXNzdWVzLnB1c2goewogICAgICAgICAgaXNzdWVOdW1iZXI6IGlzc3VlLmlzc3VlTnVtYmVyLAogICAgICAgICAgaXNzdWVOYW1lOiBpc3N1ZS5pc3N1ZU5hbWUsCiAgICAgICAgICBzdGF0dXM6IGlzc3VlLnN0YXR1cywKICAgICAgICAgIHdvcmtPcmRlck51bWJlcjogaXNzdWUud29ya09yZGVyTnVtYmVyLAogICAgICAgICAgcmVwb3J0ZWRCeTogaXNzdWUucmVwb3J0ZWRCeSwKICAgICAgICAgIHJlcG9ydGVkQXQ6CiAgICAgICAgICAgIGlzc3VlLnJlcG9ydGVkQXQgIT0gbnVsbAogICAgICAgICAgICAgID8gbW9tZW50KGlzc3VlLnJlcG9ydGVkQXQpLnRvSVNPU3RyaW5nKCkKICAgICAgICAgICAgICA6IG51bGwsCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICByZXR1cm4gaXNzdWVzOwogICAgfSwKCiAgICBidWlsZEFzc2lnbm1lbnRIaXN0b3JpZXMoKSB7CiAgICAgIGxldCBhc3NpZ25tZW50SGlzdG9yaWVzID0gW107CiAgICAgIHRoaXMuYXNzaWdubWVudEhpc3RvcnlVc2Vycy5tYXAoKHVzZXJzKSA9PiB7CiAgICAgICAgYXNzaWdubWVudEhpc3Rvcmllcy5wdXNoKHsKICAgICAgICAgIG5hbWU6IHVzZXJzLm5hbWUsCiAgICAgICAgICBkdXJhdGlvbjogdXNlcnMuZHVyYXRpb25zLAogICAgICAgICAgc3RhcnREYXRlOgogICAgICAgICAgICB1c2Vycy51c2VyU3RhcnREYXRlc1swXSAhPT0gbnVsbAogICAgICAgICAgICAgID8gbW9tZW50KHVzZXJzLnVzZXJTdGFydERhdGVzWzBdKS50b0lTT1N0cmluZygpCiAgICAgICAgICAgICAgOiBudWxsLAogICAgICAgICAgZW5kRGF0ZToKICAgICAgICAgICAgdXNlcnMudXNlckVuZGluZ0RhdGVzWzBdICE9PSBudWxsCiAgICAgICAgICAgICAgPyBtb21lbnQodXNlcnMudXNlckVuZGluZ0RhdGVzWzBdKS50b0lTT1N0cmluZygpCiAgICAgICAgICAgICAgOiBudWxsLAogICAgICAgIH0pOwogICAgICB9KTsKICAgICAgcmV0dXJuIGFzc2lnbm1lbnRIaXN0b3JpZXM7CiAgICB9LAoKICAgIGJ1aWxkQXNzaWdubWVudFJlcXVlc3QoKSB7CiAgICAgIGxldCBhc3NpZ25tZW50cyA9IFtdOwogICAgICB0aGlzLmFzc2lnbmVkVXNlcnMubWFwKCh1c2VyKSA9PiB7CiAgICAgICAgYXNzaWdubWVudHMucHVzaCh7CiAgICAgICAgICBuYW1lOiB1c2VyLm5hbWUsCiAgICAgICAgICBzdGF0dXM6IHVzZXIuc3RhdHVzLAogICAgICAgICAgc3RhcnREYXRlOgogICAgICAgICAgICB1c2VyLnN0YXJ0RGF0ZSAhPSBudWxsCiAgICAgICAgICAgICAgPyBtb21lbnQodXNlci5zdGFydERhdGUpLnRvSVNPU3RyaW5nKCkKICAgICAgICAgICAgICA6IG51bGwsCiAgICAgICAgICBhc3NpZ25lZDogdXNlci5jb3VudCwKICAgICAgICB9KTsKICAgICAgfSk7CiAgICAgIHJldHVybiBhc3NpZ25tZW50czsKICAgIH0sCgogICAgYmFzZTY0VG9BcnJheUJ1ZmZlcihiYXNlNjQpIHsKICAgICAgdmFyIGJpbmFyeVN0cmluZyA9IHdpbmRvdy5hdG9iKGJhc2U2NCk7CiAgICAgIHZhciBiaW5hcnlMZW4gPSBiaW5hcnlTdHJpbmcubGVuZ3RoOwogICAgICB2YXIgYnl0ZXMgPSBuZXcgVWludDhBcnJheShiaW5hcnlMZW4pOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJpbmFyeUxlbjsgaSsrKSB7CiAgICAgICAgdmFyIGFzY2lpID0gYmluYXJ5U3RyaW5nLmNoYXJDb2RlQXQoaSk7CiAgICAgICAgYnl0ZXNbaV0gPSBhc2NpaTsKICAgICAgfQogICAgICByZXR1cm4gYnl0ZXM7CiAgICB9LAoKICAgIGJ1aWxkRXhwb3J0RGF0YVJlcXVlc3QoKSB7CiAgICAgIGxldCByZXF1ZXN0ID0gewogICAgICAgIG5hbWU6IHRoaXMuYXNzZXREZXRhaWwubmFtZSwKICAgICAgICBtb2RlbE51bWJlcjogdGhpcy5hc3NldERldGFpbC5tb2RlbE51bWJlciwKICAgICAgICBtYW51ZmFjdHVyZXI6IHRoaXMuYXNzZXREZXRhaWwubWFudWZhY3R1cmUsCiAgICAgICAgcHVyY2hhc2VEYXRlOgogICAgICAgICAgdGhpcy5hc3NldERldGFpbC5wdXJjaGFzZURhdGUgIT09IG51bGwgJiYKICAgICAgICAgIHRoaXMuYXNzZXREZXRhaWwucHVyY2hhc2VEYXRlICE9PSAiIgogICAgICAgICAgICA/IG1vbWVudCh0aGlzLmFzc2V0RGV0YWlsLnB1cmNoYXNlRGF0ZSkudG9JU09TdHJpbmcoKQogICAgICAgICAgICA6IG51bGwsCiAgICAgICAgc3RhdHVzOiB0aGlzLmFzc2V0RGV0YWlsLnN0YXR1cywKICAgICAgICB3YXJyYW50eTogdGhpcy5hc3NldERldGFpbC53YXJyYW50eSwKICAgICAgICBwcmltYXJ5VXNhZ2VVbml0OiB0aGlzLmFzc2V0RGV0YWlsLnByaW1hcnlVc2FnZVVuaXQsCiAgICAgICAgc2Vjb25kYXJ5VXNhZ2VVbml0OiB0aGlzLmFzc2V0RGV0YWlsLnNlY29uZGFyeVVzYWdlVW5pdCwKICAgICAgICBjb25zdW1wdGlvblVuaXQ6IHRoaXMuYXNzZXREZXRhaWwuY29uc3VtcHRpb25Vbml0LAogICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmFzc2V0RGV0YWlsLmRlc2NyaXB0aW9uLAogICAgICAgIGNvc3Q6IHRoaXMuYXNzZXREZXRhaWwuY29zdCwKICAgICAgICBjdXJyZW5jeTogdGhpcy5jdXJyZW5jeSwKICAgICAgICBhZGRpdGlvbmFsRmllbGRzOiBbXSwKICAgICAgfTsKICAgICAgLy8gdGhpcy5maWVsZHMKICAgICAgdGhpcy5hc3NldEZpZWxkcy5tYXAoKGZpZWxkKSA9PiB7CiAgICAgICAgbGV0IGxhYmVsID0gdGhpcy5maWVsZHMuZmluZCgoZikgPT4gZi51dWlkID09PSBmaWVsZC5maWVsZElkKS5sYWJlbDsKICAgICAgICByZXF1ZXN0LmFkZGl0aW9uYWxGaWVsZHMucHVzaCh7CiAgICAgICAgICBmaWVsZExhYmVsOiBsYWJlbCAhPT0gdW5kZWZpbmVkICYmIGxhYmVsICE9PSBudWxsID8gbGFiZWwgOiAiIiwKICAgICAgICAgIGZpZWxkVmFsdWU6IEpTT04ucGFyc2UoZmllbGQuZmllbGRWYWx1ZSkudmFsdWVzWzBdLAogICAgICAgIH0pOwogICAgICB9KTsKICAgICAgcmV0dXJuIHJlcXVlc3Q7CiAgICB9LAoKICAgIGNsb3NlKCkgewogICAgICB0aGlzLlNob3dQb3BVcCA9IGZhbHNlOwogICAgICB0aGlzLmltYWdlRGlhbG9nID0gZmFsc2U7CiAgICAgIHRoaXMuU2hvd1VuUG9wVXAgPSBmYWxzZTsKICAgICAgdGhpcy5kZWxldGVEaWFsb2dBdHRhY2htZW50ID0gZmFsc2U7CiAgICB9LAogICAgb3BlblBvcFVwKCkgewogICAgICB0aGlzLlNob3dQb3BVcCA9IHRydWU7CiAgICB9LAogICAgb25TZWxlY3RlZCh2YWx1ZSkgewogICAgICBjb25zb2xlLmxvZygic2VsZXRlZCB2YWx1ZSIsIHZhbHVlKTsKICAgIH0sCiAgICBnZXRDdXJyZW5jeSgpIHsKICAgICAgbGV0IGN1cnJlbnRVc2VyRGV0YWlscyA9IEpTT04ucGFyc2UoCiAgICAgICAgbG9jYWxTdG9yYWdlLmdldEl0ZW0oImN1cnJlbnRVc2VyRGV0YWlscyIpCiAgICAgICk7CiAgICAgIEFzc2V0UGVyc29ubmVsU2VydmljZS5nZXRDb21wYW55Q3VycmVuY3koCiAgICAgICAgY3VycmVudFVzZXJEZXRhaWxzLnByb2ZpbGUub3JnYW5pemF0aW9uSWQKICAgICAgKS50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgIHRoaXMuY3VycmVuY3kgPSByZXNwb25zZS5kYXRhLmN1cnJlbmN5OwogICAgICAgIHRoaXMua2V5SW5kZXgrKzsKICAgICAgfSk7CiAgICB9LAogICAgaXNzdWVzQWNjb3JkaW9uRnVuY3Rpb24odmFsKSB7CiAgICAgIGlmICh0aGlzLiRyZWZzLmlzc3Vlc0FjY29yZGlvbi5vcGVuRmxhZyA9PT0gdHJ1ZSkgewogICAgICAgIHRoaXMuJHJlZnMud29ya09yZGVyc0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIHRoaXMuJHJlZnMuYXNzaWdubWVudEFjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIHRoaXMuJHJlZnMuY2F0ZWdvcnlGaWVsZHNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLmNvbnN1bXB0aW9uc0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIHRoaXMuJHJlZnMudXNhZ2VzQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy5hdHRhY2htZW50QWNjb3JkaW9uLm9wZW5GbGFnID09PSBmYWxzZTsKICAgICAgfQogICAgfSwKCiAgICB3b3JrT3JkZXJzQWNjb3JkaW9uRnVuY3Rpb24odmFsKSB7CiAgICAgIGlmICh0aGlzLiRyZWZzLndvcmtPcmRlcnNBY2NvcmRpb24ub3BlbkZsYWcgPT09IHRydWUpIHsKICAgICAgICB0aGlzLiRyZWZzLmlzc3Vlc0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIHRoaXMuJHJlZnMuYXNzaWdubWVudEFjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIHRoaXMuJHJlZnMuY2F0ZWdvcnlGaWVsZHNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLmNvbnN1bXB0aW9uc0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIHRoaXMuJHJlZnMudXNhZ2VzQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy5hdHRhY2htZW50QWNjb3JkaW9uLm9wZW5GbGFnID09PSBmYWxzZTsKICAgICAgfQogICAgfSwKCiAgICBhc3NpZ25tZW50QWNjb3JkaW9uRnVuY3Rpb24odmFsKSB7CiAgICAgIGlmICh0aGlzLiRyZWZzLmFzc2lnbm1lbnRBY2NvcmRpb24ub3BlbkZsYWcgPT09IHRydWUpIHsKICAgICAgICB0aGlzLiRyZWZzLndvcmtPcmRlcnNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLmlzc3Vlc0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIHRoaXMuJHJlZnMuY2F0ZWdvcnlGaWVsZHNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLmNvbnN1bXB0aW9uc0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIHRoaXMuJHJlZnMudXNhZ2VzQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy5hdHRhY2htZW50QWNjb3JkaW9uLm9wZW5GbGFnID09PSBmYWxzZTsKICAgICAgfQogICAgfSwKCiAgICBjYXRlZ29yeUZpZWxkc0FjY29yZGlvbkZ1bmN0aW9uKCkgewogICAgICBpZiAodGhpcy4kcmVmcy5jYXRlZ29yeUZpZWxkc0FjY29yZGlvbi5vcGVuRmxhZyA9PT0gdHJ1ZSkgewogICAgICAgIHRoaXMuJHJlZnMuYXNzaWdubWVudEFjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIHRoaXMuJHJlZnMud29ya09yZGVyc0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIHRoaXMuJHJlZnMuaXNzdWVzQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy5jb25zdW1wdGlvbnNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLnVzYWdlc0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIHRoaXMuJHJlZnMuYXR0YWNobWVudEFjY29yZGlvbi5vcGVuRmxhZyA9PT0gZmFsc2U7CiAgICAgIH0KICAgIH0sCgogICAgY29uc3VtcHRpb25zQWNjb3JkaW9uRnVuY3Rpb24oKSB7CiAgICAgIGlmICh0aGlzLiRyZWZzLmNvbnN1bXB0aW9uc0FjY29yZGlvbi5vcGVuRmxhZyA9PT0gdHJ1ZSkgewogICAgICAgIHRoaXMuJHJlZnMuY2F0ZWdvcnlGaWVsZHNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLmFzc2lnbm1lbnRBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLndvcmtPcmRlcnNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLmlzc3Vlc0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIHRoaXMuJHJlZnMudXNhZ2VzQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy5hdHRhY2htZW50QWNjb3JkaW9uLm9wZW5GbGFnID09PSBmYWxzZTsKICAgICAgfQogICAgfSwKCiAgICBhdHRhY2htZW50QWNjb3JkaW9uRnVuY3Rpb24oKSB7CiAgICAgIGlmICh0aGlzLiRyZWZzLmF0dGFjaG1lbnRBY2NvcmRpb24ub3BlbkZsYWcgPT09IHRydWUpIHsKICAgICAgICB0aGlzLiRyZWZzLmNhdGVnb3J5RmllbGRzQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy5hc3NpZ25tZW50QWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy53b3JrT3JkZXJzQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgICAgdGhpcy4kcmVmcy5pc3N1ZXNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLnVzYWdlc0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIHRoaXMuJHJlZnMuY29uc3VtcHRpb25zQWNjb3JkaW9uLm9wZW5GbGFnID09PSBmYWxzZTsKICAgICAgICBpZiAodGhpcy5pbWFnZVZvaWNlc0NoZWNrLmxlbmd0aCA+IDApIHsKICAgICAgICAgIHRoaXMubG9hZGVyRmxhZyA9IHRydWU7CiAgICAgICAgICB0aGlzLmdldEFzc2V0SW1hZ2VzKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAoKICAgIGdldEFzc2V0UmVsYXRlZElzc3VlKCkgewogICAgICBJbnNwZWN0aW9uU2VydmljZS5nZXRQYWdpbmF0ZWRJc3N1ZXNCeUFzc2V0KAogICAgICAgIHRoaXMuYXNzZXRVdWlkLAogICAgICAgICJhbnkiLAogICAgICAgIHRoaXMucGFnZSwKICAgICAgICB0aGlzLnJvd3NQZXJQYWdlCiAgICAgICkKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICBsZXQgaXNzdWVzID0gcmVzLmRhdGE7CiAgICAgICAgICBsZXQgdXVpZHMgPSBbXTsKICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBpc3N1ZXMuaXNzdWVzLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgICB1dWlkcy5wdXNoKGlzc3Vlcy5pc3N1ZXNbaW5kZXhdLnN1Ym1pdHRlZEJ5VXNlclVVSUQpOwogICAgICAgICAgfQogICAgICAgICAgQXNzZXRQZXJzb25uZWxTZXJ2aWNlLmdldE5hbWVPZlVzZXJzQnlVVUlEUyh7CiAgICAgICAgICAgIHV1aWRzOiB1dWlkcywKICAgICAgICAgIH0pLnRoZW4oKHJlc3BvbnNlMikgPT4gewogICAgICAgICAgICBsZXQgdXNlcnMgPSByZXNwb25zZTIuZGF0YS51c2VyczsKICAgICAgICAgICAgdGhpcy5pc3N1ZXMuaXNzdWVzLm1hcCgoaXNzdWUpID0+IHsKICAgICAgICAgICAgICBpc3N1ZS5yZXBvcnRlZEJ5ID0gdXNlcnNbaXNzdWUuc3VibWl0dGVkQnlVc2VyVVVJRF0ubmFtZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMuaXNzdWVzID0gaXNzdWVzOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZygiZXJyb3IiLCBlKTsKICAgICAgICB9KTsKICAgIH0sCgogICAgZ2V0QXNzZXRXb3JrT3JkZXJzKCkgewogICAgICBXb3JrT3JkZXJTZXJ2aWNlLmdldFBhZ2luYXRlZFdvcmtPcmRlcnNCeUFzc2V0KAogICAgICAgIHRoaXMucGFnZSwKICAgICAgICB0aGlzLnJvd3NQZXJQYWdlLAogICAgICAgIHRoaXMuYXNzZXRVdWlkCiAgICAgICkudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgIGxldCBjb3VudE9mVG90YWxXb3JrT3JkZXJzID0gcmVzcG9uc2UuZGF0YS53b3JrT3JkZXJzLnRvdGFsRWxlbWVudHM7CiAgICAgICAgICBsZXQgdG90YWxQYWdlcyA9IHJlc3BvbnNlLmRhdGEud29ya09yZGVycy50b3RhbFBhZ2VzOwogICAgICAgICAgbGV0IHdvcmtPcmRlcnMgPSByZXNwb25zZS5kYXRhLndvcmtPcmRlcnMuY29udGVudDsKICAgICAgICAgIGlmICh3b3JrT3JkZXJzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAvL3RoaXMuc2V0U3RhdGUoeyBsb2FkaW5nOiBmYWxzZSwgd29ya09yZGVyczogd29ya09yZGVycyB9KTsKICAgICAgICAgIH0KICAgICAgICAgIGxldCBhc3NldHV1aWRzID0gW107CiAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgd29ya09yZGVycy5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgICAgaWYgKHdvcmtPcmRlcnNbaW5kZXhdLnByaW9yaXR5ID09PSBudWxsKSB7CiAgICAgICAgICAgICAgd29ya09yZGVyc1tpbmRleF0ucHJpb3JpdHkgPSAiTm90IEFzc2lnbmVkIjsKICAgICAgICAgICAgfQogICAgICAgICAgICAvL2FkZCB1dWlkIG9mIGFzc2V0IGluIHRoZSBsaXN0IGlmIGl0IGRvZXMgbm90IGV4aXN0CiAgICAgICAgICAgIGxldCBhc3NldHV1aWRBZGRlZCA9IGZhbHNlOwogICAgICAgICAgICBmb3IgKAogICAgICAgICAgICAgIGxldCBhc3NldHV1aWRzSW5kZXggPSAwOwogICAgICAgICAgICAgIGFzc2V0dXVpZHNJbmRleCA8IGFzc2V0dXVpZHMubGVuZ3RoOwogICAgICAgICAgICAgIGFzc2V0dXVpZHNJbmRleCsrCiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIGlmIChhc3NldHV1aWRzW2Fzc2V0dXVpZHNJbmRleF0gPT09IHdvcmtPcmRlcnNbaW5kZXhdLmFzc2V0VVVJRCkgewogICAgICAgICAgICAgICAgYXNzZXR1dWlkQWRkZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghYXNzZXR1dWlkQWRkZWQpIHsKICAgICAgICAgICAgICBhc3NldHV1aWRzLnB1c2god29ya09yZGVyc1tpbmRleF0uYXNzZXRVVUlEKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvL3NldHRpbmcgZGF0ZSB0byBzdHJpbmcgKEREIG1tTSBZWVlZIGhoOm1tIGFtL3BtKSBmb3JtdAogICAgICAgICAgICAvL3N0YXJ0CiAgICAgICAgICAgIC8vIGRlYnVnZ2VyOwogICAgICAgICAgICB3b3JrT3JkZXJzW2luZGV4XS5jcmVhdGVkQXQgPSBtb21lbnQoCiAgICAgICAgICAgICAgd29ya09yZGVyc1tpbmRleF0uY3JlYXRlZEF0CiAgICAgICAgICAgICkuZm9ybWF0KCJERCBNTU0gWVlZWSBoaDptbSBhIik7CiAgICAgICAgICAgIC8vZW5kCiAgICAgICAgICAgIC8vY2FsY3VsYXRlIGlzc3VlIGNvdW50IG9mIHdvcmsgb3JkZXIKICAgICAgICAgICAgbGV0IGlzc3VlQ291bnQgPSB3b3JrT3JkZXJzW2luZGV4XS5pc3N1ZXMubGVuZ3RoOwogICAgICAgICAgICB3b3JrT3JkZXJzW2luZGV4XS5pc3N1ZUNvdW50ID0gaXNzdWVDb3VudDsKICAgICAgICAgIH0KICAgICAgICAgIC8vZ2V0IGJhc2ljIGluZm8gb2YgYXNzZXRzIGZyb20gYXNzZXQgbWFuYWdlbWVudCBzZXJ2aWNlIGxpa2UgbmFtZSBhbmQgY2F0ZWdvcnkgbmFtZSBvZiBhc3NldAogICAgICAgICAgQXNzZXRNYW5hZ2VtZW50U2VydmljZS5nZXROYW1lQW5kVHlwZU9mQXNzZXRzQnlVVUlEUyh7CiAgICAgICAgICAgIHV1aWRzOiBhc3NldHV1aWRzLAogICAgICAgICAgfSkKICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlMSkgPT4gewogICAgICAgICAgICAgIC8vIGRlYnVnZ2VyOwogICAgICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB3b3JrT3JkZXJzLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgICAgICAgd29ya09yZGVyc1tpbmRleF0uYXNzZXROYW1lID0KICAgICAgICAgICAgICAgICAgcmVzcG9uc2UxLmRhdGEuYXNzZXRzW3dvcmtPcmRlcnNbaW5kZXhdLmFzc2V0VVVJRF0ubmFtZTsKICAgICAgICAgICAgICAgIHdvcmtPcmRlcnNbaW5kZXhdLmFzc2V0Q2F0ZWdvcnkgPQogICAgICAgICAgICAgICAgICByZXNwb25zZTEuZGF0YS5hc3NldHNbd29ya09yZGVyc1tpbmRleF0uYXNzZXRVVUlEXS50eXBlOwogICAgICAgICAgICAgICAgd29ya09yZGVyc1tpbmRleF0uYXNzZXROdW1iZXIgPQogICAgICAgICAgICAgICAgICByZXNwb25zZTEuZGF0YS5hc3NldHNbCiAgICAgICAgICAgICAgICAgICAgd29ya09yZGVyc1tpbmRleF0uYXNzZXRVVUlECiAgICAgICAgICAgICAgICAgIF0uYXNzZXROdW1iZXI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRoaXMuV29ya09yZGVyTGlzdC50b3RhbEVsZW1lbnRzID0gY291bnRPZlRvdGFsV29ya09yZGVyczsKICAgICAgICAgICAgICB0aGlzLldvcmtPcmRlckxpc3QubnVtYmVyID0gcmVzcG9uc2UuZGF0YS53b3JrT3JkZXJzLm51bWJlcjsKICAgICAgICAgICAgICB0aGlzLldvcmtPcmRlckxpc3QudG90YWxQYWdlcyA9IHRvdGFsUGFnZXM7CiAgICAgICAgICAgICAgdGhpcy5Xb3JrT3JkZXJMaXN0LndvcmtPcmRlcnMgPSB3b3JrT3JkZXJzOwogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICAgICAgaWYgKGVycm9yLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA2KSB7CiAgICAgICAgICAgICAgICB0aGlzLnNob3dUb2FzdCgKICAgICAgICAgICAgICAgICAgIkVycm9yIHdoaWxlIGdldHRpbmcgd29yayBvcmRlcnMuIFBsZWFzZSB0cnkgYWdhaW4iLAogICAgICAgICAgICAgICAgICAiZXJyb3IiCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLnNob3dUb2FzdCgKICAgICAgICAgICAgICAgICAgIkVycm9yIHdoaWxlIGdldHRpbmcgd29yayBvcmRlcnMuIFBsZWFzZSB0cnkgYWdhaW4iLAogICAgICAgICAgICAgICAgICAiZXJyb3IiCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KAogICAgICAgICAgICAiRXJyb3Igd2hpbGUgZ2V0dGluZyB3b3JrIG9yZGVycy4gUGxlYXNlIHRyeSBhZ2FpbiIsCiAgICAgICAgICAgICJlcnJvciIKICAgICAgICAgICk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCgogICAgdXNhZ2VzQWNjb3JkaW9uRnVuY3Rpb24oKSB7CiAgICAgIGlmICh0aGlzLiRyZWZzLnVzYWdlc0FjY29yZGlvbi5vcGVuRmxhZyA9PT0gdHJ1ZSkgewogICAgICAgIHRoaXMuJHJlZnMuY2F0ZWdvcnlGaWVsZHNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLmFzc2lnbm1lbnRBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLndvcmtPcmRlcnNBY2NvcmRpb24ub3BlbkZsYWcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLmlzc3Vlc0FjY29yZGlvbi5vcGVuRmxhZyA9IGZhbHNlOwogICAgICAgIHRoaXMuJHJlZnMuY29uc3VtcHRpb25zQWNjb3JkaW9uLm9wZW5GbGFnID0gZmFsc2U7CiAgICAgIH0KICAgIH0sCgogICAgZ2V0QXNzZXRJbWFnZXMoKSB7CiAgICAgIEFzc2V0TWFuYWdlbWVudFNlcnZpY2UuZ2V0QXNzZXRJbWFnZXNCeVV1aWQodGhpcy5hc3NldFV1aWQpCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICB0aGlzLmxvYWRlckZsYWcgPSBmYWxzZTsKICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgICB0aGlzLmltYWdlVm9pY2VzID0gcmVzcG9uc2UuZGF0YS5hc3NldEltYWdlczsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKCJBbiBFcnJvciBPY2N1cnJlZCB3aGlsZSBnZXR0aW5nIEFzc2V0IEltYWdlcy4iKTsKICAgICAgICB9KTsKICAgIH0sCgogICAgQXNzZXRzRGV0YWlscygpIHsKICAgICAgQXNzZXRNYW5hZ2VtZW50U2VydmljZS5nZXRBc3NldFdpdGhEZXRhaWxzKAogICAgICAgIHRoaXMuYXNzZXRVdWlkLAogICAgICAgIHRydWUsCiAgICAgICAgdHJ1ZSwKICAgICAgICB0cnVlLAogICAgICAgIHRydWUsCiAgICAgICAgdHJ1ZSwKICAgICAgICBmYWxzZSwKICAgICAgICBmYWxzZQogICAgICApLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICB0aGlzLmxvYWRlckZsYWcgPSB0cnVlOwogICAgICAgICAgbGV0IHRlbXBBc3NldCA9IHJlc3BvbnNlLmRhdGEuYXNzZXREZXRhaWw7CiAgICAgICAgICB0aGlzLmFzc2V0RGV0YWlsID0gdGVtcEFzc2V0LmFzc2V0RGV0YWlsOwogICAgICAgICAgdGhpcy5hc3NldERldGFpbC5jb3N0ID0gdGhpcy5jb3N0OwogICAgICAgICAgdGhpcy5pbWFnZVZvaWNlc0NoZWNrID0gdGVtcEFzc2V0LmFzc2V0SW1hZ2U7CiAgICAgICAgICB0aGlzLmFzc2V0VXVpZCA9IHRlbXBBc3NldC5hc3NldERldGFpbC51dWlkOwogICAgICAgICAgbGV0IGFzc2V0ID0gdGVtcEFzc2V0LmFzc2V0RGV0YWlsOwogICAgICAgICAgYXNzZXQucHVyY2hhc2VEYXRlID0gbW9tZW50KGFzc2V0LnB1cmNoYXNlRGF0ZSkuZm9ybWF0KCJERCBNTU0gWVlZWSIpOwogICAgICAgICAgYXNzZXQuYWN0aXZpdHlXYWxsID0gdGVtcEFzc2V0LmFjdGl2aXR5V2FsbDsKICAgICAgICAgIGFzc2V0LmFzc2V0RmllbGRzID0gdGVtcEFzc2V0LmFzc2V0RmllbGQ7CiAgICAgICAgICBhc3NldC5hdHRhY2htZW50cyA9IHRlbXBBc3NldC5hdHRhY2htZW50OwogICAgICAgICAgYXNzZXQuZG9jdW1lbnRzID0gdGVtcEFzc2V0LmF0dGFjaG1lbnQ7CiAgICAgICAgICBhc3NldC5hc3NldEltYWdlcyA9IHRlbXBBc3NldC5hc3NldEltYWdlOwogICAgICAgICAgZm9yIChsZXQgaW5kZXggPSAxOyBpbmRleCA8IGFzc2V0LmFzc2V0SW1hZ2VzLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgICBhc3NldC5hc3NldEltYWdlc1tpbmRleF0ubG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICBhc3NldC5hc3NldEltYWdlc1tpbmRleF0uaW1hZ2VGbGFnID0gdHJ1ZTsKICAgICAgICAgICAgYXNzZXQuYXR0YWNobWVudHMucHVzaChhc3NldC5hc3NldEltYWdlc1tpbmRleF0pOwogICAgICAgICAgfQogICAgICAgICAgYXNzZXQuY2F0ZWdvcnkgPSB0ZW1wQXNzZXQuY2F0ZWdvcnk7CiAgICAgICAgICBhc3NldC5maWVsZFRlbXBsYXRlID0KICAgICAgICAgICAgdGVtcEFzc2V0LmNhdGVnb3J5ICYmIHRlbXBBc3NldC5jYXRlZ29yeS5maWVsZFRlbXBsYXRlCiAgICAgICAgICAgICAgPyB0ZW1wQXNzZXQuY2F0ZWdvcnkuZmllbGRUZW1wbGF0ZQogICAgICAgICAgICAgIDogbnVsbDsKICAgICAgICAgIHRoaXMuYXNzZXRzID0gYXNzZXQ7CiAgICAgICAgICB0aGlzLnJlbmRlckltYWdlKCk7CiAgICAgICAgICB0aGlzLmFzc2V0SW1hZ2VzID0gYXNzZXQuYXNzZXRJbWFnZXM7CiAgICAgICAgICB0aGlzLmF0dGFjaG1lbnRzID0gYXNzZXQuYXR0YWNobWVudHM7CgogICAgICAgICAgdGhpcy5maWVsZHMgPSB0aGlzLmFzc2V0cy5maWVsZFRlbXBsYXRlLmZpZWxkczsKICAgICAgICAgIHRoaXMuYXNzZXRGaWVsZHMgPSB0aGlzLmFzc2V0cy5hc3NldEZpZWxkczsKICAgICAgICAgIHRoaXMubG9hZGVyRmxhZyA9IGZhbHNlOwogICAgICAgICAgZG9jdW1lbnQudGl0bGUgPSB0aGlzLmFzc2V0RGV0YWlsLmFzc2V0TnVtYmVyICsgIiB8ICIgKyAiRXJvaGFsIjsKICAgICAgICAgIHJlc3BvbnNlLmRhdGEuYXNzZXREZXRhaWwuYWN0aXZpdHlXYWxsLm1lc3NhZ2VzLm1hcCgoaXRlbSkgPT4gewogICAgICAgICAgICBpdGVtLmZpcnN0TmFtZSA9IGl0ZW0udXNlck5hbWU7CiAgICAgICAgICAgIGl0ZW0uaWQgPSBpdGVtLnV1aWQ7CiAgICAgICAgICAgIGl0ZW0ucmVwbGllcy5tYXAoKHJlcGx5SXRlbSkgPT4gewogICAgICAgICAgICAgIHJlcGx5SXRlbS5maXJzdE5hbWUgPSByZXBseUl0ZW0udXNlck5hbWU7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpdGVtLmF0dGFjaG1lbnRzID0gIiI7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICBmdWxsc2NyZWVuSW1hZ2UodmFsdWUpIHsKICAgICAgdGhpcy5wb3B1cEltYWdlID0gdmFsdWU7CiAgICAgIHRoaXMuaW1hZ2VEaWFsb2cgPSB0cnVlOwogICAgfSwKCiAgICByZW5kZXJJbWFnZSgpIHsKICAgICAgaWYgKHRoaXMuYXNzZXRzLmFzc2V0SW1hZ2VzLmxlbmd0aCAhPT0gMCkgewogICAgICAgIGxldCBpbWFnZVVybCA9IHRoaXMuYXNzZXRzLmFzc2V0SW1hZ2VzWzBdLmltYWdlVXJsOwogICAgICAgIEluc3BlY3Rpb25TZXJ2aWNlLmdldEZpbGUoaW1hZ2VVcmwpCiAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgbGV0IGltYWdlQ29udGVudCA9ICJkYXRhOmltYWdlL3BuZztiYXNlNjQsIiArIHJlc3BvbnNlLmRhdGEuY29udGVudDsKICAgICAgICAgICAgdGhpcy5wbGFjZWhvbGRlckltZyA9IGltYWdlQ29udGVudDsKICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICAgIGlmIChlcnJvci5yZXNwb25zZS5zdGF0dXMgPT09IDQwNikgewogICAgICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KCJBbiB1bmV4cGVjdGVkIEVycm9yIE9jY3VycmVkIiwgImVycm9yIik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy5zaG93VG9hc3QoIkFuIHVuZXhwZWN0ZWQgRXJyb3IgT2NjdXJyZWQiLCAiZXJyb3IiKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gdGhpcy5wbGFjZWhvbGRlckltZyA9cmVxdWlyZSgiLi4vLi4vYXNzZXRzL2ltYWdlcy9QbGFjZWhvbGRlci5wbmciKTsKICAgICAgfQogICAgfSwKCiAgICBnZXRQYWdpbmF0ZWRDb25zdW1wdGlvbnNCeUFzc2V0KCkgewogICAgICBBc3NldE1hbmFnZW1lbnRTZXJ2aWNlLmdldENvbnN1bXB0aW9uc0J5QXNzZXQoCiAgICAgICAgdGhpcy5hc3NldFV1aWQsCiAgICAgICAgdGhpcy5wYWdlLAogICAgICAgIHRoaXMucm93c1BlclBhZ2UKICAgICAgKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgdGhpcy5jb25zdW1wdGlvbnMgPSByZXNwb25zZS5kYXRhLmNvbnN1bXB0aW9uczsKICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgICBsZXQgY29uc3VtcHRpb25zID0gcmVzcG9uc2UuZGF0YS5jb25zdW1wdGlvbnMuY29udGVudDsKICAgICAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGNvbnN1bXB0aW9ucy5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgICAgICBjb25zdW1wdGlvbnNbaW5kZXhdLmNyZWF0ZWRBdCA9IG1vbWVudCgKICAgICAgICAgICAgICAgIGNvbnN1bXB0aW9uc1tpbmRleF0uY3JlYXRlZEF0CiAgICAgICAgICAgICAgKS5mb3JtYXQoIkREIE1NTSBZWVlZIGhoOm1tIGEiKTsKICAgICAgICAgICAgICBjb25zdW1wdGlvbnNbaW5kZXhdLmNvbnN1bXB0aW9uVW5pdCA9IHRoaXMuY29uc3VtcHRpb25Vbml0OwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnNob3dUb2FzdCgKICAgICAgICAgICAgICAiRXJyb3Igd2hpbGUgZ2V0dGluZyBjb25zdW1wdGlvbnMgb2YgYXNzZXQiLAogICAgICAgICAgICAgICJlcnJvciIKICAgICAgICAgICAgKTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgIC8vICAgdGhpcy5zZXRTdGF0ZSh7IGxvYWRpbmc6IGZhbHNlIH0pOwogICAgICAgICAgaWYgKGVycm9yLnJlc3BvbnNlICE9PSB1bmRlZmluZWQgJiYgZXJyb3IucmVzcG9uc2Uuc3RhdHVzID09PSA0MDYpIHsKICAgICAgICAgICAgdGhpcy5zaG93VG9hc3QoCiAgICAgICAgICAgICAgIkVycm9yIHdoaWxlIGdldHRpbmcgY29uc3VtcHRpb25zIG9mIGFzc2V0IiwKICAgICAgICAgICAgICAiZXJyb3IiCiAgICAgICAgICAgICk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnNob3dUb2FzdCgKICAgICAgICAgICAgICAiRXJyb3Igd2hpbGUgZ2V0dGluZyBjb25zdW1wdGlvbnMgb2YgYXNzZXQiLAogICAgICAgICAgICAgICJlcnJvciIKICAgICAgICAgICAgKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0sCgogICAgZ2V0UGFnaW5hdGVkVXNhZ2VzQnlBc3NldCgpIHsKICAgICAgQXNzZXRNYW5hZ2VtZW50U2VydmljZS5nZXRVc2FnZXNCeUFzc2V0KAogICAgICAgIHRoaXMuYXNzZXRVdWlkLAogICAgICAgIHRoaXMucGFnZSwKICAgICAgICB0aGlzLnJvd3NQZXJQYWdlCiAgICAgICkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIHRoaXMudXNhZ2VzID0gcmVzcG9uc2UuZGF0YS51c2FnZXM7CiAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgICAgbGV0IHVzYWdlcyA9IHJlc3BvbnNlLmRhdGEudXNhZ2VzLmNvbnRlbnQ7CiAgICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB1c2FnZXMubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICAgICAgdXNhZ2VzW2luZGV4XS5jcmVhdGVkQXQgPSBtb21lbnQodXNhZ2VzW2luZGV4XS5jcmVhdGVkQXQpLmZvcm1hdCgKICAgICAgICAgICAgICAgICJERCBNTU0gWVlZWSBoaDptbSBhIgogICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgdXNhZ2VzW2luZGV4XS5wcmltYXJ5VXNhZ2VUaW1lID0KICAgICAgICAgICAgICAgIHVzYWdlc1tpbmRleF0ucHJpbWFyeVVzYWdlVGltZSAhPT0gbnVsbAogICAgICAgICAgICAgICAgICA/IG1vbWVudCh1c2FnZXNbaW5kZXhdLnByaW1hcnlVc2FnZVRpbWUpLmZvcm1hdCgKICAgICAgICAgICAgICAgICAgICAgICJERCBNTU0gWVlZWSBoaDptbSBhIgogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgOiBudWxsOwogICAgICAgICAgICAgIHVzYWdlc1tpbmRleF0uc2Vjb25kYXJ5VXNhZ2VUaW1lID0KICAgICAgICAgICAgICAgIHVzYWdlc1tpbmRleF0uc2Vjb25kYXJ5VXNhZ2VUaW1lICE9PSBudWxsCiAgICAgICAgICAgICAgICAgID8gbW9tZW50KHVzYWdlc1tpbmRleF0uc2Vjb25kYXJ5VXNhZ2VUaW1lKS5mb3JtYXQoCiAgICAgICAgICAgICAgICAgICAgICAiREQgTU1NIFlZWVkgaGg6bW0gYSIKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgIDogbnVsbDsKICAgICAgICAgICAgICB1c2FnZXNbaW5kZXhdLnByaW1hcnlVc2FnZVVuaXQgPSB0aGlzLnByaW1hcnlVc2FnZVVuaXQ7CiAgICAgICAgICAgICAgdXNhZ2VzW2luZGV4XS5zZWNvbmRhcnlVc2FnZVVuaXQgPSB0aGlzLnNlY29uZGFyeVVzYWdlVW5pdDsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmNvdW50T2ZUb3RhbFVzYWdlcyA9IHJlc3BvbnNlLmRhdGEudXNhZ2VzLnRvdGFsRWxlbWVudHM7CiAgICAgICAgICAgIHRoaXMuZGF0YSA9IHVzYWdlczsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KCJFcnJvciB3aGlsZSBnZXR0aW5nIHVzYWdlcyBvZiBhc3NldCIsICJlcnJvciIpOwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlcnJvcikgPT4gewogICAgICAgICAgaWYgKGVycm9yKSB7CiAgICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KCJFcnJvciB3aGlsZSBnZXR0aW5nIHVzYWdlcyBvZiBhc3NldCIsICJlcnJvciIpOwogICAgICAgICAgfQogICAgICAgICAgLy8gICB0aGlzLnNldFN0YXRlKHsgbG9hZGluZzogZmFsc2UgfSk7CiAgICAgICAgfSk7CiAgICB9LAoKICAgIHVuQXNzaWduQXNzZXQoaW5kZXgsIHZhbHVlKSB7CiAgICAgIHRoaXMuYXNzaWduVGFibGVWYWx1ZSA9IHZhbHVlOwogICAgICB2YXIgY3VycmVudERhdGUgPSBtb21lbnQoKS5mb3JtYXQoKTsKICAgICAgaWYgKG1vbWVudCh2YWx1ZS5zdGFydERhdGUpLmZvcm1hdCgpID4gY3VycmVudERhdGUpIHsKICAgICAgICB0aGlzLmZ1dHVyZWRVbkFzc2lnbm1lbnQodmFsdWUuYXNzaWdubWVudElkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnZhbHVlRWRpdEFzc2lnbiA9IHZhbHVlOwogICAgICAgIHRoaXMuaW5kZXgrKzsKICAgICAgICB0aGlzLlNob3dVblBvcFVwID0gdHJ1ZTsKICAgICAgICB0aGlzLnVzZXJJbmRleCA9IGluZGV4OwogICAgICB9CiAgICB9LAoKICAgIHVuQXNzaWduVXNlcih2YWx1ZSkgewogICAgICAvLwl0aGlzLmxvYWRlckZsYWcgPSB0cnVlOwogICAgICB2YXIgY3VycmVudERhdGUgPSBtb21lbnQoKS5mb3JtYXQoKTsKICAgICAgdmFyIHNlbGVjdGVkRGF0ZSA9IG1vbWVudCh2YWx1ZS5hc3NpZ25tZW50RGF0ZSkuZm9ybWF0KAogICAgICAgICJZWVlZLU1NLUREVEhIOk1NOlNTWiIKICAgICAgKTsKICAgICAgdmFyIGRhdGVTcGxpdCA9IHNlbGVjdGVkRGF0ZS5zcGxpdCgiVCIpOwogICAgICB2YXIgb2JqRGF0ZSA9IGRhdGVTcGxpdFswXTsKICAgICAgdmFyIHRpbWVTcGxpdCA9IHZhbHVlLmFzc2lnbm1lbnRUaW1lLnNwbGl0KCI6Iik7CiAgICAgIHZhciBob3VyID0gdGltZVNwbGl0WzBdOwogICAgICB2YXIgbWluID0gdGltZVNwbGl0WzFdOwogICAgICB2YXIgYXNzaWdubWVudERhdGUgPSBvYmpEYXRlICsgIlQiICsgaG91ciArICI6IiArIG1pbiArICI6IiArICIwMCswNTowMCI7CiAgICAgIGlmICgKICAgICAgICBEYXRlLnBhcnNlKHRoaXMuYXNzaWduVGFibGVWYWx1ZS5zdGFydERhdGUpID4gRGF0ZS5wYXJzZShhc3NpZ25tZW50RGF0ZSkKICAgICAgKSB7CiAgICAgICAgdGhpcy5zaG93VG9hc3QoCiAgICAgICAgICAiU2VsZWN0IERhdGUgYW5kIHRpbWUgbGF0ZXIgdG8gY3VycmVudCBhc3NpZ25tZW50IGRhdGUgYW5kIHRpbWUuIiwKICAgICAgICAgICJzdWNjZXNzIgogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICh2YWx1ZS5jdXJyZW50RGF0ZVRpbWUgPT0gdHJ1ZSkgewogICAgICAgIGxldCBEZWxldGVBc3NpZ25tZW50UmVjb3JkUmVxdWVzdCA9IHsKICAgICAgICAgIGFzc2V0VVVJRDogdGhpcy5hc3NldFV1aWQsCiAgICAgICAgICB1c2VyVVVJRDogdmFsdWUudXVpZCwKICAgICAgICAgIGVuZGluZ0RhdGU6IGN1cnJlbnREYXRlLAogICAgICAgIH07CiAgICAgICAgQXNzZXRQZXJzb25uZWxTZXJ2aWNlLnVuYXNzaWduQXNzZXQoRGVsZXRlQXNzaWdubWVudFJlY29yZFJlcXVlc3QpLnRoZW4oCiAgICAgICAgICAocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxldCB1c2VycyA9IHRoaXMuYXNzaWduZWRVc2VyczsKICAgICAgICAgICAgbGV0IGhpc3RvcnlVc2VycyA9IHRoaXMuYXNzaWdubWVudEhpc3RvcnlVc2VyczsKICAgICAgICAgICAgbGV0IGhpc3RvcnlBZGRlZCA9IGZhbHNlOwogICAgICAgICAgICAvL3JldHVybjsKICAgICAgICAgICAgLy8JdGhpcy5kZWxldGVNb2RlbCA9IGZhbHNlOwogICAgICAgICAgICBoaXN0b3J5VXNlcnMubWFwKChoaXN0b3J5SXRlbSkgPT4gewogICAgICAgICAgICAgIGlmIChoaXN0b3J5SXRlbS51dWlkID09PSB2YWx1ZS51dWlkKSB7CiAgICAgICAgICAgICAgICBoaXN0b3J5SXRlbS51c2VyRW5kaW5nRGF0ZXM7CiAgICAgICAgICAgICAgICBoaXN0b3J5SXRlbS51c2VyU3RhcnREYXRlczsKICAgICAgICAgICAgICAgIGhpc3RvcnlBZGRlZCA9IHRydWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBoaXN0b3J5SXRlbTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAoIWhpc3RvcnlBZGRlZCkgewogICAgICAgICAgICAgIGxldCBuZXdVc2VyID0gewogICAgICAgICAgICAgICAgdXVpZDogdmFsdWUudXVpZCwKICAgICAgICAgICAgICAgIG5hbWU6IHVzZXJzW3RoaXMudXNlckluZGV4XS5uYW1lLAogICAgICAgICAgICAgICAgZHVyYXRpb25zOiB1c2Vyc1t0aGlzLnVzZXJJbmRleF0uZHVyYXRpb25zLAogICAgICAgICAgICAgICAgdXNlclN0YXJ0RGF0ZXM6IHVzZXJzW3RoaXMudXNlckluZGV4XS51c2VyU3RhcnREYXRlcywKICAgICAgICAgICAgICAgIHVzZXJFbmRpbmdEYXRlczogdXNlcnNbdGhpcy51c2VySW5kZXhdLnVzZXJFbmRpbmdEYXRlcywKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIC8vIGhpc3RvcnlVc2Vycy5wdXNoKG5ld1VzZXIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHVzZXJzLnNwbGljZSh0aGlzLnVzZXJJbmRleCwgMSk7CiAgICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KCJVc2VyIFVuLUFzc2lnbmVkIFN1Y2Nlc3NmdWxseSIsICJzdWNjZXNzIik7CiAgICAgICAgICAgIHRoaXMuZ2V0QXNzaWduZWRVc2Vyc09mQXNzZXQoKTsKICAgICAgICAgICAgdGhpcy5nZXRBc3NpZ25tZW50SGlzdG9yeUJ5QXNzZXQoKTsKICAgICAgICAgICAgdGhpcy5TaG93VW5Qb3BVcCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmxvYWRlckZsYWcgPSBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICApOwogICAgICB9IGVsc2UgaWYgKAogICAgICAgIHZhbHVlLmN1cnJlbnREYXRlVGltZSA9PSBmYWxzZSAmJgogICAgICAgIGN1cnJlbnREYXRlID4gbW9tZW50KHZhbHVlLmFzc2lnbm1lbnREYXRlKS5mb3JtYXQoKQogICAgICApIHsKICAgICAgICBzZWxlY3RlZERhdGUgPSBtb21lbnQodmFsdWUuYXNzaWdubWVudERhdGUpLmZvcm1hdCgKICAgICAgICAgICJZWVlZLU1NLUREVEhIOk1NOlNTWiIKICAgICAgICApOwogICAgICAgIGRhdGVTcGxpdCA9IHNlbGVjdGVkRGF0ZS5zcGxpdCgiVCIpOwogICAgICAgIG9iakRhdGUgPSBkYXRlU3BsaXRbMF07CiAgICAgICAgdGltZVNwbGl0ID0gdmFsdWUuYXNzaWdubWVudFRpbWUuc3BsaXQoIjoiKTsKICAgICAgICBob3VyID0gdGltZVNwbGl0WzBdOwogICAgICAgIG1pbiA9IHRpbWVTcGxpdFsxXTsKICAgICAgICBsZXQgYXNzaWdubWVudERhdGUgPQogICAgICAgICAgb2JqRGF0ZSArICJUIiArIGhvdXIgKyAiOiIgKyBtaW4gKyAiOiIgKyAiMDArMDU6MDAiOwogICAgICAgIGxldCBEZWxldGVBc3NpZ25tZW50UmVjb3JkUmVxdWVzdCA9IHsKICAgICAgICAgIGFzc2V0VVVJRDogdGhpcy5hc3NldFV1aWQsCiAgICAgICAgICB1c2VyVVVJRDogdmFsdWUudXVpZCwKICAgICAgICAgIGVuZGluZ0RhdGU6IG1vbWVudChhc3NpZ25tZW50RGF0ZSkuZm9ybWF0KCksCiAgICAgICAgfTsKICAgICAgICBBc3NldFBlcnNvbm5lbFNlcnZpY2UudW5hc3NpZ25Bc3NldChEZWxldGVBc3NpZ25tZW50UmVjb3JkUmVxdWVzdCkudGhlbigKICAgICAgICAgIChyZXNwb25zZSkgPT4gewogICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGV0IHVzZXJzID0gdGhpcy5hc3NpZ25lZFVzZXJzOwogICAgICAgICAgICBsZXQgaGlzdG9yeVVzZXJzID0gdGhpcy5hc3NpZ25tZW50SGlzdG9yeVVzZXJzOwogICAgICAgICAgICBsZXQgaGlzdG9yeUFkZGVkID0gZmFsc2U7CiAgICAgICAgICAgIGhpc3RvcnlVc2Vycy5tYXAoKGhpc3RvcnlJdGVtKSA9PiB7CiAgICAgICAgICAgICAgaWYgKGhpc3RvcnlJdGVtLnV1aWQgPT09IHZhbHVlLnV1aWQpIHsKICAgICAgICAgICAgICAgIGhpc3RvcnlJdGVtLnVzZXJFbmRpbmdEYXRlczsKICAgICAgICAgICAgICAgIGhpc3RvcnlJdGVtLnVzZXJTdGFydERhdGVzOwogICAgICAgICAgICAgICAgaGlzdG9yeUFkZGVkID0gdHJ1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIGhpc3RvcnlJdGVtOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmICghaGlzdG9yeUFkZGVkKSB7CiAgICAgICAgICAgICAgbGV0IG5ld1VzZXIgPSB7CiAgICAgICAgICAgICAgICB1dWlkOiB2YWx1ZS51dWlkLAogICAgICAgICAgICAgICAgbmFtZTogdXNlcnNbdGhpcy51c2VySW5kZXhdLm5hbWUsCiAgICAgICAgICAgICAgICBkdXJhdGlvbnM6IHVzZXJzW3RoaXMudXNlckluZGV4XS5kdXJhdGlvbnMsCiAgICAgICAgICAgICAgICB1c2VyU3RhcnREYXRlczogdXNlcnNbdGhpcy51c2VySW5kZXhdLnVzZXJTdGFydERhdGVzLAogICAgICAgICAgICAgICAgdXNlckVuZGluZ0RhdGVzOiB1c2Vyc1t0aGlzLnVzZXJJbmRleF0udXNlckVuZGluZ0RhdGVzLAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgaGlzdG9yeVVzZXJzLnB1c2gobmV3VXNlcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdXNlcnMuc3BsaWNlKHRoaXMudXNlckluZGV4LCAxKTsKICAgICAgICAgICAgdGhpcy5zaG93VG9hc3QoIlVzZXIgVW4tQXNzaWduZWQgU3VjY2Vzc2Z1bGx5IiwgInN1Y2Nlc3MiKTsKICAgICAgICAgICAgdGhpcy5nZXRBc3NpZ25lZFVzZXJzT2ZBc3NldCgpOwogICAgICAgICAgICB0aGlzLmdldEFzc2lnbm1lbnRIaXN0b3J5QnlBc3NldCgpOwogICAgICAgICAgICB0aGlzLlNob3dVblBvcFVwID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMubG9hZGVyRmxhZyA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgICk7CiAgICAgIH0gZWxzZSBpZiAoCiAgICAgICAgY3VycmVudERhdGUgPCBtb21lbnQodmFsdWUuYXNzaWdubWVudERhdGUpLmZvcm1hdCgpICYmCiAgICAgICAgdmFsdWUuY3VycmVudERhdGVUaW1lID09IGZhbHNlCiAgICAgICkgewogICAgICAgIHNlbGVjdGVkRGF0ZSA9IG1vbWVudCh2YWx1ZS5hc3NpZ25tZW50RGF0ZSkuZm9ybWF0KAogICAgICAgICAgIllZWVktTU0tRERUSEg6TU06U1NaIgogICAgICAgICk7CiAgICAgICAgZGF0ZVNwbGl0ID0gc2VsZWN0ZWREYXRlLnNwbGl0KCJUIik7CiAgICAgICAgb2JqRGF0ZSA9IGRhdGVTcGxpdFswXTsKICAgICAgICB0aW1lU3BsaXQgPSB2YWx1ZS5hc3NpZ25tZW50VGltZS5zcGxpdCgiOiIpOwogICAgICAgIGhvdXIgPSB0aW1lU3BsaXRbMF07CiAgICAgICAgbWluID0gdGltZVNwbGl0WzFdOwogICAgICAgIGxldCBhc3NpZ25tZW50RGF0ZSA9CiAgICAgICAgICBvYmpEYXRlICsgIlQiICsgaG91ciArICI6IiArIG1pbiArICI6IiArICIwMCswNTowMCI7CiAgICAgICAgdmFsdWUuc3RhcnREYXRlID0gYXNzaWdubWVudERhdGU7CiAgICAgICAgdGhpcy51bkFzc2lnbm1lbnRVc2VyTGF0ZXIodmFsdWUpOwogICAgICB9CiAgICB9LAoKICAgIHVuQXNzaWdubWVudFVzZXJMYXRlcih2YWx1ZSkgewogICAgICB0aGlzLmxvYWRlckZsYWcgPSB0cnVlOwogICAgICBJbnNwZWN0aW9uU2VydmljZS5nZXRJbnNwZWN0aW9uVGVtcGFsdGVzQnlBc3NldCh0aGlzLmFzc2V0VXVpZCkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgICBsZXQgcG9zdEFzc2lnbm1lbnQgPSBbXTsKICAgICAgICAgICAgbGV0IG9iaiA9IHsKICAgICAgICAgICAgICBhc3NpZ25tZW50VVVJRDogdmFsdWUuYXNzaWdubWVudFVVSUQsCiAgICAgICAgICAgICAgYXNzZXRJZDogdGhpcy5hc3NldFV1aWQsCiAgICAgICAgICAgICAgdXNlcklkOiB2YWx1ZS51dWlkLAogICAgICAgICAgICAgIGFzc2lnbjogZmFsc2UsCiAgICAgICAgICAgICAgZW5kRGF0ZTogdmFsdWUuc3RhcnREYXRlLAogICAgICAgICAgICB9OwogICAgICAgICAgICBwb3N0QXNzaWdubWVudC5wdXNoKG9iaik7CiAgICAgICAgICAgIGxldCBVcGRhdGVBc3NldEFzc2lnbm1lbnRSZXF1ZXN0ID0ge307CiAgICAgICAgICAgIFVwZGF0ZUFzc2V0QXNzaWdubWVudFJlcXVlc3QuaW5zcGVjdGlvblRlbXBsYXRlcyA9CiAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5pbnNwZWN0aW9uVGVtcGxhdGVzOwogICAgICAgICAgICBVcGRhdGVBc3NldEFzc2lnbm1lbnRSZXF1ZXN0LnBvc3RBc3NpZ25tZW50ID0gcG9zdEFzc2lnbm1lbnQ7CiAgICAgICAgICAgIEFzc2V0UGVyc29ubmVsU2VydmljZS5hZGRQb3N0QXNzaWdubWVudE9yVW5Bc3NpZ25tZW50KAogICAgICAgICAgICAgIFVwZGF0ZUFzc2V0QXNzaWdubWVudFJlcXVlc3QKICAgICAgICAgICAgKQogICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KHJlcy5kYXRhLmRlc2NyaXB0aW9uLCAic3VjY2VzcyIpOwogICAgICAgICAgICAgICAgdGhpcy5TaG93VW5Qb3BVcCA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5nZXRBc3NpZ25lZFVzZXJzT2ZBc3NldCgpOwogICAgICAgICAgICAgICAgdGhpcy5nZXRBc3NpZ25tZW50SGlzdG9yeUJ5QXNzZXQoKTsKICAgICAgICAgICAgICAgIHRoaXMubG9hZGVyRmxhZyA9IGZhbHNlOwogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgY29uc29sZS5sb2coImVycm9yIiwgZSk7CiAgICAgICAgfSk7CiAgICB9LAoKICAgIGFzc2lnblVzZXIodmFsdWUpIHsKICAgICAgaWYgKHRoaXMudmFsdWUgIT09IG51bGwpIHsKICAgICAgICB2YXIgc2VsZWN0ZWREYXRlID0gbW9tZW50KHZhbHVlLmFzc2lnbm1lbnREYXRlKS5mb3JtYXQoCiAgICAgICAgICAiWVlZWS1NTS1ERFRISDpNTTpTU1oiCiAgICAgICAgKTsKICAgICAgICB2YXIgZGF0ZVNwbGl0ID0gc2VsZWN0ZWREYXRlLnNwbGl0KCJUIik7CiAgICAgICAgdmFyIG9iakRhdGUgPSBkYXRlU3BsaXRbMF07CiAgICAgICAgdmFyIHRpbWVTcGxpdCA9IHZhbHVlLmFzc2lnbm1lbnRUaW1lLnNwbGl0KCI6Iik7CiAgICAgICAgdmFyIGhvdXIgPSB0aW1lU3BsaXRbMF07CiAgICAgICAgdmFyIG1pbiA9IHRpbWVTcGxpdFsxXTsKICAgICAgICBsZXQgYXNzaWdubWVudERhdGUgPQogICAgICAgICAgb2JqRGF0ZSArICJUIiArIGhvdXIgKyAiOiIgKyBtaW4gKyAiOiIgKyAiMDArMDU6MDAiOwogICAgICAgIC8vbGV0IGRhdGUgPSBEYXRlKCk7CiAgICAgICAgdmFyIGN1cnJlbnREYXRlID0gbW9tZW50KCkuZm9ybWF0KCk7CiAgICAgICAgaWYgKHZhbHVlLmN1cnJlbnREYXRlVGltZSA9PSB0cnVlKSB7CiAgICAgICAgICB2YWx1ZS5zdGFydERhdGUgPSBhc3NpZ25tZW50RGF0ZTsKICAgICAgICAgIHRoaXMuYXNzaWdubWVudFVzZXJDdXJyZW50RGF0ZSh2YWx1ZSk7CiAgICAgICAgfSBlbHNlIGlmICgKICAgICAgICAgIGFzc2lnbm1lbnREYXRlID4gY3VycmVudERhdGUgJiYKICAgICAgICAgIHZhbHVlLmN1cnJlbnREYXRlVGltZSA9PSBmYWxzZQogICAgICAgICkgewogICAgICAgICAgdmFsdWUuc3RhcnREYXRlID0gYXNzaWdubWVudERhdGU7CiAgICAgICAgICB0aGlzLmFzc2lnbm1lbnRVc2VyTGF0ZXIodmFsdWUpOwogICAgICAgIH0gZWxzZSBpZiAoYXNzaWdubWVudERhdGUgPCBjdXJyZW50RGF0ZSkgewogICAgICAgICAgdmFsdWUuc3RhcnREYXRlID0gYXNzaWdubWVudERhdGU7CiAgICAgICAgICB0aGlzLnBhc3RBc3NpZ25tZW50VXNlckN1cnJlbnREYXRlKHZhbHVlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgdW5hc3NpZ25Bc3NldChpbmRleCwgaWQpIHsKICAgICAgdGhpcy5sb2FkZXJGbGFnID0gdHJ1ZTsKICAgICAgdGhpcy51c2VySW5kZXggPSBpbmRleDsKICAgICAgQXNzZXRQZXJzb25uZWxTZXJ2aWNlLnVuYXNzaWduQXNzZXQodGhpcy5hc3NldFV1aWQsIGlkKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAgIC8vIGRlYnVnZ2VyOwogICAgICAgICAgICBsZXQgdXNlcnMgPSB0aGlzLmFzc2lnbmVkVXNlcnM7CiAgICAgICAgICAgIGxldCBoaXN0b3J5VXNlcnMgPSB0aGlzLmFzc2lnbm1lbnRIaXN0b3J5VXNlcnM7CiAgICAgICAgICAgIGxldCBoaXN0b3J5QWRkZWQgPSBmYWxzZTsKCiAgICAgICAgICAgIGhpc3RvcnlVc2Vycy5tYXAoKGhpc3RvcnlJdGVtKSA9PiB7CiAgICAgICAgICAgICAgaWYgKGhpc3RvcnlJdGVtLnV1aWQgPT09IGlkKSB7CiAgICAgICAgICAgICAgICBoaXN0b3J5SXRlbS51c2VyRW5kaW5nRGF0ZXMucHVzaCgKICAgICAgICAgICAgICAgICAgbW9tZW50KCkuZm9ybWF0KCJERCBNTU0gWVlZWSBoaDptbSBhIikKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBoaXN0b3J5QWRkZWQgPSB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gaGlzdG9yeUl0ZW07CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKCFoaXN0b3J5QWRkZWQpIHsKICAgICAgICAgICAgICBsZXQgbmV3VXNlciA9IHsKICAgICAgICAgICAgICAgIHV1aWQ6IGlkLAogICAgICAgICAgICAgICAgbmFtZTogdXNlcnNbdGhpcy51c2VySW5kZXhdLm5hbWUsCiAgICAgICAgICAgICAgICB1c2VyRW5kaW5nRGF0ZXM6IFttb21lbnQoKS5mb3JtYXQoIkREIE1NTSBZWVlZIGhoOm1tIGEiKV0sCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBoaXN0b3J5VXNlcnMucHVzaChuZXdVc2VyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB1c2Vycy5zcGxpY2UodGhpcy51c2VySW5kZXgsIDEpOwogICAgICAgICAgICB0aGlzLnNob3dUb2FzdCgiVXNlciBVbi1Bc3NpZ25lZCBTdWNjZXNzZnVsbHkiLCAic3VjY2VzcyIpOwogICAgICAgICAgICB0aGlzLmxvYWRlckZsYWcgPSBmYWxzZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KAogICAgICAgICAgICAgICJFcnJvciB3aGlsZSBVbi1Bc3NpZ25pbmcgdGhlIHVzZXIuIFBsZWFzZSB0cnkgYWdhaW4iLAogICAgICAgICAgICAgICJlcnJvciIKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIC8vIHRoaXMuc25hY2tCYXJSZWYuY3VycmVudC5zaG93U25hY2tCYXIoJ0Vycm9yIHdoaWxlIFVuLUFzc2lnbmluZyB0aGUgdXNlci4gUGxlYXNlIHRyeSBhZ2FpbicsJ2Vycm9yJyk7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICAvLyAgdGhpcy5zZXRTdGF0ZSh7IGxvYWRpbmc6IGZhbHNlfSk7CiAgICAgICAgICBpZiAoZXJyb3IucmVzcG9uc2Uuc3RhdHVzID09PSA0MDYpIHsKICAgICAgICAgICAgdGhpcy5zaG93VG9hc3QoCiAgICAgICAgICAgICAgIkVycm9yIHdoaWxlIFVuLUFzc2lnbmluZyB0aGUgdXNlci4gUGxlYXNlIHRyeSBhZ2FpbiIsCiAgICAgICAgICAgICAgImVycm9yIgogICAgICAgICAgICApOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5zaG93VG9hc3QoCiAgICAgICAgICAgICAgIkVycm9yIHdoaWxlIFVuLUFzc2lnbmluZyB0aGUgdXNlci4gUGxlYXNlIHRyeSBhZ2FpbiIsCiAgICAgICAgICAgICAgImVycm9yIgogICAgICAgICAgICApOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKCiAgICBwYXN0QXNzaWdubWVudFVzZXJDdXJyZW50RGF0ZSh2YWx1ZSkgewogICAgICB0aGlzLmxvYWRlckZsYWcgPSB0cnVlOwogICAgICBJbnNwZWN0aW9uU2VydmljZS5nZXRJbnNwZWN0aW9uVGVtcGFsdGVzQnlBc3NldCh0aGlzLmFzc2V0VXVpZCkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgICAvLwlkZWJ1Z2dlcgogICAgICAgICAgICBsZXQgYXNzaWdubWVudFJlY29yZCA9IFtdOwogICAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdmFsdWUudXNlci5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgICAgICBjb25zdCB1c2VySWQgPSB2YWx1ZS51c2VyW2luZGV4XS51dWlkOwogICAgICAgICAgICAgIGxldCBvYmogPSB7CiAgICAgICAgICAgICAgICBhc3NldElkOiB0aGlzLmFzc2V0VXVpZCwKICAgICAgICAgICAgICAgIGFzc2V0TWFuYWdlcklkOiB1c2VySWQsCiAgICAgICAgICAgICAgICB0eXBlOiAiIiwKICAgICAgICAgICAgICAgIHN0YXJ0ZWRBdDogdmFsdWUuc3RhcnREYXRlLAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgYXNzaWdubWVudFJlY29yZC5wdXNoKG9iaik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGV0IGFkZEFzc2V0QXNzaWdubWVudFJlcXVlc3QgPSB7fTsKICAgICAgICAgICAgYWRkQXNzZXRBc3NpZ25tZW50UmVxdWVzdC5pbnNwZWN0aW9uVGVtcGxhdGVzID0KICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmluc3BlY3Rpb25UZW1wbGF0ZXM7CiAgICAgICAgICAgIGFkZEFzc2V0QXNzaWdubWVudFJlcXVlc3QuYXNzaWdubWVudFJlY29yZCA9IGFzc2lnbm1lbnRSZWNvcmQ7CiAgICAgICAgICAgIC8vCXJldHVybjsKICAgICAgICAgICAgQXNzZXRQZXJzb25uZWxTZXJ2aWNlLmFkZEFzc2lnbm1lbnRSZWNvcmQoYWRkQXNzZXRBc3NpZ25tZW50UmVxdWVzdCkKICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UxKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UxLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuc2VuZE5vdGlmaWNhdGlvblRvQXNzaWduZWRVc2VyT2ZBc3NldHMoCiAgICAgICAgICAgICAgICAgICAgYWRkQXNzZXRBc3NpZ25tZW50UmVxdWVzdAogICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICBsZXQgdXNlcmRldGFpbCA9IFtdOwogICAgICAgICAgICAgICAgICBBc3NldFBlcnNvbm5lbFNlcnZpY2UuZ2V0VXNlckRldGFpbEJ5QXNzZXRJZEFuZFVzZXJJZCgKICAgICAgICAgICAgICAgICAgICB0aGlzLmFzc2V0VXVpZCwKICAgICAgICAgICAgICAgICAgICB2YWx1ZS52YWx1ZQogICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlMikgPT4gewogICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlMi5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICB1c2VyZGV0YWlsLnV1aWQgPSB2YWx1ZS52YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgdXNlcmRldGFpbC5uYW1lID0gdmFsdWUuZGlzcGxheTsKICAgICAgICAgICAgICAgICAgICAgICAgdXNlcmRldGFpbC5zdGFydERhdGUgPSByZXNwb25zZTIuZGF0YS51c2VyLnN0YXJ0RGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgdXNlcmRldGFpbC5jb3VudCA9IHJlc3BvbnNlMi5kYXRhLnVzZXIuY291bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXNzaWduZWRVc2Vycy5wdXNoKHVzZXJkZXRhaWwpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dUb2FzdCgKICAgICAgICAgICAgICAgICAgICAgICAgICAiQXNzZXQgQXNzaWduZWQgdG8gdXNlciBTdWNjZXNzZnVsbHkiLAogICAgICAgICAgICAgICAgICAgICAgICAgICJzdWNjZXNzIgogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldEFzc2lnbmVkVXNlcnNPZkFzc2V0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZGVyRmxhZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLlNob3dQb3BVcCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93VG9hc3QoCiAgICAgICAgICAgICAgICAgICAgICAgICAgIkVycm9yIHdoaWxlIGFzc2lnbmluZyB1c2VyIHRvIHRoZSBhc3NldCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgImVycm9yIgogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKChlcnJvcjIpID0+IHsKICAgICAgICAgICAgICAgICAgICAgIC8vICAgdGhpcy5zZXRTdGF0ZSh7bG9hZGluZzpmYWxzZX0pOwogICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yMi5yZXNwb25zZS5zdGF0dXMgPT09IDQwNikgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dUb2FzdCgKICAgICAgICAgICAgICAgICAgICAgICAgICAiRXJyb3Igd2hpbGUgYXNzaWduaW5nIHVzZXIgdG8gdGhlIGFzc2V0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAiZXJyb3IiCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dUb2FzdCgKICAgICAgICAgICAgICAgICAgICAgICAgICAiRXJyb3Igd2hpbGUgYXNzaWduaW5nIHVzZXIgdG8gdGhlIGFzc2V0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAiZXJyb3IiCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAuY2F0Y2goKGVycm9yMSkgPT4gewogICAgICAgICAgICAgICAgLy8gdGhpcy5zZXRTdGF0ZSh7bG9hZGluZzpmYWxzZX0pOwogICAgICAgICAgICAgICAgaWYgKGVycm9yMS5yZXNwb25zZS5zdGF0dXMgPT09IDQwNikgewogICAgICAgICAgICAgICAgICB0aGlzLnNob3dUb2FzdCgKICAgICAgICAgICAgICAgICAgICAiRXJyb3Igd2hpbGUgYXNzaWduaW5nIHVzZXIgdG8gdGhlIGFzc2V0IiwKICAgICAgICAgICAgICAgICAgICAiZXJyb3IiCiAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB0aGlzLnNob3dUb2FzdCgKICAgICAgICAgICAgICAgICAgICAiRXJyb3Igd2hpbGUgYXNzaWduaW5nIHVzZXIgdG8gdGhlIGFzc2V0IiwKICAgICAgICAgICAgICAgICAgICAiZXJyb3IiCiAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICBpZiAoZXJyb3IpIHsKICAgICAgICAgICAgdGhpcy5zaG93VG9hc3QoIkVycm9yIHdoaWxlIGFzc2lnbmluZyB1c2VyIHRvIHRoZSBhc3NldCIsICJlcnJvciIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5zaG93VG9hc3QoIkVycm9yIHdoaWxlIGFzc2lnbmluZyB1c2VyIHRvIHRoZSBhc3NldCIsICJlcnJvciIpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKCiAgICBzZW5kTm90aWZpY2F0aW9uVG9Bc3NpZ25lZFVzZXJPZkFzc2V0cyhhZGRBc3NldEFzc2lnbm1lbnRSZXF1ZXN0KSB7CiAgICAgIEFzc2V0UGVyc29ubmVsU2VydmljZS5zZW5kTm90aWZpY2F0aW9uVG9Bc3NpZ25lZFVzZXJzKAogICAgICAgIGFkZEFzc2V0QXNzaWdubWVudFJlcXVlc3QKICAgICAgKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTsKICAgICAgICB9KTsKICAgIH0sCgogICAgYXNzaWdubWVudFVzZXJDdXJyZW50RGF0ZSh2YWx1ZSkgewogICAgICB0aGlzLmxvYWRlckZsYWcgPSB0cnVlOwogICAgICBJbnNwZWN0aW9uU2VydmljZS5nZXRJbnNwZWN0aW9uVGVtcGFsdGVzQnlBc3NldCh0aGlzLmFzc2V0VXVpZCkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIHZhciBjdXJyZW50RGF0ZSA9IG1vbWVudCgpLmZvcm1hdCgpOwogICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAgIC8vCWRlYnVnZ2VyCiAgICAgICAgICAgIGxldCBhc3NpZ25tZW50UmVjb3JkID0gW107CiAgICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB2YWx1ZS51c2VyLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgICAgIGNvbnN0IHVzZXJJZCA9IHZhbHVlLnVzZXJbaW5kZXhdLnV1aWQ7CiAgICAgICAgICAgICAgbGV0IG9iaiA9IHsKICAgICAgICAgICAgICAgIGFzc2V0SWQ6IHRoaXMuYXNzZXRVdWlkLAogICAgICAgICAgICAgICAgYXNzZXRNYW5hZ2VySWQ6IHVzZXJJZCwKICAgICAgICAgICAgICAgIHR5cGU6ICIiLAogICAgICAgICAgICAgICAgc3RhcnRlZEF0OiBjdXJyZW50RGF0ZSwKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIGFzc2lnbm1lbnRSZWNvcmQucHVzaChvYmopOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxldCBhZGRBc3NldEFzc2lnbm1lbnRSZXF1ZXN0ID0ge307CiAgICAgICAgICAgIGFkZEFzc2V0QXNzaWdubWVudFJlcXVlc3QuaW5zcGVjdGlvblRlbXBsYXRlcyA9CiAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5pbnNwZWN0aW9uVGVtcGxhdGVzOwogICAgICAgICAgICBhZGRBc3NldEFzc2lnbm1lbnRSZXF1ZXN0LmFzc2lnbm1lbnRSZWNvcmQgPSBhc3NpZ25tZW50UmVjb3JkOwogICAgICAgICAgICAvL3JldHVybjsKICAgICAgICAgICAgQXNzZXRQZXJzb25uZWxTZXJ2aWNlLmFkZEFzc2lnbm1lbnRSZWNvcmQoYWRkQXNzZXRBc3NpZ25tZW50UmVxdWVzdCkKICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UxKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UxLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuc2VuZE5vdGlmaWNhdGlvblRvQXNzaWduZWRVc2VyT2ZBc3NldHMoCiAgICAgICAgICAgICAgICAgICAgYWRkQXNzZXRBc3NpZ25tZW50UmVxdWVzdAogICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICBsZXQgdXNlcmRldGFpbCA9IFtdOwogICAgICAgICAgICAgICAgICBBc3NldFBlcnNvbm5lbFNlcnZpY2UuZ2V0VXNlckRldGFpbEJ5QXNzZXRJZEFuZFVzZXJJZCgKICAgICAgICAgICAgICAgICAgICB0aGlzLmFzc2V0VXVpZCwKICAgICAgICAgICAgICAgICAgICB2YWx1ZS52YWx1ZQogICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlMikgPT4gewogICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlMi5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICB1c2VyZGV0YWlsLnV1aWQgPSB2YWx1ZS52YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgdXNlcmRldGFpbC5uYW1lID0gdmFsdWUuZGlzcGxheTsKICAgICAgICAgICAgICAgICAgICAgICAgdXNlcmRldGFpbC5zdGFydERhdGUgPSByZXNwb25zZTIuZGF0YS51c2VyLnN0YXJ0RGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgdXNlcmRldGFpbC5jb3VudCA9IHJlc3BvbnNlMi5kYXRhLnVzZXIuY291bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXNzaWduZWRVc2Vycy5wdXNoKHVzZXJkZXRhaWwpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dUb2FzdCgKICAgICAgICAgICAgICAgICAgICAgICAgICAiQXNzZXQgQXNzaWduZWQgdG8gdXNlciBTdWNjZXNzZnVsbHkiLAogICAgICAgICAgICAgICAgICAgICAgICAgICJzdWNjZXNzIgogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldEFzc2lnbmVkVXNlcnNPZkFzc2V0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuU2hvd1BvcFVwID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZGVyRmxhZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93VG9hc3QoCiAgICAgICAgICAgICAgICAgICAgICAgICAgIkVycm9yIHdoaWxlIGFzc2lnbmluZyB1c2VyIHRvIHRoZSBhc3NldCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgImVycm9yIgogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKChlcnJvcjIpID0+IHsKICAgICAgICAgICAgICAgICAgICAgIC8vICAgdGhpcy5zZXRTdGF0ZSh7bG9hZGluZzpmYWxzZX0pOwogICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yMi5yZXNwb25zZS5zdGF0dXMgPT09IDQwNikgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dUb2FzdCgKICAgICAgICAgICAgICAgICAgICAgICAgICAiRXJyb3Igd2hpbGUgYXNzaWduaW5nIHVzZXIgdG8gdGhlIGFzc2V0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAiZXJyb3IiCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dUb2FzdCgKICAgICAgICAgICAgICAgICAgICAgICAgICAiRXJyb3Igd2hpbGUgYXNzaWduaW5nIHVzZXIgdG8gdGhlIGFzc2V0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAiZXJyb3IiCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAuY2F0Y2goKGVycm9yMSkgPT4gewogICAgICAgICAgICAgICAgLy8gdGhpcy5zZXRTdGF0ZSh7bG9hZGluZzpmYWxzZX0pOwogICAgICAgICAgICAgICAgaWYgKGVycm9yMS5yZXNwb25zZS5zdGF0dXMgPT09IDQwNikgewogICAgICAgICAgICAgICAgICB0aGlzLnNob3dUb2FzdCgKICAgICAgICAgICAgICAgICAgICAiRXJyb3Igd2hpbGUgYXNzaWduaW5nIHVzZXIgdG8gdGhlIGFzc2V0IiwKICAgICAgICAgICAgICAgICAgICAiZXJyb3IiCiAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB0aGlzLnNob3dUb2FzdCgKICAgICAgICAgICAgICAgICAgICAiRXJyb3Igd2hpbGUgYXNzaWduaW5nIHVzZXIgdG8gdGhlIGFzc2V0IiwKICAgICAgICAgICAgICAgICAgICAiZXJyb3IiCiAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICBpZiAoZXJyb3IpIHsKICAgICAgICAgICAgdGhpcy5zaG93VG9hc3QoIkVycm9yIHdoaWxlIGFzc2lnbmluZyB1c2VyIHRvIHRoZSBhc3NldCIsICJlcnJvciIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5zaG93VG9hc3QoIkVycm9yIHdoaWxlIGFzc2lnbmluZyB1c2VyIHRvIHRoZSBhc3NldCIsICJlcnJvciIpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKCiAgICBhc3NpZ25tZW50VXNlckxhdGVyKHZhbHVlKSB7CiAgICAgIHRoaXMubG9hZGVyRmxhZyA9IHRydWU7CiAgICAgIEluc3BlY3Rpb25TZXJ2aWNlLmdldEluc3BlY3Rpb25UZW1wYWx0ZXNCeUFzc2V0KHRoaXMuYXNzZXRVdWlkKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAgIGxldCBwb3N0QXNzaWdubWVudCA9IFtdOwogICAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdmFsdWUudXNlci5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgICAgICBjb25zdCB1c2VySWQgPSB2YWx1ZS51c2VyW2luZGV4XS51dWlkOwogICAgICAgICAgICAgIGxldCBvYmogPSB7CiAgICAgICAgICAgICAgICBhc3NpZ25tZW50VVVJRDogIiIsCiAgICAgICAgICAgICAgICBhc3NldElkOiB0aGlzLmFzc2V0VXVpZCwKICAgICAgICAgICAgICAgIHVzZXJJZDogdXNlcklkLAogICAgICAgICAgICAgICAgYXNzaWduOiB0cnVlLAogICAgICAgICAgICAgICAgc3RhcnREYXRlOiB2YWx1ZS5zdGFydERhdGUsCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBwb3N0QXNzaWdubWVudC5wdXNoKG9iaik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGV0IFVwZGF0ZUFzc2V0QXNzaWdubWVudFJlcXVlc3QgPSB7fTsKICAgICAgICAgICAgVXBkYXRlQXNzZXRBc3NpZ25tZW50UmVxdWVzdC5pbnNwZWN0aW9uVGVtcGxhdGVzID0KICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmluc3BlY3Rpb25UZW1wbGF0ZXM7CiAgICAgICAgICAgIFVwZGF0ZUFzc2V0QXNzaWdubWVudFJlcXVlc3QucG9zdEFzc2lnbm1lbnQgPSBwb3N0QXNzaWdubWVudDsKICAgICAgICAgICAgLy8JcmV0dXJuOwogICAgICAgICAgICBBc3NldFBlcnNvbm5lbFNlcnZpY2UuYWRkUG9zdEFzc2lnbm1lbnRPclVuQXNzaWdubWVudCgKICAgICAgICAgICAgICBVcGRhdGVBc3NldEFzc2lnbm1lbnRSZXF1ZXN0CiAgICAgICAgICAgICkKICAgICAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLnNob3dUb2FzdChyZXMuZGF0YS5kZXNjcmlwdGlvbiwgInN1Y2Nlc3MiKTsKICAgICAgICAgICAgICAgIHRoaXMuU2hvd1BvcFVwID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRlckZsYWcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRoaXMuZ2V0QXNzaWduZWRVc2Vyc09mQXNzZXQoKTsKICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKCJlcnJvciIsIGUpOwogICAgICAgIH0pOwogICAgfSwKICAgIHVwZGF0ZUFzc2lnblVzZXIodmFsdWUpIHsKICAgICAgdGhpcy5sb2FkZXJGbGFnID0gdHJ1ZTsKICAgICAgdmFyIHNlbGVjdGVkRGF0ZSA9IG1vbWVudCh2YWx1ZS5hc3NpZ25tZW50RGF0ZSkuZm9ybWF0KAogICAgICAgICJZWVlZLU1NLUREVEhIOk1NOlNTWiIKICAgICAgKTsKICAgICAgdmFyIGRhdGVTcGxpdCA9IHNlbGVjdGVkRGF0ZS5zcGxpdCgiVCIpOwogICAgICB2YXIgb2JqRGF0ZSA9IGRhdGVTcGxpdFswXTsKICAgICAgdmFyIHRpbWVTcGxpdCA9IHZhbHVlLmFzc2lnbm1lbnRUaW1lLnNwbGl0KCI6Iik7CiAgICAgIHZhciBob3VyID0gdGltZVNwbGl0WzBdOwogICAgICB2YXIgbWluID0gdGltZVNwbGl0WzFdOwogICAgICBsZXQgYXNzaWdubWVudERhdGUgPSBvYmpEYXRlICsgIlQiICsgaG91ciArICI6IiArIG1pbiArICI6IiArICIwMCswNTowMCI7CiAgICAgIHZhbHVlLnN0YXJ0RGF0ZSA9IGFzc2lnbm1lbnREYXRlOwogICAgICB0aGlzLnVwZGF0ZUN1cnJlbnRBc3NpZ25tZW50KHZhbHVlKTsKICAgIH0sCiAgICB1cGRhdGVDdXJyZW50QXNzaWdubWVudCh2YWx1ZSkgewogICAgICBpZiAodmFsdWUudXNlci5sZW5ndGggPiAxKSB7CiAgICAgICAgdGhpcy5zaG93VG9hc3QoIlNlbGVjdCBvbmx5IG9uZSB1c2VyIiwgImVycm9yIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIEluc3BlY3Rpb25TZXJ2aWNlLmdldEluc3BlY3Rpb25UZW1wYWx0ZXNCeUFzc2V0KHRoaXMuYXNzZXRVdWlkKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PSAyMDApIHsKICAgICAgICAgICAgbGV0IFVwZGF0ZUFzc2V0QXNzaWdubWVudFJlcXVlc3QgPSB7CiAgICAgICAgICAgICAgYXNzaWdubWVudElkOiB2YWx1ZS5hc3NpZ25tZW50SWQsCiAgICAgICAgICAgICAgYXNzZXRJZDogdGhpcy5hc3NldFV1aWQsCiAgICAgICAgICAgICAgdXNlcklkOiB2YWx1ZS51c2VyWzBdLnV1aWQsCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIC8vbGV0IGRhdGUgPSBEYXRlKCk7CiAgICAgICAgICAgIHZhciBjdXJyZW50RGF0ZSA9IG1vbWVudCgpLmZvcm1hdCgpOwogICAgICAgICAgICBpZiAodmFsdWUuY3VycmVudERhdGVUaW1lID09IHRydWUpIHsKICAgICAgICAgICAgICBVcGRhdGVBc3NldEFzc2lnbm1lbnRSZXF1ZXN0LnN0YXJ0RGF0ZSA9IGN1cnJlbnREYXRlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIFVwZGF0ZUFzc2V0QXNzaWdubWVudFJlcXVlc3Quc3RhcnREYXRlID0gdmFsdWUuc3RhcnREYXRlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBBc3NldFBlcnNvbm5lbFNlcnZpY2UuZWRpdEFzc2lnbm1lbnRSZWNvcmQoCiAgICAgICAgICAgICAgVXBkYXRlQXNzZXRBc3NpZ25tZW50UmVxdWVzdAogICAgICAgICAgICApCiAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlMSkgPT4gewogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlMS5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICBkZWJ1Z2dlcgogICAgICAgICAgICAgICAgICB0aGlzLnNob3dUb2FzdCgiVXNlciBVcGRhdGUgc3VjY2Vzc2Z1bGx5IiwgInN1Y2Nlc3MiKTsKICAgICAgICAgICAgICAgICAgdGhpcy5nZXRBc3NpZ25lZFVzZXJzT2ZBc3NldCgpOwogICAgICAgICAgICAgICAgICB0aGlzLlNob3dQb3BVcCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICB0aGlzLmxvYWRlckZsYWcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgIC5jYXRjaCgoZXJyb3IxKSA9PiB7CiAgICAgICAgICAgICAgICAvLyB0aGlzLnNldFN0YXRlKHtsb2FkaW5nOmZhbHNlfSk7CiAgICAgICAgICAgICAgICBpZiAoZXJyb3IxLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA2KSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KAogICAgICAgICAgICAgICAgICAgICJFcnJvciB3aGlsZSBhc3NpZ25pbmcgdXNlciB0byB0aGUgYXNzZXQiLAogICAgICAgICAgICAgICAgICAgICJlcnJvciIKICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KAogICAgICAgICAgICAgICAgICAgICJFcnJvciB3aGlsZSBhc3NpZ25pbmcgdXNlciB0byB0aGUgYXNzZXQiLAogICAgICAgICAgICAgICAgICAgICJlcnJvciIKICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgIGlmIChlcnJvcikgewogICAgICAgICAgICB0aGlzLnNob3dUb2FzdCgiRXJyb3Igd2hpbGUgYXNzaWduaW5nIHVzZXIgdG8gdGhlIGFzc2V0IiwgImVycm9yIik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnNob3dUb2FzdCgiRXJyb3Igd2hpbGUgYXNzaWduaW5nIHVzZXIgdG8gdGhlIGFzc2V0IiwgImVycm9yIik7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9LAogICAgZnV0dXJlZFVuQXNzaWdubWVudCh1dWlkKSB7CiAgICAgIHRoaXMubG9hZGVyRmxhZyA9IHRydWU7CiAgICAgIEFzc2V0UGVyc29ubmVsU2VydmljZS5kZWxldGVQb3N0QXNzaWdubWVudEJ5VVVJRCh1dWlkKQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KHJlcy5kYXRhLmRlc2NyaXB0aW9uLCAic3VjY2VzcyIpOwogICAgICAgICAgdGhpcy5nZXRBc3NpZ25lZFVzZXJzT2ZBc3NldCgpOwogICAgICAgICAgdGhpcy5sb2FkZXJGbGFnID0gZmFsc2U7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgIH0pOwogICAgfSwKICAgIGVkaXRBc3NpZ25lZChpbmRleCwgdmFsKSB7CiAgICAgIHRoaXMuU2hvd1BvcFVwID0gdHJ1ZTsKICAgICAgdGhpcy52YWx1ZUVkaXRBc3NpZ24gPSB2YWw7CiAgICAgIHRoaXMuaW5kZXgrKzsKICAgIH0sCiAgICBzZWxlY3RVc2VyKCkgewogICAgICBsZXQgY3VycmVudFVzZXJEZXRhaWxzID0gSlNPTi5wYXJzZSgKICAgICAgICBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiY3VycmVudFVzZXJEZXRhaWxzIikKICAgICAgKTsKICAgICAgQXNzZXRQZXJzb25uZWxTZXJ2aWNlLmdldEFsbFVzZXJzKAogICAgICAgIGN1cnJlbnRVc2VyRGV0YWlscy5wcm9maWxlLm9yZ2FuaXphdGlvbklkCiAgICAgICkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIGxldCB1c2VycyA9IFtdOwogICAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHJlc3BvbnNlLmRhdGEudXNlcnMubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICAgIGxldCB1c2VyID0ge307CiAgICAgICAgICAgIHVzZXIubGFiZWwgPSByZXNwb25zZS5kYXRhLnVzZXJzW2luZGV4XS5uYW1lOwogICAgICAgICAgICB1c2VyLnZhbHVlID0gcmVzcG9uc2UuZGF0YS51c2Vyc1tpbmRleF0ubmFtZTsKICAgICAgICAgICAgdXNlci51dWlkID0gcmVzcG9uc2UuZGF0YS51c2Vyc1tpbmRleF0udXVpZDsKICAgICAgICAgICAgdXNlci5uYW1lID0gcmVzcG9uc2UuZGF0YS51c2Vyc1tpbmRleF0ubmFtZTsKICAgICAgICAgICAgdXNlcnMucHVzaCh1c2VyKTsKICAgICAgICAgICAgdGhpcy5hbGxVc2Vycy5wdXNoKHsKICAgICAgICAgICAgICBmaXJzdE5hbWU6IHJlc3BvbnNlLmRhdGEudXNlcnNbaW5kZXhdLmZpcnN0TmFtZSwKICAgICAgICAgICAgICBsYXN0TmFtZTogcmVzcG9uc2UuZGF0YS51c2Vyc1tpbmRleF0ubGFzdE5hbWUsCiAgICAgICAgICAgICAgcHJvZmlsZUltYWdlOiByZXNwb25zZS5kYXRhLnVzZXJzW2luZGV4XS5pbWFnZVVybCwKICAgICAgICAgICAgICB1dWlkOiByZXNwb25zZS5kYXRhLnVzZXJzW2luZGV4XS51dWlkLAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuVXNlcnMgPSB1c2VyczsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgfSk7CiAgICB9LAogICAgZ2V0QXNzaWduZWRVc2Vyc09mQXNzZXQoKSB7CiAgICAgIEFzc2V0UGVyc29ubmVsU2VydmljZS5nZXRBc3NpZ25lZFVzZXJzT2ZBc3NldCh0aGlzLmFzc2V0VXVpZCkKICAgICAgICAudGhlbigocmVzcG9uc2UxKSA9PiB7CiAgICAgICAgICBpZiAocmVzcG9uc2UxLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAgIGxldCB1c2VycyA9IFtdOwogICAgICAgICAgICBmb3IgKAogICAgICAgICAgICAgIGxldCBpbmRleCA9IDA7CiAgICAgICAgICAgICAgaW5kZXggPCByZXNwb25zZTEuZGF0YS5kZXRhaWxzLmxlbmd0aDsKICAgICAgICAgICAgICBpbmRleCsrCiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIGxldCBvYmogPSB7fTsKICAgICAgICAgICAgICBvYmoubmFtZSA9IHJlc3BvbnNlMS5kYXRhLmRldGFpbHNbaW5kZXhdLm5hbWU7CiAgICAgICAgICAgICAgb2JqLmNvdW50ID0gcmVzcG9uc2UxLmRhdGEuZGV0YWlsc1tpbmRleF0uY291bnQ7CiAgICAgICAgICAgICAgb2JqLnN0YXR1cyA9IHJlc3BvbnNlMS5kYXRhLmRldGFpbHNbaW5kZXhdLnN0YXR1czsKICAgICAgICAgICAgICBvYmouc3RhcnREYXRlID0gbW9tZW50KAogICAgICAgICAgICAgICAgcmVzcG9uc2UxLmRhdGEuZGV0YWlsc1tpbmRleF0uc3RhcnREYXRlCiAgICAgICAgICAgICAgKS5mb3JtYXQoIkREIE1NTSBZWVlZIGhoOm1tIGEiKTsKICAgICAgICAgICAgICBvYmoudXVpZCA9IHJlc3BvbnNlMS5kYXRhLmRldGFpbHNbaW5kZXhdLnV1aWQ7CiAgICAgICAgICAgICAgb2JqLnVzZXJFbmRpbmdEYXRlcyA9CiAgICAgICAgICAgICAgICByZXNwb25zZTEuZGF0YS5kZXRhaWxzW2luZGV4XS51c2VyRW5kaW5nRGF0ZXM7CiAgICAgICAgICAgICAgb2JqLmFzc2lnbm1lbnRJZCA9IHJlc3BvbnNlMS5kYXRhLmRldGFpbHNbaW5kZXhdLmFzc2lnbm1lbnRJZDsKICAgICAgICAgICAgICB1c2Vycy5wdXNoKG9iaik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5hc3NpZ25lZFVzZXJzID0gdXNlcnM7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICBpZiAoZXJyb3IucmVzcG9uc2Uuc3RhdHVzID09PSA0MDYpIHsKICAgICAgICAgICAgdGhpcy5zaG93VG9hc3QoIkFuIHVuZXhwZWN0ZWQgRXJyb3IgT2NjdXJyZWQiLCAiZXJyb3IiKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KAogICAgICAgICAgICAgICJFcnJvciBPY2N1cnJlZCB3aGlsZSBnZXR0aW5nIEFzc2V0IEFzc2lnbm1lbnQiLAogICAgICAgICAgICAgICJlcnJvciIKICAgICAgICAgICAgKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0sCiAgICBnZXRBc3NpZ25tZW50SGlzdG9yeUJ5QXNzZXQoKSB7CiAgICAgIEFzc2V0UGVyc29ubmVsU2VydmljZS5nZXRBc3NpZ25tZW50SGlzdG9yeUJ5QXNzZXQoCiAgICAgICAgdGhpcy5hc3NldFV1aWQsCiAgICAgICAgdGhpcy5wYWdlLAogICAgICAgIHRoaXMucm93c1BlclBhZ2UKICAgICAgKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAgIGxldCB1c2VycyA9IFtdOwogICAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgcmVzcG9uc2UuZGF0YS5kZXRhaWxzLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgICAgIGxldCBvYmogPSB7fTsKICAgICAgICAgICAgICBvYmoubmFtZSA9IHJlc3BvbnNlLmRhdGEuZGV0YWlsc1tpbmRleF0ubmFtZTsKICAgICAgICAgICAgICBvYmouY291bnQgPSByZXNwb25zZS5kYXRhLmRldGFpbHNbaW5kZXhdLmNvdW50OwogICAgICAgICAgICAgIG9iai51c2VyU3RhcnREYXRlcyA9IG1vbWVudCgKICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZGV0YWlsc1tpbmRleF0uc3RhcnREYXRlCiAgICAgICAgICAgICAgKS5mb3JtYXQoIkREIE1NTSBZWVlZIGhoOm1tIGEiKTsKICAgICAgICAgICAgICBvYmoudXNlckVuZGluZ0RhdGVzID0gbW9tZW50KAogICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5kZXRhaWxzW2luZGV4XS5lbmREYXRlCiAgICAgICAgICAgICAgKS5mb3JtYXQoIkREIE1NTSBZWVlZIGhoOm1tIGEiKTsKICAgICAgICAgICAgICBvYmoudXVpZCA9IHJlc3BvbnNlLmRhdGEuZGV0YWlsc1tpbmRleF0udXVpZDsKICAgICAgICAgICAgICBvYmouZHVyYXRpb25zID0gcmVzcG9uc2UuZGF0YS5kZXRhaWxzW2luZGV4XS5kdXJhdGlvbjsKICAgICAgICAgICAgICAvLyBvYmouc3RhdHVzID0gcmVzcG9uc2UuZGF0YS5kZXRhaWxzW2luZGV4XS5zdGF0dXM7CiAgICAgICAgICAgICAgdXNlcnMucHVzaChvYmopOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuYXNzaWdubWVudEhpc3RvcnlVc2VycyA9IHVzZXJzOwogICAgICAgICAgICB0aGlzLmFzc2lnbm1lbnRIaXN0b3J5VXNlcnMudG90YWxQYWdlcyA9IHJlc3BvbnNlLmRhdGEudG90YWxQYWdlczsKICAgICAgICAgICAgdGhpcy5hc3NpZ25tZW50SGlzdG9yeVVzZXJzLnRvdGFsRWxlbWVudHMgPQogICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEudG90YWxFbGVtZW50czsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgIGlmIChlcnJvci5yZXNwb25zZS5zdGF0dXMgPT09IDQwNikgewogICAgICAgICAgICB0aGlzLnNob3dUb2FzdCgiT3BwcyBpdHMgbG9vayBsaWtlIG91ciBzZXJ2ZXIgaXMgb2ZmbGluZSIsICJlcnJvciIpOwogICAgICAgICAgfQogICAgICAgICAgLy8gICB0aGlzLnNldFN0YXRlKHsgbG9hZGluZzogZmFsc2V9KTsKICAgICAgICAgIGVsc2UgewogICAgICAgICAgICB0aGlzLnNob3dUb2FzdCgiT3BwcyBpdHMgbG9vayBsaWtlIG91ciBzZXJ2ZXIgaXMgb2ZmbGluZSIsICJlcnJvciIpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKICAgIGRlbGV0ZUFzc2V0SW1hZ2UoaWQpIHsKICAgICAgQXNzZXRNYW5hZ2VtZW50U2VydmljZS5kZWxldGVBc3NldEltYWdlKGlkKQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMuZ2V0QXNzZXRJbWFnZXMoKTsKICAgICAgICAgIHRoaXMuc2hvd1RvYXN0KCJJbWFnZXMgZGVsZXRlZCBzdWNjZXNzZnVsbHkiLCAic3VjY2VzcyIpOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICB9KTsKICAgIH0sCiAgICBnZXRNYWludGFpbmFuY2VDb3N0KGFzc2V0SWQpIHsKICAgICAgewogICAgICAgIFdvcmtPcmRlclNlcnZpY2UuZ2V0QXNzZXRNYWludGVuYW5jZUNvc3RCeUFzc2V0VVVJRChhc3NldElkKQogICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICB0aGlzLmNvc3QgPSByZXMuZGF0YS5tYWludGVuYW5jZUNvc3Q7CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCgogICAgc2hvd1RvYXN0KG1lc3NhZ2UsIHR5cGUpIHsKICAgICAgdGhpcy50b2FzdE1lc3NhZ2UgPSBtZXNzYWdlOwogICAgICB0aGlzLnRvYXN0VHlwZSA9IHR5cGU7CiAgICAgIHRoaXMudG9hc3RGbGFnKys7CiAgICB9LAogIH0sCiAgbW91bnRlZCgpIHt9LAogIGNyZWF0ZWQoKSB7CiAgICB0aGlzLmxvYWRlckZsYWcgPSB0cnVlOwogICAgdGhpcy5hc3NldFV1aWQgPSB0aGlzLiRyb3V0ZS5wYXJhbXMuYXNzZXRJRDsKICAgIHRoaXMuZ2V0TWFpbnRhaW5hbmNlQ29zdCh0aGlzLmFzc2V0VXVpZCk7CiAgICB0aGlzLkFzc2V0c0RldGFpbHMoKTsKICAgIHRoaXMuZ2V0UGFnaW5hdGVkQ29uc3VtcHRpb25zQnlBc3NldCgpOwogICAgdGhpcy5nZXRQYWdpbmF0ZWRVc2FnZXNCeUFzc2V0KCk7CiAgICB0aGlzLnNlbGVjdFVzZXIoKTsKICAgIHRoaXMuZ2V0QXNzaWduZWRVc2Vyc09mQXNzZXQoKTsKICAgIHRoaXMuZ2V0QXNzaWdubWVudEhpc3RvcnlCeUFzc2V0KCk7CiAgICB0aGlzLmdldEFzc2V0UmVsYXRlZElzc3VlKCk7CiAgICB0aGlzLmdldEN1cnJlbmN5KCk7CiAgICB0aGlzLmdldEFzc2V0V29ya09yZGVycygpOwogICAgLy8JdGhpcy5nZXRNYWludGFpbmFuY2VDb3N0KHRoaXMuYXNzZXRVdWlkKTsKICB9LAogIGNvbXB1dGVkOiB7fSwKfTsK"},null]}